/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
 * This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
var Model={ADMINDBID:"000000000000000000000000",META:"000000000000000000000001",FORM:"000000000000000000000002",VIEW:"000000000000000000000003",PAGE:"000000000000000000000004",TASK:"000000000000000000000005",USER:"000000000000000000000006",OU:"000000000000000000000007",GROUP:"000000000000000000000008",ROLE:"000000000000000000000009",SIDE_VIEW:"00000000000000000000000a",ACTION:"00000000000000000000000b",VALIDATE_METHOD:"00000000000000000000000c",CATEGORY:"00000000000000000000000e",DATABASE:"00000000000000000000000f",META_ROOT:"0000000000000000000e0001",FORM_ROOT:"0000000000000000000e0002",VIEW_ROOT:"0000000000000000000e0003",PAGE_ROOT:"0000000000000000000e0004",TASK_ROOT:"0000000000000000000e0005",OU_ROOT:"0000000000000000000e0007",GROUP_ROOT:"0000000000000000000e0008",ROLE_ROOT:"0000000000000000000e0009",SIDE_VIEW_ROOT:"0000000000000000000e000a",ACTION_ROOT:"0000000000000000000e000b",DATABASE_ROOT:"0000000000000000000e000f",types:{},forms:{},views:{},pages:{},sideViews:{},typeId:function(a){if(a==this.META_ROOT){return this.META}else{if(a==this.FORM_ROOT){return this.FORM}else{if(a==this.VIEW_ROOT){return this.VIEW}else{if(a==this.PAGE_ROOT){return this.PAGE}else{if(a==this.TASK_ROOT){return this.TASK}else{if(a==this.OU_ROOT){return this.OU}else{if(a==this.GROUP_ROOT){return this.GROUP}else{if(a==this.ROLE_ROOT){return this.ROLE}else{if(a==this.SIDE_VIEW_ROOT){return this.SIDE_VIEW}else{if(a==this.ACTION_ROOT){return this.ACTION}else{if(a==this.DATABASE_ROOT){return this.DATABASE}}}}}}}}}}}},typeName:function(a){if(a==this.META){return"Meta"}else{if(a==this.FORM){return"Form"}else{if(a==this.VIEW){return"View"}else{if(a==this.PAGE){return"Page"}else{if(a==this.TASK){return"Task"}else{if(a==this.USER){return"User"}else{if(a==this.OU){return"Organization Unit"}else{if(a==this.GROUP){return"Group"}else{if(a==this.ROLE){return"Role"}else{if(a==this.SIDE_VIEW){return"Side View"}else{if(a==this.CATEGORY){return"Category"}else{if(a==this.ACTION){return"Action"}else{if(a==this.DATABASE){return"Database"}}}}}}}}}}}}}},rootId:function(a){if(a==this.META){return this.META_ROOT}else{if(a==this.FORM){return this.FORM_ROOT}else{if(a==this.VIEW){return this.VIEW_ROOT}else{if(a==this.PAGE){return this.PAGE_ROOT}else{if(a==this.TASK){return this.TASK_ROOT}else{if(a==this.OU||a==this.USER){return this.OU_ROOT}else{if(a==this.GROUP){return this.GROUP_ROOT}else{if(a==this.ROLE){return this.ROLE_ROOT}else{if(a==this.SIDE_VIEW){return this.SIDE_VIEW_ROOT}else{if(a==this.ACTION){return this.ACTION_ROOT}else{if(a==this.DATABASE){return this.DATABASE_ROOT}}}}}}}}}}}},getForms:function(h,b,j){var k=this,e={$or:[]},a=[],c;for(var i in b){c=this.forms[b[i]];if(c){a.push(c)}else{e.$or.push({_id:b[i]})}}function g(s,f){var r=[];if(f.length>0){for(var q in s){for(var p in f){if(f[p]._id==s[q]){r.push(f[p]);k.forms[f[p]._id]=f[p];break}}}}return r}if(e.$or.length>0){$.ans.getDoc(h,null,{selector:e},function(f,p){j(f,g(b,a.concat(p.docs)))})}else{j(null,g(b,a))}},loadToolbarActions:function(a,c){var b={type:Model.ACTION,$or:[]};$.each(["toolbarHeader","toolbarMiddle","toolbarTail"],function(){b.$or.push({extendPoint:this})});$.ans.getDoc(a,null,{selector:b},function(e,f){var g=null;if(f){g={toolbarHeaderActions:[],toolbarMiddleActions:[],toolbarTailActions:[]};$.each(f.docs,function(){g[this.extendPoint+"Actions"].push(this)})}c(e,g)})},newDocument:function(f,e,g,h){h=h||{};h.isNew=true;var c=this,b=Model.rootId(g),i=$.extend(true,{},h["default"],{_id:h.id||new ObjectId().toString(),type:g});if(i._path){i._path=i._path.replace(/[^,]+,$/,i._id+",")}else{if(b){i._path=b+","+i._id+","}}function a(j){if(j.type==c.FORM||j.type==c.PAGE){j.content=j.content||"";c._doOpenForm(f,e,j,$.extend(true,{mode:"design"},h))}else{if(j.type==c.VIEW){j.viewType=h.viewType;c._doOpenView(f,e,j,$.extend(true,{mode:"design"},h))}else{c._doOpenDocument(f,e,j,$.extend(true,{mode:"edit"},h))}}}if($.type(h.parent)=="string"){$.ans.getDoc(e,h.parent,null,function(j,k){if(j){console.log("Get parent document "+h.parent+" error:"+j)}else{if(k&&k._path){i._path=k._path+i._id+","}a(i)}})}else{if(h.parent&&h.parent._path){i._path=h.parent._path+i._id+","}a(i)}},_doOpenDocument:function(element,dbId,doc,opts){var optsx=$.extend(true,{title:opts.title||doc.title||doc.name||doc._id,dbId:dbId,document:doc,isDocumentEditor:true},opts),self=this;if(optsx.formIds){this.getForms(dbId,optsx.formIds,function(err,forms){if(err){console.log("Load forms "+optsx.formIds+" error: "+err)}else{optsx.forms=forms;element.editor(optsx);optsx.opened&&optsx.opened(element.data("editor"))}})}else{var type=this.types[doc.type];function openEditor(type){if(optsx.isNew){var obj=type.defaultValues||"{}";$.extend(true,optsx.document,eval("("+obj+")"))}self.getForms(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{optsx.forms=forms;element.editor(optsx);opts.opened&&opts.opened(element.data("editor"))}})}if(type){openEditor(type)}else{$.ans.getDoc(dbId,doc.type,null,function(err,type){if(err||!type){console.log("Load document type "+doc.type+" error: "+err)}else{self.types[doc.type]=type;openEditor(type)}})}}},openDocument:function(e,b,c,f){f=f||{};var a=this;if(!c&&f.document){this._doOpenDocument(e,b,f.document,f)}else{$.ans.getDoc(b,c,null,function(g,h){if(g){console.log("Load document "+c+" error: "+g)}else{a._doOpenDocument(e,b,h,f)}})}},_doOpenForm:function(element,dbId,form,opts){var self=this,title=opts.title||form.title||form.name||form._id,type=this.types[form.type];function openEditor(type){if(opts.mode&&(opts.mode!="design")){var doc={};if(opts.isNew){$.extend(true,doc,eval("("+type.defaultValues+")"||"{}"))}if(form.type==Model.FORM){element.editor($.extend(true,{title:title,dbId:dbId,document:doc,forms:[form]},opts));opts.opened&&opts.opened(element.data("editor"))}else{if(form.type==Model.PAGE){element.page($.extend(true,{title:title,dbId:dbId,form:form},opts));opts.opened&&opts.opened(element.data("page"))}}}else{self.getForms(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{element.editor($.extend(true,{title:title,dbId:dbId,document:form,forms:forms,design:true,isFormEditor:true},$.extend(true,{},opts,{mode:"edit"})));opts.opened&&opts.opened(element.data("editor"))}})}}if(type){openEditor(type)}else{$.ans.getDoc(dbId,form.type,null,function(err,type){if(err){console.log("Load document type "+form.type+" error: "+err)}else{self.types[form.type]=type;openEditor(type)}})}},openForm:function(c,b,f,e){e=e||{};var a=this;if(this.forms[f]){this._doOpenForm(c,b,this.forms[f],e)}else{$.ans.getDoc(b,f,null,function(h,g){if(h){console.log("Load form "+f+" error: "+h)}else{a.forms[f]=g;a._doOpenForm(c,b,g,e)}})}},_doOpenView:function(element,dbId,view,opts){var self=this;function openView(element,dbId,viewDoc,opts){var title=viewDoc.title||viewDoc.name||viewDoc._id,vt=viewDoc.viewType||"gridview";vt=vt.toLowerCase();if(opts.mode=="design"){function openEditor(type){if(opts.isNew){$.extend(true,viewDoc,eval("("+type.defaultValues+")"||"{}"))}self.getForms(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{element.editor($.extend(true,{title:title,dbId:dbId,document:viewDoc,forms:forms,design:true,isViewEditor:true},$.extend(true,{},opts,{mode:"edit"})));opts.opened&&opts.opened(element.data("editor"))}})}var type=self.types[viewDoc.type];if(type){openEditor(type)}else{$.ans.getDoc(dbId,viewDoc.type,null,function(err,type){if(err){console.log("Load document type "+viewDoc.type+" error: "+err)}else{self.types[viewDoc.type]=type;openEditor(type)}})}}else{element[vt]($.extend(true,{title:title,dbId:dbId,view:viewDoc,isViewEditor:true},opts));opts.opened&&opts.opened(element.data(vt))}}if(view.viewType=="formView"){var form=this.forms[view.formId];if(form){opts.form=form;openView(element,dbId,view,opts)}else{$.ans.getDoc(dbId,view.formId,null,function(err,form){if(err){console.log("Load form "+view.formId+" error: "+err)}else{opts.form=self.forms[view.formId]=form;openView(element,dbId,view,opts)}})}}else{openView(element,dbId,view,opts)}},openView:function(f,e,a,g){g=g||{};var c=this,b=this.views[a];if(b){this._doOpenView(f,e,b,g)}else{$.ans.getDoc(e,a,null,function(i,h){if(i){console.log("Load view "+a+" error: "+i)}else{c.views[a]=h;c._doOpenView(f,e,h,g)}})}},_doOpenSideView:function(c,b,a,e){if(a&&a.category=="treeView"){c.sideview($.extend(true,{dbId:b},a,e));e.opened&&e.opened(c.data("sideview"))}else{if(a&&a.category=="outline"){c.outline($.extend(true,a,e));e.opened&&e.opened(c.data("outline"))}}},openSideView:function(e,c,f,g){g=g||{};var b=this,a=this.sideViews[f];if(a){this._doOpenSideView(e,c,a,g)}else{$.ans.getDoc(c,f,null,function(i,h){if(i){console.log("Load side view "+f+" error: "+i)}else{b.sideViews[f]=h;b._doOpenSideView(e,c,h,g)}})}},postDocument:function(a,c,b,e){$.ans.postDoc(a,c,b,e)},updateDocument:function(b,c,a,e,f){this._cleanCache(c);$.ans.putDoc(b,c,a,e,f)},deleteDocument:function(a,c,b,e){this._cleanCache(c);$.ans.delDoc(a,c,b,e)},_cleanCache:function(a){delete this.types[a];delete this.forms[a];delete this.views[a];delete this.pages[a];delete this.sideViews[a]}};function DocWrapper(doc,parseDot){this._doc=doc;this._parseDot=parseDot;this.setDoc=function(doc){var oldDoc=this._doc;this._doc=doc;$(this).trigger("docchanged",[doc,oldDoc])};this.getDoc=function(){return this._doc};this.prop=function(id,value,isTransient){if(!id){return null}if(value===undefined){try{return eval("this._doc."+id)}catch(e){}}else{var oldValue=this.prop(id);if(value==oldValue){return this}if(this._parseDot){var parts=id.split(".");function assign(doc,parts,val){var part=parts.shift(),r=part.match(/([a-zA-Z0-9_]+)\[([0-9]+)\]/);if(r){doc[r[1]]=doc[r[1]]||[];if(parts.length>0){doc[r[1]][r[2]]=doc[r[1]][r[2]]||{};assign(doc[r[1]][r[2]],parts,val)}else{doc[r[1]][r[2]]=val}}else{if(parts.length>0){doc[part]=doc[part]||{};assign(doc[part],parts,val)}else{doc[part]=val}}}assign(this._doc,parts,value)}else{this._doc[id]=value}$(this).trigger("propchanged",[id,value,oldValue,isTransient])}}}
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
function emptyEqual(b,a){if(b===null&&a===null){return 1}else{if(b===null||a===null){return -1}}if(b===undefined&&a===undefined){return 1}else{if(b===undefined||a===undefined){return -1}}if(b===""&&a===""){return 1}else{if(b===""||a===""){return -1}}return 0}function isBothObject(b,a){if(typeof b==="object"&&typeof a==="object"){return 0}else{if(typeof b==="object"||typeof a==="object"){return -1}}return 1}function equals(e,b){var c=0;var a=true;c=emptyEqual(e,b);if(c==1){return true}else{if(c==-1){return false}}c=isBothObject(e,b);if(c==-1){return false}if(c==1){if(e===b){return true}else{return false}}else{for(var f in e){var g=arguments.callee(e[f],b[f]);if(!g){a=false;break}}for(var f in b){var g=arguments.callee(b[f],e[f]);if(!g){a=false;break}}}return a}function attributes(e){var b={},a=e.attributes;for(var c=0;c<a.length;c++){if(a[c].name!="metadata"){b[a[c].name]=a[c].value}}return b}function print(a){var b=$("body").children("iframe#printer");if(b.length==0){b=$("<iframe id='printer'>").hide().appendTo("body")}b.attr("src",a)}function showDialog(e,c,b){b=b||{};var a=[];$.each(b.buttons||[],function(){var f=this;a.push({text:f.text,click:function(){f.handler&&f.handler($(this).data("dialog"))}})});if(a.length==0){a.push({text:"OK",click:function(){$(this).dialog("close")}})}$("<div/>").dialog({title:e,height:220,width:360,modal:true,create:function(f,g){$(this).html(c)},buttons:a,close:function(g,f){$(this).remove()}})}function openDialog(a,e,b,c){$("<div/>").dialog($.extend(true,{height:220,width:360,modal:true,create:function(f,g){Model[c]($(this),a,e,b)},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}],close:function(g,f){$(this).remove()}},b))}function newDocument(a,b,c){openDialog(a,b,c,"newDocument")}function openDocument(a,b,c){openDialog(a,b,c,"openDocument")}var openForm,openView,openPage,openSideView;openForm=openView=openPage=openSideView=function(b,a,c){openDialog(b,a,c,"openForm")};var hexcase=0;function hex_md5(b){return rstr2hex(rstr_md5(str2rstr_utf8(b)))}function hex_hmac_md5(e,c){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(c)))}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(b){return binl2rstr(binl_md5(rstr2binl(b),b.length*8))}function rstr_hmac_md5(r,k){var p=rstr2binl(r);if(p.length>16){p=binl_md5(p,r.length*8)}var i=Array(16),q=Array(16);for(var h=0;h<16;h++){i[h]=p[h]^909522486;q[h]=p[h]^1549556828}var j=binl_md5(i.concat(rstr2binl(k)),512+k.length*8);return binl2rstr(binl_md5(q.concat(j),512+128))}function rstr2hex(p){try{hexcase}catch(i){hexcase=0}var j=hexcase?"0123456789ABCDEF":"0123456789abcdef";var e="";var h;for(var k=0;k<p.length;k++){h=p.charCodeAt(k);e+=j.charAt((h>>>4)&15)+j.charAt(h&15)}return e}function str2rstr_utf8(j){var f="";var i=-1;var g,h;while(++i<j.length){g=j.charCodeAt(i);h=i+1<j.length?j.charCodeAt(i+1):0;if(55296<=g&&g<=56319&&56320<=h&&h<=57343){g=65536+((g&1023)<<10)+(h&1023);i++}if(g<=127){f+=String.fromCharCode(g)}else{if(g<=2047){f+=String.fromCharCode(192|((g>>>6)&31),128|(g&63))}else{if(g<=65535){f+=String.fromCharCode(224|((g>>>12)&15),128|((g>>>6)&63),128|(g&63))}else{if(g<=2097151){f+=String.fromCharCode(240|((g>>>18)&7),128|((g>>>12)&63),128|((g>>>6)&63),128|(g&63))}}}}}return f}function rstr2binl(e){var f=Array(e.length>>2);for(var g=0;g<f.length;g++){f[g]=0}for(var g=0;g<e.length*8;g+=8){f[g>>5]|=(e.charCodeAt(g/8)&255)<<(g%32)}return f}function binl2rstr(e){var f="";for(var g=0;g<e.length*32;g+=8){f+=String.fromCharCode((e[g>>5]>>>(g%32))&255)}return f}function binl_md5(a,r){a[r>>5]|=128<<((r)%32);a[(((r+64)>>>9)<<4)+14]=r;var b=1732584193;var c=-271733879;var i=-1732584194;var q=271733878;for(var u=0;u<a.length;u+=16){var s=b;var t=c;var v=i;var w=q;b=md5_ff(b,c,i,q,a[u+0],7,-680876936);q=md5_ff(q,b,c,i,a[u+1],12,-389564586);i=md5_ff(i,q,b,c,a[u+2],17,606105819);c=md5_ff(c,i,q,b,a[u+3],22,-1044525330);b=md5_ff(b,c,i,q,a[u+4],7,-176418897);q=md5_ff(q,b,c,i,a[u+5],12,1200080426);i=md5_ff(i,q,b,c,a[u+6],17,-1473231341);c=md5_ff(c,i,q,b,a[u+7],22,-45705983);b=md5_ff(b,c,i,q,a[u+8],7,1770035416);q=md5_ff(q,b,c,i,a[u+9],12,-1958414417);i=md5_ff(i,q,b,c,a[u+10],17,-42063);c=md5_ff(c,i,q,b,a[u+11],22,-1990404162);b=md5_ff(b,c,i,q,a[u+12],7,1804603682);q=md5_ff(q,b,c,i,a[u+13],12,-40341101);i=md5_ff(i,q,b,c,a[u+14],17,-1502002290);c=md5_ff(c,i,q,b,a[u+15],22,1236535329);b=md5_gg(b,c,i,q,a[u+1],5,-165796510);q=md5_gg(q,b,c,i,a[u+6],9,-1069501632);i=md5_gg(i,q,b,c,a[u+11],14,643717713);c=md5_gg(c,i,q,b,a[u+0],20,-373897302);b=md5_gg(b,c,i,q,a[u+5],5,-701558691);q=md5_gg(q,b,c,i,a[u+10],9,38016083);i=md5_gg(i,q,b,c,a[u+15],14,-660478335);c=md5_gg(c,i,q,b,a[u+4],20,-405537848);b=md5_gg(b,c,i,q,a[u+9],5,568446438);q=md5_gg(q,b,c,i,a[u+14],9,-1019803690);i=md5_gg(i,q,b,c,a[u+3],14,-187363961);c=md5_gg(c,i,q,b,a[u+8],20,1163531501);b=md5_gg(b,c,i,q,a[u+13],5,-1444681467);q=md5_gg(q,b,c,i,a[u+2],9,-51403784);i=md5_gg(i,q,b,c,a[u+7],14,1735328473);c=md5_gg(c,i,q,b,a[u+12],20,-1926607734);b=md5_hh(b,c,i,q,a[u+5],4,-378558);q=md5_hh(q,b,c,i,a[u+8],11,-2022574463);i=md5_hh(i,q,b,c,a[u+11],16,1839030562);c=md5_hh(c,i,q,b,a[u+14],23,-35309556);b=md5_hh(b,c,i,q,a[u+1],4,-1530992060);q=md5_hh(q,b,c,i,a[u+4],11,1272893353);i=md5_hh(i,q,b,c,a[u+7],16,-155497632);c=md5_hh(c,i,q,b,a[u+10],23,-1094730640);b=md5_hh(b,c,i,q,a[u+13],4,681279174);q=md5_hh(q,b,c,i,a[u+0],11,-358537222);i=md5_hh(i,q,b,c,a[u+3],16,-722521979);c=md5_hh(c,i,q,b,a[u+6],23,76029189);b=md5_hh(b,c,i,q,a[u+9],4,-640364487);q=md5_hh(q,b,c,i,a[u+12],11,-421815835);i=md5_hh(i,q,b,c,a[u+15],16,530742520);c=md5_hh(c,i,q,b,a[u+2],23,-995338651);b=md5_ii(b,c,i,q,a[u+0],6,-198630844);q=md5_ii(q,b,c,i,a[u+7],10,1126891415);i=md5_ii(i,q,b,c,a[u+14],15,-1416354905);c=md5_ii(c,i,q,b,a[u+5],21,-57434055);b=md5_ii(b,c,i,q,a[u+12],6,1700485571);q=md5_ii(q,b,c,i,a[u+3],10,-1894986606);i=md5_ii(i,q,b,c,a[u+10],15,-1051523);c=md5_ii(c,i,q,b,a[u+1],21,-2054922799);b=md5_ii(b,c,i,q,a[u+8],6,1873313359);q=md5_ii(q,b,c,i,a[u+15],10,-30611744);i=md5_ii(i,q,b,c,a[u+6],15,-1560198380);c=md5_ii(c,i,q,b,a[u+13],21,1309151649);b=md5_ii(b,c,i,q,a[u+4],6,-145523070);q=md5_ii(q,b,c,i,a[u+11],10,-1120210379);i=md5_ii(i,q,b,c,a[u+2],15,718787259);c=md5_ii(c,i,q,b,a[u+9],21,-343485551);b=safe_add(b,s);c=safe_add(c,t);i=safe_add(i,v);q=safe_add(q,w)}return Array(b,c,i,q)}function md5_cmn(a,j,k,p,b,i){return safe_add(bit_rol(safe_add(safe_add(j,a),safe_add(p,i)),b),k)}function md5_ff(q,r,a,b,s,c,p){return md5_cmn((r&a)|((~r)&b),q,r,s,c,p)}function md5_gg(q,r,a,b,s,c,p){return md5_cmn((r&b)|(a&(~b)),q,r,s,c,p)}function md5_hh(q,r,a,b,s,c,p){return md5_cmn(r^a^b,q,r,s,c,p)}function md5_ii(q,r,a,b,s,c,p){return md5_cmn(a^(r|(~b)),q,r,s,c,p)}function safe_add(f,g){var h=(f&65535)+(g&65535);var e=(f>>16)+(g>>16)+(h>>16);return(e<<16)|(h&65535)}function bit_rol(e,c){return(e<<c)|(e>>>(32-c))}function md5(a){return hex_md5(a)}var ObjectId=(function(){var a=0;var b=Math.floor(Math.random()*(32767));var h=Math.floor(Math.random()*(16777216));if(localStorage&&typeof(localStorage)!="undefined"){var g=parseInt(localStorage.mongoMachineId);if(g>=0&&g<=16777215){h=Math.floor(localStorage.mongoMachineId)}localStorage.mongoMachineId=h;document.cookie="mongoMachineId="+h+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var c=document.cookie.split("; ");for(var f in c){var e=c[f].split("=");if(e[0]=="mongoMachineId"&&e[1]>=0&&e[1]<=16777215){h=e[1];break}}document.cookie="mongoMachineId="+h+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return function(){if(!(this instanceof ObjectId)){return new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}if(typeof(arguments[0])=="object"){this.timestamp=arguments[0].timestamp;this.machine=arguments[0].machine;this.pid=arguments[0].pid;this.increment=arguments[0].increment}else{if(typeof(arguments[0])=="string"&&arguments[0].length==24){this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))}else{if(arguments.length==4&&arguments[0]!=null){this.timestamp=arguments[0];this.machine=arguments[1];this.pid=arguments[2];this.increment=arguments[3]}else{this.timestamp=Math.floor(new Date().valueOf()/1000);this.machine=h;this.pid=b;if(a>16777215){a=0}this.increment=a++}}}}})();ObjectId.prototype.getDate=function(){return new Date(this.timestamp*1000)};ObjectId.prototype.toString=function(){var e=this.timestamp.toString(16);var c=this.machine.toString(16);var b=this.pid.toString(16);var a=this.increment.toString(16);return"00000000".substr(0,6-e.length)+e+"000000".substr(0,6-c.length)+c+"0000".substr(0,4-b.length)+b+"000000".substr(0,6-a.length)+a};
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(f){f.ans=f.ans||{};function i(u,r,q){var p=u.getResponseHeader("content-type")||"",k=r==="xml"||!r&&p.indexOf("xml")>=0,t=k?u.responseXML:u.responseText;if(k&&t.documentElement.nodeName==="parsererror"){jQuery.error("parsererror")}if(q&&q.dataFilter){t=q.dataFilter(t,r)}if(typeof t==="string"){if(r==="json"||!r&&p.indexOf("json")>=0){t=jQuery.parseJSON(t)}else{if(r==="script"||!r&&p.indexOf("javascript")>=0){jQuery.globalEval(t)}}}return t}function c(k,q){if(typeof hex_sha1=="undefined"){alert("creating a user doc requires sha1.js to be loaded in the page");return}var p="org.notesdb.user:";k._id=k._id||p+k.name;if(q){k.salt=f.notes.newUUID();k.password_sha=hex_sha1(q+k.salt)}k.type="user";if(!k.roles){k.roles=[]}return k}function g(q){var p=[];if(typeof(q)==="object"&&q!==null){for(var k in q){var r=q[k];if(typeof(r==="object")){r=j(r)}p.push(encodeURIComponent(k)+"="+encodeURIComponent(r))}}return p.length?"?"+p.join("&"):""}function j(k){return k!==null?JSON.stringify(k):null}function h(p,q,k){f.ajax(f.extend(true,{type:"GET",url:p,cache:!(f.browser.msie),dataType:"json",complete:function(t){var u=i(t,"json"),s,r;if(t.status==200){r=u}else{s={status:t.status,error:u.error,reason:u.reason}}q(s,r)}},k))}function a(k,p,q){f.ajax({type:"POST",url:k,dataType:"json",contentType:"application/json",data:JSON.stringify(p),complete:function(t){var u=i(t,"json"),s,r;if(t.status==201){r=u}else{s={status:t.status,error:u.error,reason:u.reason}}q(s,r,u)}})}function b(k,p,q){f.ajax({type:"PUT",url:k,dataType:"json",contentType:"application/json",data:JSON.stringify(p),complete:function(t){var u=i(t,"json"),s,r;if(t.status==200){r=u}else{s={status:t.status,error:u.error,reason:u.reason}}q(s,r)}})}function e(k,p){f.ajax({type:"DELETE",url:k,dataType:"json",complete:function(s){var t=i(s,"json"),r,q;if(s.status==200){q=t}else{r={status:s.status,error:t.error,reason:t.reason}}p(r,q)}})}f.extend(f.ans,{login:function(k,p){a("/login",k,p)},logout:function(k){h("/logout",k)},dbAttachmentUri:function(k,p){return"/dbs/"+Model.ADMINDBID+"/"+k+"/attachments/"+p},getDB:function(k,p,q){p=p||{};f.extend(true,p,{selector:{type:Model.DATABASE}});h("/dbs/"+Model.ADMINDBID+"/"+(k||g(p)),q)},postDB:function(k,p){a("/dbs/"+Model.ADMINDBID,k,function(r,q){p(r,q);if(!r){f(document).trigger("databaseCreated",q)}})},putDB:function(k,q,p,r){p=p||{};f.extend(true,p,{selector:{type:Model.DATABASE}});b("/dbs/"+Model.ADMINDBID+"/"+(k||g(p)),q,function(t,s){r(t,s);if(!t){f(document).trigger("databaseChanged",q)}})},delDB:function(k,p,q){p=p||{};f.extend(true,p,{selector:{type:Model.DATABASE}});e("/dbs/"+Model.ADMINDBID+"/"+(k||g(p)),function(s,r){q(s,r);if(!s){f(document).trigger("databaseDeleted",{_id:k})}})},getDBAttachment:function(k,p){},postDBAttachment:function(p,k,q){var r=f('<form action="" method="POST"></form>').append(k.clone().attr("name","attachment"));var s={url:"/dbs/"+Model.ADMINDBID+"/"+p._id+"/attachments"};f.extend(s,q);r.ajaxSubmit(s)},delDBAttachment:function(k,p){},getDoc:function(p,s,r,t){var k={},q="/dbs/"+p;if(r&&r.headers){f.extend(k,{headers:r.headers});delete r.headers}if(s){q+="/"+s}if(r){q+=g(r)}h(q,t,k)},postDoc:function(k,q,p,r){a("/dbs/"+k+g(p),q,function(t,s){r(t,s);if(!t){f(document).trigger("documentCreated",q)}})},putDoc:function(p,s,k,r,t){var q="/dbs/"+p+"/"+s;if(r){q+=g(r)}b(q,k,function(v,u){t(v,u);if(!v){f(document).trigger("documentChanged",k)}})},delDoc:function(k,r,q,s){var p="/dbs/"+k;if(r){p+="/"+r}if(q){p+=g(q)}e(p,function(u,t){s(u,t);if(!u){f(document).trigger("documentDeleted",{_id:r})}})},getAttachmentPath:function(k,p,q){return"/dbs/"+k+"/"+p+"/attachments/"+q},postAttachment:function(p,r,k,q){var s=f('<form action="" method="POST"></form>').append(k.clone().attr("name","attachment"));var t={url:"/dbs/"+p+"/"+r+"/attachments"};f.extend(t,q);s.ajaxSubmit(t)},delAttachment:function(k,p,q){},getTempPath:function(k){return"/tmp/"+k},postTemp:function(k,p){var q=f('<form action="" method="POST"></form>').append(k.clone().attr("name","file")),r={url:"/tmp"};f.extend(r,p);q.ajaxSubmit(r)}})})(jQuery);(function($){$.extend({metadata:{defaults:{type:"elem",name:"script",single:"script"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts),elem=$(elem);settings.single=settings.single||"metadata";var data=$.data(elem,settings.single);if(!$.isEmptyObject(data)){return data}data="{}";if(settings.type=="elem"){data=$.trim(elem.children(settings.name+"[type='text/json']").html())||data}else{if(settings.type=="attr"){data=elem.attr(settings.name)||data}}if(data.indexOf("{")<0){data="{"+data+"}"}try{data=eval("("+data+")")}catch(e){}if(!$.isEmptyObject(data)){$.data(elem,settings.single,data)}return data},set:function(elem,metadata,opts){var settings=$.extend({},this.defaults,opts),elem=$(elem);settings.single=settings.single||"metadata";if(settings.type=="elem"){elem.children("script[type='text/json']").remove();if(!$.isEmptyObject(metadata)){elem.html("<script type='text/json'>"+$.toJSON(metadata)+"<\/script>")}}else{if(settings.type=="attr"){elem.removeAttr(settings.name);if(!$.isEmptyObject(metadata)){elem.attr(settings.name,$.toJSON(metadata))}}}$.data(elem,settings.single,metadata)}}});$.fn.metadata=function(opts){return $.metadata.get(this,opts)};$.fn.getMetadata=function(opts){return $.metadata.get(this,opts)};$.fn.setMetadata=function(metadata,opts){$.metadata.set(this,metadata,opts)}})(jQuery);(function(a){a.extend(a.fn,{validate:function(b){if(!this.length){b&&b.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var c=a.data(this[0],"validator");if(c){return c}this.attr("novalidate","novalidate");c=new a.validator(b,this[0]);a.data(this[0],"validator",c);if(c.settings.onsubmit){var e=this.find("input, button");e.filter(".cancel").click(function(){c.cancelSubmit=true});if(c.settings.submitHandler){e.filter(":submit").click(function(){c.submitButton=this})}this.submit(function(f){if(c.settings.debug){f.preventDefault()}function g(){if(c.settings.submitHandler){if(c.submitButton){var h=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(c.submitButton.value).appendTo(c.currentForm)}c.settings.submitHandler.call(c,c.currentForm);if(c.submitButton){h.remove()}return false}return true}if(c.cancelSubmit){c.cancelSubmit=false;return g()}if(c.form()){if(c.pendingRequest){c.formSubmitted=true;return false}return g()}else{c.focusInvalid();return false}})}return c},valid:function(){if(a(this[0]).is("form")){return this.validate().form()}else{var c=true;var b=a(this[0].form).validate();this.each(function(){c&=b.element(this)});return c}},removeAttrs:function(e){var b={},c=this;a.each(e.split(/\s/),function(f,g){b[g]=c.attr(g);c.removeAttr(g)});return b},rules:function(f,b){var h=this[0];if(f){var e=a.data(h.form,"validator").settings;var j=e.rules;var k=a.validator.staticRules(h);switch(f){case"add":a.extend(k,a.validator.normalizeRule(b));j[h.name]=k;if(b.messages){e.messages[h.name]=a.extend(e.messages[h.name],b.messages)}break;case"remove":if(!b){delete j[h.name];return k}var i={};a.each(b.split(/\s/),function(p,q){i[q]=k[q];delete k[q]});return i}}var g=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(h),a.validator.classRules(h),a.validator.attributeRules(h),a.validator.staticRules(h)),h);if(g.required){var c=g.required;delete g.required;g=a.extend({required:c},g)}return g}});a.extend(a.expr[":"],{blank:function(b){return !a.trim(""+b.value)},filled:function(b){return !!a.trim(""+b.value)},unchecked:function(b){return !b.checked}});a.validator=function(b,c){this.settings=a.extend(true,{},a.validator.defaults,b);this.currentForm=c;this.init()};a.validator.format=function(b,c){if(arguments.length==1){return function(){var e=a.makeArray(arguments);e.unshift(b);return a.validator.format.apply(this,e)}}if(arguments.length>2&&c.constructor!=Array){c=a.makeArray(arguments).slice(1)}if(c.constructor!=Array){c=[c]}a.each(c,function(e,f){b=b.replace(new RegExp("\\{"+e+"\\}","g"),f)});return b};a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(b,c){this.lastActive=b;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,b,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(b)).hide()}},onfocusout:function(b,c){if(!this.checkable(b)&&(b.name in this.submitted||!this.optional(b))){this.element(b)}},onkeyup:function(b,c){if(b.name in this.submitted||b==this.lastElement){this.element(b)}},onclick:function(b,c){if(b.name in this.submitted){this.element(b)}else{if(b.parentNode.name in this.submitted){this.element(b.parentNode)}}},highlight:function(e,b,c){if(e.type==="radio"){this.findByName(e.name).addClass(b).removeClass(c)}else{a(e).addClass(b).removeClass(c)}},unhighlight:function(e,b,c){if(e.type==="radio"){this.findByName(e.name).removeClass(b).addClass(c)}else{a(e).removeClass(b).addClass(c)}}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=a(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm);this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=(this.groups={});a.each(this.settings.groups,function(f,g){a.each(g.split(/\s/),function(i,h){b[h]=f})});var e=this.settings.rules;a.each(e,function(f,g){e[f]=a.validator.normalizeRule(g)});function c(h){var g=a.data(this[0].form,"validator"),f="on"+h.type.replace(/^validate/,"");g.settings[f]&&g.settings[f].call(g,this[0],h)}a(this.currentForm).validateDelegate("input[type='text'], input[type='password'], input[type='file'], select, textarea, input[type='number'], input[type='search'] ,input[type='tel'], input[type='url'], input[type='email'], input[type='datetime'], input[type='date'], input[type='month'], input[type='week'], input[type='time'], input[type='datetime-local'], input[type='range'], input[type='color'] ","focusin focusout keyup",c).validateDelegate("input[type='radio'], input[type='checkbox'], select, option","click",c);if(this.settings.invalidHandler){a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();a.extend(this.submitted,this.errorMap);this.invalid=a.extend({},this.errorMap);if(!this.valid()){a(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var b=0,c=(this.currentElements=this.elements());c[b];b++){this.check(c[b])}return this.valid()},element:function(c){c=this.validationTargetFor(this.clean(c));this.lastElement=c;this.prepareElement(c);this.currentElements=a(c);var b=this.check(c);if(b){delete this.invalid[c.name]}else{this.invalid[c.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return b},showErrors:function(c){if(c){a.extend(this.errorMap,c);this.errorList=[];for(var b in c){this.errorList.push({message:c[b],element:this.findByName(b)[0]})}this.successList=a.grep(this.successList,function(e){return !(e.name in c)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if(a.fn.resetForm){a(this.currentForm).resetForm()}this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var c=0;for(var b in e){c++}return c},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}}},findLastActive:function(){var b=this.lastActive;return b&&a.grep(this.errorList,function(c){return c.element.name==b.name}).length==1&&b},elements:function(){var c=this,b={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&c.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!c.objectLength(a(this).rules())){return false}b[this.name]=true;return true})},clean:function(b){return a(b)[0]},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=a([]);this.toHide=a([]);this.currentElements=a([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(b){this.reset();this.toHide=this.errorsFor(b)},check:function(c){c=this.validationTargetFor(this.clean(c));var i=a(c).rules();var f=false;for(var j in i){var h={method:j,parameters:i[j]};try{var b=a.validator.methods[j].call(this,c.value.replace(/\r/g,""),c,h.parameters);if(b=="dependency-mismatch"){f=true;continue}f=false;if(b=="pending"){this.toHide=this.toHide.not(this.errorsFor(c));return}if(!b){this.formatAndAdd(c,h);return false}}catch(g){this.settings.debug&&window.console&&console.log("exception occured when checking element "+c.id+", check the '"+h.method+"' method",g);throw g}}if(f){return}if(this.objectLength(i)){this.successList.push(c)}return true},customMetaMessage:function(b,e){if(!a.metadata){return}var c=this.settings.meta?a(b).metadata()[this.settings.meta]:a(b).metadata();return c&&c.messages&&c.messages[e]},customMessage:function(c,e){var b=this.settings.messages[c];return b&&(b.constructor==String?b:b[e])},findDefined:function(){for(var b=0;b<arguments.length;b++){if(arguments[b]!==undefined){return arguments[b]}}return undefined},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customMetaMessage(b,c),!this.settings.ignoreTitle&&b.title||undefined,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(c,f){var e=this.defaultMessage(c,f.method),b=/\$?\{(\d+)\}/g;if(typeof e=="function"){e=e.call(this,f.parameters,c)}else{if(b.test(e)){e=jQuery.format(e.replace(b,"{$1}"),f.parameters)}}this.errorList.push({message:e,element:c});this.errorMap[c.name]=e;this.submitted[c.name]=e},addWrapper:function(b){if(this.settings.wrapper){b=b.add(b.parent(this.settings.wrapper))}return b},defaultShowErrors:function(){for(var c=0;this.errorList[c];c++){var b=this.errorList[c];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var c=0;this.successList[c];c++){this.showLabel(this.successList[c])}}if(this.settings.unhighlight){for(var c=0,e=this.validElements();e[c];c++){this.settings.unhighlight.call(this,e[c],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(c,e){var b=this.errorsFor(c);if(b.length){b.removeClass(this.settings.validClass).addClass(this.settings.errorClass);b.attr("generated")&&b.html(e)}else{b=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(c),generated:true}).addClass(this.settings.errorClass).html(e||"");if(this.settings.wrapper){b=b.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(b).length){this.settings.errorPlacement?this.settings.errorPlacement(b,a(c)):b.insertAfter(c)}}if(!e&&this.settings.success){b.text("");typeof this.settings.success=="string"?b.addClass(this.settings.success):this.settings.success(b)}this.toShow=this.toShow.add(b)},errorsFor:function(c){var b=this.idOrName(c);return this.errors().filter(function(){return a(this).attr("for")==b})},idOrName:function(b){return this.groups[b.name]||(this.checkable(b)?b.name:b.id||b.name)},validationTargetFor:function(b){if(this.checkable(b)){b=this.findByName(b.name).not(this.settings.ignore)[0]}return b},checkable:function(b){return/radio|checkbox/i.test(b.type)},findByName:function(b){var c=this.currentForm;return a(document.getElementsByName(b)).map(function(e,f){return f.form==c&&f.name==b&&f||null})},getLength:function(c,b){switch(b.nodeName.toLowerCase()){case"select":return a("option:selected",b).length;case"input":if(this.checkable(b)){return this.findByName(b.name).filter(":checked").length}}return c.length},depend:function(c,b){return this.dependTypes[typeof c]?this.dependTypes[typeof c](c,b):true},dependTypes:{"boolean":function(c,b){return c},string:function(c,b){return !!a(c,b.form).length},"function":function(c,b){return c(b)}},optional:function(b){return !a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch"},startRequest:function(b){if(!this.pending[b.name]){this.pendingRequest++;this.pending[b.name]=true}},stopRequest:function(b,c){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[b.name];if(c&&this.pendingRequest==0&&this.formSubmitted&&this.form()){a(this.currentForm).submit();this.formSubmitted=false}else{if(!c&&this.pendingRequest==0&&this.formSubmitted){a(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}}},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:true,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(b,c){b.constructor==String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(c){var e={};var b=a(c).attr("class");b&&a.each(b.split(" "),function(){if(this in a.validator.classRuleSettings){a.extend(e,a.validator.classRuleSettings[this])}});return e},attributeRules:function(c){var f={};var b=a(c);for(var g in a.validator.methods){var e;if(g==="required"&&typeof a.fn.prop==="function"){e=b.prop(g)}else{e=b.attr(g)}if(e){f[g]=e}else{if(b[0].getAttribute("type")===g){f[g]=true}}}if(f.maxlength&&/-1|2147483647|524288/.test(f.maxlength)){delete f.maxlength}return f},metadataRules:function(b){if(!a.metadata){return{}}var c=a.data(b.form,"validator").settings.meta;return c?a(b).metadata()[c]:a(b).metadata()},staticRules:function(c){var e={};var b=a.data(c.form,"validator");if(b.settings.rules){e=a.validator.normalizeRule(b.settings.rules[c.name])||{}}return e},normalizeRules:function(c,b){a.each(c,function(g,f){if(f===false){delete c[g];return}if(f.param||f.depends){var e=true;switch(typeof f.depends){case"string":e=!!a(f.depends,b.form).length;break;case"function":e=f.depends.call(b,b);break}if(e){c[g]=f.param!==undefined?f.param:true}else{delete c[g]}}});a.each(c,function(e,f){c[e]=a.isFunction(f)?f(b):f});a.each(["minlength","maxlength","min","max"],function(){if(c[this]){c[this]=Number(c[this])}});a.each(["rangelength","range"],function(){if(c[this]){c[this]=[Number(c[this][0]),Number(c[this][1])]}});if(a.validator.autoCreateRanges){if(c.min&&c.max){c.range=[c.min,c.max];delete c.min;delete c.max}if(c.minlength&&c.maxlength){c.rangelength=[c.minlength,c.maxlength];delete c.minlength;delete c.maxlength}}if(c.messages){delete c.messages}return c},normalizeRule:function(c){if(typeof c=="string"){var b={};a.each(c.split(/\s/),function(){b[this]=true});c=b}return c},addMethod:function(b,e,c){a.validator.methods[b]=e;a.validator.messages[b]=c!=undefined?c:a.validator.messages[b];if(e.length<3){a.validator.addClassRules(b,a.validator.normalizeRule(b))}},methods:{required:function(c,b,f){if(!this.depend(f,b)){return"dependency-mismatch"}switch(b.nodeName.toLowerCase()){case"select":var e=a(b).val();return e&&e.length>0;case"input":if(this.checkable(b)){return this.getLength(c,b)>0}default:return a.trim(c).length>0}},remote:function(g,c,h){if(this.optional(c)){return"dependency-mismatch"}var e=this.previousValue(c);if(!this.settings.messages[c.name]){this.settings.messages[c.name]={}}e.originalMessage=this.settings.messages[c.name].remote;this.settings.messages[c.name].remote=e.message;h=typeof h=="string"&&{url:h}||h;if(this.pending[c.name]){return"pending"}if(e.old===g){return e.valid}e.old=g;var b=this;this.startRequest(c);var f={};f[c.name]=g;a.ajax(a.extend(true,{url:h,mode:"abort",port:"validate"+c.name,dataType:"json",data:f,success:function(j){b.settings.messages[c.name].remote=e.originalMessage;var p=j===true;if(p){var i=b.formSubmitted;b.prepareElement(c);b.formSubmitted=i;b.successList.push(c);b.showErrors()}else{var q={};var k=j||b.defaultMessage(c,"remote");q[c.name]=e.message=a.isFunction(k)?k(g):k;b.showErrors(q)}e.valid=p;b.stopRequest(c,p)}},h));return"pending"},minlength:function(c,b,e){return this.optional(b)||this.getLength(a.trim(c),b)>=e},maxlength:function(c,b,e){return this.optional(b)||this.getLength(a.trim(c),b)<=e},rangelength:function(e,b,f){var c=this.getLength(a.trim(e),b);return this.optional(b)||(c>=f[0]&&c<=f[1])},min:function(c,b,e){return this.optional(b)||c>=e},max:function(c,b,e){return this.optional(b)||c<=e},range:function(c,b,e){return this.optional(b)||(c>=e[0]&&c<=e[1])},email:function(c,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(c)},url:function(c,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c)},date:function(c,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(c))},dateISO:function(c,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(c)},number:function(c,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(c)},digits:function(c,b){return this.optional(b)||/^\d+$/.test(c)},creditcard:function(g,c){if(this.optional(c)){return"dependency-mismatch"}if(/[^0-9 -]+/.test(g)){return false}var h=0,f=0,b=false;g=g.replace(/\D/g,"");for(var i=g.length-1;i>=0;i--){var e=g.charAt(i);var f=parseInt(e,10);if(b){if((f*=2)>9){f-=9}}h+=f;b=!b}return(h%10)==0},accept:function(c,b,e){e=typeof e=="string"?e.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||c.match(new RegExp(".("+e+")$","i"))},equalTo:function(c,b,f){var e=a(f).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(b).valid()});return c==e.val()}}});a.format=a.validator.format})(jQuery);(function(c){var a={};if(c.ajaxPrefilter){c.ajaxPrefilter(function(g,f,h){var e=g.port;if(g.mode=="abort"){if(a[e]){a[e].abort()}a[e]=h}})}else{var b=c.ajax;c.ajax=function(f){var g=("mode" in f?f:c.ajaxSettings).mode,e=("port" in f?f:c.ajaxSettings).port;if(g=="abort"){if(a[e]){a[e].abort()}return(a[e]=b.apply(this,arguments))}return b.apply(this,arguments)}}})(jQuery);(function(a){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){a.each({focus:"focusin",blur:"focusout"},function(c,b){a.event.special[b]={setup:function(){this.addEventListener(c,e,true)},teardown:function(){this.removeEventListener(c,e,true)},handler:function(f){arguments[0]=a.event.fix(f);arguments[0].type=b;return a.event.handle.apply(this,arguments)}};function e(f){f=a.event.fix(f);f.type=b;return a.event.handle.call(this,f)}})}a.extend(a.fn,{validateDelegate:function(e,c,b){return this.bind(c,function(f){var g=a(f.target);if(g.is(e)){return b.apply(g,arguments)}})}})})(jQuery);(function($){$.toJSON=function(o){if(typeof(JSON)=="object"&&JSON.stringify){return JSON.stringify(o)}var type=typeof(o);if(o===null){return"null"}if(type=="undefined"){return undefined}if(type=="number"||type=="boolean"){return o+""}if(type=="string"){return $.quoteString(o)}if(type=="object"){if(typeof o.toJSON=="function"){return $.toJSON(o.toJSON())}if(o.constructor===Date){var month=o.getUTCMonth()+1;if(month<10){month="0"+month}var day=o.getUTCDate();if(day<10){day="0"+day}var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10){hours="0"+hours}var minutes=o.getUTCMinutes();if(minutes<10){minutes="0"+minutes}var seconds=o.getUTCSeconds();if(seconds<10){seconds="0"+seconds}var milli=o.getUTCMilliseconds();if(milli<100){milli="0"+milli}if(milli<10){milli="0"+milli}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(o.constructor===Array){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i])||"null")}return"["+ret.join(",")+"]"}var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}if(typeof o[k]=="function"){continue}var val=$.toJSON(o[k]);pairs.push(name+":"+val)}return"{"+pairs.join(", ")+"}"}};$.evalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}return eval("("+src+")")};$.secureEvalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}};$.quoteString=function(string){if(string.match(_escapeable)){return'"'+string.replace(_escapeable,function(a){var c=_meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}})(jQuery);
/* Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(e){var b=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks){for(var a=b.length;a;){e.event.fixHooks[b[--a]]=e.event.mouseHooks}}e.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var f=b.length;f;){this.addEventListener(b[--f],c,false)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var f=b.length;f;){this.removeEventListener(b[--f],c,false)}}else{this.onmousewheel=null}}};e.fn.extend({mousewheel:function(f){return f?this.bind("mousewheel",f):this.trigger("mousewheel")},unmousewheel:function(f){return this.unbind("mousewheel",f)}});function c(k){var i=k||window.event,h=[].slice.call(arguments,1),p=0,j=true,g=0,f=0;k=e.event.fix(i);k.type="mousewheel";if(i.wheelDelta){p=i.wheelDelta/120}if(i.detail){p=-i.detail/3}f=p;if(i.axis!==undefined&&i.axis===i.HORIZONTAL_AXIS){f=0;g=-1*p}if(i.wheelDeltaY!==undefined){f=i.wheelDeltaY/120}if(i.wheelDeltaX!==undefined){g=-1*i.wheelDeltaX/120}h.unshift(k,p,g,f);return(e.event.dispatch||e.event.handle).apply(this,h)}})(jQuery);(function(b,f){var e,c,a;e=c=b.jQuery;a=c.ScrollTo=c.ScrollTo||{config:{duration:400,easing:"swing",callback:f,durationMode:"each",offsetTop:0,offsetLeft:0},configure:function(g){c.extend(a.config,g||{});return this},scroll:function(t,B){var s,v,q,g,k,D,z,r,A,w,x,h,p,u,E,C,j,i;s=t.pop();v=s.$container;q=v.get(0);g=s.$target;k=c("<span/>").css({position:"absolute",top:"0px",left:"0px"});D=v.css("position");v.css("position","relative");k.appendTo(v);x=k.offset().top;h=g.offset().top;p=h-x-parseInt(B.offsetTop,10);u=k.offset().left;E=g.offset().left;C=E-u-parseInt(B.offsetLeft,10);z=q.scrollTop;r=q.scrollLeft;k.remove();v.css("position",D);j={};i=function(F){if(t.length===0){if(typeof B.callback==="function"){B.callback.apply(this,[F])}}else{a.scroll(t,B)}return true};if(B.onlyIfOutside){A=z+v.height();w=r+v.width();if(z<p&&p<A){p=z}if(r<C&&C<w){C=r}}if(p!==z){j.scrollTop=p}if(C!==r){j.scrollLeft=C}if(c.browser.safari&&q===document.body){b.scrollTo(j.scrollLeft,j.scrollTop);i()}else{if(j.scrollTop||j.scrollLeft){v.animate(j,B.duration,B.easing,i)}else{i()}}return true},fn:function(j){var k,i,r,h;k=[];var g=c(this);if(g.length===0){return this}i=c.extend({},a.config,j);r=g.parent();h=r.get(0);while((r.length===1)&&(h!==document.body)&&(h!==document)){var p,q;p=r.css("overflow-y")!=="visible"&&h.scrollHeight!==h.clientHeight;q=r.css("overflow-x")!=="visible"&&h.scrollWidth!==h.clientWidth;if(p||q){k.push({"$container":r,"$target":g});g=r}r=r.parent();h=r.get(0)}k.push({"$container":c((c.browser.msie||c.browser.mozilla)?"html,body":"body"),"$target":g});if(i.durationMode==="all"){i.duration/=k.length}a.scroll(k,i);return this}};c.fn.ScrollTo=c.ScrollTo.fn})(window);(function($){$.ui.timepicker=$.ui.timepicker||{};if($.ui.timepicker.version){return}$.extend($.ui,{timepicker:{version:"1.0.3"}});function Timepicker(){this.regional=[];this.regional[""]={currentText:"Now",closeText:"Done",ampm:false,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm tt",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",timezoneText:"Time Zone"};this._defaults={showButtonPanel:true,timeOnly:false,showHour:true,showMinute:true,showSecond:false,showMillisec:false,showTimezone:false,showTime:true,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:null,useLocalTimezone:false,defaultTimezone:"+0000",hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:true,separator:" ",altFieldTimeOnly:true,altSeparator:null,altTimeSuffix:null,showTimepicker:true,timezoneIso8601:false,timezoneList:null,addSliderAccess:false,sliderAccessArgs:null,defaultValue:null};$.extend(this._defaults,this.regional[""])}$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:null,defaultTimezone:"+0000",hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec"],setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_newInst:function($input,o){var tp_inst=new Timepicker(),inlineSettings={};for(var attrName in this._defaults){if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue){try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}}tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(input,dp_inst){if($.isFunction(o.beforeShow)){return o.beforeShow(input,dp_inst,tp_inst)}},onChangeMonthYear:function(year,month,dp_inst){tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onChangeMonthYear)){o.onChangeMonthYear.call($input[0],year,month,dp_inst,tp_inst)}},onClose:function(dateText,dp_inst){if(tp_inst.timeDefined===true&&$input.val()!==""){tp_inst._updateDateTime(dp_inst)}if($.isFunction(o.onClose)){o.onClose.call($input[0],dateText,dp_inst,tp_inst)}},timepicker:tp_inst});tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(val){return val.toUpperCase()});tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(val){return val.toUpperCase()});if(tp_inst._defaults.timezoneList===null){var timezoneList=["-1200","-1100","-1000","-0930","-0900","-0800","-0700","-0600","-0500","-0430","-0400","-0330","-0300","-0200","-0100","+0000","+0100","+0200","+0300","+0330","+0400","+0430","+0500","+0530","+0545","+0600","+0630","+0700","+0800","+0845","+0900","+0930","+1000","+1030","+1100","+1130","+1200","+1245","+1300","+1400"];if(tp_inst._defaults.timezoneIso8601){timezoneList=$.map(timezoneList,function(val){return val=="+0000"?"Z":(val.substring(0,3)+":"+val.substring(3))})}tp_inst._defaults.timezoneList=timezoneList}tp_inst.timezone=tp_inst._defaults.timezone;tp_inst.hour=tp_inst._defaults.hour;tp_inst.minute=tp_inst._defaults.minute;tp_inst.second=tp_inst._defaults.second;tp_inst.millisec=tp_inst._defaults.millisec;tp_inst.ampm="";tp_inst.$input=$input;if(o.altField){tp_inst.$altInput=$(o.altField).css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})}if(tp_inst._defaults.minDate===0||tp_inst._defaults.minDateTime===0){tp_inst._defaults.minDate=new Date()}if(tp_inst._defaults.maxDate===0||tp_inst._defaults.maxDateTime===0){tp_inst._defaults.maxDate=new Date()}if(tp_inst._defaults.minDate!==undefined&&tp_inst._defaults.minDate instanceof Date){tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())}if(tp_inst._defaults.minDateTime!==undefined&&tp_inst._defaults.minDateTime instanceof Date){tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())}if(tp_inst._defaults.maxDate!==undefined&&tp_inst._defaults.maxDate instanceof Date){tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())}if(tp_inst._defaults.maxDateTime!==undefined&&tp_inst._defaults.maxDateTime instanceof Date){tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())}tp_inst.$input.bind("focus",function(){tp_inst._onFocus()});return tp_inst},_addTimePicker:function(dp_inst){var currDT=(this.$altInput&&this._defaults.altFieldTimeOnly)?this.$input.val()+" "+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(currDT);this._limitMinMaxDateTime(dp_inst,false);this._injectTimePicker()},_parseTime:function(timeString,withDate){if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0])}if(withDate||!this._defaults.timeOnly){var dp_dateFormat=$.datepicker._get(this.inst,"dateFormat");try{var parseRes=parseDateTimeInternal(dp_dateFormat,this._defaults.timeFormat,timeString,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!parseRes.timeObj){return false}$.extend(this,parseRes.timeObj)}catch(err){return false}return true}else{var timeObj=$.datepicker.parseTime(this._defaults.timeFormat,timeString,this._defaults);if(!timeObj){return false}$.extend(this,timeObj);return true}},_injectTimePicker:function(){var $dp=this.inst.dpDiv,o=this.inst.settings,tp_inst=this,litem="",uitem="",max={},gridSize={},size=null;if($dp.find("div.ui-timepicker-div").length===0&&o.showTimepicker){var noDisplay=' style="display:none;"',html='<div class="ui-timepicker-div"><dl><dt class="ui_tpicker_time_label"'+((o.showTime)?"":noDisplay)+">"+o.timeText+'</dt><dd class="ui_tpicker_time"'+((o.showTime)?"":noDisplay)+"></dd>";for(var i=0,l=this.units.length;i<l;i++){litem=this.units[i];uitem=litem.substr(0,1).toUpperCase()+litem.substr(1);max[litem]=parseInt((o[litem+"Max"]-((o[litem+"Max"]-o[litem+"Min"])%o["step"+uitem])),10);gridSize[litem]=0;html+='<dt class="ui_tpicker_'+litem+'_label"'+((o["show"+uitem])?"":noDisplay)+">"+o[litem+"Text"]+'</dt><dd class="ui_tpicker_'+litem+'"><div class="ui_tpicker_'+litem+'_slider"'+((o["show"+uitem])?"":noDisplay)+"></div>";if(o["show"+uitem]&&o[litem+"Grid"]>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';if(litem=="hour"){for(var h=o[litem+"Min"];h<=max[litem];h+=parseInt(o[litem+"Grid"],10)){gridSize[litem]++;var tmph=(o.ampm&&h>12)?h-12:h;if(tmph<10){tmph="0"+tmph}if(o.ampm){if(h===0){tmph=12+"a"}else{if(h<12){tmph+="a"}else{tmph+="p"}}}html+='<td data-for="'+litem+'">'+tmph+"</td>"}}else{for(var m=o[litem+"Min"];m<=max[litem];m+=parseInt(o[litem+"Grid"],10)){gridSize[litem]++;html+='<td data-for="'+litem+'">'+((m<10)?"0":"")+m+"</td>"}}html+="</tr></table></div>"}html+="</dd>"}html+='<dt class="ui_tpicker_timezone_label"'+((o.showTimezone)?"":noDisplay)+">"+o.timezoneText+"</dt>";html+='<dd class="ui_tpicker_timezone" '+((o.showTimezone)?"":noDisplay)+"></dd>";html+="</dl></div>";var $tp=$(html);if(o.timeOnly===true){$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+o.timeOnlyTitle+"</div></div>");$dp.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()}this.hour_slider=$tp.find(".ui_tpicker_hour_slider").prop("slide",null).slider({orientation:"horizontal",value:this.hour,min:o.hourMin,max:max.hour,step:o.stepHour,slide:function(event,ui){tp_inst.hour_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});this.minute_slider=$tp.find(".ui_tpicker_minute_slider").prop("slide",null).slider({orientation:"horizontal",value:this.minute,min:o.minuteMin,max:max.minute,step:o.stepMinute,slide:function(event,ui){tp_inst.minute_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});this.second_slider=$tp.find(".ui_tpicker_second_slider").prop("slide",null).slider({orientation:"horizontal",value:this.second,min:o.secondMin,max:max.second,step:o.stepSecond,slide:function(event,ui){tp_inst.second_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});this.millisec_slider=$tp.find(".ui_tpicker_millisec_slider").prop("slide",null).slider({orientation:"horizontal",value:this.millisec,min:o.millisecMin,max:max.millisec,step:o.stepMillisec,slide:function(event,ui){tp_inst.millisec_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});for(var i=0,l=tp_inst.units.length;i<l;i++){litem=tp_inst.units[i];uitem=litem.substr(0,1).toUpperCase()+litem.substr(1);if(o["show"+uitem]&&o[litem+"Grid"]>0){size=100*gridSize[litem]*o[litem+"Grid"]/(max[litem]-o[litem+"Min"]);$tp.find(".ui_tpicker_"+litem+" table").css({width:size+"%",marginLeft:(size/(-2*gridSize[litem]))+"%",borderCollapse:"collapse"}).find("td").click(function(e){var $t=$(this),h=$t.html(),f=$t.data("for");if(f=="hour"&&o.ampm){var ap=h.substring(2).toLowerCase(),aph=parseInt(h.substring(0,2),10);if(ap=="a"){if(aph==12){h=0}else{h=aph}}else{if(aph==12){h=12}else{h=aph+12}}}tp_inst[f+"_slider"].slider("option","value",parseInt(h,10));tp_inst._onTimeChange();tp_inst._onSelectHandler()}).css({cursor:"pointer",width:(100/gridSize[litem])+"%",textAlign:"center",overflow:"hidden"})}}this.timezone_select=$tp.find(".ui_tpicker_timezone").append("<select></select>").find("select");$.fn.append.apply(this.timezone_select,$.map(o.timezoneList,function(val,idx){return $("<option />").val(typeof val=="object"?val.value:val).text(typeof val=="object"?val.label:val)}));if(typeof(this.timezone)!="undefined"&&this.timezone!==null&&this.timezone!==""){var local_date=new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12);var local_timezone=$.timepicker.timeZoneOffsetString(local_date);if(local_timezone==this.timezone){selectLocalTimeZone(tp_inst)}else{this.timezone_select.val(this.timezone)}}else{if(typeof(this.hour)!="undefined"&&this.hour!==null&&this.hour!==""){this.timezone_select.val(o.defaultTimezone)}else{selectLocalTimeZone(tp_inst)}}this.timezone_select.change(function(){tp_inst._defaults.useLocalTimezone=false;tp_inst._onTimeChange()});var $buttonPanel=$dp.find(".ui-datepicker-buttonpane");if($buttonPanel.length){$buttonPanel.before($tp)}else{$dp.append($tp)}this.$timeObj=$tp.find(".ui_tpicker_time");if(this.inst!==null){var timeDefined=this.timeDefined;this._onTimeChange();this.timeDefined=timeDefined}if(this._defaults.addSliderAccess){var sliderAccessArgs=this._defaults.sliderAccessArgs;setTimeout(function(){if($tp.find(".ui-slider-access").length===0){$tp.find(".ui-slider:visible").sliderAccess(sliderAccessArgs);var sliderAccessWidth=$tp.find(".ui-slider-access:eq(0)").outerWidth(true);if(sliderAccessWidth){$tp.find("table:visible").each(function(){var $g=$(this),oldWidth=$g.outerWidth(),oldMarginLeft=$g.css("marginLeft").toString().replace("%",""),newWidth=oldWidth-sliderAccessWidth,newMarginLeft=((oldMarginLeft*newWidth)/oldWidth)+"%";$g.css({width:newWidth,marginLeft:newMarginLeft})})}}},10)}}},_limitMinMaxDateTime:function(dp_inst,adjustSliders){var o=this._defaults,dp_date=new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay);if(!this._defaults.showTimepicker){return}if($.datepicker._get(dp_inst,"minDateTime")!==null&&$.datepicker._get(dp_inst,"minDateTime")!==undefined&&dp_date){var minDateTime=$.datepicker._get(dp_inst,"minDateTime"),minDateTimeDate=new Date(minDateTime.getFullYear(),minDateTime.getMonth(),minDateTime.getDate(),0,0,0,0);if(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null){this.hourMinOriginal=o.hourMin;this.minuteMinOriginal=o.minuteMin;this.secondMinOriginal=o.secondMin;this.millisecMinOriginal=o.millisecMin}if(dp_inst.settings.timeOnly||minDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMin=minDateTime.getHours();if(this.hour<=this._defaults.hourMin){this.hour=this._defaults.hourMin;this._defaults.minuteMin=minDateTime.getMinutes();if(this.minute<=this._defaults.minuteMin){this.minute=this._defaults.minuteMin;this._defaults.secondMin=minDateTime.getSeconds();if(this.second<=this._defaults.secondMin){this.second=this._defaults.secondMin;this._defaults.millisecMin=minDateTime.getMilliseconds()}else{if(this.millisec<this._defaults.millisecMin){this.millisec=this._defaults.millisecMin}this._defaults.millisecMin=this.millisecMinOriginal}}else{this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}else{this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}else{this._defaults.hourMin=this.hourMinOriginal;this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}if($.datepicker._get(dp_inst,"maxDateTime")!==null&&$.datepicker._get(dp_inst,"maxDateTime")!==undefined&&dp_date){var maxDateTime=$.datepicker._get(dp_inst,"maxDateTime"),maxDateTimeDate=new Date(maxDateTime.getFullYear(),maxDateTime.getMonth(),maxDateTime.getDate(),0,0,0,0);if(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null){this.hourMaxOriginal=o.hourMax;this.minuteMaxOriginal=o.minuteMax;this.secondMaxOriginal=o.secondMax;this.millisecMaxOriginal=o.millisecMax}if(dp_inst.settings.timeOnly||maxDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMax=maxDateTime.getHours();if(this.hour>=this._defaults.hourMax){this.hour=this._defaults.hourMax;this._defaults.minuteMax=maxDateTime.getMinutes();if(this.minute>=this._defaults.minuteMax){this.minute=this._defaults.minuteMax;this._defaults.secondMax=maxDateTime.getSeconds()}else{if(this.second>=this._defaults.secondMax){this.second=this._defaults.secondMax;this._defaults.millisecMax=maxDateTime.getMilliseconds()}else{if(this.millisec>this._defaults.millisecMax){this.millisec=this._defaults.millisecMax}this._defaults.millisecMax=this.millisecMaxOriginal}}}else{this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal}}else{this._defaults.hourMax=this.hourMaxOriginal;this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal}}if(adjustSliders!==undefined&&adjustSliders===true){var hourMax=parseInt((this._defaults.hourMax-((this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour)),10),minMax=parseInt((this._defaults.minuteMax-((this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute)),10),secMax=parseInt((this._defaults.secondMax-((this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond)),10),millisecMax=parseInt((this._defaults.millisecMax-((this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec)),10);if(this.hour_slider){this.hour_slider.slider("option",{min:this._defaults.hourMin,max:hourMax}).slider("value",this.hour)}if(this.minute_slider){this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:minMax}).slider("value",this.minute)}if(this.second_slider){this.second_slider.slider("option",{min:this._defaults.secondMin,max:secMax}).slider("value",this.second)}if(this.millisec_slider){this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:millisecMax}).slider("value",this.millisec)}}},_onTimeChange:function(){var hour=(this.hour_slider)?this.hour_slider.slider("value"):false,minute=(this.minute_slider)?this.minute_slider.slider("value"):false,second=(this.second_slider)?this.second_slider.slider("value"):false,millisec=(this.millisec_slider)?this.millisec_slider.slider("value"):false,timezone=(this.timezone_select)?this.timezone_select.val():false,o=this._defaults;if(typeof(hour)=="object"){hour=false}if(typeof(minute)=="object"){minute=false}if(typeof(second)=="object"){second=false}if(typeof(millisec)=="object"){millisec=false}if(typeof(timezone)=="object"){timezone=false}if(hour!==false){hour=parseInt(hour,10)}if(minute!==false){minute=parseInt(minute,10)}if(second!==false){second=parseInt(second,10)}if(millisec!==false){millisec=parseInt(millisec,10)}var ampm=o[hour<12?"amNames":"pmNames"][0];var hasChanged=(hour!=this.hour||minute!=this.minute||second!=this.second||millisec!=this.millisec||(this.ampm.length>0&&(hour<12)!=($.inArray(this.ampm.toUpperCase(),this.amNames)!==-1))||((this.timezone===null&&timezone!=this.defaultTimezone)||(this.timezone!==null&&timezone!=this.timezone)));if(hasChanged){if(hour!==false){this.hour=hour}if(minute!==false){this.minute=minute}if(second!==false){this.second=second}if(millisec!==false){this.millisec=millisec}if(timezone!==false){this.timezone=timezone}if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0])}this._limitMinMaxDateTime(this.inst,true)}if(o.ampm){this.ampm=ampm}this.formattedTime=$.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults);if(this.$timeObj){this.$timeObj.text(this.formattedTime+o.timeSuffix)}this.timeDefined=true;if(hasChanged){this._updateDateTime()}},_onSelectHandler:function(){var onSelect=this._defaults.onSelect||this.inst.settings.onSelect;var inputEl=this.$input?this.$input[0]:null;if(onSelect&&inputEl){onSelect.apply(inputEl,[this.formattedDateTime,this])}},_formatTime:function(time,format){time=time||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var tmptime=(format||this._defaults.timeFormat).toString();tmptime=$.datepicker.formatTime(tmptime,time,this._defaults);if(arguments.length){return tmptime}else{this.formattedTime=tmptime}},_updateDateTime:function(dp_inst){dp_inst=this.inst||dp_inst;var dt=$.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay)),dateFmt=$.datepicker._get(dp_inst,"dateFormat"),formatCfg=$.datepicker._getFormatConfig(dp_inst),timeAvailable=dt!==null&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(dateFmt,(dt===null?new Date():dt),formatCfg);var formattedDateTime=this.formattedDate;if(this._defaults.timeOnly===true){formattedDateTime=this.formattedTime}else{if(this._defaults.timeOnly!==true&&(this._defaults.alwaysSetTime||timeAvailable)){formattedDateTime+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix}}this.formattedDateTime=formattedDateTime;if(!this._defaults.showTimepicker){this.$input.val(this.formattedDate)}else{if(this.$altInput&&this._defaults.altFieldTimeOnly===true){this.$altInput.val(this.formattedTime);this.$input.val(this.formattedDate)}else{if(this.$altInput){this.$input.val(formattedDateTime);var altFormattedDateTime="",altSeparator=this._defaults.altSeparator?this._defaults.altSeparator:this._defaults.separator,altTimeSuffix=this._defaults.altTimeSuffix?this._defaults.altTimeSuffix:this._defaults.timeSuffix;if(this._defaults.altFormat){altFormattedDateTime=$.datepicker.formatDate(this._defaults.altFormat,(dt===null?new Date():dt),formatCfg)}else{altFormattedDateTime=this.formattedDate}if(altFormattedDateTime){altFormattedDateTime+=altSeparator}if(this._defaults.altTimeFormat){altFormattedDateTime+=$.datepicker.formatTime(this._defaults.altTimeFormat,this,this._defaults)+altTimeSuffix}else{altFormattedDateTime+=this.formattedTime+altTimeSuffix}this.$altInput.val(altFormattedDateTime)}else{this.$input.val(formattedDateTime)}}}this.$input.trigger("change")},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var inst=$.datepicker._getInst(this.$input.get(0)),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst)}catch(err){$.datepicker.log(err)}}}}}});$.fn.extend({timepicker:function(o){o=o||{};var tmp_args=Array.prototype.slice.call(arguments);if(typeof o=="object"){tmp_args[0]=$.extend(o,{timeOnly:true})}return $(this).each(function(){$.fn.datetimepicker.apply($(this),tmp_args)})},datetimepicker:function(o){o=o||{};var tmp_args=arguments;if(typeof(o)=="string"){if(o=="getDate"){return $.fn.datepicker.apply($(this[0]),tmp_args)}else{return this.each(function(){var $t=$(this);$t.datepicker.apply($t,tmp_args)})}}else{return this.each(function(){var $t=$(this);$t.datepicker($.timepicker._newInst($t,o)._defaults)})}}});$.datepicker.parseDateTime=function(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings){var parseRes=parseDateTimeInternal(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings);if(parseRes.timeObj){var t=parseRes.timeObj;parseRes.date.setHours(t.hour,t.minute,t.second,t.millisec)}return parseRes.date};$.datepicker.parseTime=function(timeFormat,timeString,options){var getPatternAmpm=function(amNames,pmNames){var markers=[];if(amNames){$.merge(markers,amNames)}if(pmNames){$.merge(markers,pmNames)}markers=$.map(markers,function(val){return val.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")});return"("+markers.join("|")+")?"};var getFormatPositions=function(timeFormat){var finds=timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),orders={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(finds){for(var i=0;i<finds.length;i++){if(orders[finds[i].toString().charAt(0)]==-1){orders[finds[i].toString().charAt(0)]=i+1}}}return orders};var o=extendRemove(extendRemove({},$.timepicker._defaults),options||{});var regstr="^"+timeFormat.toString().replace(/h{1,2}/ig,"(\\d?\\d)").replace(/m{1,2}/ig,"(\\d?\\d)").replace(/s{1,2}/ig,"(\\d?\\d)").replace(/l{1}/ig,"(\\d?\\d?\\d)").replace(/t{1,2}/ig,getPatternAmpm(o.amNames,o.pmNames)).replace(/z{1}/ig,"(z|[-+]\\d\\d:?\\d\\d|\\S+)?").replace(/\s/g,"\\s?")+o.timeSuffix+"$",order=getFormatPositions(timeFormat),ampm="",treg;treg=timeString.match(new RegExp(regstr,"i"));var resTime={hour:0,minute:0,second:0,millisec:0};if(treg){if(order.t!==-1){if(treg[order.t]===undefined||treg[order.t].length===0){ampm="";resTime.ampm=""}else{ampm=$.inArray(treg[order.t].toUpperCase(),o.amNames)!==-1?"AM":"PM";resTime.ampm=o[ampm=="AM"?"amNames":"pmNames"][0]}}if(order.h!==-1){if(ampm=="AM"&&treg[order.h]=="12"){resTime.hour=0}else{if(ampm=="PM"&&treg[order.h]!="12"){resTime.hour=parseInt(treg[order.h],10)+12}else{resTime.hour=Number(treg[order.h])}}}if(order.m!==-1){resTime.minute=Number(treg[order.m])}if(order.s!==-1){resTime.second=Number(treg[order.s])}if(order.l!==-1){resTime.millisec=Number(treg[order.l])}if(order.z!==-1&&treg[order.z]!==undefined){var tz=treg[order.z].toUpperCase();switch(tz.length){case 1:tz=o.timezoneIso8601?"Z":"+0000";break;case 5:if(o.timezoneIso8601){tz=tz.substring(1)=="0000"?"Z":tz.substring(0,3)+":"+tz.substring(3)}break;case 6:if(!o.timezoneIso8601){tz=tz=="Z"||tz.substring(1)=="00:00"?"+0000":tz.replace(/:/,"")}else{if(tz.substring(1)=="00:00"){tz="Z"}}break}resTime.timezone=tz}return resTime}return false};$.datepicker.formatTime=function(format,time,options){options=options||{};options=$.extend({},$.timepicker._defaults,options);time=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:"+0000"},time);var tmptime=format;var ampmName=options.amNames[0];var hour=parseInt(time.hour,10);if(options.ampm){if(hour>11){ampmName=options.pmNames[0];if(hour>12){hour=hour%12}}if(hour===0){hour=12}}tmptime=tmptime.replace(/(?:hh?|mm?|ss?|[tT]{1,2}|[lz]|('.*?'|".*?"))/g,function(match){switch(match.toLowerCase()){case"hh":return("0"+hour).slice(-2);case"h":return hour;case"mm":return("0"+time.minute).slice(-2);case"m":return time.minute;case"ss":return("0"+time.second).slice(-2);case"s":return time.second;case"l":return("00"+time.millisec).slice(-3);case"z":return time.timezone;case"t":case"tt":if(options.ampm){if(match.length==1){ampmName=ampmName.charAt(0)}return match.charAt(0)==="T"?ampmName.toUpperCase():ampmName.toLowerCase()}return"";default:return match.replace(/\'/g,"")||"'"}});tmptime=$.trim(tmptime);return tmptime};$.datepicker._base_selectDate=$.datepicker._selectDate;$.datepicker._selectDate=function(id,dateStr){var inst=this._getInst($(id)[0]),tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._limitMinMaxDateTime(inst,true);inst.inline=inst.stay_open=true;this._base_selectDate(id,dateStr);inst.inline=inst.stay_open=false;this._notifyChange(inst);this._updateDatepicker(inst)}else{this._base_selectDate(id,dateStr)}};$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){var input=inst.input[0];if($.datepicker._curInst&&$.datepicker._curInst!=inst&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=input){return}if(typeof(inst.stay_open)!=="boolean"||inst.stay_open===false){this._base_updateDatepicker(inst);var tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._addTimePicker(inst);if(tp_inst._defaults.useLocalTimezone){var date=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay,12);selectLocalTimeZone(tp_inst,date);tp_inst._onTimeChange()}}}};$.datepicker._base_doKeyPress=$.datepicker._doKeyPress;$.datepicker._doKeyPress=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if($.datepicker._get(inst,"constrainInput")){var ampm=tp_inst._defaults.ampm,dateChars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat")),datetimeChars=tp_inst._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,ampm?"APM":"").replace(/Tt/g,ampm?"AaPpMm":"").replace(/tT/g,ampm?"AaPpMm":"").replace(/T/g,ampm?"AP":"").replace(/tt/g,ampm?"apm":"").replace(/t/g,ampm?"ap":"")+" "+tp_inst._defaults.separator+tp_inst._defaults.timeSuffix+(tp_inst._defaults.showTimezone?tp_inst._defaults.timezoneList.join(""):"")+(tp_inst._defaults.amNames.join(""))+(tp_inst._defaults.pmNames.join(""))+dateChars,chr=String.fromCharCode(event.charCode===undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<" "||!dateChars||datetimeChars.indexOf(chr)>-1)}}return $.datepicker._base_doKeyPress(event)};$.datepicker._base_doKeyUp=$.datepicker._doKeyUp;$.datepicker._doKeyUp=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst)}catch(err){$.datepicker.log(err)}}}return $.datepicker._base_doKeyUp(event)};$.datepicker._base_gotoToday=$.datepicker._gotoToday;$.datepicker._gotoToday=function(id){var inst=this._getInst($(id)[0]),$dp=inst.dpDiv;this._base_gotoToday(id);var tp_inst=this._get(inst,"timepicker");selectLocalTimeZone(tp_inst);var now=new Date();this._setTime(inst,now);$(".ui-datepicker-today",$dp).click()};$.datepicker._disableTimepickerDatepicker=function(target){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");$(target).datepicker("getDate");if(tp_inst){tp_inst._defaults.showTimepicker=false;tp_inst._updateDateTime(inst)}};$.datepicker._enableTimepickerDatepicker=function(target){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");$(target).datepicker("getDate");if(tp_inst){tp_inst._defaults.showTimepicker=true;tp_inst._addTimePicker(inst);tp_inst._updateDateTime(inst)}};$.datepicker._setTime=function(inst,date){var tp_inst=this._get(inst,"timepicker");if(tp_inst){var defaults=tp_inst._defaults,hour=date?date.getHours():defaults.hour,minute=date?date.getMinutes():defaults.minute,second=date?date.getSeconds():defaults.second,millisec=date?date.getMilliseconds():defaults.millisec;var hourEq=hour===defaults.hourMin,minuteEq=minute===defaults.minuteMin,secondEq=second===defaults.secondMin;var reset=false;if(hour<defaults.hourMin||hour>defaults.hourMax){reset=true}else{if((minute<defaults.minuteMin||minute>defaults.minuteMax)&&hourEq){reset=true}else{if((second<defaults.secondMin||second>defaults.secondMax)&&hourEq&&minuteEq){reset=true}else{if((millisec<defaults.millisecMin||millisec>defaults.millisecMax)&&hourEq&&minuteEq&&secondEq){reset=true}}}}if(reset){hour=defaults.hourMin;minute=defaults.minuteMin;second=defaults.secondMin;millisec=defaults.millisecMin}tp_inst.hour=hour;tp_inst.minute=minute;tp_inst.second=second;tp_inst.millisec=millisec;if(tp_inst.hour_slider){tp_inst.hour_slider.slider("value",hour)}if(tp_inst.minute_slider){tp_inst.minute_slider.slider("value",minute)}if(tp_inst.second_slider){tp_inst.second_slider.slider("value",second)}if(tp_inst.millisec_slider){tp_inst.millisec_slider.slider("value",millisec)}tp_inst._onTimeChange();tp_inst._updateDateTime(inst)}};$.datepicker._setTimeDatepicker=function(target,date,withDate){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");if(tp_inst){this._setDateFromField(inst);var tp_date;if(date){if(typeof date=="string"){tp_inst._parseTime(date,withDate);tp_date=new Date();tp_date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec)}else{tp_date=new Date(date.getTime())}if(tp_date.toString()=="Invalid Date"){tp_date=undefined}this._setTime(inst,tp_date)}}};$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker;$.datepicker._setDateDatepicker=function(target,date){var inst=this._getInst(target);if(!inst){return}var tp_date=(date instanceof Date)?new Date(date.getTime()):date;this._updateDatepicker(inst);this._base_setDateDatepicker.apply(this,arguments);this._setTimeDatepicker(target,tp_date,true)};$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker;$.datepicker._getDateDatepicker=function(target,noDefault){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");if(tp_inst){var date=this._getDate(inst);if(date&&tp_inst._parseTime($(target).val(),tp_inst.timeOnly)){date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec)}return date}return this._base_getDateDatepicker(target,noDefault)};$.datepicker._base_parseDate=$.datepicker.parseDate;$.datepicker.parseDate=function(format,value,settings){var splitRes=splitDateTime(format,value,settings);return $.datepicker._base_parseDate(format,splitRes[0],settings)};$.datepicker._base_formatDate=$.datepicker._formatDate;$.datepicker._formatDate=function(inst,day,month,year){var tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._updateDateTime(inst);return tp_inst.$input.val()}return this._base_formatDate(inst)};$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker;$.datepicker._optionDatepicker=function(target,name,value){var inst=this._getInst(target);if(!inst){return null}var tp_inst=this._get(inst,"timepicker");if(tp_inst){var min=null,max=null,onselect=null;if(typeof name=="string"){if(name==="minDate"||name==="minDateTime"){min=value}else{if(name==="maxDate"||name==="maxDateTime"){max=value}else{if(name==="onSelect"){onselect=value}}}}else{if(typeof name=="object"){if(name.minDate){min=name.minDate}else{if(name.minDateTime){min=name.minDateTime}else{if(name.maxDate){max=name.maxDate}else{if(name.maxDateTime){max=name.maxDateTime}}}}}}if(min){if(min===0){min=new Date()}else{min=new Date(min)}tp_inst._defaults.minDate=min;tp_inst._defaults.minDateTime=min}else{if(max){if(max===0){max=new Date()}else{max=new Date(max)}tp_inst._defaults.maxDate=max;tp_inst._defaults.maxDateTime=max}else{if(onselect){tp_inst._defaults.onSelect=onselect}}}}if(value===undefined){return this._base_optionDatepicker(target,name)}return this._base_optionDatepicker(target,name,value)};function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]===null||props[name]===undefined){target[name]=props[name]}}return target}var splitDateTime=function(dateFormat,dateTimeString,dateSettings,timeSettings){try{var separator=timeSettings&&timeSettings.separator?timeSettings.separator:$.timepicker._defaults.separator,format=timeSettings&&timeSettings.timeFormat?timeSettings.timeFormat:$.timepicker._defaults.timeFormat,ampm=timeSettings&&timeSettings.ampm?timeSettings.ampm:$.timepicker._defaults.ampm,timeParts=format.split(separator),timePartsLen=timeParts.length,allParts=dateTimeString.split(separator),allPartsLen=allParts.length;if(!ampm){timeParts=$.trim(format.replace(/t/gi,"")).split(separator);timePartsLen=timeParts.length}if(allPartsLen==1){return allParts}if(allPartsLen>1){return[allParts.splice(0,allPartsLen-timePartsLen).join(separator),allParts.splice(timePartsLen*-1).join(separator)]}}catch(err){if(err.indexOf(":")>=0){var dateStringLength=dateTimeString.length-(err.length-err.indexOf(":")-2),timeString=dateTimeString.substring(dateStringLength);return[$.trim(dateTimeString.substring(0,dateStringLength)),$.trim(dateTimeString.substring(dateStringLength))]}else{throw err}}return[dateTimeString,""]};var parseDateTimeInternal=function(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings){var date;var splitRes=splitDateTime(dateFormat,dateTimeString,dateSettings,timeSettings);date=$.datepicker._base_parseDate(dateFormat,splitRes[0],dateSettings);if(splitRes[1]!==""){var timeString=splitRes[1],parsedTime=$.datepicker.parseTime(timeFormat,timeString,timeSettings);if(parsedTime===null){throw"Wrong time format"}return{date:date,timeObj:parsedTime}}else{return{date:date}}};var selectLocalTimeZone=function(tp_inst,date){if(tp_inst&&tp_inst.timezone_select){tp_inst._defaults.useLocalTimezone=true;var now=typeof date!=="undefined"?date:new Date();var tzoffset=$.timepicker.timeZoneOffsetString(now);if(tp_inst._defaults.timezoneIso8601){tzoffset=tzoffset.substring(0,3)+":"+tzoffset.substring(3)}tp_inst.timezone_select.val(tzoffset)}};$.timepicker=new Timepicker();$.timepicker.timeZoneOffsetString=function(date){var off=date.getTimezoneOffset()*-1,minutes=off%60,hours=(off-minutes)/60;return(off>=0?"+":"-")+("0"+(hours*101).toString()).substr(-2)+("0"+(minutes*101).toString()).substr(-2)};$.timepicker.timeRange=function(startTime,endTime,options){return $.timepicker.handleRange("timepicker",startTime,endTime,options)};$.timepicker.dateTimeRange=function(startTime,endTime,options){$.timepicker.dateRange(startTime,endTime,options,"datetimepicker")};$.timepicker.dateRange=function(startTime,endTime,options,method){method=method||"datepicker";$.timepicker.handleRange(method,startTime,endTime,options)};$.timepicker.handleRange=function(method,startTime,endTime,options){$.fn[method].call(startTime,$.extend({onClose:function(dateText,inst){checkDates(this,endTime,dateText)},onSelect:function(selectedDateTime){selected(this,endTime,"minDate")}},options,options.start));$.fn[method].call(endTime,$.extend({onClose:function(dateText,inst){checkDates(this,startTime,dateText)},onSelect:function(selectedDateTime){selected(this,startTime,"maxDate")}},options,options.end));if(method!="timepicker"&&options.reformat){$([startTime,endTime]).each(function(){var format=$(this)[method].call($(this),"option","dateFormat"),date=new Date($(this).val());if($(this).val()&&date){$(this).val($.datepicker.formatDate(format,date))}})}checkDates(startTime,endTime,startTime.val());function checkDates(changed,other,dateText){if(other.val()&&(new Date(startTime.val())>new Date(endTime.val()))){other.val(dateText)}}selected(startTime,endTime,"minDate");selected(endTime,startTime,"maxDate");function selected(changed,other,option){if(!$(changed).val()){return}var date=$(changed)[method].call($(changed),"getDate");if(date.getTime){$(other)[method].call($(other),"option",option,date)}}return $([startTime.get(0),endTime.get(0)])};$.timepicker.version="1.0.3"})(jQuery);
/*
 * jQuery Form Plugin
 * version: 3.09 (16-APR-2012)
 * @requires jQuery v1.3.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */
(function(f){var c={};c.fileapi=f("<input type='file'/>").get(0).files!==undefined;c.formdata=window.FormData!==undefined;f.fn.ajaxSubmit=function(h){if(!this.length){e("ajaxSubmit: skipping submit process - no element selected");return this}var g,C,j,r=this;if(typeof h=="function"){h={success:h}}g=this.attr("method");C=this.attr("action");j=(typeof C==="string")?f.trim(C):"";j=j||window.location.href||"";if(j){j=(j.match(/^([^#]+)/)||[])[1]}h=f.extend(true,{url:j,success:f.ajaxSettings.success,type:g||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},h);var w={};this.trigger("form-pre-serialize",[this,h,w]);if(w.veto){e("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(h.beforeSerialize&&h.beforeSerialize(this,h)===false){e("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var p=h.traditional;if(p===undefined){p=f.ajaxSettings.traditional}var u=[];var F,G=this.formToArray(h.semantic,u);if(h.data){h.extraData=h.data;F=f.param(h.data,p)}if(h.beforeSubmit&&h.beforeSubmit(G,this,h)===false){e("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[G,this,h,w]);if(w.veto){e("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var A=f.param(G,p);if(F){A=(A?(A+"&"+F):F)}if(h.type.toUpperCase()=="GET"){h.url+=(h.url.indexOf("?")>=0?"&":"?")+A;h.data=null}else{h.data=A}var I=[];if(h.resetForm){I.push(function(){r.resetForm()})}if(h.clearForm){I.push(function(){r.clearForm(h.includeHidden)})}if(!h.dataType&&h.target){var i=h.success||function(){};I.push(function(q){var k=h.replaceTarget?"replaceWith":"html";f(h.target)[k](q).each(i,arguments)})}else{if(h.success){I.push(h.success)}}h.success=function(L,q,M){var K=h.context||h;for(var J=0,k=I.length;J<k;J++){I[J].apply(K,[L,q,M||r,r])}};var E=f("input:file:enabled[value]",this);var s=E.length>0;var D="multipart/form-data";var z=(r.attr("enctype")==D||r.attr("encoding")==D);var x=c.fileapi&&c.formdata;e("fileAPI :"+x);var t=(s||z)&&!x;if(h.iframe!==false&&(h.iframe||t)){if(h.closeKeepAlive){f.get(h.closeKeepAlive,function(){H(G)})}else{H(G)}}else{if((s||z)&&x){v(G)}else{f.ajax(h)}}for(var B=0;B<u.length;B++){u[B]=null}this.trigger("form-submit-notify",[this,h]);return this;function v(q){var k=new FormData();for(var J=0;J<q.length;J++){k.append(q[J].name,q[J].value)}if(h.extraData){for(var M in h.extraData){if(h.extraData.hasOwnProperty(M)){k.append(M,h.extraData[M])}}}h.data=null;var L=f.extend(true,{},f.ajaxSettings,h,{contentType:false,processData:false,cache:false,type:"POST"});if(h.uploadProgress){L.xhr=function(){var N=jQuery.ajaxSettings.xhr();if(N.upload){N.upload.onprogress=function(R){var Q=0;var O=R.loaded||R.position;var P=R.total;if(R.lengthComputable){Q=Math.ceil(O/P*100)}h.uploadProgress(R,O,P,Q)}}return N}}L.data=null;var K=L.beforeSend;L.beforeSend=function(O,N){N.data=k;if(K){K.call(N,O,h)}};f.ajax(L)}function H(ah){var M=r[0],L,ad,X,af,aa,O,S,Q,R,ab,ae,V;var P=!!f.fn.prop;if(f(":input[name=submit],:input[id=submit]",M).length){alert('Error: Form elements must not have name or id of "submit".');return}if(ah){for(ad=0;ad<u.length;ad++){L=f(u[ad]);if(P){L.prop("disabled",false)}else{L.removeAttr("disabled")}}}X=f.extend(true,{},f.ajaxSettings,h);X.context=X.context||X;aa="jqFormIO"+(new Date().getTime());if(X.iframeTarget){O=f(X.iframeTarget);ab=O.attr("name");if(!ab){O.attr("name",aa)}else{aa=ab}}else{O=f('<iframe name="'+aa+'" src="'+X.iframeSrc+'" />');O.css({position:"absolute",top:"-1000px",left:"-1000px"})}S=O[0];Q={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(ak){var al=(ak==="timeout"?"timeout":"aborted");e("aborting upload... "+al);this.aborted=1;O.attr("src",X.iframeSrc);Q.error=al;if(X.error){X.error.call(X.context,Q,al,ak)}if(af){f.event.trigger("ajaxError",[Q,X,al])}if(X.complete){X.complete.call(X.context,Q,al)}}};af=X.global;if(af&&0===f.active++){f.event.trigger("ajaxStart")}if(af){f.event.trigger("ajaxSend",[Q,X])}if(X.beforeSend&&X.beforeSend.call(X.context,Q,X)===false){if(X.global){f.active--}return}if(Q.aborted){return}R=M.clk;if(R){ab=R.name;if(ab&&!R.disabled){X.extraData=X.extraData||{};X.extraData[ab]=R.value;if(R.type=="image"){X.extraData[ab+".x"]=M.clk_x;X.extraData[ab+".y"]=M.clk_y}}}var W=1;var T=2;function U(al){var ak=al.contentWindow?al.contentWindow.document:al.contentDocument?al.contentDocument:al.document;return ak}var K=f("meta[name=csrf-token]").attr("content");var J=f("meta[name=csrf-param]").attr("content");if(J&&K){X.extraData=X.extraData||{};X.extraData[J]=K}function ac(){var am=r.attr("target"),ak=r.attr("action");M.setAttribute("target",aa);if(!g){M.setAttribute("method","POST")}if(ak!=X.url){M.setAttribute("action",X.url)}if(!X.skipEncodingOverride&&(!g||/post/i.test(g))){r.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(X.timeout){V=setTimeout(function(){ae=true;Z(W)},X.timeout)}function an(){try{var ap=U(S).readyState;e("state = "+ap);if(ap&&ap.toLowerCase()=="uninitialized"){setTimeout(an,50)}}catch(aq){e("Server abort: ",aq," (",aq.name,")");Z(T);if(V){clearTimeout(V)}V=undefined}}var al=[];try{if(X.extraData){for(var ao in X.extraData){if(X.extraData.hasOwnProperty(ao)){al.push(f('<input type="hidden" name="'+ao+'">').attr("value",X.extraData[ao]).appendTo(M)[0])}}}if(!X.iframeTarget){O.appendTo("body");if(S.attachEvent){S.attachEvent("onload",Z)}else{S.addEventListener("load",Z,false)}}setTimeout(an,15);M.submit()}finally{M.setAttribute("action",ak);if(am){M.setAttribute("target",am)}else{r.removeAttr("target")}f(al).remove()}}if(X.forceSync){ac()}else{setTimeout(ac,10)}var ai,aj,ag=50,N;function Z(ap){if(Q.aborted||N){return}try{aj=U(S)}catch(at){e("cannot access response document: ",at);ap=T}if(ap===W&&Q){Q.abort("timeout");return}else{if(ap==T&&Q){Q.abort("server abort");return}}if(!aj||aj.location.href==X.iframeSrc){if(!ae){return}}if(S.detachEvent){S.detachEvent("onload",Z)}else{S.removeEventListener("load",Z,false)}var an="success",ar;try{if(ae){throw"timeout"}var am=X.dataType=="xml"||aj.XMLDocument||f.isXMLDoc(aj);e("isXml="+am);if(!am&&window.opera&&(aj.body===null||!aj.body.innerHTML)){if(--ag){e("requeing onLoad callback, DOM not available");setTimeout(Z,250);return}}var au=aj.body?aj.body:aj.documentElement;Q.responseText=au?au.innerHTML:null;Q.responseXML=aj.XMLDocument?aj.XMLDocument:aj;if(am){X.dataType="xml"}Q.getResponseHeader=function(ax){var aw={"content-type":X.dataType};return aw[ax]};if(au){Q.status=Number(au.getAttribute("status"))||Q.status;Q.statusText=au.getAttribute("statusText")||Q.statusText}var ak=(X.dataType||"").toLowerCase();var aq=/(json|script|text)/.test(ak);if(aq||X.textarea){var ao=aj.getElementsByTagName("textarea")[0];if(ao){Q.responseText=ao.value;Q.status=Number(ao.getAttribute("status"))||Q.status;Q.statusText=ao.getAttribute("statusText")||Q.statusText}else{if(aq){var al=aj.getElementsByTagName("pre")[0];var av=aj.getElementsByTagName("body")[0];if(al){Q.responseText=al.textContent?al.textContent:al.innerText}else{if(av){Q.responseText=av.textContent?av.textContent:av.innerText}}}}}else{if(ak=="xml"&&!Q.responseXML&&Q.responseText){Q.responseXML=Y(Q.responseText)}}try{ai=k(Q,ak,X)}catch(ap){an="parsererror";Q.error=ar=(ap||an)}}catch(ap){e("error caught: ",ap);an="error";Q.error=ar=(ap||an)}if(Q.aborted){e("upload aborted");an=null}if(Q.status){an=(Q.status>=200&&Q.status<300||Q.status===304)?"success":"error"}if(an==="success"){if(X.success){X.success.call(X.context,ai,"success",Q)}if(af){f.event.trigger("ajaxSuccess",[Q,X])}}else{if(an){if(ar===undefined){ar=Q.statusText}if(X.error){X.error.call(X.context,Q,an,ar)}if(af){f.event.trigger("ajaxError",[Q,X,ar])}}}if(af){f.event.trigger("ajaxComplete",[Q,X])}if(af&&!--f.active){f.event.trigger("ajaxStop")}if(X.complete){X.complete.call(X.context,Q,an)}N=true;if(X.timeout){clearTimeout(V)}setTimeout(function(){if(!X.iframeTarget){O.remove()}Q.responseXML=null},100)}var Y=f.parseXML||function(ak,al){if(window.ActiveXObject){al=new ActiveXObject("Microsoft.XMLDOM");al.async="false";al.loadXML(ak)}else{al=(new DOMParser()).parseFromString(ak,"text/xml")}return(al&&al.documentElement&&al.documentElement.nodeName!="parsererror")?al:null};var q=f.parseJSON||function(ak){return window["eval"]("("+ak+")")};var k=function(ap,an,am){var al=ap.getResponseHeader("content-type")||"",ak=an==="xml"||!an&&al.indexOf("xml")>=0,ao=ak?ap.responseXML:ap.responseText;if(ak&&ao.documentElement.nodeName==="parsererror"){if(f.error){f.error("parsererror")}}if(am&&am.dataFilter){ao=am.dataFilter(ao,an)}if(typeof ao==="string"){if(an==="json"||!an&&al.indexOf("json")>=0){ao=q(ao)}else{if(an==="script"||!an&&al.indexOf("javascript")>=0){f.globalEval(ao)}}}return ao}}};f.fn.ajaxForm=function(g){g=g||{};g.delegation=g.delegation&&f.isFunction(f.fn.on);if(!g.delegation&&this.length===0){var h={s:this.selector,c:this.context};if(!f.isReady&&h.s){e("DOM not ready, queuing ajaxForm");f(function(){f(h.s,h.c).ajaxForm(g)});return this}e("terminating; zero elements found by selector"+(f.isReady?"":" (DOM not ready)"));return this}if(g.delegation){f(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,a).on("submit.form-plugin",this.selector,g,b).on("click.form-plugin",this.selector,g,a);return this}return this.ajaxFormUnbind().bind("submit.form-plugin",g,b).bind("click.form-plugin",g,a)};function b(h){var g=h.data;if(!h.isDefaultPrevented()){h.preventDefault();f(this).ajaxSubmit(g)}}function a(k){var j=k.target;var h=f(j);if(!(h.is(":submit,input:image"))){var g=h.closest(":submit");if(g.length===0){return}j=g[0]}var i=this;i.clk=j;if(j.type=="image"){if(k.offsetX!==undefined){i.clk_x=k.offsetX;i.clk_y=k.offsetY}else{if(typeof f.fn.offset=="function"){var p=h.offset();i.clk_x=k.pageX-p.left;i.clk_y=k.pageY-p.top}else{i.clk_x=k.pageX-j.offsetLeft;i.clk_y=k.pageY-j.offsetTop}}}setTimeout(function(){i.clk=i.clk_x=i.clk_y=null},100)}f.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};f.fn.formToArray=function(B,g){var A=[];if(this.length===0){return A}var p=this[0];var s=B?p.getElementsByTagName("*"):p.elements;if(!s){return A}var u,t,r,C,q,x,k;for(u=0,x=s.length;u<x;u++){q=s[u];r=q.name;if(!r){continue}if(B&&p.clk&&q.type=="image"){if(!q.disabled&&p.clk==q){A.push({name:r,value:f(q).val(),type:q.type});A.push({name:r+".x",value:p.clk_x},{name:r+".y",value:p.clk_y})}continue}C=f.fieldValue(q,true);if(C&&C.constructor==Array){if(g){g.push(q)}for(t=0,k=C.length;t<k;t++){A.push({name:r,value:C[t]})}}else{if(c.fileapi&&q.type=="file"&&!q.disabled){if(g){g.push(q)}var h=q.files;if(h.length){for(t=0;t<h.length;t++){A.push({name:r,value:h[t],type:q.type})}}else{A.push({name:r,value:"",type:q.type})}}else{if(C!==null&&typeof C!="undefined"){if(g){g.push(q)}A.push({name:r,value:C,type:q.type,required:q.required})}}}}if(!B&&p.clk){var w=f(p.clk),z=w[0];r=z.name;if(r&&!z.disabled&&z.type=="image"){A.push({name:r,value:w.val()});A.push({name:r+".x",value:p.clk_x},{name:r+".y",value:p.clk_y})}}return A};f.fn.formSerialize=function(g){return f.param(this.formToArray(g))};f.fn.fieldSerialize=function(h){var g=[];this.each(function(){var q=this.name;if(!q){return}var k=f.fieldValue(this,h);if(k&&k.constructor==Array){for(var p=0,j=k.length;p<j;p++){g.push({name:q,value:k[p]})}}else{if(k!==null&&typeof k!="undefined"){g.push({name:this.name,value:k})}}});return f.param(g)};f.fn.fieldValue=function(q){for(var p=[],j=0,g=this.length;j<g;j++){var k=this[j];var h=f.fieldValue(k,q);if(h===null||typeof h=="undefined"||(h.constructor==Array&&!h.length)){continue}if(h.constructor==Array){f.merge(p,h)}else{p.push(h)}}return p};f.fieldValue=function(g,r){var j=g.name,z=g.type,A=g.tagName.toLowerCase();if(r===undefined){r=true}if(r&&(!j||g.disabled||z=="reset"||z=="button"||(z=="checkbox"||z=="radio")&&!g.checked||(z=="submit"||z=="image")&&g.form&&g.form.clk!=g||A=="select"&&g.selectedIndex==-1)){return null}if(A=="select"){var s=g.selectedIndex;if(s<0){return null}var w=[],h=g.options;var p=(z=="select-one");var u=(p?s+1:h.length);for(var k=(p?s:0);k<u;k++){var q=h[k];if(q.selected){var x=q.value;if(!x){x=(q.attributes&&q.attributes.value&&!(q.attributes.value.specified))?q.text:q.value}if(p){return x}w.push(x)}}return w}return f(g).val()};f.fn.clearForm=function(g){return this.each(function(){f("input,select,textarea",this).clearFields(g)})};f.fn.clearFields=f.fn.clearInputs=function(g){var h=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var j=this.type,i=this.tagName.toLowerCase();if(h.test(j)||i=="textarea"){this.value=""}else{if(j=="checkbox"||j=="radio"){this.checked=false}else{if(i=="select"){this.selectedIndex=-1}else{if(g){if((g===true&&/hidden/.test(j))||(typeof g=="string"&&f(this).is(g))){this.value=""}}}}}})};f.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};f.fn.enable=function(g){if(g===undefined){g=true}return this.each(function(){this.disabled=!g})};f.fn.selected=function(g){if(g===undefined){g=true}return this.each(function(){var h=this.type;if(h=="checkbox"||h=="radio"){this.checked=g}else{if(this.tagName.toLowerCase()=="option"){var i=f(this).parent("select");if(g&&i[0]&&i[0].type=="select-one"){i.find("option").selected(false)}this.selected=g}}})};f.fn.ajaxSubmit.debug=false;function e(){if(!f.fn.ajaxSubmit.debug){return}var g="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(g)}else{if(window.opera&&window.opera.postError){window.opera.postError(g)}}}})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.widget",{options:{mode:"browser"},_create:function(){var c=this,f=this.options,e=this.element;f.mode=f.readonly&&f.mode=="edit"?"browser":f.mode;e.addClass("an-widget "+f.mode)[0].contentEditable=false;f.metadata=e.getMetadata()||{};f.attributes=attributes(e.get(0));f["transient"]=f.attributes["transient"];f.id=e.attr("id");if(f.id){f.id=f.id.replace(/-/g,".")}f.type=e.attr("type");if(a.type(f.parent)=="function"){f.parent=f.parent()}this.content=e.children("div.content");if(this.content.size()==0){this.content=a("<div class='content'/>").appendTo(e)}this._makeResizable();e.bind("metadatachanged.widget",function(i,h,g){i.stopImmediatePropagation();c._reloadMetadata(h,g)}).bind("attributeschanged.widget",function(i,g,h){i.stopImmediatePropagation();f.attributes=g;c._trigger("optionchanged",null,{key:"attributes",value:g,oldValue:h})}).bind("dblclick.widget click.widget change.widget",function(g){if(a(g.target).closest(".widget")[0]==c.element[0]){setTimeout(function(){e.trigger(a.Event(g,{type:"widget"+g.type}),c)},20)}})},_init:function(){this.refresh()},selectable:function(c){return this.options.mode=="design"},_makeResizable:function(){var c=this,g=this.options,f=this.element,e=null;f.removeClass("fill-width auto-width fill-height auto-height");if(g.width=="fill"||g.width=="auto"){f.css("width","").addClass(g.width+"-width")}else{e="e"}if(g.height=="fill"||g.height=="auto"){f.css("height","").addClass(g.height+"-height")}else{e=e?(e+",s,se"):"s"}if(e&&(g.mode=="design"||g.resizable)){f.resizable({handles:e,stop:function(i,h){c._trigger("resize",null,{size:h.size,oldSize:h.originalSize})}})}},option:function(c,e){var f=this.options;if(c==="mode"&&e==="edit"&&f.readonly){e="browser"}if(c==="value"&&e===b){return f.value}if(c==="actionSet"&&e===b){return f.actioSet}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(e,f){var g=this.options,c=g[e];if(!equals(f,c)){a.Widget.prototype._setOption.apply(this,arguments);this._handleChange(e,f,c);this._trigger("optionchanged",null,{key:e,value:f,oldValue:c,isTransient:g.isTransient})}return this},_handleChange:function(e,f,c){if(e==="mode"||e==="value"){if(e==="mode"){this.element.removeClass(c).addClass(f)}this.refresh()}else{if(e=="width"||e=="height"){this._makeResizable()}}},_reloadMetadata:function(e,c){this.options.metadata=e;this.option(e[this.widgetName]);this._trigger("optionchanged",null,{key:"metadata",value:e,oldValue:c})},_updateMetadata:function(){var e=this.options,c=this.element.getMetadata();if(!equals(e.metadata,c)){this.element.setMetadata(e.metadata);this._trigger("optionchanged",null,{key:"metadata",value:e.metadata,oldValue:c})}},refresh:function(){var c=this.options;this["_"+c.mode]&&this["_"+c.mode]()},highlight:function(c){this.element.toggleClass("an-state-hover",c)},scrollTo:function(){var e=this.options,c={onlyIfOutside:true,offsetTop:50,offsetLeft:50};if(e.mode=="design"){e.parent.scrollTo(e.id,c)}else{this.element.ScrollTo(c)}},destroy:function(){this.element.resizable("destroy").unbind(".widget").removeAttr("contenteditable").removeClass("an-widget browser design edit fill-width auto-width fill-height auto-height selected");return a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.field",a.an.widget,{options:{value:""},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var e=this.options,c=this.element;c.addClass("an-field");this.content.empty();e.isTransient=c.attr("transient")},destroy:function(){this.content.remove();this.element.removeClass("an-field");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.box",a.an.widget,{options:{visibleButtonCount:3,height:"auto",link:"raw"},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var e=this.options,c=this.element;c.addClass("an-box ui-corner-all").addClass(e.link=="raw"?"raw":"link").children(".title-bar").remove();this._showTitleBar(!e.hideTitleBar);this._showFootButtons(e.footAreaButtons||[]);c.bind("contextmenu2.box contextmenu.box",function(f){if((e.contextmenu2&&f.type=="contextmenu2")||(!e.contextmenu2&&f.type=="contextmenu")){var g={};if(e.mode=="design"){g.select={type:"menuItem",text:"Select",handler:function(){c.trigger("click")}}}if(!a.isEmptyObject(g)){a(f.target).menu({autoShow:true,menuPosition:{of:f,my:"left top",at:"left bottom"},actions:g,select:function(i,h){a(this).menu("destroy")},collapseAll:function(h){a(this).menu("destroy")}})}}f.preventDefault()})},selectable:function(f){var g=this.options,c=f.target;if(g.hideTitleBar){return c==this.element[0]}else{return a(c).closest("div.title-bar")[0]==this.titleBar[0]}},_showTitleBar:function(c){var f=this.options,e=this.element;if(c){e.addClass("title-bar");if(!this.titleBar){this.titleBar=a("<div class='title-bar ui-widget-header ui-corner-top'/>").prependTo(this.element);this.title=a("<div class='title'/>").html(f.title).appendTo(this.titleBar);this.toolbar=a("<div class='toolbar'/>").appendTo(this.titleBar)}this._refreshToolbarButtons()}else{e.removeClass("title-bar");this.titleBar&&this.titleBar.remove();delete this.titleBar}},_refreshToolbarButtons:function(){var f=this,j=this.options,h=j.toolbarButtons||[];a.each(h,function(i,p){if(i>=j.visibleButtonCount){return false}a("<button class='title-button'/>").appendTo(f.toolbar).button({label:p.label}).click(function(k){f.element.trigger("boxtoolbarbuttonclick",[f,p.id]);k.preventDefault();k.stopImmediatePropagation()})});if(h.length>j.visibleButtonCount){var e=[];for(var g=j.visibleButtonCount;g<h.length;g++){e.push({id:h[g].id,type:"menuItem",text:h[g].label,handler:function(){f.element.trigger("toolbarbuttonclick",[f,this.id])},enabled:function(){return true}})}var c=a("<button class='box-menu'/>").button({label:"Box Menu",text:false,icons:{primary:"box-menu-icon"}}).appendTo(f.toolbar);c.menu({triggerEvent:"click",menuPosition:{of:c,my:"right top",at:"right bottom"},actions:e,select:function(){a(this).menu("collapseAll")}}).click(function(i){i.preventDefault()}).blur(function(i){c.menu("collapseAll")})}},_showFootButtons:function(f){var c=this,e=this.element;if(f&&f.length>0){if(!this.footArea){e.addClass("foot-area");this.footArea=a("<div class='foot-area'/>").appendTo(e)}else{this.footArea.empty()}a.each(f,function(g,h){a("<button class='foot-button'/>").attr("id",h.id).html(h.label).prependTo(c.footArea).button().click(function(i){c.element.trigger("boxfootareabuttonclick",[c,h.id]);i.preventDefault();i.stopImmediatePropagation()})})}else{e.removeClass("foot-area");this.footArea&&this.footArea.remove();delete this.footArea}},newDocument:function(g,h){h=h||{};var e=this,j=this.options,c=h.dbId||j.dbId,f=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var p=k.option("document"),q=h.title||p.title||p._id;e._showFootButtons(h.footAreaButtons||[]);e.option("title",q);h.opened&&h.opened(k)}});Model.newDocument(f,c,g,i);return this},openDocument:function(f,h){h=h||{};var e=this,j=this.options,c=h.dbId||j.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var p=k.option("document"),q=h.title||p.title||p._id;e._showFootButtons(h.footAreaButtons||[]);e.option("title",q);h.opened&&h.opened(k)}});Model.openDocument(g,c,f,i);return this},saveDocument:function(c){c=c||{};var e=this.linkedWidget();if(e&&e.option("isDocumentEditor")){e.save(c)}return this},openForm:function(j,g){g=g||{};var e=this,i=this.options,c=g.dbId||i.dbId,f=a("<div class='target'/>").appendTo(this.content.empty()),h=a.extend(true,{mode:"edit"},g,{opened:function(k){var p=k.option("currentForm"),q=g.title||p.title||p._id;e._showFootButtons(g.footAreaButtons||[]);e.option("title",q);g.opened&&g.opened(k)}});Model.openForm(f,c,j,h);return this},openView:function(c,h){h=h||{};var f=this,j=this.options,e=h.dbId||j.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var p=k.option("view"),q=h.title||p.title||p._id;f._showFootButtons(h.footAreaButtons||[]);f.option("title",q);h.opened&&h.opened(k)}});Model.openView(g,e,c,i);return this},openPage:function(f,h){h=h||{};var e=this,j=this.options,c=h.dbId||j.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{mode:"edit"},h,{opened:function(k){var q=k.option("page"),r=h.title||q.title||q._id;e._showFootButtons(h.footAreaButtons||[]);e.option("title",r);h.opened&&h.opened(k)}});Model.openForm(g,c,f,i);return this},openSideView:function(g,h){h=h||{};var e=this,j=this.options,c=h.dbId||j.dbId,f=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var p=h.title||k.option("title")||k.option("_id");e._showFootButtons(h.footAreaButtons||[]);e.option("title",p);h.opened&&h.opened(page)}});Model.openSideView(f,c,g,i);return this},_browser:function(){var k=this.options,f=k.link;this.option("contextmenu2",false);this.content[0].contentEditable=false;if(f&&f!="raw"){var j=this.content.children(".target"),h=j.data(),g=false;for(var c in h){if(a.inArray(c,["editor","gridview","formview","page","sideview","outline"])!=-1){h[c].option("mode","browser");g=true}}if(!g){var e={mode:"browser",dbId:k.odbId||k.dbId},p=k.targetId;if(f=="documentType"){this.newDocument(p,e)}else{if(f=="document"){this.openDocument(p,e)}else{if(f=="form"){this.openForm(p,e)}else{if(f=="view"){this.openView(p,e)}else{if(f=="page"){this.openPage(p,e)}else{if(f=="sideView"){this.openSideView(p,e)}}}}}}}}},linkedWidget:function(){var e=this.content.children(".an-gridview,.an-formview,.an-page,.an-editor").data(),c=null;a.each(e,function(){if(a.inArray(this.widgetName,["editor","gridview","formview","page"])!=-1){c=this;return false}});return c},_edit:function(){var g=this.options,p=g.link;this.option("contextmenu2",false);this.content[0].contentEditable=false;if(p&&p!="raw"){var k=this.content.children(".target"),h=k.data(),c=false;for(var j in h){if(j=="editor"){h[j].option("mode","edit");c=true}if(a.inArray(j,["gridview","formview","page","sideview","outline"])!=-1){h[j].option("mode","browser");c=true}}if(!c){var e=g.targetId,f={mode:"browser",dbId:g.odbId||g.dbId},q={mode:"edit",dbId:g.odbId||g.dbId};if(p=="documentType"){this.newDocument(e,q)}else{if(p=="document"){this.openDocument(e,q)}else{if(p=="form"){this.openForm(e,q)}else{if(p=="view"){this.openView(e,f)}else{if(p=="page"){this.openPage(e,q)}else{if(p=="sideView"){this.openSideView(e,f)}}}}}}}}},_design:function(){var e=this.options,c=e.link;this._browser();this.option("contextmenu2",true);if(c=="raw"){this.content[0].contentEditable=true}},_handleChange:function(e,f,c){if(e==="title"){this.title&&this.title.html(f)}else{if(e==="hideTitleBar"){this._showTitleBar(!f)}}return a.an.widget.prototype._handleChange.apply(this,arguments)},destroy:function(){var e=this.options,c=e.link;if(c&&c!="raw"){this.content.remove()}else{this.content.removeAttr("contenteditable")}this.titleBar&&this.titleBar.remove();this.footArea&&this.footArea.remove();this.element.unbind(".box").removeClass("an-box ui-corner-all title-bar");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.inputfield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-inputfield").find("input").remove();this.input=this._createInput().appendTo(this.element)},_createInput:function(){var e=this,f=this.options;var c=a("<input type='"+f.type+"'/>").attr({name:f.id}).addClass("ui-widget-content ui-corner-all").bind("change.inputfield keyup.inputfield",function(i){var h=e.input.val(),g=f.value;if(h!=g){f.value=h;e._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}}).bind("dblclick.inputfield",function(g){g.stopImmediatePropagation()}).hide();if(!a.isEmptyObject(f.validate)){c.addClass(a.toJSON({validate:f.validate}))}return c},_browser:function(){this.input.hide();this.content.html(this.options.value+"").show()},_edit:function(){this.input.val(this.options.value).removeAttr("style");this.content.hide()},_design:function(){this.input.hide();this.content.html(this.options.value+"").show()},highlight:function(c){(this.options.mode=="edit"?this.input:this.element).toggleClass("an-state-hover",c)},destroy:function(){this.input.unbind(".inputfield").remove();this.element.removeClass("an-inputfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(b,c){var a="C:\\fakepath\\";b.widget("an.fileinput",{options:{browserButtonText:"Browse",uploadParams:{},uploadURL:"",uploadButtonText:"Upload",inputText:""},_create:function(){var e=this,f=this.options;this.parent=this.element.parent();this.fileFile=this.element;this.wrapper=b("<div class='wrapper' />").insertAfter(this.fileFile);this.fileWrapper=b("<div class='fileinput-wrapper' />").hover(function(){e.browserButton.addClass("ui-state-hover")},function(){e.browserButton.removeClass("ui-state-hover ui-state-active")}).bind("mousemove.fileinput",function(h){var g=e.fileFile,i=b(this).offset();g.css({left:(h.pageX-i.left)-(g.width()/1.2),top:(h.pageY-i.top)-(g.height()/2)})}).bind("mousedown.fileinput",function(g){e.browserButton.addClass("ui-state-active")}).bind("mouseup.fileinput",function(g){e.browserButton.removeClass("ui-state-active")}).appendTo(this.wrapper);this.fileFile.addClass("fileinput-file").appendTo(this.fileWrapper);this.fileInput=b("<div class='fileinput-input ui-widget-content ui-corner-left' />").text(this._getText()).insertBefore(this.fileFile);this.browserButtonText=b("<span class='fileinput-button-text' />").text(f.browserButtonText);this.browserButton=b("<span class='fileinput-button ui-state-default ui-widget-header ui-corner-right' />").append(this.browserButtonText).insertAfter(this.fileInput);if(f.upload){this.uploadButtonText=b("<span class='fileinput-button-text' />").text(f.uploadButtonText);this.uploadButton=b("<span class='upload-button ui-state-default ui-widget-header ui-corner-right' />").append(this.uploadButtonText).insertAfter(this.fileWrapper).click(function(h){e.fileInput.progressbar();var g=b('<form action="" method="POST"></form>');e.fileFile.clone().attr("name","attachment").appendTo(g);b.each(f.uploadParams,function(j,i){b('<input type="hidden">').attr("name",j).attr("value",i).appendTo(g)});g.ajaxSubmit({url:f.uploadURL,uploadProgress:function(p,i,k,j){e.fileInput.progressbar("option","value",j*100)},success:function(i){e.fileInput.progressbar("destroy").addClass("ui-widget-content");e.element.trigger("uploaded",[i]);e.reset()}})})}this.fileFile.bind("change.fileinput mouseout.fileinput",function(g){e.fileInput.text(e._getText())}).bind("focusin.fileinput",function(){e.browserButton.addClass("ui-state-hover")}).bind("focusout.fileinput",function(){e.browserButton.removeClass("ui-state-hover")})},_getText:function(){var e=this.getValue(),f=this.options.inputText;if(e==""){return f}else{return e}},getValue:function(){return fileValue=this.fileFile.val().replace(a,"")},reset:function(){this.fileInput.text(this.options.inputText)},destroy:function(){this.fileFile.removeClass("fileinput-file").appendTo(this.parent);this.wrapper.remove();b.Widget.prototype.destroy.call(this)},hide:function(){this.wrapper.hide()},show:function(){this.wrapper.show()},_setOption:function(e,f){b.Widget.prototype._setOption.apply(this,arguments);switch(e){case"browserButtonText":this.browserButtonText.text(f);break;case"inputText":this.fileInput.text(this._getText());break}}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.textfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-textfield")},destroy:function(){this.element.removeClass("an-textfield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.radiofield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);var c=this,f=this.options,e=this.element.attr("value");this.element.addClass("an-radiofield");this.content.hide();this.input.attr("value",e).css({width:"",height:""}).prop("checked",e==f.value).show();this.input.unbind("change keypress").bind("change.checkboxfield",function(g){c._trigger("optionchanged",null,{key:"value",value:e,oldValue:null,isTransient:c.element.is(".isTransient")})})},_makeResizable:function(){},option:function(e,f){if(e=="value"){var c=this.element.attr("value");if(f===b){return this.input.prop("checked")?c:null}else{this.input.prop("checked",f==c);this.refresh();return}}return a.an.inputfield.prototype.option.apply(this,arguments)},_browser:function(){this.input.attr("disabled","disabled")},_edit:function(){this.input.removeAttr("disabled")},_design:function(){this.input.hide()},highlight:function(c){this.element.toggleClass("an-state-hover",c)},destroy:function(){this.element.removeClass("an-radiofield");a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.checkboxfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-checkboxfield");var c=this;this.content.hide();this.input.unbind("change keypress").bind("change.checkboxfield",function(f){c.option("value",c.input.prop("checked"))}).css({width:"",height:""}).show()},_makeResizable:function(){},_browser:function(){this.input.prop("checked",this.options.value).attr("disabled","disabled")},_edit:function(){this.input.prop("checked",this.options.value).removeAttr("disabled")},_design:function(){this.input.hide();this.content.show()},highlight:function(c){this.element.toggleClass("an-state-hover",c)},destroy:function(){this.input.unbind(".checkboxfield");this.element.removeClass("an-checkboxfield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.passwordfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-passwordfield")},_browser:function(){this.input.hide();this.content.html("********").show()},_edit:function(){this.content.hide();this.input.val(this.options.value).show()},_design:function(){this.input.hide();this.content.html("********").show()},destroy:function(){this.element.removeClass("an-passwordfield");a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.datetimefield",$.an.inputfield,{_create:function(){$.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-datetimefield")},_edit:function(){var date=new Date();var opts={hour:date.getHours(),minute:date.getMinutes(),dateFormat:this.options.dateFormat?this.options.dateFormat:"mm/dd/yy",minDate:this.options.minDate&&eval("("+this.options.minDate+")")||null,maxDate:this.options.maxDate&&eval("("+this.options.maxDate+")")||null,changeMonth:true,changeYear:true,onClose:function(){var $this=$(this);$this.valid&&$this.valid()}};var lng=window.database.local;if(lng&&lng!="en"){$.extend(opts,$.i18n.datepicker)}$.an.inputfield.prototype._edit.apply(this,arguments);this.input.removeClass("hasDatepicker");if(this.options.time=="y"){this.input.datetimepicker(opts)}else{this.input.datepicker(opts)}},destroy:function(){this.input.datepicker("destroy");this.element.removeClass("an-datetimefield");return $.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.textareafield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);var e=this,g=this.options,f=this.element;f.addClass("an-textareafield");var c=this.textarea=a("<textarea type='"+g.type+"'/>").attr("name",g.id).addClass("ui-widget-content ui-corner-all").appendTo(a("<div class='textarea-wrapper'/>").appendTo(f));if(!a.isEmptyObject(g.validate)){c.addClass(a.toJSON({validate:g.validate}))}c.bind("change.textareafield keyup.textareafield",function(j){j.preventDefault();var i=c.val(),h=g.value;if(i!=h){g.value=i;e._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}}).bind("dblclick.textareafield",function(h){h.stopImmediatePropagation()})},_browser:function(){var c=this.options;this.textarea.hide();this.content.html(c.pre?"<pre>"+c.value+"</pre>":c.value).show()},_edit:function(){var c=this.options;this.content.hide();this.textarea.val(c.value).show()},_design:function(){var c=this.options;this.textarea.hide();this.content.html(c.pre?"<pre>"+c.value+"</pre>":c.value).show()},destroy:function(){this.textarea.unbind(".textareafield").parent().remove();this.element.removeClass("an-textareafield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.rtefield",a.an.field,{options:{showToolbar:true},_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-rtefield");var c=this,e=this.options;this.content.bind("change.rtefield",function(h){h.preventDefault();var g=c.content.rte("option","content"),f=e.value;if(g!=f){e.value=g;c._trigger("optionchanged",null,{key:"value",value:g,oldValue:f,isTransient:e.isTransient})}})},_browser:function(){this.content.rte("destroy").html(this.options.value);this.content.find(".widget[type=tabsx]").each(function(){var c=a(this);if(c.is(".an-tabsxwidget")){c.data("tabsxwidget").option("mode","browser")}else{c.tabsxwidget({parent:function(){return self},mode:"browser"})}})},_edit:function(){var c=this.options;this.content.rte({content:c.value,dbId:c.dbId,showToolbar:c.showToolbar,stylesheet:c.stylesheet,cssClass:c.cssClass,resizable:c.resizable,cssfiles:["stylesheets/rte/rte-design.css","stylesheets/jquery-ui-1.8.24.custom.css","stylesheets/base.css"].concat(c.globalCSSFiles).concat(c.localCSSFiles),jsfiles:[].concat(c.globalJSFiles).concat(c.localJSFiles)})},_design:function(){this._browser()},destroy:function(){this.content.rte("destroy");this.element.removeClass("an-rtefield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.selectfield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);var c=this,g=this.options,e=this.element;e.addClass("an-selectfield");var f=this.select=a("<select />").attr("name",g.id).appendTo(e);a("<option/>").attr("value","").html("").appendTo(f);a.each(g.selectItems||[],function(){a("<option/>").attr("value",this.value).html(this.label).appendTo(f)});if(!a.isEmptyObject(g.validate)){f.addClass(a.toJSON({validate:g.validate}))}f.bind("change.selectfield",function(j){j.preventDefault();var i=f.val(),h=g.value;if(i!=h){g.value=i;c._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}})},_browser:function(){var c=this,e=this.options;this.select.hide();a.each(e.selectItems,function(){if(this.value==e.value){c.content.html(this.label).show();return false}})},_edit:function(){this.content.hide();this.select.val(this.options.value).show()},_design:function(){var c=this,e=this.options;this.select.hide();a.each(e.selectItems,function(){if(this.value==e.value){c.content.html(this.label).show();return false}})},destroy:function(){this.select.unbind(".selectfield").remove();this.element.removeClass("an-selectfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.filefield",a.an.inputfield,{options:{tags:[],sortBy:"name",mode:"browser",value:[],maxCount:Number.MAX_VALUE,itemWidth:64,itemHeight:64},_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);var e=this,f=this.options,g=this.content;this.element.addClass("an-filefield wrapper");this.files=a("<ul class='grid'/>").appendTo(g);this.loadIcons();g.delegate("li[data-id][data-id!=uploadButton]","hover.filefield",function(c){if(f.mode!="edit"){return}if(c.type=="mouseenter"){a(this).find("img.button").remove();a("<img class='button' width='24' height='24' src='stylesheets/images/delete.png' />").appendTo(this).position({of:a(this),my:"right top",at:"right top"})}else{if(c.type=="mouseleave"){a(this).find("img.button").remove()}}}).delegate("img.button","hover.filefield",function(c){if(c.type=="mouseenter"){a(this).addClass("ui-state-hover")}else{if(c.type=="mouseleave"){a(this).removeClass("ui-state-hover ui-state-active")}}}).delegate("img.button","mousedown.filefield",function(c){a(this).addClass("ui-state-active")}).delegate("img.button","mouseup.filefield",function(c){a(this).removeClass("ui-state-active")}).delegate("img.button","click.filefield",function(j){j.preventDefault();j.stopImmediatePropagation();var k=a(this).closest("li").attr("data-id"),c=[].concat(f.value);for(var h=0;h<f.value.length;h++){if(f.value[h]._id==k){f.value[h]._del=true;break}}e.loadIcons();e._trigger("optionchanged",null,{key:"value",value:f.value,oldValue:c,isTransient:f.isTransient})}).delegate("li[data-id=uploadButton]","click.filefield",function(c){c.preventDefault();c.stopImmediatePropagation();e.input.click()})},_createInput:function(){return a("<input type='file'/>").hide().appendTo(this.element).bind("change",a.proxy(this,"_uploadFile"))},_uploadFile:function(g){var c=this,h=this.options,f=this.files.find("li[data-id=uploadButton]");a.ans.postTemp(this.input,{uploadProgress:function(k,e,j,i){f.progressbar("option","value",i*100)},success:function(i){f.progressbar("destroy").addClass("ui-widget-content");i._tmp=true;var e=[].concat(h.value);h.value.push(i);c.loadIcons();c._trigger("optionchanged",null,{key:"value",value:h.value,oldValue:e,isTransient:h.isTransient})}})},loadIcons:function(){var e=this,g=this.options;this.files.empty();a.each(g.value,function(i,h){if(!h._del){e._addIcon(h)}});if(g.mode=="edit"||g.mode=="design"){var f=this.files.children().size();if((f<g.maxCount)||(f<1&&g.maxCount==1)){var c=a("<li/>").attr("data-id","uploadButton");a("<img/>").css({width:g.itemWidth,height:g.itemHeight}).attr("src","stylesheets/images/selection.png").appendTo(c);c.appendTo(this.files)}}},_addIcon:function(g){var i=this.options,c=a("<li/>").attr("data-id",g._id),h="stylesheets/images/file.png",f="";if(g._tmp){f="/tmp/"+g._id;if(/^image\/.*/.test(g.contentType)){h=f}}else{if(g.metadata){f=i.url+"/"+g.metadata.filepath;if(/^image\/.*/.test(g.contentType)){h=f}}}var e=a("<img/>").css({width:i.itemWidth,height:i.itemHeight}).attr("src",h);if(i.downloadable){e.wrap("<a target='_blank'/>").parent().attr("href",f).appendTo(c)}else{e.appendTo(c)}if(i.showFileName){a("<strong/>").text(g.filename).appendTo(c)}if(i.showFileSize){a("<span/>").text(g.length).appendTo(c)}c.appendTo(this.files)},_addUploadButton:function(e){var f=this.options;if((e.size()>=f.maxCount)||(e.size()>=1&&f.maxCount==1)){return e}var c=a("<li/>").attr("data-id","uploadButton");a("<img/>").css({width:f.itemWidth,height:f.itemHeight}).attr("src","stylesheets/images/selection.png").appendTo(c);return e.add(c.get())},_delUploadButton:function(){this.files.find("li#uploadButton").remove()},sort:function(e,g){var h=this.options,f=null;if(e&&e.length){f=this.data.find("li."+e.join("."))}else{f=this.data.find("li")}function c(k,i){var j={reversed:false,by:function(p){return p.text()}};a.extend(j,i);arr=k.get();arr.sort(function(r,p){var s=j.by(a(r));var q=j.by(a(p));if(j.reversed){return(s<q)?1:(s>q)?-1:0}else{return(s<q)?-1:(s>q)?1:0}});return a(arr)}if(g=="size"){f=c(f,{by:function(i){return parseFloat(a(i).find("span").text())}})}else{f=c(f,{by:function(i){return a(i).find("strong").text().toLowerCase()}})}if(h.mode=="edit"||h.mode=="design"){f=this._addUploadButton(f)}this.files.quicksand(f,{duration:800,easing:"easeInOutQuad",useScaling:true},function(){})},_handleChange:function(e,f,c){a.an.inputfield.prototype._setOption.apply(this,arguments);if(e==="sortBy"){var g=this.options;this.sort(g.tags,g.sortBy)}},refresh:function(){this.loadIcons()},destroy:function(){this.content.undelegate(".filefield");this.element.removeClass("an-filefield wrapper");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.gridfield",$.an.field,{options:{mode:"browser",title:"",addItemLabel:"Add",editItemLabel:"Edit",deleteItemLabel:"Delete",value:[]},_create:function(){$.an.field.prototype._create.apply(this,arguments);var self=this,o=this.options,c=this.content;this.element.addClass("an-gridfield");this.titlebar=$("<div class='titlebar ui-widget-header'/>").appendTo(c);this.title=$("<span class='title'/>").html(o.title).appendTo(this.titlebar);this.toolbar=$("<span class='toolbar'/>").appendTo(this.titlebar);if(o.converter){o.converter=eval("("+o.converter+")");if(!$.isFunction(o.converter)){o.converter=function(row,col,v){return v}}}var lng=window.database.local;if(lng&&lng!="en"){$.extend(o,$.i18n.gridfield)}this.grid=$("<div/>").css({top:this.titlebar.outerHeight()}).appendTo(c).agilegrid($.extend({dbId:o.dbId,cellRender:function(row,col){var v="",r=o.value[row],cm=this.colModel;if(r){try{v=eval("r."+cm[col].name)}catch(e){}v=v||""}return o.converter?o.converter(row,col,v):v},leftHeaderRender:function(row){return row+1},columnResize:function(e,data){if(o.mode=="design"){self._updateMetadata()}},optionchanged:function(e,data){if(o.mode=="design"&&data.key=="colModel"){self._updateMetadata()}}},o.gridOptions));$.each(["addItem","editItem","deleteItem"],function(k,v){$("<button class='title-button'/>").attr("id",v).html(o[v+"Label"]).appendTo(self.toolbar).button().click(function(e){self["_"+$(e.target).closest("button").attr("id")]();return false})})},_updateMetadata:function(){var opts={colModel:this.grid.agilegrid("option","colModel"),totalColCount:this.grid.agilegrid("option","totalColCount")};$.extend(true,this.options.metadata,{gridfield:{gridOptions:opts}});return $.an.field.prototype._updateMetadata.apply(this,arguments)},_addItem:function(){this._createItemEditor(this.options.formId)},_editItem:function(){var o=this.options,row=0;$.each(this.grid.agilegrid("option","rowSelections"),function(k,v){if(v){row=k;return false}});this._createItemEditor(o.formId,row)},_deleteItem:function(){var o=this.options,sel=this.grid.agilegrid("option","rowSelections"),value=[];$.each(o.value,function(k,v){if(!sel[k]){value.push(v)}});this._setValue(value)},_setValue:function(value){var o=this.options;var oldValue=o.value;o.value=value;this.grid.agilegrid("option","rowCount",value.length).agilegrid("refresh");this.element.trigger("change");this._trigger("optionchanged",null,{key:"value",value:value,oldValue:oldValue,isTransient:o.isTransient})},_createItemEditor:function(formId,row){var self=this,o=this.options;o.value=o.value||[];$.ans.getDoc(o.dbId,formId,null,function(err,form){$("<div/>").dialog($.extend({title:form.title||form.name||form._id,autoOpen:true,height:500,width:600,modal:true,open:function(event,ui){var doc=new DocWrapper(o.value[row]||{});$(this).form({form:form,document:doc,url:o.url,dbId:o.dbId,mode:"edit",ignoreEscape:true})},buttons:{OK:function(){if(!(o.gridOptions.validate)||(o.gridOptions.validate&&$(this).form("validate"))){var $this=$(this),doc=$this.form("option","document").getDoc(),value=[].concat(o.value);if(row!==undefined){value.splice(row,1,doc)}else{value.push(doc)}self._setValue(value);$this.dialog("close")}},Cancel:function(){$(this).dialog("close")}},close:function(){$(this).form("destroy").remove()}},o.dialogOptions))})},_handleChange:function(key,value,oldValue){$.an.field.prototype._handleChange.apply(this,arguments);if(key==="title"){this.title.html(value)}},_browser:function(){var o=this.options;this.grid.agilegrid($.extend(true,{},{rowCount:(o.value&&o.value.length)||0,isColumnResizable:false,isRowResizable:false,contextmenu2:false},o.gridOptions)).agilegrid("refresh");this.toolbar.hide()},_edit:function(){this._browser();this.toolbar.show()},_design:function(){var o=this.options;this.grid.agilegrid($.extend(true,{},{rowCount:(o.value&&o.value.length)||0,isColumnResizable:true,isRowResizable:true,columnEditable:true,contextmenu2:true},o.gridOptions)).agilegrid("refresh");this.toolbar.show()},destroy:function(){$(window).unbind("resize.an-gridfield",this._proxy);this.element.removeClass("an-gridfield");return $.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.jsrenderfield",$.an.field,{options:{mode:"browser",selector:"",browserTemplate:"",editorTemplate:"",value:[]},_create:function(){$.an.field.prototype._create.apply(this,arguments);var o=this.options,c=this.content;this.element.addClass("an-jsrenderfield");try{c.html(o.content)}catch(e){}if(o.templates){var obj={};for(var i=0;i<o.templates.length;i++){obj[o.templates[i].name]=o.templates[i].content}$.templates(obj)}if(o.converters){var conv={};var tmp=null;for(var j=0;j<o.converters.length;j++){tmp=eval("(0,"+o.converters[j]["function"]+")");if(!$.isFunction(tmp)){conv[o.converters[j]["name"]]=function(v){return v}}else{conv[o.converters[j]["name"]]=tmp}}$.views.converters(conv)}},_notify:function(oldValue,value){var o=this.options;if(value!=oldValue){o.value=value;this._trigger("optionchanged",null,{key:"value",value:value,oldValue:oldValue,isTransient:o.isTransient})}},appendValue:function(value){var o=this.options,oldValue=[].concat(o.value);o.value.push(value);this.refresh();this._notify(oldValue,o.value)},insertValue:function(index,value){var o=this.options,oldValue=[].concat(o.value);o.value.splice(index,1,value);this.refresh();this._notify(oldValue,o.value)},delValue:function(index){var o=this.options,oldValue=[].concat(o.value);o.value.splice(index,1);this.refresh();this._notify(oldValue,o.value)},getValue:function(index){var o=this.options;return o.value[index]},replaceValue:function(index,value){var o=this.options,oldValue=[].concat(o.value);o.value[index]=value;this.refresh();this._notify(oldValue,o.value)},_browser:function(){var o=this.options;if(o.browserTemplate!=undefined&&o.browserTemplate!=""){var html=$.render[o.browserTemplate](o.value);$(o.selector,this.element).html(html)}else{if(o.templates){var html=$.render[o.templates[0].name](o.value);$(o.selector,this.element).html(html)}}},_edit:function(){var o=this.options;if(o.editorTemplate!=undefined&&o.editorTemplate!=""){var html=$.render[o.editorTemplate](o.value);$(o.selector,this.element).html(html)}else{if(o.templates){var html=$.render[o.templates[0].name](o.value);$(o.selector,this.element).html(html)}}},_design:function(){this._browser()},destroy:function(){this.element.removeClass("an-jsrenderfield");return $.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.buttonfield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-buttonfield");this.content.button({label:this.options.label})},destroy:function(){this.content.button("destroy");this.element.removeClass("an-buttonfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.tabsxwidget",$.an.widget,{_create:function(){$.an.widget.prototype._create.apply(this,arguments);var self=this,o=this.options,el=this.element,c=this.content,ul=c.children("ul");el.addClass("an-tabsxwidget");if(ul.length<=0){ul=$("<ul/>").appendTo(c)}c.tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a></li>",destroyTabs:false,duration:o.duration,slideshow:o.slideshow,fxs:eval("("+o.fx+")"),mode:o.mode}).bind("contextmenu2.tabsxwidget contextmenu.tabsxwidget",function(e){if((o.contextmenu2&&e.type=="contextmenu2")||(!o.contextmenu2&&e.type=="contextmenu")){var t=$(e.target),actions={},index=t.closest("li").index(),ul=t.closest("ul");if(o.mode=="design"){actions.add={type:"menuItem",text:"Add Tab",handler:function(){self.insertTab(index)}};if(ul.size()!=0){actions.edit={type:"menuItem",text:"Edit Tab",handler:function(){self.editTab(index)}};actions.del={type:"menuItem",text:"Delete Tab",handler:function(){self.removeTab(index)}}}}if(!$.isEmptyObject(actions)){t.menu({autoShow:true,menuPosition:{of:e,my:"left top",at:"left bottom"},actions:actions,select:function(e,ui){$(this).menu("destroy")},collapseAll:function(e){$(this).menu("destroy")}})}e.preventDefault()}});this._updateContentHeight();if(o.mode=="design"){this._contentEditable(true)}},selectable:function(e){return e.target==this.content.children(".ui-tabs-nav")[0]||e.target==this.element[0]},select:function(id){this.content.tabsx("select",id)},_updateContentHeight:function(){var o=this.options,c=this.content,css={},ul=c.children("ul");if(o.minHeight){css["min-height"]=o.minHeight-ul.outerHeight(true)-16}else{if(o.height){css.height=o.height-ul.outerHeight(true)-16}}c.children(".ui-tabs-panel").css(css)},_doEditTab:function(index,isNew){var self=this,o=this.options,c=this.content,doc={},a,p;if(!isNew){a=c.children("ul").find("li").eq(index).children("a");doc.id=a.attr("href").substring(1);doc.label=a.html();p=c.find("#"+doc.id)}$("<div/>").dialog({title:isNew?"Insert Tab":"Edit Tab",height:400,width:500,modal:true,create:function(event,ui){var $this=$(this);$.ans.getDoc(o.dbId,"50a4f883d6c6603d0a000018",null,function(err,form){$this.editor({document:doc,forms:[form],dbId:o.dbId,ignoreEscape:true,mode:"edit"})})},buttons:{OK:function(){var $this=$(this),doc=$this.editor("option","document");if(isNew){c.tabsx("add","#"+doc.id,doc.label,index);self._updateContentHeight();c.children("#"+doc.id)[0].contentEditable=true}else{a.attr("href","#"+doc.id).html(doc.label);p.attr("id",doc.id)}self.element.trigger("contentchange");$this.dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},insertTab:function(index){if(index<0||index>this.content.tabsx("length")){index=this.content.tabsx("length")}this._doEditTab(index,true)},editTab:function(index){if(index>=0&&index<this.content.tabsx("length")){this._doEditTab(index)}},removeTab:function(index){this.content.tabsx("remove",index).trigger("contentchange")},_browser:function(){this.option("contextmenu2",false);this._contentEditable(false)},_edit:function(){this.option("contextmenu2",false);this._contentEditable(false)},_design:function(){this.option("contextmenu2",true);this._contentEditable(true)},_contentEditable:function(editable){this.content.children(".ui-tabs-panel").each(function(){this.contentEditable=editable})},destroy:function(){this.content.children(".ui-tabs-panel").css({height:"","min-height":""});this.content.tabsx("destroy");this.element.unbind(".tabsxwidget").removeClass("an-tabsxwidget");return $.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.tree",{options:{draggable:true,droppable:true,labelProvider:{getText:function(c){return c.text},getClass:function(c){return c["class"]}}},_create:function(){var c=this,e=this.element,f=this.options;e.addClass("an-tree").empty();this.contentProvider={getRoots:function(){return[]},getChildren:function(g){return[]},hasChildren:function(g){return false},getId:function(g){return g.id?g.id:null}};f.contentProvider=f.contentProvider||this.contentProvider;this._loadChildren(e);e.delegate(".hitarea","click.tree",function(){var g=a(this).parent();c["_do"+(g.is(".expandable")?"Expand":"Collapse")](g)}).delegate("li>span","hover.tree",function(g){a(this).toggleClass("ui-state-hover");c._trigger("nodehover",g,a(this).closest("li").data("node"))}).delegate("li>span","click.tree contextmenu.tree",function(g){e.find("li>span.selected").removeClass("selected");a(this).addClass("selected");if(g.type=="click"){c._trigger("nodeclick",g,a(this).closest("li").data("node"))}else{if(g.type=="contextmenu"){c._trigger("contextmenu",g,a(this).closest("li").data("node"))}}}).delegate("li>span","dblclick.tree",function(g){c._trigger("nodedblclick",g,a(this).closest("li").data("node"))})},refresh:function(f){var p=this;if(f){var j=this.element.find("#"+f);if(j.length){var e=this.options,g=e.labelProvider,h=e.contentProvider,c=j.attr("id"),i=j.parent().closest("li");function k(q){var s=null;for(var r in q){if(c==q[r].id){s=r;break}}if(s!=null){j.data("node",q[s]).addClass(g.getClass(q[s])).children("span").html(g.getText(q[s]));if(j.is(".expandable")){j.addClass("stale")}else{if(j.is(".collapsable")){p._loadChildren(j)}}}else{j.remove()}}if(i.length){h.getChildren(i.data("node"),k)}else{h.getRoots(k)}}}else{this._loadChildren(this.element)}},add:function(e,c){this._addNode(this.element.find("#"+e).children("ul"),c)},"delete":function(e){var c=this.element.find("#"+e);if(c.is(".last")){c.prev().addClass("last")}c.remove()},expand:function(e){var c=this.element.find("#"+e);if(c.length>0){this._doExpand(c)}},collapse:function(e){var c=this.element.find("#"+e);if(c.length>=0){this._doCollapse(c)}},_doExpand:function(c){if(c.is(".expandable.stale")){this._loadChildren(c)}else{if(c.is(".expandable")){c.children("ul").show();c.removeClass("expandable").addClass("collapsable")}}},_doCollapse:function(c){if(c.is(".collapsable")){c.children("ul").hide();c.removeClass("collapsable").addClass("expandable")}},_addNode:function(j,f){var q=this,e=this.options,g=e.labelProvider,i=e.contentProvider,c=i.getId(f),p=g.getText(f),k=a("<li/>").addClass(g.getClass(f)).attr("id",c);if(e.checkbox){a("<input type='checkbox'/>").prop("checked",a.inArray(c,e.checkedNodes)!=-1).appendTo(k)}a("<span/>").addClass(g.getClass(f)).html(p).appendTo(k);if(i.hasChildren(f)){k.addClass("expandable stale").prepend("<div class='hitarea'/>");var h=a.type(e.droppable)=="function"?e.droppable(f):e.droppable;if(h){k.children("span").droppable({greedy:true,hoverClass:"ui-state-hover",drop:function(s,t){q._trigger("drop",null,{source:t.draggable.data("node"),target:f})}})}}j.children("li.last").removeClass("last");k.data("node",f).addClass("last").appendTo(j);var r=a.type(e.draggable)=="function"?e.draggable(f):e.draggable;if(r){k.draggable({appendTo:"body",helper:"clone",scroll:true,distance:20,scrollSensitivity:100,zIndex:9999})}},_loadChildren:function(h){var e=this,k=this.options,f=h.children("ul"),i=k.contentProvider||this.contentProvider;if(f.length==0){f=a("<ul/>").appendTo(h)}var g=[];f.find(".collapsable").each(function(){g.push(a(this).attr("id"))});f.empty();var c=h.children(".hitarea").addClass("loading");function j(p){a.each(p,function(s,r){e._addNode(f,r)});h.removeClass("expandable stale").addClass("collapsable");for(var q in g){e.expand(g[q])}c.removeClass("loading")}if(h[0]==this.element[0]){i.getRoots(j)}else{i.getChildren(h.data("node"),j)}},option:function(f,g){if(f=="checkedNodes"&&g===b){var e=[];a("input:checked",this.element).each(function(){e.push(a(this).closest("li").data("node"))});return e}else{if(f==="roots"&&g===b){var c=[];this.element.children("ul").children("li").each(function(){c.push(a(this).attr("id"))});return c}else{if(f==="selectedNodes"&&g===b){var e=[];this.element.find(".selected").each(function(){e.push(a(this).closest("li").attr("id"))});return e}}}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(e,g){a.Widget.prototype._setOption.apply(this,arguments);var c=this,f=this.element;if(e==="contentProvider"){this._loadChildren(this.element)}else{if(e==="checkedNodes"){a.each(g,function(i,h){a("#"+h+" input",c.element).prop("checked",true)})}else{if(e==="selectedNodes"){a.each(g,function(i,h){f.find("li>span.selected").removeClass("selected");f.find("li#"+h+">span").addClass("selected")})}}}return this},destroy:function(){this.element.undelegate(".hitarea",".tree").undelegate("li>span",".tree").removeClass("an-tree");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);jQuery.cookie=function(b,k,r){if(typeof k!="undefined"){r=r||{};if(k===null){k="";r.expires=-1}var f="";if(r.expires&&(typeof r.expires=="number"||r.expires.toUTCString)){var g;if(typeof r.expires=="number"){g=new Date();g.setTime(g.getTime()+(r.expires*24*60*60*1000))}else{g=r.expires}f="; expires="+g.toUTCString()}var q=r.path?"; path="+(r.path):"";var h=r.domain?"; domain="+(r.domain):"";var a=r.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(k),f,q,h,a].join("")}else{var e=null;if(document.cookie&&document.cookie!=""){var p=document.cookie.split(";");for(var j=0;j<p.length;j++){var c=jQuery.trim(p[j]);if(c.substring(0,b.length+1)==(b+"=")){e=decodeURIComponent(c.substring(b.length+1));break}}}return e}};(function(b){b.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};function a(e){if(typeof e.data!=="string"){return}var c=e.handler,f=e.data.toLowerCase().split(" ");e.handler=function(r){if(this!==r.target&&(/textarea|select/i.test(r.target.nodeName)||r.target.type==="text")){return}var j=r.type!=="keypress"&&b.hotkeys.specialKeys[r.which],s=String.fromCharCode(r.which).toLowerCase(),p,q="",h={};if(r.altKey&&j!=="alt"){q+="alt+"}if(r.ctrlKey&&j!=="ctrl"){q+="ctrl+"}if(r.metaKey&&!r.ctrlKey&&j!=="meta"){q+="meta+"}if(r.shiftKey&&j!=="shift"){q+="shift+"}if(j){h[q+j]=true}else{h[q+s]=true;h[q+b.hotkeys.shiftNums[s]]=true;if(q==="shift+"){h[b.hotkeys.shiftNums[s]]=true}}for(var k=0,g=f.length;k<g;k++){if(h[f[k]]){return c.apply(this,arguments)}}}}b.each(["keydown","keyup","keypress"],function(){b.event.special[this]={add:a}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(b){var a=0;b.widget("an.menu",{defaultElement:"<ul>",delay:100,options:{submenuPosition:{my:"left top",at:"right top"},triggerEvent:"contextmenu",menuPosition:{my:"left top",at:"left bottom"}},_create:function(){var c=this.options;this.element.addClass("an-menu");this.activeMenu=this.menu=this._createMenuContent(c.actions);this.menu.appendTo("body").hide();this.menuId=this.menu.attr("id")||"ui-menu-"+a++;if(this.menu.find(".ui-icon").length){this.menu.addClass("ui-menu-icons")}this.bindings=b();this.menu.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:"menu"}).css({"z-index":"999999"}).bind("click.menu",b.proxy(function(e){if(c.disabled){e.preventDefault()}},this));this._bind({"click .ui-menu-item:has(a)":function(e){var f=b(e.currentTarget);if(!this.active||(this.active[0]!==f[0])){this.focus(e,f)}this.select(e);e.preventDefault()},"mouseover .ui-menu-item:not(.seperator)":function(e){e.stopImmediatePropagation();var f=b(e.currentTarget);f.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(e,f)},mouseleave:"_mouseleave","mouseleave .ui-menu":"_mouseleave","mouseout .ui-menu-item":"blur",focus:function(e){this.focus(e,b(e.target).children(".ui-menu-item:first"))},blur:"collapseAll"});this.refresh();this.menu.attr("tabIndex",0);this._bind({keydown:function(i){switch(i.keyCode){case b.ui.keyCode.PAGE_UP:this.previousPage(i);i.preventDefault();i.stopImmediatePropagation();break;case b.ui.keyCode.PAGE_DOWN:this.nextPage(i);i.preventDefault();i.stopImmediatePropagation();break;case b.ui.keyCode.HOME:this._move("first","first",i);i.preventDefault();i.stopImmediatePropagation();break;case b.ui.keyCode.END:this._move("last","last",i);i.preventDefault();i.stopImmediatePropagation();break;case b.ui.keyCode.UP:this.previous(i);i.preventDefault();i.stopImmediatePropagation();break;case b.ui.keyCode.DOWN:this.next(i);i.preventDefault();i.stopImmediatePropagation();break;case b.ui.keyCode.LEFT:if(this.collapse(i)){i.stopImmediatePropagation()}i.preventDefault();break;case b.ui.keyCode.RIGHT:if(this.expand(i)){i.stopImmediatePropagation()}i.preventDefault();break;case b.ui.keyCode.ENTER:if(this.active.children("a[aria-haspopup='true']").length){if(this.expand(i)){i.stopImmediatePropagation()}}else{this.select(i);i.stopImmediatePropagation()}i.preventDefault();break;case b.ui.keyCode.ESCAPE:if(this.collapse(i)){i.stopImmediatePropagation()}i.preventDefault();break;default:i.stopPropagation();clearTimeout(this.filterTimer);var e,h=this.previousFilter||"",j=String.fromCharCode(i.keyCode),g=false;if(j==h){g=true}else{j=h+j}function f(k){return k.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}e=this.activeMenu.children(".ui-menu-item").filter(function(){return new RegExp("^"+f(j),"i").test(b(this).children("a").text())});e=g&&e.index(this.active.next())!=-1?this.active.nextAll(".ui-menu-item"):e;if(!e.length){j=String.fromCharCode(i.keyCode);e=this.activeMenu.children(".ui-menu-item").filter(function(){return new RegExp("^"+f(j),"i").test(b(this).children("a").text())})}if(e.length){this.focus(i,e);if(e.length>1){this.previousFilter=j;this.filterTimer=this._delay(function(){delete this.previousFilter},1000)}else{delete this.previousFilter}}else{delete this.previousFilter}}}});if(c.triggerEvent){this.element.unbind(c.triggerEvent+".menu");this.element.bind(c.triggerEvent+".menu",b.proxy(function(g){var e=b.extend({},{of:g,offset:"0 0"},b.type(this.options.menuPosition)=="function"?this.options.menuPosition(this.active):this.options.menuPosition);var f=b(document).data("contextmenu");if(f){f.collapseAll()}b(document).data("contextmenu",this);this.menu.show().position(e);if(this.options.triggerEvent=="contextmenu"){g.preventDefault()}},this))}this.proxy=b.proxy(function(e){var f=b(e.target);if(f.closest(".ui-menu").length||f.closest(".an-menu").get(0)==this.element.get(0)){return}this.collapseAll(e)},this);b(document).bind("click.menu",this.proxy);if(c.autoShow){this.menu.position(b.type(this.options.menuPosition)=="function"?this.options.menuPosition(this.active):this.options.menuPosition).show()}},_createMenuContent:function(f){var c=this,e=b("<ul/>");b.each(f,function(i,h){switch(h.type){case"submenu":var j=c._createMenuContent(h.children);b("<li/>").append(b("<a href='#'/>").text(h.text)).append(j).appendTo(e);break;case"menuItem":b("<a/>").attr("href","#"+i).text(h.text).click(function(k){h.handler(arguments);k.preventDefault()}).wrap("<li/>").parent().appendTo(e);break;case"seperator":b("<li class='seperator'/>").append(b("<a href='#'/>")).appendTo(e);break;case"checkbox":var g=b("<input/>").attr("type","checkbox").attr("name",h.name).prop("checked",h.checked);b("<a/>").attr("href","#"+i).text(h.text).click(function(r){var q=b(r.target),p=false;if(q.is("a")){var k=q.find("input");p=!k.prop("checked");k.prop("checked",p)}else{if(q.is("input")){p=q.prop("checked")}}h.handler(r,p);r.stopImmediatePropagation()}).prepend(g).wrap("<li/>").parent().appendTo(e);break}});return e},refresh:function(){var c=this.menu.find("ul:not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","menu").hide().attr("aria-hidden","true").attr("aria-expanded","false");var e=this.menuId;c.add(this.menu).children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").addClass("ui-corner-all").attr("tabIndex",-1).attr("role","menuitem").attr("id",function(f){return e+"-"+f});c.each(function(){var g=b(this),f=g.prev("a");f.attr("aria-haspopup","true").prepend('<span class="ui-menu-icon ui-icon ui-icon-carat-1-e"></span>');g.attr("aria-labelledby",f.attr("id"))})},focus:function(c,k){this.blur(c);if(this._hasScroll()){var f=parseFloat(b.curCSS(this.activeMenu[0],"borderTopWidth",true))||0,p=parseFloat(b.curCSS(this.activeMenu[0],"paddingTop",true))||0,g=k.offset().top-this.activeMenu.offset().top-f-p,j=this.activeMenu.scrollTop(),h=this.activeMenu.height(),e=k.height();if(g<0){this.activeMenu.scrollTop(j+g)}else{if(g+e>h){this.activeMenu.scrollTop(j+g-h+e)}}}this.active=k.first().children("a").addClass("ui-state-focus").end();this.menu.attr("aria-activedescendant",this.active.children("a").attr("id"));this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");this.timer=this._delay(function(){this._close()},this.delay);var i=b(">ul",k);if(i.length&&(/^mouse/.test(c.type))){this._startOpening(i)}this.activeMenu=k.parent();this._trigger("focus",c,{item:k})},blur:function(c){if(!this.active){return}clearTimeout(this.timer);this.active.children("a").removeClass("ui-state-focus");this.active=null;this._trigger("blur",c,{item:this.active})},_startOpening:function(c){clearTimeout(this.timer);if(c.attr("aria-hidden")!=="true"){return}this.timer=this._delay(function(){this._close();this._open(c)},this.delay)},_open:function(e){clearTimeout(this.timer);this.menu.find(".ui-menu").not(e.parents()).hide().attr("aria-hidden","true");var c=b.extend({},{of:this.active},b.type(this.options.submenuPosition)=="function"?this.options.submenuPosition(this.active):this.options.submenuPosition);e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(c){var e=false;if(c){var f=b(c.target);if(f.is(".ui-menu")){e=f}else{if(f.closest(".ui-menu").length){e=f.closest(".ui-menu")}}}this._close(e);this.blur(c);this.activeMenu=this.menu;this._trigger("collapseAll")},_close:function(c){if(!c){c=this.active?this.active.parent():this.menu}c.find("ul").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active");if(c==this.menu){c.hide().attr("aria-hidden","true").attr("aria-expanded","false")}},collapse:function(e){var c=this.active&&this.active.parents("li:not(.ui-menubar-item)").first();if(c&&c.length){this._close();this.focus(e,c);return true}},expand:function(e){var c=this.active&&this.active.children("ul").children("li").first();if(c&&c.length){this._open(c.parent());this._delay(function(){this.focus(e,c)},20);return true}},next:function(c){this._move("next","first",c)},previous:function(c){this._move("prev","last",c)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(g,e,f){if(!this.active){this.focus(f,this.activeMenu.children(".ui-menu-item")[e]());return}var c;if(g==="first"||g==="last"){c=this.active[g==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1)}else{c=this.active[g+"All"](".ui-menu-item").eq(0)}if(c.length){this.focus(f,c)}else{this.focus(f,this.activeMenu.children(".ui-menu-item")[e]())}},nextPage:function(f){if(this._hasScroll()){if(!this.active){this.focus(f,this.activeMenu.children(".ui-menu-item").first());return}if(this.last()){return}var g=this.active.offset().top,e=this.menu.height(),c;this.active.nextAll(".ui-menu-item").each(function(){c=b(this);return b(this).offset().top-g-e<0});this.focus(f,c)}else{this.focus(f,this.activeMenu.children(".ui-menu-item")[!this.active?"first":"last"]())}},previousPage:function(f){if(this._hasScroll()){if(!this.active){this.focus(f,this.activeMenu.children(".ui-menu-item").first());return}if(this.first()){return}var g=this.active.offset().top,e=this.menu.height(),c;this.active.prevAll(".ui-menu-item").each(function(){c=b(this);return b(this).offset().top-g+e>0});this.focus(f,c)}else{this.focus(f,this.activeMenu.children(".ui-menu-item").first())}},_hasScroll:function(){return this.menu.height()<this.menu.prop("scrollHeight")},_mouseleave:function(c){this.collapseAll(c);this.blur()},select:function(c){var e={item:this.active};this.collapseAll(c);this._trigger("select",c,e)},_bind:function(f,e){if(!e){e=f;f=this.menu}else{f=b(f);this.bindings=this.bindings.add(f)}var c=this;b.each(e,function(p,k){function i(){if(c.options.disabled===true||b(this).hasClass("ui-state-disabled")){return}return(typeof k==="string"?c[k]:k).apply(c,arguments)}var j=p.match(/^(\w+)\s*(.*)$/),h=j[1]+"."+c.widgetName,g=j[2];if(g){c.menu.delegate(g,h,i)}else{f.bind(h,i)}})},_delay:function(g,f){function e(){return(typeof g==="string"?c[g]:g).apply(c,arguments)}var c=this;return setTimeout(e,f||0)},destroy:function(){b(document).unbind(".menu",this.proxy);this.menu.removeAttr("aria-activedescendant").find("ul").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").show();this.menu.find(".ui-menu-item").unbind(".menu").removeClass("ui-menu-item").removeAttr("role").children("a").removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").removeAttr("id").children(".ui-icon").remove();this.bindings.unbind("."+this.widgetName);this.menu.remove();this.element.unbind("."+this.widgetName).removeClass("an-menu");b.Widget.prototype.destroy.apply(this,arguments)}})}(jQuery));
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.border",{options:{center:{minWidth:200,minHeight:20}},_create:function(){this.element.addClass("an-border");this._calculateDimension();this._makeResizable();this._proxy=a.proxy(function(c){if(c.target===window){this._calculateDimension()}},this);a(window).bind("resize.border",this._proxy)},_setOption:function(e,f){var c=a.extend({},this.options[e]);switch(e){case"east":case"south":case"west":case"north":case"center":a.extend(true,this.options[e],f);if(f.width!=c.width||f.height!=c.height){this._calculateDimension(e)}if(f.hasOwnProperty("resizable")){this._makeResizable()}break;default:break}this._trigger("optionchanged",null,{key:e,value:this.options[e],oldValue:c})},_calculateDimension:function(j){var t=this,f=this.options,e=null;if(f.center.selector&&f.center.selector!=""){e=t.element.children(f.center.selector)}if(!e||e.length==0){e=a("<div/>").appendTo(t.element)}t.centerElement=e;var p={pbmWidth:0,pbmHeight:0,minWidth:0,minHeight:0,totalMinWidth:0,totalMinHeight:0},k=a.extend({height:0,totalHeight:0},p),r=a.extend({},k),h=a.extend({width:0,totalWidth:0},p),q=a.extend({},h),g={};g.pbmWidth=(e.outerWidth(true)-e.width());g.pbmHeight=(e.outerHeight(true)-e.height());g.minWidth=parseFloat(f.center.minWidth);g.minHeight=parseFloat(f.center.minHeight);g.totalMinWidth=g.minWidth+g.pbmWidth;g.totalMinHeight=g.minHeight+g.pbmHeight;a.each({north:k,south:r},function(w,u){var x=null;if(f[w]){if(f[w].selector&&f[w].selector!=""){x=t.element.children(f[w].selector)}if(!x||x.length==0){x=a("<div/>").appendTo(t.element)}u.height=parseFloat(f[w].height||u.minHeight||0);u.pbmWidth=x.outerWidth(true)-x.width();u.pbmHeight=x.outerHeight(true)-x.height();u.totalHeight=u.height+u.pbmHeight;u.minWidth=parseFloat(f[w].minWidth);u.minHeight=parseFloat(f[w].minHeight);u.totalMinWidth=u.minWidth+u.pbmWidth;u.totalMinHeight=u.minHeight+u.pbmHeight;t[w+"Element"]=x}});a.each({west:h,east:q},function(w,u){var x=null;if(f[w]){if(f[w].selector&&f[w].selector!=""){x=t.element.children(f[w].selector)}if(!x||x.length==0){x=a("<div/>").appendTo(t.element)}u.width=parseFloat(f[w].width||u.minWidth||0);u.pbmWidth=x.outerWidth(true)-x.width();u.pbmHeight=x.outerHeight(true)-x.height();u.totalWidth=u.width+u.pbmWidth;u.minWidth=parseFloat(f[w].minWidth);u.minHeight=parseFloat(f[w].minHeight);u.totalMinWidth=u.minWidth+u.pbmWidth;u.totalMinHeight=u.minHeight+u.pbmHeight;t[w+"Element"]=x}});var i=t.element.width(),c=t.element.height();if((k.totalHeight+r.totalHeight+g.totalMinHeight>c)&&(k.totalMinHeight+r.totalMinHeight+g.totalMinHeight<c)){var s=k.totalHeight+r.totalHeight+g.totalMinHeight-c;if(!j){r.height=r.height-Math.ceil(s/2);k.height=k.height-Math.floor(s/2);if(r.height<r.minHeight){k.height=k.height-(r.minHeight-r.height);r.height=r.minHeight}if(k.height<k.minHeight){r.height=r.height-(k.minHeight-k.height);k.height=k.minHeight}r.totalHeight=r.height+r.pbmHeight;k.totalHeight=k.height+k.pbmHeight}else{if(j=="north"){r.height=r.height-s;if(r.height<r.minHeight){k.height=k.height-(r.minHeight-r.height);r.height=r.minHeight;k.totalHeight=k.height+k.pbmHeight}r.totalHeight=r.height+r.pbmHeight}else{if(j=="south"){k.height=k.height-s;if(k.height<k.minHeight){r.height=r.height-(k.minHeight-k.height);k.height=k.minHeight;r.totalHeight=r.height+r.pbmHeight}k.totalHeight=k.height+k.pbmHeight}}}}else{if(k.totalMinHeight+r.totalMinHeight+g.totalMinHeight>=c){k.height=k.minHeight;r.height=r.minHeight;k.totalHeight=k.height+k.pbmHeight;r.totalHeight=r.height+r.pbmHeight;c=k.totalMinHeight+r.totalMinHeight+g.totalMinHeight}}if((h.totalWidth+q.totalWidth+g.totalMinWidth>i)&&(h.totalMinWidth+q.totalMinWidth+g.totalMinWidth<i)){var s=h.totalWidth+q.totalWidth+g.totalMinWidth-i;if(!j){q.width=q.width-Math.ceil(s/2);h.width=h.width-Math.floor(s/2);if(q.width<q.minWidth){h.width=h.width-(q.minWidth-q.width);q.width=q.minWidth}if(h.width<h.minWidth){q.width=q.width-(h.minWidth-h.width);h.width=h.minWidth}q.totalWidth=q.width+q.pbmWidth;h.totalWidth=h.width+h.pbmWidth}else{if(j=="west"){q.width=q.width-s;if(q.width<q.minWidth){h.width=h.width-(q.minWidth-q.width);q.width=q.minWidth;h.totalWidth=h.width+h.pbmWidth}q.totalWidth=q.width+q.pbmWidth}else{if(j=="east"){h.width=h.width-s;if(h.width<h.minWidth){q.width=q.width-(h.minWidth-h.width);h.width=h.minWidth;q.totalWidth=q.width+q.pbmWidth}h.totalWidth=h.width+h.pbmWidth}}}}else{if(h.totalMinWidth+q.totalMinWidth+g.totalMinWidth>=i){h.width=h.minWidth;q.width=q.minWidth;h.totalWidth=h.width+h.pbmWidth;q.totalWidth=q.width+q.pbmWidth;i=h.totalMinWidth+q.totalMinWidth+g.totalMinWidth}}g.top=parseFloat(t.element.css("padding-top"));g.left=parseFloat(t.element.css("padding-left"));g.right=parseFloat(t.element.css("padding-right"));g.bottom=parseFloat(t.element.css("padding-bottom"));if(t.northElement){k.top=parseFloat(t.element.css("padding-top"));k.left=parseFloat(t.element.css("padding-left"));k.width=i-k.pbmWidth;g.top+=k.totalHeight}if(t.southElement){r.left=parseFloat(t.element.css("padding-left"));r.width=i-r.pbmWidth;r.top=c-r.totalHeight;g.bottom+=r.totalHeight}if(t.westElement){h.top=g.top;h.left=parseFloat(t.element.css("padding-left"));h.height=c-g.top-g.bottom-h.pbmHeight;g.left+=h.totalWidth}if(t.eastElement){q.top=g.top;q.left=i-q.totalWidth;q.height=c-g.top-g.bottom-q.pbmHeight;g.right+=q.totalWidth}g.width=i-g.left-g.right-g.pbmWidth;g.height=c-g.top-g.bottom-g.pbmHeight;a.each({north:k,south:r,west:h,east:q,center:g},function(w,u){if(t[w+"Element"]){t[w+"Element"].css(a.extend({position:"absolute"},{top:u.top+"px",left:u.left+"px",overflow:w=="north"?"visible":"hidden",width:u.width+"px",height:u.height+"px"}))}});t.element.trigger("resize")},_makeResizable:function(){var c=this,e=this.options;if(this.northElement){this.northElement.resizable(e.north.resizable?{handles:"s",containment:c.element,resize:function(h,g){var f=Math.max(ui.size.height,e.north.minHeight||0);f=Math.min(f,e.north.maxHeight||Number.MAX_VALUE);c._setOption("north",{height:f})},start:function(f,g){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(f,g){a("#mask").remove()}}:"destroy")}if(this.southElement){this.southElement.resizable(e.south.resizable?{handles:"n",containment:c.element,resize:function(g,h){var f=Math.max(h.size.height,e.south.minHeight||0);f=Math.min(f,e.south.maxHeight||Number.MAX_VALUE);c._setOption("south",{height:f})},start:function(f,g){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(f,g){a("#mask").remove()}}:"destroy")}if(this.westElement){this.westElement.resizable(e.west.resizable?{handles:"e",containment:c.element,resize:function(g,h){var f=Math.max(h.size.width,e.west.minWidth||0);f=Math.min(f,e.west.maxWidth||Number.MAX_VALUE);c._setOption("west",{width:f})},start:function(f,g){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(f,g){a("#mask").remove()}}:"destroy")}if(this.eastElement){this.eastElement.resizable(e.east.resizable?{handles:"w",containment:c.element,resize:function(g,h){var f=Math.max(h.size.width,e.east.minWidth||0);f=Math.min(f,e.east.maxWidth||Number.MAX_VALUE);c._setOption("east",{width:f})},start:function(f,g){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(f,g){a("#mask").remove()}}:"destroy")}},refresh:function(){this._calculateDimension()},destroy:function(){this.element.removeClass("ui-border");a(window).unbind("resize.border",this._proxy);return a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.rte",{options:{doctype:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">',cssfiles:[],jsfiles:[],mode:"design",lang:"en",absoluteURLs:true,styleWithCSS:false,history:[],undoable:false,redoable:false,formIds:{standard:"5080143085ac60df09000001",link:"508251eb0b27990c0a000001",image:"5082d29f0b27990c0a000005",label:"50af2f976cec663c0a00000e",table:"5085f383eeeac1e909000001",cell:"5086b873eeeac1e909000002",tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"]}},_create:function(){var c=this,h=this.options,f=this.element;f.addClass("an-rte").empty();this.url=this._parseURL(window.location.href);this.lang=(""+h.lang);h.iframe=a("<iframe/>").addClass("container").attr({frameborder:0}).appendTo(f);h.win=h.iframe[0].contentWindow;var g=(h.doc=h.win.document);if(h.resizable){f.resizable()}this.source=a("<textarea class='content'/>").appendTo(f);this.source[h.mode=="sourcecode"?"show":"hide"]();h.actions=this._createActions();a(h.win).bind("focus.rte blur.rte",function(j){c._trigger(j.type,j,f)});a(g).bind("dragend.rte",function(j){setTimeout(function(){try{h.win.focus();sel.moveToBookmark(sel.getBookmark());c.updatePath()}catch(k){}},200)});h.iframe.load(function(){var j=a(this).contents().find("body")[0];if(a.browser.msie){j.contentEditable=true}else{try{j.contentEditable=true;g.execCommand("styleWithCSS",false,h.styleWithCSS)}catch(k){}}c.$body=a(j).addClass("rte-structure");if(h.cssClass){c.$body.addClass(h.cssClass)}h.onload&&h.onload();h.restore&&h.restore(c.$body);c._restore()});var e='<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';a.each(h.cssfiles,function(){e+="<link rel='stylesheet' type='text/css' href='"+this+"'/>"});a.each(h.jsfiles,function(){e+="<script type='text/javascript' language='javascript' src='"+this+"'><\/script>"});e+='<style id="stylesheet" type="text/css">'+(h.stylesheet||"")+"</style>";g.open();g.write(h.doctype+e+"</head><body>"+a.trim(h.content||"")+"</body></html>");g.close();h.dom=new rteDom(this);h.selection=new rteSelection(this);this.showToolbar(h.showToolbar);this.source.bind("change.rte keyup.rte",function(j){j.preventDefault();j.stopImmediatePropagation();c.element.trigger("change")}).bind("keydown.rte",function(q){if(q.keyCode==a.ui.keyCode.TAB){q.preventDefault();if(a.browser.msie){var j=document.selection.createRange();j.text="\t"+j.text;this.focus()}else{var p=this.value,k=p.substr(0,this.selectionStart),s=p.substr(this.selectionEnd);this.value=k+"\t"+s;this.setSelectionRange(k.length+1,k.length+1)}}});var i=null;a(g).bind("keydown.rte",function(k){var j=h.selection;if(k.keyCode==13){var p=j.getNode();if(h.dom.selfOrParent(p,/^PRE$/)){j.insertNode(h.doc.createTextNode("\r\n"))}else{if(a.browser.safari&&k.shiftKey){j.insertNode(h.doc.createElement("br"))}}}if(k.keyCode==32&&a.browser.opera){j.insertNode(h.doc.createTextNode(" "))}if((k.keyCode>=48&&k.keyCode<=57)||k.keyCode==61||k.keyCode==109||(k.keyCode>=65&&k.keyCode<=90)||(k.keyCode>=188&&k.keyCode<=190)||k.keyCode==191||(k.keyCode>=219&&k.keyCode<=222)||k.keyCode==8||k.keyCode==46||k.keyCode==32||k.keyCode==13){c.element.trigger("change")}if((k.keyCode>=8&&k.keyCode<=13)||(k.keyCode>=32&&k.keyCode<=40)||k.keyCode==46||(k.keyCode>=96&&k.keyCode<=111)||(k.keyCode==65)&&(k.metaKey||k.ctrlKey)){c.updatePath()}c.element.trigger(k)}).bind("contextmenu.rte",function(q){q.preventDefault();q.stopImmediatePropagation();var r=h.iframe.offset(),k=r.left+q.clientX,j=r.top+q.clientY,p=a.extend(a.Event(),{type:"contextmenu2",pageX:k,pageY:j});a(g).find(q.target).trigger(p)}).bind("paste.rte",function(j){if(h.denyPaste){j.stopPropagation();j.preventDefault()}}).bind("mousedown.rte",function(j){i="down"}).bind("mousemove.rte",function(j){if(i=="down"){i="moving"}c.element.trigger(j)}).bind("mouseup.rte dblclick.rte",function(j){if(i=="moving"||j.type=="dblclick"){i=null;c.element.trigger("selectionChanged")}c.updatePath();c.element.trigger(j)}).bind("click.rte newwidget.rte contentchange.rte",function(j){c.element.trigger(j)}).bind("treenodeclick.rte",function(k,j){c.element.trigger(k,j)});if(a.browser.msie){a(g).bind("keyup.rte",function(k){var j=h.selection;if(k.keyCode==86&&(k.metaKey||k.ctrlKey)){j.saveIERange();h.content=c.$body.html();j.restoreIERange();c.$body.mouseup();c.updatePath()}})}if(a.browser.safari){a(g).bind("click.rte",function(j){content.find(".rte-webkit-hl").removeClass("rte-webkit-hl");if(j.target.nodeName=="IMG"){a(j.target).addClass("rte-webkit-hl")}}).bind("keyup.rte",function(j){content.find(".rte-webkit-hl").removeClass("rte-webkit-hl")})}h.win.focus()},option:function(c,e){if(/^can.*/.test(c)){this.options[c]=this["_"+c]?this["_"+c]():false}if(c==="actionSets"&&e===b){return this._createActionSets()}else{if(c==="content"&&e===b){return this._getContent()}}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(e,f){var g=this.options,c=this.option(e);if(!equals(f,c)){a.Widget.prototype._setOption.apply(this,arguments);if(e=="mode"){if(f=="design"){g.iframe.show();this.$body.html(this.source.hide().val());g.restore&&g.restore(this.$body);this._restore();g.win.focus()}else{g.clean&&g.clean(this.$body);this._clean();this.source.val(this.$body.html()).show();g.iframe.hide();if(a.browser.msie){}else{this.source[0].setSelectionRange(0,0)}}}else{if(e=="content"){if(g.mode=="design"){this.$body.html(f)}else{if(g.mode=="sourcecode"){this.source.val(f)}}}else{if(e=="stylesheet"){a(g.doc).find("#stylesheet").text(f)}else{if(e=="height"){this.element.css("height",f)}else{if(e=="width"){this.element.css("width",f)}else{if(e=="showToolbar"){this.showToolbar(f)}else{if(e=="path"){this.toolbar&&this.toolbar.toolbar("refresh")}}}}}}}this._trigger("optionchanged",null,{key:e,value:f,oldValue:c})}return this},history:function(){var c=this,f=c.options,e=f.history;if(f.mode=="design"){clearTimeout(f.historyT);f.historyT=setTimeout(function(){e.push(c._getContent());c.htStep=e.length-1;c.option("undoable",true)},400)}},undo:function(){var c=this,e=c.options.history;if(e.length<=1){return}c.htStep=c.htStep-1;if(c.htStep<0){c.htStep=0}c.$body.html(e[c.htStep]);c._restore();c.option("redoable",true);c.htStep==0&&c.option("undoable",false)},redo:function(){var c=this,e=c.options.history;if(e.length<=1){return}c.htStep++;if(c.htStep>(e.length-1)){c.htStep=e.length-1}c.$body.html(e[c.htStep]);c._restore();c.option("undoable",true);(c.htStep==e.length-1)&&c.option("redoable",false)},showToolbar:function(c){if(c){if(!this.toolbar){var e=this,f=this.options;this.toolbar=a("<div/>").toolbar({actionSets:this._createActionSets()}).prependTo(this.element);function g(){if(e.toolbar.is(":visible")){var h=e.element.height()-e.toolbar.outerHeight(true);f.iframe.css({height:h});e.source.css({height:h})}}g();this._proxy=a.proxy(function(h){g()},this);a(window).bind("resize.rte",this._proxy)}}else{if(this.toolbar){a(window).unbind("resize.rte",this._proxy);this.toolbar.remove();delete this.toolbar}}},_getContent:function(){var e=this.options,c=e.content;if(e.mode=="design"&&this.$body){e.clean&&e.clean(this.$body);this._clean();c=this.$body.html();e.restore&&e.restore(this.$body);this._restore()}else{if(e.mode=="sourcecode"){c=this.source.val()}}return c},_clean:function(){a("table",this.$body).each(function(){if(a(this).data("resizable")){a(this).data("resizable").destroy()}});a("img",this.$body).unbind("dblclick");this.$body.find(".widget[type=tabsx]").each(function(){var c=a(this).data("tabsxwidget");if(c){c.destroy()}})},_restore:function(){var c=this,g=this.options,e=g.formIds,f=g.selection;a("table",this.$body).resizable({stop:function(i,h){c.element.trigger("contentchange");i.preventDefault();i.stopImmediatePropagation()}});a("img",this.$body).each(function(){var h=this;a(this).dblclick(function(){var i=attributes(h);i.width=a(h).css("width").replace(/px/g,"");i.height=a(h).css("height").replace(/px/g,"");c._showDialog("Image",i,[e.standard,e.image],function(j){a.each(j,function(q,p){if(q=="width"||q=="height"){p=a.trim(p)?$img.css(q,p):$img.removeAttr(q)}else{p=a.trim(p)?$img.attr(q,p):$img.removeAttr(q)}});if(!h.parentNode){f.insertNode(h)}c.element.trigger("contentchange")})})});this.$body.find(".widget[type=tabsx]").each(function(){var h=a(this);if(h.is(".an-tabsxwidget")){h.data("tabsxwidget").option("mode",g.mode)}else{h.tabsxwidget({parent:function(){return c},mode:g.mode,dbId:g.dbId,optionchanged:function(j,i){if(i.key=="metadata"||i.key=="attributes"){c.element.trigger("contentchange")}}})}})},_createActionSets:function(){var e=this.options,c=e.mode;if(c=="design"){return[this._controlActionSet(),this._formatActionSet(),this._tableActionSet(),this._widgetActionSet(),this._modeActionSet()]}else{if(c=="sourcecode"){return[this._modeActionSet()]}}},_controlActionSet:function(){return this._createActionSet(["properties","cleanFormat","docStructure"])},_formatActionSet:function(){return this._createActionSet(["bold","italic","underline","strikethrough","subscript","superscript","alignLeft","alignCenter","alignRight","alignFull","font","fontSize","format","leftToRight","rightToLeft","fontColor","backgroundColor","outdent","indent","orderedList","unorderedList","link","deleteLink","horizontalRule","blockQuote","blockElement","stopFloat","image"])},_tableActionSet:function(){return this._createActionSet(["table","tableProps","deleteTable","rowBefore","rowAfter","deleteRow","columnBefore","columnAfter","deleteColumn","cellProps","mergeCells","splitCells"])},_widgetActionSet:function(){return this._createActionSet(["tabsx"])},_modeActionSet:function(){return this._createActionSet(["sourcecode"])},_createActionSet:function(c){var f=this.options.actions,e={};a.each(c,function(){e[this]=f[this]});return e},_doCCP:function(g){this.addHistory();try{this.options.doc.execCommand(g,false,null)}catch(f){if(a.browser.mozilla){var c=" Ctl + C";if(g=="cut"){c=" Ctl + X"}else{if(g=="paste"){c=" Ctl + V"}}a("<div class='rte-dialog'/>").dialog({title:"Warning",height:260,width:380,modal:true,open:function(e,h){a(this).append("This operation is disabled in your browser on security reason. Use shortcut instead.: "+c)},buttons:{OK:function(){a(this).dialog("close")}},close:function(i,h){a(this).remove()}})}else{window.console.log("commands failed: "+g)}}this.updatePath()},_canCCP:function(h){var g=this.options,c=false;try{c=g.mode=="design"&&g.doc.queryCommandEnabled(h)}catch(f){}return c},_canCut:function(){return this._canCCP("cut")},_canCopy:function(){return this._canCCP("copy")},_canPaste:function(){return this._canCCP("paste")},cut:function(){this._doCCP("cut")},copy:function(){this._doCCP("copy")},paste:function(){this._doCCP("paste")},updatePath:function(k){var e=this.options,f=e.selection,h=e.dom;k&&f.cleanCache();var g=f.getNode(),c=h.parents(g,"*"),q=e.rtl,t=q?" &laquo; ":" &raquo; ",s="",j;function r(u){var i=u.nodeName.toLowerCase();u=a(u);if(i=="img"||i=="div"){if(u.is(".widget")){var p=u.attr("id");if(p){p=p.replace(/-/g,".")}i=p+" ("+u.attr("type")+")"}}return i}if(g&&g.nodeType==1&&g.nodeName!="BODY"){c.unshift(g)}if(!q){c=c.reverse()}for(j=0;j<c.length;j++){s+=(j>0?t:"")+r(c[j])}return this.option("path",s)},removeFormat:function(){this.options.doc.execCommand("removeformat",false,null);return this},toggleDocumentStructure:function(){this.$body.toggleClass("rte-structure");return this},bold:function(){this.options.doc.execCommand("bold",false,null);this.element.trigger("contentchange");return this},italic:function(){this.options.doc.execCommand("italic",false,null);this.element.trigger("contentchange");return this},underline:function(){this.options.doc.execCommand("underline",false,null);this.element.trigger("contentchange");return this},strikethrough:function(){this.options.doc.execCommand("strikethrough",false,null);this.element.trigger("contentchange");return this},subscript:function(){this.options.doc.execCommand("subscript",false,null);this.element.trigger("contentchange");return this},superscript:function(){this.options.doc.execCommand("superscript",false,null);this.element.trigger("contentchange");return this},align:function(e){var g=this.options,f=g.selection.selected({collapsed:true,blocks:true,tag:"div"}),c=f.length;while(c--){g.dom.filter(f[c],"textNodes")&&a(f[c]).css("text-align",e)}this.element.trigger("contentchange");return this},leftToRight:function(){var f=this.options,e=f.dom,c=f.selection,g=c.getNode();if(a(g).attr("dir")=="ltr"||a(g).parents('[dir="ltr"]').length||a(g).find('[dir="ltr"]').length){a(g).removeAttr("dir");a(g).parents('[dir="ltr"]').removeAttr("dir");a(g).find('[dir="ltr"]').removeAttr("dir")}else{if(e.is(g,"textNodes")&&e.is(g,"block")){a(g).attr("dir","ltr")}else{a.each(e.parents(g,"textNodes"),function(h,j){if(e.is(j,"block")){a(j).attr("dir","ltr");return false}})}}this.element.trigger("contentchange");return this},rightToLeft:function(){var e=this.options,c=e.dom,f=e.selection.getNode();if(a(f).attr("dir")=="rtl"||a(f).parents('[dir="rtl"]').length||a(f).find('[dir="rtl"]').length){a(f).removeAttr("dir");a(f).parents('[dir="rtl"]').removeAttr("dir");a(f).find('[dir="rtl"]').removeAttr("dir")}else{if(c.is(f,"textNodes")&&c.is(f,"block")){a(f).attr("dir","rtl")}else{a.each(c.parents(f,"textNodes"),function(g,h){if(c.is(h,"block")){a(h).attr("dir","rtl");return false}})}}this.element.trigger("contentchange");return this},outdent:function(){var h=this.options,e=h.selection,g=h.dom;function f(k){function i(r){var p={type:"",val:0},q;if((q=g.attr(r,"style"))){p.type=q.indexOf("padding-left")!=-1?"padding-left":(q.indexOf("margin-left")!=-1?"margin-left":"");p.val=p.type?parseInt(a(r).css(p.type))||0:0}return p}var k=e.getNode(),j=i(k);if(j.val){j.node=k}else{a.each(g.parents(k,"*"),function(){j=i(this);if(j.val){j.node=this;return j}})}return j}var c=f();if(c.node){a(c.node).css(c.type,(c.val>40?c.val-40:0)+"px");this.updatePath()}this.element.trigger("contentchange");return this},indent:function(){var k=this.options,g=k.selection,j=k.dom,h=k.doc,e=g.selected({collapsed:true,blocks:true,wrap:"inline",tag:"p"});function c(r){var i=/(IMG|HR|TABLE|EMBED|OBJECT)/.test(r.nodeName)?"margin-left":"padding-left";var q=j.attr(r,"style").indexOf(i)!=-1?parseInt(a(r).css(i))||0:0;a(r).css(i,q+40+"px")}for(var f=0;f<e.length;f++){if(/^(TABLE|THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(e[f].nodeName)){a(e[f]).find("td,th").each(function(){c(this)})}else{if(/^LI$/.test(e[f].nodeName)){var p=a(e[f]);a(h.createElement(e[f].parentNode.nodeName)).append(a(h.createElement("li")).html(p.html()||"")).appendTo(p.html("&nbsp;"))}else{c(e[f])}}}this.updatePath();this.element.trigger("contentchange");return this},orderedList:function(){this.options.doc.execCommand("insertorderedlist",false,null);this.updatePath();this.element.trigger("contentchange");return this},unorderedList:function(){this.options.doc.execCommand("insertunorderedlist",false,null);this.updatePath();this.element.trigger("contentchange");return this},_showDialog:function(i,j,c,k,h){var p=this,f=this.options,g=f.selection,e=g.getBookmark();g.saveIERange();a("<div class='rte-dialog'/>").dialog({title:i,height:400,width:500,modal:true,create:function(q,r){var s=a(this);Model.getForms(f.dbId,c,function(u,t){if(t){s.editor({document:j,forms:t,dbId:f.dbId,mode:"edit",ignoreEscape:true})}})},buttons:{OK:function(){var q=a(this);g.moveToBookmark(e);k(q.editor("option","document"));p.updatePath();q.dialog("close")},Cancel:function(){a(this).dialog("close")}},open:function(q,r){if(typeof h=="function"){h()}},close:function(r,q){g.removeBookmark(e);a.browser.msie&&g.restoreIERange();a(this).remove()}})},link:function(){var r=this,e=this.options,f=e.selection,j=e.dom,q=e.doc,g=f.getNode(),p=j.selfOrParentLink(g),c=e.formIds;function h(i){return i.nodeName=="A"&&i.href}if(!p){sn=a.browser.msie?f.selected():f.selected({wrap:false});if(sn.length){for(var k=0;k<sn.length;k++){if(h(sn[k])){p=sn[k];break}}if(!p){p=j.parent(sn[0],h)||j.parent(sn[f.length-1],h)}}}p=p||q.createElement("a");this._showDialog("Link",attributes(p),[c.standard,c.link],function(t){var s=r._absoluteURL(t.href),u,i=g.nodeName=="IMG"?g:null;if(i&&i.parentNode){p=a(q.createElement("a")).attr("href",s);j.wrap(i,p[0])}else{if(!p.parentNode){u="#--el-editor---"+Math.random();q.execCommand("createLink",false,u);p=a('a[href="'+u+'"]',q).each(function(){var v=a(this);if(!a.trim(v.html())&&!a.trim(v.text())){v.replaceWith(v.text())}})}}t.href=s;p=a(p);a.each(t,function(x,w){w=a.trim(w)?p.attr(x,w):p.removeAttr(x)});i&&f.select(i)});this.element.trigger("contentchange");return this},blockQuote:function(){var g=this.options,e=g.selection,f=g.dom,h,c;if(e.collapsed()&&(h=f.selfOrParent(e.getNode(),/^BLOCKQUOTE$/))){a(h).replaceWith(a(h).html())}else{c=e.selected({wrap:"all",tag:"blockquote"});c.length&&e.select(c[0],c[c.length-1])}this.updatePath();this.element.trigger("contentchange");return this},blockElement:function(){var g=this.options,e=g.selection,f=g.dom,h,c;if(e.collapsed()){h=f.selfOrParent(e.getNode(),/^DIV$/);if(h){a(h).replaceWith(a(h).html())}}else{c=e.selected({wrap:"all",tag:"div"});c.length&&e.select(c[0],c[c.length-1])}this.updatePath();this.element.trigger("contentchange");return this},stopFloat:function(){var h=this.options,c=h.selection,g=h.dom,e=h.doc;function f(){if(c.collapsed()){var j=g.selfOrParent(c.getEnd(),/^DIV$/);if(j&&(g.attr(j,"clear")||a(j).css("clear")!="none")){return j}}}var i=f();if(i){i=a(i);if(!i.children().length&&!a.trim(i.text()).length){i.remove()}else{i.removeAttr("clear").css("clear","")}}else{c.insertNode(a(e.createElement("div")).css("clear","both")[0],true)}this.updatePath();this.element.trigger("contentchange");return this},deleteTable:function(){a(this.options.dom.parent(this.options.selection.getNode(),/^TABLE$/)).remove();this.updatePath();this.element.trigger("contentchange");return this},insertTableRow:function(k){var u=this.options,A=u.dom,w=u.selection,v=w.getNode(),C=u.doc,B=A.selfOrParent(v,/^(TD|TH)$/),t=A.selfOrParent(B,/^TR$/),s=A.tableMatrix(A.selfOrParent(B,/^TABLE$/));if(B&&t&&s){var q="before"==k,p=a(t).prevAll("tr").length,x=0,g=[];function h(c,i){while(i>0){i--;if(s[i]&&s[i][c]&&s[i][c].nodeName){return s[i][c]}}}for(var z=0;z<s[p].length;z++){if(s[p][z]&&s[p][z].nodeName){var e=a(s[p][z]);var f=parseInt(e.attr("colspan")||1);if(parseInt(e.attr("rowspan")||1)>1){if(q){x+=f}else{g.push(e)}}else{x+=f}}else{if(s[p][z]=="-"){e=h(z,p);e&&g.push(a(e))}}}var j=a(C.createElement("tr"));for(var z=0;z<x;z++){j.append("<td>&nbsp;</td>")}if(q){j.insertBefore(t)}else{j.insertAfter(t)}a.each(g,function(){a(this).attr("rowspan",parseInt(a(this).attr("rowspan")||1)+1)});this.updatePath()}this.element.trigger("contentchange");return this},deleteRow:function(){var t=this.options,w=t.selection,A=t.dom,v=w.getNode(),B=A.selfOrParent(v,/^(TD|TH)$/),s=A.selfOrParent(B,/^TR$/),k=A.selfOrParent(B,/^TABLE$/),q=A.tableMatrix(k);if(B&&s&&q.length){if(q.length==1){a(k).remove();this.updatePath()}var f=[],p=a(s).prevAll("tr").length;function g(c,i){while(i>0){i--;if(q[i]&&q[i][c]&&q[i][c].nodeName){return q[i][c]}}}function j(i,c){y=p+1;var D=null;if(q[y]){for(var r=0;r<c;r++){if(q[y][r]&&q[y][r].nodeName){D=q[y][r]}}i=i.remove();if(D){i.insertAfter(D)}else{i.prependTo(a(s).next("tr").eq(0))}}}function x(r){for(var c=0;c<r.length;c++){if(r[c]==B){return c<r.length-1?r[c+1]:r[c-1]}}}for(var z=0;z<q[p].length;z++){var e=null;var u=false;if(q[p][z]&&q[p][z].nodeName){e=q[p][z];u=true}else{if(q[p][z]=="-"&&(e=g(z,p))){u=false}}if(e){e=a(e);var C=parseInt(e.attr("rowspan")||1);if(C>1){e.attr("rowspan",C-1);u&&j(e,z,p)}}}var h=x(A.tableColumn(B));if(h){w.selectContents(h).collapse(true)}a(s).remove()}this.updatePath();this.element.trigger("contentchange");return this},insertTableColumn:function(i){var h=this.options,f=h.doc,g=h.dom,e=h.selection,c=g.tableColumn(e.getNode(),false,true);if(c.length){a.each(c,function(){var k=a(this);var j=parseInt(k.attr("colspan")||1);if(j>1){k.attr("colspan",j+1)}else{var p=a(f.createElement(this.nodeName)).html("&nbsp;");if(i=="before"){p.insertBefore(this)}else{p.insertAfter(this)}}})}this.updatePath();this.element.trigger("contentchange");return this},deleteColumn:function(){var e=this.options,f=e.selection,i=e.dom,g=f.getNode(),p=i.selfOrParent(g,/^(TD|TH)$/),h=a(p).prev("td,th")[0],k=a(p).next("td,th")[0],j=i.parent(g,/^TABLE$/),q=i.tableColumn(g,false,true);if(q.length){a.each(q,function(){var r=a(this),c=parseInt(r.attr("colspan")||1);if(c>1){r.attr("colspan",c-1)}else{r.remove()}});i.fixTable(j);if(h||k){f.selectContents(h?h:k).collapse(true)}}this.updatePath();this.element.trigger("contentchange");return this},mergeCells:function(){var u=this.options,w=u.selection,x=u.dom,f=null,v=x.selfOrParent(w.getStart(),/^(TD|TH)$/),t=x.selfOrParent(w.getEnd(),/^(TD|TH)$/);if(v&&t&&v!=t&&a(v).parents("table")[0]==a(t).parents("table")[0]){f=[v,t]}if(f){var z=x.indexOf(a(f[0]).parent("tr")[0]),g=x.indexOf(a(f[1]).parent("tr")[0]),q=Math.min(z,g),s=Math.max(z,g)-q+1,j=x.tableColumn(f[0],true,true),i=x.tableColumn(f[1],true),p=a.inArray(f[0],j.column),k=a.inArray(f[1],i.column),e=j.info.offset[p]<i.info.offset[k]?j:i,c=j.info.offset[p]>=i.info.offset[k]?j:i,h=0,A=null,r="";a(a(f[0]).parents("table").eq(0).find("tr").get().slice(q,q+s)).each(function(D){var C=r.length,B=false;a(this).children("td,th").each(function(){var J=a(this),H=a.inArray(this,e.column),G=a.inArray(this,c.column);if(H!=-1||G!=-1){B=H!=-1&&G==-1;var F=parseInt(J.attr("colspan")||1);if(D==0){h+=F}if(H!=-1&&D>0){var K=e.info.delta[H],E;if(K>0){if(J.css("text-align")=="left"){E=J.clone(true);J.html("&nbsp;")}else{E=J.clone().html("&nbsp;")}E.removeAttr("colspan").removeAttr("id").insertBefore(this);if(K>1){E.attr("colspan",K)}}}if(G!=-1){var K=c.info.delta[G],E;if(F-K>1){var I=F-K-1;if(J.css("text-align")=="right"){E=J.clone(true);J.html("&nbsp;")}else{E=J.clone().html("&nbsp;")}E.removeAttr("colspan").removeAttr("id").insertAfter(this);if(I>1){E.attr("colspan",I)}}}if(!A){A=J}else{r+=J.html();J.remove()}}else{if(B){if(D==0){h+=parseInt(J.attr("colspan")||1)}r+=J.html();J.remove()}}});r+=C!=r.length?"<br/>":""});A.removeAttr("colspan").removeAttr("rowspan").html(A.html()+r);if(h>1){A.attr("colspan",h)}if(s>1){A.attr("rowspan",s)}x.fixTable(a(f[0]).parents("table").get(0))}this.updatePath();this.element.trigger("contentchange");return this},splitCells:function(){var g=this.options,h=g.selection,t=g.dom,x=g.doc,j=t.selfOrParent(h.getNode(),/^(TD|TH)$/);if(j){var k=parseInt(t.attr(j,"colspan")),p=parseInt(t.attr(j,"rowspan"));if(k>1||p>1){var v=k-1,w=p-1,s=t.parent(j,/^TABLE$/),q=t.tableMatrix(s);if(v){for(var u=0;u<v;u++){a(x.createElement(j.nodeName)).html("&nbsp;").insertAfter(j)}}if(w){var A=t.indexesOfCell(j,q),f=A[0],e=A[1];for(var c=f+1;c<f+w+1;c++){var z=null;if(!q[c][e].nodeName){if(q[c][e-1].nodeName){z=q[c][e-1]}else{for(var u=e-1;u>=0;u--){if(q[c][u].nodeName){z=q[c][u];break}}}if(z){for(var u=0;u<=v;u++){a(x.createElement(z.nodeName)).html("&nbsp;").insertAfter(z)}}}}}a(j).removeAttr("colspan").removeAttr("rowspan");t.fixTable(s)}}this.updatePath();this.element.trigger("contentchange");return this},fontColor:function(h){var g=this.options,f=g.selection;if(!f.collapsed()){var e=f.selected({collapse:false,wrap:"text"});a.each(e,function(){if(/^(THEAD|TBODY|TFOOT|TR)$/.test(this.nodeName)){a(this).find("td,th").each(function(){a(this).css("color",h).find("*").css("color","")})}else{a(this).css("color",h).find("*").css("color","")}});this.updatePath();this.element.trigger("contentchange")}return this},backgroundColor:function(h){var g=this.options,f=g.selection;if(!f.collapsed()){var e=f.selected({collapse:false,wrap:"text"});a.each(e,function(){if(/^(THEAD|TBODY|TFOOT|TR)$/.test(this.nodeName)){a(this).find("td,th").each(function(){a(this).css("background-color",h).find("*").css("background-color","")})}else{a(this).css("background-color",h).find("*").css("background-color","")}});this.updatePath();this.element.trigger("contentchange")}return this},font:function(e){var g=this.options,f=g.selection,c=f.selected({filter:"textContainsNodes"});a.each(c,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?a(this).find("td,th"):a(this);a(this).css("font-family",e).find("[style]").css("font-family","")});this.updatePath();this.element.trigger("contentchange");return this},fontSize:function(e){var f=this.options,c=f.selection.selected({filter:"textContainsNodes"});a.each(c,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?a(this).find("td,th"):a(this);$this.css("font-size",e).find("[style]").css("font-size","")});this.updatePath();this.element.trigger("contentchange");return this},format:function(B){var j=this.options,k=j.selection,r=j.dom,A=j.doc;function u(f,c){function e(i){a(i).find("h1,h2,h3,h4,h5,h6,p,address,pre").each(function(){a(this).replaceWith(a(this).html())});return i}if(/^(LI|DT|DD|TD|TH|CAPTION)$/.test(f.nodeName)){!r.isEmpty(f)&&r.wrapContents(e(f),c)}else{if(/^(UL|OL|DL|TABLE)$/.test(f.nodeName)){r.wrap(f,c)}else{!r.isEmpty(f)&&a(e(f)).replaceWith(a(A.createElement(c)).html(a(f).html()))}}}var D=B.toUpperCase(),t,p,z,x=k.collapsed(),h=k.getBookmark(),g=k.selected({collapsed:true,blocks:true,filter:"textContainsNodes",wrap:"inline",tag:"span"}),q=g.length,C=a(g[0]).prev(),w=a(g[g.length-1]).next();while(q--){p=g[q];z=a(p);if(D=="DIV"||D=="SPAN"){if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(p.nodeName)){z.replaceWith(a(A.createElement("div")).html(z.html()||""))}}else{if(/^(THEAD|TBODY|TFOOT|TR)$/.test(p.nodeName)){z.find("td,th").each(function(){u(this,D)})}else{if(p.nodeName!=D){u(p,D)}}}}k.moveToBookmark(h);this.updatePath();this.element.trigger("contentchange");return this},deleteLink:function(){var k=this.options,g=k.selection,j=k.dom,h=k.doc,p=g.getNode(),c=j.selfOrParentLink(p);function f(i){return i.nodeName=="A"&&i.href}if(c){g.select(c);h.execCommand("unlink",false,null)}else{g=a.browser.msie?g.selected():g.selected({wrap:false});if(g.length){for(var e=0;e<g.length;e++){if(f(g[e])){c=g[e];break}}if(!c){c=j.parent(g[0],f)||j.parent(g[g.length-1],f)}}}this.updatePath();this.element.trigger("contentchange");return this},horizontalRule:function(){var f=this.options,c=f.selection,g=c.getEnd(),e=f.doc;g=(g&&(g.nodeName=="HR"))?g:e.createElement("hr");this._showDialog("Horizontal Rule",attributes(g),[f.formIds.standard],function(h){var i=a(g);a.each(h,function(p,j){j=a.trim(j)?i.attr(p,j):i.removeAttr(p)});if(!i.parent().length){c.insertNode(g)}});this.element.trigger("contentchange");return this},properties:function(){var c=this,f=this.options,e=f.selection,g=e.getNode();if(g.nodeType==3){g=g.parentNode}if(g.nodeType!=1||g.nodeName=="BODY"){return}this._showDialog("Standard Properties",attributes(g),[f.formIds.standard],function(h){var i=a(g);a.each(h,function(p,j){j=a.trim(j)?i.attr(p,j):i.removeAttr(p)});c.element.trigger("contentchange")});return this},image:function(){var f=this,k=this.options,i=k.selection,e=i.getEnd(),j=k.doc,h=k.formIds;if(a(e).is(".widget,:not(img)")){e=j.createElement("img")}if(e.width&&a(e).attr("style")){e.width=e.offsetWidth;a(e).attr("style",a(e).attr("style").replace(/width:\s*\d+px/,"width:"+e.offsetWidth+"px"))}if(e.height&&a(e).attr("style")){e.height=e.offsetHeight;a(e).attr("style",a(e).attr("style").replace(/height:\s*\d+px/,"height:"+e.offsetHeight+"px"))}var c=attributes(e),g=a.extend(true,{},c);this._showDialog("Image",attributes(e),[h.standard,h.image],function(p){var q=a(e);if(p.width&&p.style){p.style=p.style.replace(/width:\s*\d+px/,"width:"+p.width+"px")}if(p.height&&p.style){p.style=p.style.replace(/height:\s*\d+px/,"height:"+p.height+"px")}a.each(p,function(s,r){r=a.trim(r)?q.attr(s,r):q.removeAttr(s)});if(!e.parentNode){i.insertNode(e)}f.element.trigger("contentchange");if(!equals(p,g)){f.element.trigger("contentchange")}q.dblclick(function(){var r=attributes(e);r.width=a(e).css("width").replace(/px/g,"");r.height=a(e).css("height").replace(/px/g,"");f._showDialog("Image",r,[h.standard,h.image],function(s){a.each(s,function(u,t){if(u=="width"||u=="height"){t=a.trim(t)?q.css(u,t):q.removeAttr(u)}else{t=a.trim(t)?q.attr(u,t):q.removeAttr(u)}});if(!e.parentNode){i.insertNode(e)}f.element.trigger("contentchange")})})});return this},label:function(){var e=this,i=this.options,h=i.selection,j=h.getEnd(),g=a(j),f=i.formIds;if(!g.is("label")){g=a("<label>New Label</label>");j=g.get(0)}var c=a.extend({},{content:g.html()},attributes(j));if(c["for"]){c["for"]=c["for"].replace(/-/g,".")}this._showDialog("Label",c,[f.standard,f.label],function(k){g.html(k.content);delete k.content;a.each(k,function(q,p){p=a.trim(p);if(p){if(q=="for"){p=p.replace(/\./g,"-")}g.attr(q,p)}else{g.removeAttr(q)}});if(!g.parent().length){h.insertNode(j)}e.element.trigger("contentchange")});return this},labelActive:function(){return a(this.options.selection.getEnd()).is("label")},rteWidget:function(k,e,c){var f=this.options,g=f.selection,h=g.getStart(),p=a(h);if(!p.is(".widget[type="+k+"]")){p=a("<div class='widget'/>").attr("type",k).css((c&&c.style)||{});p.toggleClass("field",a.inArray(k,["text","checkbox","radio","select","datetime","textarea","file","grid","jsrender","password","rte","button"])!=-1);p.toggleClass("box",a.inArray(k,["box","editor","page","view"])!=-1);h=p.get(0)}var j=p.getMetadata(),i=attributes(h),q=k.substring(0,1).toUpperCase()+k.substring(1)+" Properties";if(i.id){i.id=i.id.replace(/-/g,".")}this._showDialog(q,a.extend({},j,i),e,function(r){var s={};if(p.is(".field")&&r[k+"field"]){s[k+"field"]=r[k+"field"];delete r[k+"field"]}else{if(p.is("[type=widget]")){s.widget=r.widget;delete r.widget}else{if(p.is("[type=box]")){s.box=r.box;delete r.box;if(j&&j.box&&!(j.box.link==s.box.link&&s.box.link=="raw")){p.children(".content").empty()}}else{if(p.is("[type=tabsx]")){s.tabsxwidget=r.tabsxwidget;delete r.tabsxwidget}else{if(p.is(".box")&&r[k+"box"]){s[k+"box"]=r[k+"box"];delete r[k+"box"]}}}}}if(!equals(s,j)){p.setMetadata(s);p.trigger("metadatachanged",[s,j])}if(!equals(r,i)){if(r.id){r.id=r.id.replace(/\./g,"-")}a.each(r,function(u,t){t=a.trim(t)?p.attr(u,t):p.removeAttr(u)});if(p.parent().length==0){g.insertNode(h);p.trigger("newwidget",[h])}else{p.trigger("attributeschanged",[r,i])}}});return this},rteWidgetActive:function(c){return a(this.options.selection.getEnd()).is(".widget[type="+c+"]")},_alignEnable:function(){var e=this.options;if(e.mode!="design"){return false}var c=e.selection.getNode();return c&&c.nodeName=="BODY"?c:e.dom.selfOrParent(c,"textNodes")||(c&&c.parentNode&&c.parentNode.nodeName=="BODY"?c.parentNode:null)?true:false},_alignActive:function(g){var e=this.options;if(e.mode!="design"){return false}var c=e.selection.getNode(),f=c.nodeName=="BODY"?c:e.dom.selfOrParent(c,"textNodes")||(c.parentNode&&c.parentNode.nodeName=="BODY"?c.parentNode:null);return a(f).css("text-align")==g},_commandEnabled:function(f){var h=this.options,c=false;try{c=(h.mode=="design")&&h.doc.queryCommandEnabled(f)}catch(g){}return c},_commandState:function(f){var h=this.options,c=false;try{c=(h.mode=="design")&&h.doc.queryCommandState(f)}catch(g){}return c},_directionActive:function(c){var e=a(this.options.selection.getNode());return e.attr("dir")==c||e.parents("[dir="+c+"]").length||e.find("[dir="+c+"]").length},_colorEnable:function(f,e){var g=this.options;if(g.mode!="design"){return false}var i=g.selection.getNode();if(i){var h=a(i.nodeType!=1?i.parentNode:i).css(e);f.data("select").val(this._color2Hex(""+h)||(e=="color"?"#000000":"#FFFFFF"));return true}return false},_fontEnable:function(e){var f=this.options;if(f.mode!="design"){return false}var g=f.selection.getNode();if(g){if(g.nodeType!=1){g=g.parentNode}var c=a(g).css("font-family");c=c?c.toString().toLowerCase().replace(/,\s+/g,",").replace(/'|"/g,""):"";e.element.data("select").val(e.src[c]?c:"");return true}return false},_fontSizeEnable:function(c){var e=this.options;if(e.mode!="design"){return false}var f=e.selection.getNode();c.element.data("select").val((m=e.dom.attr(f,"style").match(/font-size:\s*([^;]+)/i))?m[1]:"");return true},_formatEnable:function(c){var e=this.options;if(e.mode!="design"){return false}var f=e.dom.selfOrParent(e.selection.getNode(),/^(H[1-6]|P|ADDRESS|PRE)$/);c.element.data("select").val(f?f.nodeName.toLowerCase():"span");return true},_outdentEnable:function(){var i=this.options;if(i.mode!="design"){return false}var f=i.selection,h=i.dom;function c(q){var k={type:"",val:0},p;if((p=h.attr(q,"style"))){k.type=p.indexOf("padding-left")!=-1?"padding-left":(p.indexOf("margin-left")!=-1?"margin-left":"");k.val=k.type?parseInt(a(q).css(k.type))||0:0}return k}var j=f.getNode(),g=c(j),e=null;if(g.val){e=j}else{a.each(h.parents(j,"*"),function(){g=c(this);if(g.val){e=this}})}return e?true:false},_linkEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,g=c.getNode();if(g){var e=f.dom;return e.selfOrParentLink(g)||e.selectionHas(c,function(h){return h.nodeName=="A"&&h.href})||!c.collapsed()||g.nodeName=="IMG"}return false},_linkActive:function(){var f=this.options,c=f.selection;if(f.mode!="design"){return false}var g=c.getNode();if(g){var e=f.dom;return e.selfOrParentLink(g)||e.selectionHas(c,function(h){return h.nodeName=="A"&&h.href})}return false},_deleteLinkEnable:function(){var f=this.options,c=f.selection;if(f.mode!="design"){return false}var g=c.getNode();if(g){var e=f.dom;return e.selfOrParentLink(g)||e.selectionHas(c,function(h){return h.nodeName=="A"&&h.href})}return false},_blockQuoteEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;if(!c.collapsed()){return true}return e.selfOrParent(c.getNode(),/^BLOCKQUOTE$/)},_blockElementEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return !c.collapsed()||e.selfOrParent(c.getNode(),/^DIV$/)},_blockElementActive:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return c.collapsed()&&e.selfOrParent(c.getNode(),/^DIV$/)},_stopFloatActive:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;if(!c.collapsed()){return false}var g=e.selfOrParent(c.getEnd(),/^DIV$/);return g&&(e.attr(g,"clear")||a(g).css("clear")!="none")},_propertiesEnable:function(){var e=this.options,c=e.selection,f=c.getNode();if(e.mode!="design"){return false}if(f&&f.nodeType==3){f=f.parentNode}f=(f&&f.nodeType==1&&f.nodeName!="BODY")?f:null;return f?true:false},_imageActive:function(){var e=this.options;if(e.mode!="design"){return false}var f=e.selection.getEnd();if(f){var c=a(f);return f.nodeName=="IMG"&&!c.is(".widget")&&!c.is(".rte-media")}return false},_tablePropsEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.selfOrParent(c.getNode(),/^TABLE$/)},_deleteTableEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.parent(c.getNode(),/^TABLE$/)},_rowBeforeEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.selfOrParent(c.getNode(),/^TR$/)},_rowAfterEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.selfOrParent(c.getNode(),/^TR$/)},_deleteRowEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.selfOrParent(c.getNode(),/^TR$/)},_columnBeforeEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.selfOrParent(c.getNode(),/^(TD|TH)$/)},_columnAfterEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.selfOrParent(c.getNode(),/^(TD|TH)$/)},_deleteColumnEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.selfOrParent(c.getNode(),/^(TD|TH)$/)},_cellPropsEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom;return e.parent(c.getNode(),/^TABLE$/)},_mergeCellsEnable:function(){var h=this.options;if(h.mode!="design"){return false}var f=h.selection,g=h.dom,e=g.selfOrParent(f.getStart(),/^(TD|TH)$/),c=g.selfOrParent(f.getEnd(),/^(TD|TH)$/);return e&&c&&e!=c&&a(e).parents("table").get(0)==a(c).parents("table").get(0)},_splitCellsEnable:function(){var f=this.options;if(f.mode!="design"){return false}var c=f.selection,e=f.dom,g=e.selfOrParent(c.getNode(),/^(TD|TH)$/);return g&&(parseInt(e.attr(g,"colspan"))>1||parseInt(e.attr(g,"rowspan"))>1)},_parseURL:function(f){var g=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var e=f.match(g);var c={};a.each(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(h){c[this]=e[h]});if(!c.host.match(/[a-z0-9]/i)){c.host=""}return c},_absoluteURL:function(e){var f=this.url.protocol+"://"+(this.url.userInfo?parts.userInfo+"@":"")+this.url.host+(this.url.port?":"+this.url.port:"");var g=!this.url.file?this.url.path:this.url.path.substring(0,this.url.path.length-this.url.file.length);e=a.trim(e);if(!e){return""}if(e[0]=="#"){return e}var c=this._parseURL(e);if(!c.host&&!c.path&&!c.anchor){return""}if(!this.options.absoluteURLs){return e}if(c.protocol){return e}if(c.host&&(c.host.indexOf(".")!=-1||c.host=="localhost")){return this.url.protocol+"://"+e}if(e[0]=="/"){e=f+e}else{if(e.indexOf("./")==0){e=e.substring(2)}e=f+g+e}return e},_color2Hex:function(j){var f={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#fffffff",yellow:"#ffff00"};var i=/\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*/i;var g=/aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|rgb\s*\([^\)]+\)/i;var e;j=j||"";if(j.indexOf("#")===0){return j}function h(c){c=parseInt(c).toString(16);return c.length>1?c:"0"+c}if(f[j]){return f[j]}if((e=j.match(i))){return"#"+h(e[1])+h(e[2])+h(e[3])}return""},_trimEventCallback:function(e){e=e?e.toString():"";return a.trim(e.replace(/\r*\n/mg,"").replace(/^function\s*on[a-z]+\s*\(\s*event\s*\)\s*\{(.+)\}$/igm,"$1"))},_toPixels:function(e){var c=e.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(c){e=c[1];unit=c[2]}if(e[0]=="."){e="0"+e}e=parseFloat(e);if(isNaN(e)){return""}var f=parseInt(a(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(e*f);case"pt":return parseInt(e*f/12);case"%":return parseInt(e*f/100)}return e},_parseStyle:function(g){var e={},f,i,c,h;if(typeof(g)=="string"&&g.length){a.each(g.replace(/&quot;/gi,"'").split(";"),function(j,k){if((h=k.indexOf(":"))!==-1){i=a.trim(k.substr(0,h));c=a.trim(k.substr(h+1));if(i=="color"||i=="background-color"){c=c.toLowerCase()}if(i&&c){e[i]=c}}})}return e},_encode:function(f){var h={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};var c=/[<>&\"]/g;var g=h;return(""+f).replace(c,function(e){return g[e]})},_edittable:function(j){var f=this.options,g=f.selection,i=f.dom,k=f.doc,e=f.formIds,q=this;var p=j?k.createElement("table"):i.selfOrParent(g.getNode(),/^TABLE$/);p=p||k.createElement("table");if(p.width&&a(p).attr("style")){p.width=p.offsetWidth;a(p).attr("style",a(p).attr("style").replace(/width:\s*\d+px/,"width:"+p.offsetWidth+"px"))}if(p.height&&a(p).attr("style")){p.height=p.offsetHeight;a(p).attr("style",a(p).attr("style").replace(/height:\s*\d+px/,"height:"+p.offsetHeight+"px"))}var h=attributes(p);if(j){a.extend(h,{rows:2,columns:2,_isNew:true})}var c=a.extend(true,{},h);this._showDialog("Table",h,[e.standard,e.table],function(v){var u=a(p);if(!u.parents().length){var x=parseInt(v.rows)||0;var A=parseInt(v.columns)||0;if(x<=0||A<=0){return}var s=a(k.createElement("tbody")).appendTo(p);for(var w=0;w<x;w++){var z="<tr>";for(var t=0;t<A;t++){z+="<td>&nbsp;</td>"}s.append(z+"</tr>")}}else{u.removeAttr("width").removeAttr("border").removeAttr("cellspacing").removeAttr("cellpadding").removeAttr("frame").removeAttr("rules").removeAttr("style")}delete v.rows;delete v.columns;delete v._isNew;if(v.width&&v.style){v.style=v.style.replace(/width:\s*\d+px/,"width:"+v.width+"px")}if(v.height&&v.style){v.style=v.style.replace(/height:\s*\d+px/,"height:"+v.height+"px")}a.each(v,function(B,r){r=a.trim(r)?u.attr(B,r):u.removeAttr(B)});if(!p.parentNode){g.insertNode(p)}u.resizable({stop:function(B,r){q.element.trigger("contentchange");B.preventDefault();B.stopImmediatePropagation()}});if(!equals(v,c)){q.element.trigger("contentchange")}});return this},_cellProperties:function(){var f=this,k=this.options,i=k.selection,j=k.dom,g=k.formIds;var c=j.selfOrParent(i.getNode(),/^(TD|TH)$/);if(!c){return}var h=a(c),e=attributes(c);a.extend(e,{type:c.nodeName.toLowerCase(),width:h.css("width")||h.attr("width"),height:h.css("height")||h.attr("height")});this._showDialog("Cell",e,[g.standard,g.cell],function(p){var q=h;switch(p.apply){case"row":q=h.parent("tr").children("td,th");break;case"column":q=a(j.tableColumn(c));break;case"table":q=h.closest("table").find("td,th");break}delete p.apply;if(c.nodeName.toLowerCase()!=p.type){a.each(q.get(),function(){a(this).replaceWith(a("<"+p.type+" />").html(a(this).html()))})}delete p.type;f.element.trigger("contentchange");a.each(p,function(s,r){r=a.trim(r)?q.attr(s,r):q.removeAttr(s)})});return this},addClass:function(c,e){this.$body.find(c).addClass(e)},removeClass:function(c,e){this.$body.find(c).removeClass(e)},toggleClass:function(e,f,c){this.$body.find(e).toggleClass(f,c)},_createActions:function(){var c=this,f=this.options;var e={properties:{type:"button",label:"Properties",icons:{primary:"ui-icon-css"},handler:function(){c.properties()},enabled:function(){return c._propertiesEnable()}},docStructure:{type:"checkbox",label:"Toggle display document structure",icons:{primary:"ui-icon-doc-struct"},handler:function(){c.toggleDocumentStructure()},checked:function(){return c.$body&&c.$body.is(".rte-structure")}},cleanFormat:{type:"checkbox",label:"Clean Format",icons:{primary:"ui-icon-clean-format"},handler:function(){c.removeFormat()},enabled:function(){return c._commandEnabled("removeformat")},checked:function(){return c._commandState("removeformat")}},bold:{type:"checkbox",label:"Bold",icons:{primary:"ui-icon-bold"},handler:function(){c.bold()},enabled:function(){return c._commandEnabled("bold")},checked:function(){return c._commandState("bold")}},italic:{type:"checkbox",label:"Italic",icons:{primary:"ui-icon-italic"},handler:function(){c.italic()},enabled:function(){return c._commandEnabled("italic")},checked:function(){return c._commandState("italic")}},underline:{type:"checkbox",label:"Underline",icons:{primary:"ui-icon-underline"},handler:function(){c.underline()},enabled:function(){return c._commandEnabled("underline")},checked:function(){return c._commandState("underline")}},strikethrough:{type:"checkbox",label:"Strikethrough",icons:{primary:"ui-icon-strikethrough"},handler:function(){c.strikethrough()},enabled:function(){return c._commandEnabled("strikethrough")},checked:function(){return c._commandState("strikethrough")}},subscript:{type:"checkbox",label:"Subscript",icons:{primary:"ui-icon-subscript"},handler:function(){c.subscript()},enabled:function(){return c._commandEnabled("subscript")},checked:function(){return c._commandState("subscript")}},superscript:{type:"checkbox",label:"Superscript",icons:{primary:"ui-icon-superscript"},handler:function(){c.superscript()},enabled:function(){return c._commandEnabled("superscript")},checked:function(){return c._commandState("superscript")}},alignLeft:{name:"align",type:"radio",label:"Align left",icons:{primary:"ui-icon-align-left"},handler:function(){c.align("left")},enabled:function(){return c._alignEnable()},checked:function(){return c._alignActive("left")}},alignCenter:{name:"align",type:"radio",label:"Align center",icons:{primary:"ui-icon-align-center"},handler:function(){c.align("center")},enabled:function(){return c._alignEnable()},checked:function(){return c._alignActive("center")}},alignRight:{name:"align",type:"radio",label:"Align right",icons:{primary:"ui-icon-align-right"},handler:function(){c.align("right")},enabled:function(){return c._alignEnable()},checked:function(){return c._alignActive("right")}},alignFull:{name:"align",type:"radio",label:"Align full",icons:{primary:"ui-icon-align-full"},handler:function(){c.align("justify")},enabled:function(){return c._alignEnable()},checked:function(){return c._alignActive("justify")}},leftToRight:{name:"direction",type:"radio",label:"Left to right",icons:{primary:"ui-icon-left-to-right"},handler:function(){c.leftToRight()},checked:function(){return c._directionActive("ltr")}},rightToLeft:{name:"direction",type:"radio",label:"Right to left",icons:{primary:"ui-icon-right-to-left"},handler:function(){c.rightToLeft()},checked:function(){return c._directionActive("rtl")}},fontColor:{type:"colorPicker",label:"Font color",icons:{primary:"ui-icon-font-color"},handler:function(g){c.fontColor(g)},enabled:function(){return c._colorEnable(this.element,"color")}},backgroundColor:{type:"colorPicker",label:"Background color",color:"#FFFFFF",icons:{primary:"ui-icon-background-color"},handler:function(g){c.backgroundColor(g)},enabled:function(){return c._colorEnable(this.element,"background-color")}},font:{type:"select",label:"Font",tpl:'<span style="font-family:%val">%label</span>',src:{"":"Font","andale mono,sans-serif":"Andale Mono","arial,helvetica,sans-serif":"Arial","arial black,gadget,sans-serif":"Arial Black","book antiqua,palatino,sans-serif":"Book Antiqua","comic sans ms,cursive":"Comic Sans MS","courier new,courier,monospace":"Courier New","georgia,palatino,serif":"Georgia","helvetica,sans-serif":"Helvetica","impact,sans-serif":"Impact","lucida console,monaco,monospace":"Lucida console","lucida sans unicode,lucida grande,sans-serif":"Lucida grande","tahoma,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,lucida grande,verdana,sans-serif":"Trebuchet MS","verdana,geneva,sans-serif":"Verdana"},select:function(g){c.font(g)},enabled:function(){return c._fontEnable(this)}},fontSize:{type:"select",label:"Font size",labelTpl:"%label",tpl:'<span style="font-size:%val;line-height:1.2em">%label</span>',src:{"":"Font size","xx-small":"Small (8pt)","x-small":"Small (10px)",small:"Small (12pt)",medium:"Normal (14pt)",large:"Large (18pt)","x-large":"Large (24pt)","xx-large":"Large (36pt)"},select:function(g){c.fontSize(g)},enabled:function(){return c._fontSizeEnable(this)}},format:{type:"select",label:"Format",labelTpl:"%label",tpls:{"":"%label"},src:{span:"Format",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",p:"Paragraph",address:"Address",pre:"Preformatted",div:"Normal (DIV)"},select:function(g){c.format(g)},enabled:function(){return c._formatEnable(this)}},outdent:{type:"button",label:"Outdent",icons:{primary:"ui-icon-outdent"},handler:function(){c.outdent()},enabled:function(){return c._outdentEnable()}},indent:{type:"button",label:"Indent",icons:{primary:"ui-icon-indent"},handler:function(){c.indent()}},orderedList:{type:"button",label:"Ordered list",icons:{primary:"ui-icon-ordered-list"},handler:function(){c.orderedList()},enabled:function(){return c._commandEnabled("insertorderedlist")},checked:function(){return c._commandState("insertorderedlist")}},unorderedList:{type:"button",label:"Unordered List",icons:{primary:"ui-icon-unordered-list"},handler:function(){c.unorderedList()},enabled:function(){return c._commandEnabled("insertunorderedlist")},checked:function(){return c._commandState("insertunorderedlist")}},link:{type:"checkbox",label:"Link",icons:{primary:"ui-icon-link"},handler:function(){c.link()},enabled:function(){return c._linkEnable()},checked:function(){return c._linkActive()}},deleteLink:{type:"checkbox",label:"Delete Link",icons:{primary:"ui-icon-del-link"},handler:function(){c.deleteLink()},enabled:function(){return c._deleteLinkEnable()},checked:function(){return c._deleteLinkEnable()}},horizontalRule:{type:"checkbox",label:"Horizontal rule",icons:{primary:"ui-icon-horizontal-rule"},handler:function(){c.horizontalRule()},checked:function(){return f.mode=="design"&&f.selection.getEnd()&&f.selection.getEnd().nodeName=="HR"}},blockQuote:{type:"checkbox",label:"Block quote",icons:{primary:"ui-icon-block-quote"},handler:function(){c.blockQuote()},enabled:function(){return c._blockQuoteEnable()},checked:function(){return c._blockQuoteEnable()}},blockElement:{type:"checkbox",label:"Block element (DIV)",icons:{primary:"ui-icon-block-element"},handler:function(){c.blockElement()},enabled:function(){return c._blockElementEnable()},checked:function(){return c._blockElementActive()}},stopFloat:{type:"checkbox",label:"Stop element floating",icons:{primary:"ui-icon-stop-float"},handler:function(){c.stopFloat()},checked:function(){return c._stopFloatActive()}},image:{type:"checkbox",label:"Image",icons:{primary:"ui-icon-image"},handler:function(){c.image()},checked:function(){return c._imageActive()}},table:{type:"button",label:"Table",icons:{primary:"ui-icon-table"},handler:function(){c._edittable(true)}},tableProps:{type:"button",label:"Table properties",icons:{primary:"ui-icon-table-props"},handler:function(){c._edittable()},enabled:function(){return c._tablePropsEnable()}},deleteTable:{type:"button",label:"Delete table",icons:{primary:"ui-icon-del-table"},handler:function(){c.deleteTable()},enabled:function(){return c._deleteTableEnable()}},rowBefore:{type:"button",label:"Insert row before",icons:{primary:"ui-icon-row-before"},handler:function(){c.insertTableRow("before")},enabled:function(){return c._rowBeforeEnable()}},rowAfter:{type:"button",label:"Insert row after",icons:{primary:"ui-icon-row-after"},handler:function(){c.insertTableRow("after")},enabled:function(){return c._rowAfterEnable()}},deleteRow:{type:"button",label:"Delete row",icons:{primary:"ui-icon-del-row"},handler:function(){c.deleteRow()},enabled:function(){return c._deleteRowEnable()}},columnBefore:{type:"button",label:"Insert column before",icons:{primary:"ui-icon-col-before"},handler:function(){c.insertTableColumn("before")},enabled:function(){return c._columnBeforeEnable()}},columnAfter:{type:"button",label:"Insert column after",icons:{primary:"ui-icon-col-after"},handler:function(){c.insertTableColumn("after")},enabled:function(){return c._columnAfterEnable()}},deleteColumn:{type:"button",label:"Delete column",icons:{primary:"ui-icon-del-column"},handler:function(){c.deleteColumn()},enabled:function(){return c._deleteColumnEnable()}},cellProps:{type:"button",label:"Table cell properties",icons:{primary:"ui-icon-cell-props"},handler:function(){c._cellProperties()},enabled:function(){return c._cellPropsEnable()}},mergeCells:{type:"button",label:"Merge table cells",icons:{primary:"ui-icon-merge-cells"},handler:function(){c.mergeCells()},enabled:function(){return c._mergeCellsEnable()}},splitCells:{type:"button",label:"Split table cells",icons:{primary:"ui-icon-split-cells"},handler:function(){c.splitCells()},enabled:function(){return c._splitCellsEnable()}},tabsx:{type:"checkbox",label:"Tabsx",icons:{primary:"ui-icon-tabsx"},handler:function(){c.rteWidget("tabsx",f.formIds.tabsx,{style:{width:400,height:300}})},checked:function(){return c.rteWidgetActive("tabsx")}},sourcecode:{type:"checkbox",label:"Source Code",icons:{primary:"ui-icon-sourcecode"},handler:function(){c.option("mode",f.mode=="sourcecode"?"design":"sourcecode")},checked:function(){return f.mode=="sourcecode"},enabled:function(){return true}}};a.each(e,function(){this.text=false;if(!this.enabled){this.enabled=function(){return f.mode=="design"}}});return e},destroy:function(){var e=this.options,c=e.doc;e.history=[];this.toolbar&&this.toolbar.remove();this.source.unbind(".rte");a(c).unbind(".rte");this.$body.unbind(".rte");a(e.win).unbind(".rte");a(window).unbind("resize.rte",this._proxy);this.element.removeClass("an-rte");return a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.tabsx",a.ui.tabs,{options:{duration:2000,slideshow:false,fxs:null},_create:function(){var c=this,e=this.options;if(e.mode=="edit"&&e.slideshow){e.fx=e.fxs?e.fxs:{opacity:"toggle",duration:200}}a.ui.tabs.prototype._create.apply(this,arguments);this.element.addClass("an-tabsx");this._navMenu=a("<div id='nav-menu'>>><span>0</span></div>");this._navMenu.css({position:"relative","float":"left",width:"18px",height:"22px","font-size":"60%",border:"1px solid #CCCCCC",margin:"0px",padding:"0px"});this._navMenu.find("span").css({position:"absolute",right:"0px",bottom:"0px","font-size":"11px"});this._navMenu.hover(function(f){c._navMenu.css({border:"1px solid #AAAAAA",cursor:"pointer",margin:"0px",padding:"0px"})},function(){c._navMenu.css({border:"1px solid #CCCCCC",margin:"0px",padding:"0px"})});if(e.mode=="edit"&&e.slideshow){this._slideshow(e.duration)}else{this.element.bind("tabsxadd.tabsx",a.proxy(this,"_showMenu"));this.element.bind("tabsxshow.tabsx",a.proxy(this,"_showMenu"));this.element.bind("tabsxremove.tabsx",a.proxy(this,"_showMenu"));this._proxy=a.proxy(this,"_showMenu");a(window).bind("resize.tabsx",this._proxy)}if(e.showTabsContextMenu){this.list.menu({triggerEvent:"contextmenu",menuPosition:{my:"left top",at:"left bottom"},delay:false,actions:{close:{type:"menuItem",text:"Close",handler:a.proxy(c,"closeCurrent")},closeOthers:{type:"menuItem",text:"Close Others",handler:a.proxy(c,"closeOthers")},closeAll:{type:"menuItem",text:"Close All",handler:a.proxy(c,"closeAll")}},select:function(g,f){a(this).menu("collapseAll")}})}},_slideshow:function(h){var c=this,i=this.options,j=null,g=0;this.lis.each(function(){g+=a(this).outerWidth(true)});this.list.css({width:g}).addClass("ui-tabs-slideshow-nav").removeClass("ui-widget-header");var e=function(k){f();c._rotation=setTimeout(function(){var p=i.selected;if(j!=null&&j==p){f();return false}c.select(++p<c.anchors.length?p:0);e()},h)};function f(){clearTimeout(c._rotation);c._rotation=null}if(h){this.anchors.bind("click",f);this.anchors.bind("mouseover",function(){var k=c.anchors.index(this);if(i.selected==k){f()}else{j=k}});this.anchors.bind("mouseout",function(){e();j=null});this.anchors.bind("mouseup",function(){a(this).parent().hasClass("ui-state-focus")&&a(this).parent().removeClass("ui-state-focus")});e()}else{f()}return this},closeCurrent:function(){this.remove(this.option("selected"))},closeOthers:function(){var c=this.option("selected");while(this.length()-1>c){this.remove(this.length()-1)}while(this.length()>1){this.remove(0)}},closeAll:function(){while(this.length()>0){this.remove(0)}},option:function(c,e){if(c==="selectedPanel"&&e===b){return this.panels.get(this.options.selected)}else{if(c==="panels"&&e===b){return this.panels}}return a.Widget.prototype.option.apply(this,arguments)},_showMenu:function(j,i){if(this.list.is(":hidden")){return}var c=this;if(j.type=="tabsxshow"){this.lis.each(function(q,e){var s=a(e),r=parseInt(s.attr("hit"))||0;s.attr("hit",s.is(".ui-tabs-selected")?0:r+1)})}var p=this.lis.toArray();p.sort(function(e,s){var r=parseInt(a(e).attr("hit")),q=parseInt(a(s).attr("hit"));return r-q});this._navMenu.appendTo(this.list);var h=this.list.width()-this._navMenu.outerWidth(true);this._navMenu.menu("destroy").detach();a.each(p,function(q,e){h-=a(e).outerWidth(true);a(e)[h>0?"show":"hide"]()});var g=this.lis.filter(":hidden"),f=g.size();if(f>0){this._navMenu.find("span").html(f);var k={};g.each(function(){var q=a(this),e=q.find("a:first"),r=e.attr("href").slice(1);k[r]={type:"menuItem",text:e.text(),handler:function(){c.element.tabsx("select","#"+r)}}});c._navMenu.appendTo(this.list);c._navMenu.menu({triggerEvent:"click",menuPosition:{of:c._navMenu,my:"left top",at:"left bottom"},delay:false,actions:k,select:function(r,q){a(this).menu("collapseAll")}})}},remove:function(c){if(this._getIndex(c)==-1){return}return a.ui.tabs.prototype.remove.apply(this,arguments)},panel:function(c){return a(this.panels[this._getIndex(c)])},_trigger:function(c,e,f){var i,h,g=this.options[c];f=f||{};e=a.Event(e);e.type=(c===this.widgetEventPrefix?c:this.widgetEventPrefix+c).toLowerCase();e.target=this.element[0];h=e.originalEvent;if(h){for(i in h){if(!(i in e)){e[i]=h[i]}}}!(a.isFunction(g)&&g.call(this.element[0],e,f)===false||e.isDefaultPrevented());return this.element.trigger(e,f)},destroy:function(){var c=this.options;if(!c.destroyTabs){this.lis.add(this.panels).each(function(){a.removeData(this,"destroy.tabs")})}a(window).unbind("resize.tabsx",this._proxy);this.list.unbind(".tabsx");this.element.removeClass("an-tabsx").unbind(".tabsx").removeData("tabsx");return a.ui.tabs.prototype.destroy.apply(this,arguments)}})}(jQuery));
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.form",{options:{mode:"browser",document:{},printable:true,actionSets:[],formIds:{text:["5080143085ac60df09000001","5092733215ca72150a000001"],password:["5080143085ac60df09000001"],checkbox:["5080143085ac60df09000001","50af2d266cec663c0a000009"],button:["5080143085ac60df09000001","50de596da092007b11000001"],datetime:["5080143085ac60df09000001","50af2da26cec663c0a00000b"],textarea:["5080143085ac60df09000001","50af2ca66cec663c0a000008"],tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],file:["5080143085ac60df09000001","50ceb75ba092004120000000"],grid:["5080143085ac60df09000001","5089e21f2b2255080a000005"],jsrender:["5080143085ac60df09000001","514d0a46caa05a669e0005c8","514d0e9dcaa05a26e30001af","514d052fcaa05a669e000000","514d5ef3ac8f27413200014e"],radio:["5080143085ac60df09000001","50af2d626cec663c0a00000a"],select:["5080143085ac60df09000001","508259700b27990c0a000003"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],rte:["5080143085ac60df09000001"]},wrapper:"<form/>"},_create:function(){var self=this,o=this.options,el=this.element;el.addClass("an-form");o.document=$.type(o.document)=="function"?o.document():o.document;$(o.document).bind("docchanged.form",function(e,doc,oldDoc){self.refresh();el.trigger("documentchanged",e,[doc,oldDoc])}).bind("propchanged.form",function(e,id,value,oldValue,trans){self.field(id,value)});$.extend(this,eval("try{("+(o.form.methods||"{}")+")}catch(e){}"));this.refresh();el.bind("dblclick.form",function(e){if(o.mode=="design"&&self.labelActive()){self.label()}})},_createOutline:function(){var form=this.options.form,root=this._getForm();function getWidget(el){var widget=null,type=el.attr("type");if(el.is(".field")){widget=el.data(type+"field")}else{if(el.is(".box")){widget=el.data(type)}else{if(el.is(".widget")){widget=el.data(type+"widget")}}}return widget}return{getRoots:function(mountNodes){var nodes=new Array();nodes.push({id:"root",text:form.title||form.name||form._id,"class":"folder"});mountNodes(nodes)},getChildren:function(parentNode,mountNodes){var nodes=new Array();if(parentNode.id=="root"){root.find(".widget").each(function(){var $this=$(this),id=$this.attr("id");if($this.parent().closest(".widget").length==0){nodes.push({id:id,text:id,"class":$this.is(".field")?"file":"folder",data:getWidget($this)})}})}else{root.find("#"+parentNode.id).find(".widget").each(function(){var $this=$(this),id=$this.attr("id");if($this.parent().closest(".widget").attr("id")==parentNode.id){nodes.push({id:id,text:id,"class":$this.is(".field")?"file":"folder",data:getWidget($this)})}})}mountNodes(nodes)},hasChildren:function(node){return node["class"]=="folder"},getId:function(node){return node.id?node.id:null}}},option:function(key,value){var o=this.options;if(key==="mode"&&o.readonly){return}else{if(key==="isValid"&&value===undefined&&o.mode=="edit"){return this.validator.form()}else{if(key==="actionSets"&&value===undefined){return this._createActionSets()}else{if(key==="outline"&&value===undefined){return this._createOutline()}else{if(key=="content"&&value==undefined){if(o.isDirty){this._syncFormContent()}return o.form.content}}}}}var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var o=this.options,oldValue=o[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);this._handleChange(key,value,oldValue);this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},_handleChange:function(key,value,oldValue){var o=this.options;if(key==="mode"||key==="document"||key==="form"){if(key==="mode"&&o.isDirty){this._syncFormContent()}else{if(key==="form"){this.element.children("style").text(o.form.stylesheet);this.$form&&!o.isDirty&&this.$form.empty().html(o.form.content);if(this.rte){!o.isDirty&&this.rte.rte("option","content",o.form.content);this.rte.rte("option","stylesheet",o.form.stylesheet)}}}this.refresh()}else{if(key==="url"){this.$form.find(".field.file").filefield("option","url",o.url);this.$form.find(".field.grid").gridfield("option","url",o.url)}}},refresh:function(){var o=this.options;this["_"+o.mode]&&this["_"+o.mode]()},_browser:function(){this.rte&&this.rte.hide();if(!this.$form){this._createForm()}else{this.$form.show();this._refreshFields()}},_edit:function(){this.rte&&this.rte.hide();if(!this.$form){this._createForm()}else{this.$form.show();this._refreshFields()}},_design:function(){this.$form&&this.$form.hide();if(!this.rte){this._createRTE()}else{this.rte.show();this._refreshFields()}},field:function(id,value){var field=this._getForm().find("#"+id.replace(/\./g,"-")+".field");if(field.size()==0){return}if(value===undefined){var v=null;field.each(function(){var $this=$(this),type=$this.attr("type");v=$this[type+"field"]("option","value");if(type=="radio"&&v!=null){return false}});return v}else{field[field.attr("type")+"field"]("option","value",value)}},showWidget:function(){var self=this;$.each(arguments,function(){var w=self.getWidget(this);w&&w.widget().show()})},hideWidget:function(){var self=this;$.each(arguments,function(){var w=self.getWidget(this);w&&w.widget().hide()})},getWidget:function(id){var self=this,o=this.options,widget=null;this._getForm().find("#"+id).each(function(){var $this=$(this),type=$this.attr("type"),filter=(o.mode=="design"?".an-box:not(.raw),."+o.form.name:".an-page,.an-form");$this.parent().closest(filter).each(function(){if($(this).is("."+o.form.name)||this==self.element[0]){if($this.is(".field")){widget=$this.data(type+"field")}else{if($this.is(".box")){widget=$this.data(type)}else{if($this.is(".widget")){widget=$this.data(type+"widget")}}}return false}});if(widget){return false}});return widget},_createForm:function(){var o=this.options,form=o.form,el=this.element;$('<style type="text/css">'+(form.stylesheet||"")+"</style>").appendTo(el);this.$form=$(o.wrapper).addClass(form.name).html(form.content).appendTo(el);this.validator=this.$form.validate($.extend({meta:"validate",errorPlacement:function(error,element){error.insertAfter(element.closest("div.field"))}},eval("("+(form.validator||"{}")+")")));var data={};data[this.widgetName]=this;$.each(eval("("+(o.form.actions||"[]")+")"),function(k,action){el.bind(action.events,data,action.handler)});this._refreshFields()},_createRTE:function(){var self=this,o=this.options,form=o.form;var globalCSSFiles=["stylesheets/rte/rte-design.css","stylesheets/jquery-ui-1.8.24.custom.css","stylesheets/jquery.ui.timepicker.css","stylesheets/jquery.an.menu.css","stylesheets/jquery.an.agilegrid.css","stylesheets/jquery.an.tree.css","stylesheets/jquery.an.border.css","stylesheets/jquery.an.tabsx.css","stylesheets/jquery.an.toolbar.css","stylesheets/jquery.an.page.css","stylesheets/jquery.an.form.css","stylesheets/jquery.an.editor.css","stylesheets/jquery.an.formview.css","stylesheets/jquery.an.widget.css","stylesheets/jquery.an.tabsxwidget.css","stylesheets/jquery.an.box.css","stylesheets/jquery.an.fileinput.css","stylesheets/jquery.an.filefield.css","stylesheets/jquery.an.gridfield.css","stylesheets/jquery.colorpicker.css","stylesheets/jquery.ui.select.css","stylesheets/rte/paddinginput.css","stylesheets/jquery.an.rte.css","stylesheets/base.css"],globalJSFiles=["javascripts/jquery-1.8.2.js","javascripts/jquery.scrollto.js"];var localCSSFiles=[],localJSFiles=[];$.each(form.cssfiles||[],function(k,v){localCSSFiles.push("/dbs/"+dbId+"/forms/"+form._id+"/attachments/"+v.metadata.filepath)});$.each(form.jsfiles||[],function(k,v){localJSFiles.push("/dbs/"+dbId+"/forms/"+form._id+"/attachments/"+v.metadata.filepath)});var cssfiles=[].concat(globalCSSFiles).concat(localCSSFiles),jsfiles=[].concat(globalJSFiles).concat(localJSFiles);this.rte=$("<div class = 'rte'/>").appendTo(this.element).rte({content:form.content,dbId:o.dbId,stylesheet:form.stylesheet,cssfiles:cssfiles,jsfiles:jsfiles,cssClass:form.name,restore:function(form){self._refreshFields(form)},clean:function(form){form.find(".widget").each(function(){var $this=$(this),type=$this.attr("type"),wid;if($this.is(".field")){wid=$this.data(type+"field")}else{if($this.is(".box")){wid=$this.data("box")}else{if($this.is("[type="+type+"]")){wid=$this.data(type+"widget")}}}wid&&wid.destroy()})},onload:function(){var sel=self.rte.rte("option","selection"),$doc=$(self.rte.rte("option","doc"));$doc.bind("paste.form",function(e){setTimeout(function(){self._refreshFields();self.rte.rte("updatePath");self._trigger("change",null,self)},20)}).bind("widgetdblclick.form widgetclick.form widgetchange.form click.form",function(e,widget){$doc.find(".widget.selected").removeClass("selected");if(e.type=="widgetclick"||e.type=="widgetdblclick"){if(widget.selectable(e.originalEvent)){var el=widget.widget();el.addClass("selected");!$.browser.chrome&&sel.select(el[0]);self._trigger("widgetselect",null,widget)}self.rte.rte("updatePath");if(e.type=="widgetdblclick"){var type=widget.option("type");if(self.rteWidgetActive(type)){self.rteWidget(type)}}}self.rte.trigger(e,widget)});self._refreshFields();self._trigger("formcreated",null,{form:self})}}).bind("change.form contentchange.form",function(e){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}).bind("newwidget.form",function(e,widget){e.stopImmediatePropagation();self.refresh();self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)})},_getForm:function(){return this.options.mode=="design"?$(this.rte.rte("option","doc")):this.$form},_refreshFields:function(form){var self=this,o=this.options,doc=o.document;(form||this._getForm()).find(".widget").each(function(){var $this=$(this),id=$this.attr("id"),type=$this.attr("type");if(id){id=id.replace(/-/g,".")}if($this.is(".field")){var value=doc&&doc.prop&&doc.prop(id),field=$this.data(type+"field");if(field){field.option("mode",o.mode).option("value",value);field.refresh()}else{var opts={dbId:o.dbId,parent:function(){return self},value:value,url:o.url,mode:o.mode,optionchanged:function(e,data){if(data.key=="value"){var id=$(e.target).attr("id");id=id&&id.replace(/-/g,".");var curValue=doc.prop(id);if(curValue!=data.value){doc.prop(id,data.value,data["transient"])}}else{if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}},resize:function(e,data){self.option("isDirty",true)}};if(type=="button"){$this[type+"field"]({parent:function(){return self},label:$this.attr("label")})}else{$this[type+"field"]&&$this[type+"field"](opts)}}}else{if($this.is(".box")){var actions=[],id=$this.attr("id");$.each(o.boxToolbarActions||[],function(){if(this.boxName==id){actions.push(this)}});if($this.is(".an-box")){$this.data("box").option("mode",o.mode)}else{$this.box({parent:function(){return self},mode:o.mode,dbId:o.dbId,toolbarActions:actions,optionchanged:function(e,data){if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}})}}else{if($this.is("[type="+type+"]")){if($this.is(".an-"+type+"widget")){$this.data(type+"widget").option("mode",o.mode)}else{$this[type+"widget"]({parent:function(){return self},mode:o.mode,dbId:o.dbId,optionchanged:function(e,data){if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}})}}}}});return this},_createActionSets:function(){if(this.options.mode=="design"){return[this._controlActionSet(),this._formatActionSet(),this._tableActionSet()]}},_controlActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["properties","cleanFormat","docStructure"],actions)},_formatActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["bold","italic","underline","strikethrough","subscript","superscript","alignLeft","alignCenter","alignRight","alignFull","font","fontSize","format","leftToRight","rightToLeft","fontColor","backgroundColor","outdent","indent","orderedList","unorderedList","link","deleteLink","horizontalRule","blockQuote","blockElement","stopFloat","image"],actions)},_tableActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["table","tableProps","deleteTable","rowBefore","rowAfter","deleteRow","columnBefore","columnAfter","deleteColumn","cellProps","mergeCells","splitCells"],actions)},_createActionSet:function(actionNames,actions){var actionSet={};$.each(actionNames,function(){actionSet[this]=actions[this]});return actionSet},_syncFormContent:function(){var form=this.options.form;form.content=this.rte.rte("option","content");this.$form&&this.$form.empty().html(form.content)},validate:function(){return this.validator?this.validator.form():true},rteWidget:function(type,opts){this.rte&&this.rte.rte("rteWidget",type,this.options.formIds[type],opts);return this},rteWidgetActive:function(type){return this.rte&&this.rte.rte("rteWidgetActive",type)},label:function(){this.rte&&this.rte.rte("label");return this},labelActive:function(){return this.rte&&this.rte.rte("labelActive")},sourceCode:function(){if(this.rte){var mode=this.rte.rte("option","mode");this.rte.rte("option","mode",mode=="sourcecode"?"design":"sourcecode")}},sourceCodeActive:function(){return this.rte&&this.rte.rte("option","mode")=="sourcecode"},handler:function(){self.option("mode",o.mode=="sourcecode"?"design":"sourcecode")},checked:function(){return o.mode=="sourcecode"},save:function(){var self=this,o=this.options;if(o.isDirty){this._syncFormContent();ModelupdateDocument(o.dbId,o.form._id,o.form,null,function(err,result){self.option("isDirty",false)})}return this},print:function(){var o=this.options,docId=o.document.prop("_id"),loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&docid="+docId+"&formid="+o.form._id;print(url);return this},highlightWidget:function(id,highlight){var w=this.getWidget(id);w&&w.highlight(highlight);return this},scrollTo:function(id,opts){var o=this.options;if(o.mode=="design"){var win=this.rte.rte("option","win");win.$("#"+id.replace(/\./g,"-")).ScrollTo(opts)}else{this.$form.find("#"+id).scrollTo(opts)}},destroy:function(){$(this.options.document).unbind(".form");this.element.unbind(".form").removeClass("an-form").children("style").remove();return $.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.outline",{options:{},_create:function(){var c=this,f=this.options,e=this.element;e.addClass("an-outline").tree({contextmenu:f.contextmenu,contentProvider:f.contentProvider,nodehover:f.nodehover,nodeclick:f.nodeclick,nodedblclick:f.nodedblclick});a.each(e.tree("option","roots")||[],function(h,g){e.tree("expand",g)});a(window).bind("outline.outline",function(h){var g=h.workbench.currentEditor();c._setOption("contentProvider",g&&g.option("outline"))}).bind("widgetselect.outline",function(h,g){e.tree("option","selectedNodes",[g.option("id")])})},_setOption:function(c,f){if(c==="contentProvider"){var e=this.element;e.tree("option","contentProvider",f);a.each(e.tree("option","roots")||[],function(h,g){e.tree("expand",g)})}return a.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){a(window).unbind(".outline");this.element.removeClass("an-outline");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.agilegrid",{options:{selectionMode:"row",showTopHeader:true,showLeftHeader:true,isColumnResizable:false,isRowResizable:false,topHeaderHeight:28,leftHeaderWidth:50,defaultColWidth:80,defaultRowHeight:28,cellSelections:[],colSelections:{},rowSelections:{},focus:{row:0,col:0},pagerHeight:28,currentPage:0,totalPage:0,colModel:{},rowModel:{},rowOffset:0,limit:30,rowCount:0,totalRowCount:0,totalColCount:3,topHeaderRender:function(e,c){return c&&c.label?c.label:e},leftHeaderRender:function(c){return c},cellRender:function(e,c){return e+","+c}},_create:function(){this.element.addClass("an-agilegrid").empty();var c=this,e=this.options;if(e.showLeftHeader&&e.showTopHeader){this.topLeftCorner=a("<div class='top-left ui-widget-header'/>").css({left:0,top:0,width:e.leftHeaderWidth,height:e.topHeaderHeight}).appendTo(this.element)}if(e.showTopHeader){this.topHeaderTable=a("<table cellspacing='0' cellpadding='0'><thead><tr/></thead></table>");this.topHeaderArea=a("<div class='top-header ui-widget-header'/>").css({left:e.showLeftHeader?e.leftHeaderWidth+1:0,top:0,right:0,height:e.topHeaderHeight+1}).append(this.topHeaderTable).appendTo(this.element).disableSelection()}if(e.showLeftHeader){this.leftHeaderTable=a("<table cellspacing='0' cellpadding='0'><thead></thead></table>");this.leftHeaderArea=a("<div class='left-header ui-widget-header'/>").css({left:0,top:e.showTopHeader?e.topHeaderHeight+1:0,bottom:e.showPager?e.pagerHeight:0,width:e.leftHeaderWidth+1}).append(this.leftHeaderTable).appendTo(this.element).disableSelection()}this.contentArea=a("<div class='content-area'/>").css({left:e.showLeftHeader?e.leftHeaderWidth+1:0,top:e.showTopHeader?e.topHeaderHeight+1:0,bottom:e.showPager?e.pagerHeight:0,right:0}).appendTo(this.element).disableSelection();this.contentTable=a("<table class='content' cellspacing='0' cellpadding='0'><tbody/></table>").appendTo(this.contentArea);if(e.showPager){this.pager=a("<div class='pager ui-widget-header'/>").css({left:0,right:0,bottom:0,height:e.pagerHeight}).appendTo(this.element);a.each(["first","prev","goto","next","last"],function(g,f){if(f=="goto"){c.pager.append("<div class='goto-page'>Page<input class='current-page' type='text' value='"+e.currentPage+"'>of<div class='total-page'>"+e.totalPage+"</div></div>");c.pager.delegate("input","change.agilegrid",function(){var i=a(this),h=a(this).val();if(h<=0){h=1;i.val(h)}else{if(h>e.totalPage){h=e.totalPage;i.val(h)}}c._trigger("gotopage",null,{page:h})})}else{a("<button class='pager-button'/>").attr("id",f).appendTo(c.pager).button({label:f,icons:{primary:"ui-icon-"+f+"-page"},text:false,disabled:true}).click(function(h){h.preventDefault();h.stopImmediatePropagation();c._trigger(f+"page",null,{currentPage:e.currentPage})})}});this.pager.append("<div class='info'>")}this.contentArea.scroll(function(){var f=c.contentTable.position();if(e.showTopHeader){c.topHeaderTable.css("left",f.left)}if(e.showLeftHeader){c.leftHeaderTable.css("top",f.top)}});this.element.delegate(".top-header th>div","hover.agilegrid",function(f){if(e.isColumnResizable){a(this).resizable({handles:"e",resize:function(g,h){c._columnWidth(parseInt(h.element.parent().attr("index")),h.size.width)}})}}).delegate(".left-header th>div","hover.agilegrid",function(f){if(e.isRowResizable){a(this).resizable({handles:"s",resize:function(g,h){c._rowHeight(e.rowOffset,parseInt(h.element.parent().attr("index")),h.size.height)}})}}).delegate(".top-header th","mousedown.agilegrid",function(j){if(e.selectionMode=="row"){return}var g=parseInt(a(this).attr("index"));if(j.ctrlKey){if(e.colSelections[g]){delete e.colSelections[g]}else{e.colSelections[g]=true}c.contentTable.find("td[colindex="+g+"]").toggleClass("selected",e.colSelections[g]==true?true:false);e.focus=a.extend(e.focus,{col:g})}else{if(j.shiftKey){var k=Math.min(e.focus.col,g),f=Math.max(e.focus.col,g);c.clearSelection();for(var h=k;h<=f;h++){e.colSelections[h]=true;c.contentTable.find("td[colindex="+h+"]").addClass("selected")}}else{c.clearSelection();e.focus=a.extend(e.focus,{col:g});e.colSelections[g]=true;c.contentTable.find("td[colindex="+g+"]").addClass("selected");e.focus=a.extend(e.focus,{col:g})}}c.mouseDownTopHeader=true}).delegate(".top-header th","mousemove.agilegrid",function(j){if(c.mouseDownTopHeader){var g=parseInt(a(this).attr("index")),k=Math.min(e.focus.col,g),f=Math.max(e.focus.col,g);if(!j.ctrlKey){c.clearSelection()}for(var h=k;h<=f;h++){e.colSelections[h]=true;c.contentTable.find("td[colindex="+g+"]").addClass("selected")}}}).delegate(".left-header th","mousedown.agilegrid",function(j){if(e.selectionMode=="column"){return}var p=parseInt(a(this).attr("index")),k=e.rowOffset+p;if(j.ctrlKey){if(e.rowSelections[k]){delete e.rowSelections[k]}else{e.rowSelections[k]=true}c.contentTable.find("tr[rowindex="+p+"]").toggleClass("selected",e.rowSelections[k]==true?true:false);e.focus=a.extend(e.focus,{row:k})}else{if(j.shiftKey){var g=Math.min(e.focus.row,k),h=Math.max(e.focus.row,k);c.clearSelection();for(var f=g;f<=h;f++){e.rowSelections[f]=true;c.contentTable.find("tr[rowindex="+(f-e.rowOffset)+"]").addClass("selected")}}else{c.clearSelection();e.focus=a.extend(e.focus,{row:k});e.rowSelections[k]=true;c.contentTable.find("tr[rowindex="+p+"]").addClass("selected");e.focus=a.extend(e.focus,{row:k})}}c.mouseDownLeftHeader=true}).delegate(".left-header th","mousemove.agilegrid",function(j){if(c.mouseDownLeftHeader){var p=parseInt(a(this).attr("index")),k=e.rowOffset+p,g=Math.min(e.focus.row,k),h=Math.max(e.focus.row,k);if(!j.ctrlKey){c.clearSelection()}for(var f=g;f<=h;f++){e.rowSelections[f]=true;c.contentTable.find("tr[rowindex="+(f-e.rowOffset)+"]").addClass("selected")}}}).delegate(".content td","mousedown.agilegrid",function(i){var h=a(this),k=parseInt(h.attr("rowindex")),g=parseInt(h.attr("colindex")),j=e.rowOffset+k,f=g;c.select(j,f,i.ctrlKey?"ctrl":(i.shiftKey?"shift":null));c.mouseDownContent=true}).delegate(".content td","mousemove.agilegrid",function(k){if(c.mouseDownContent){var q=a(this),r=parseInt(q.attr("rowindex")),s=parseInt(q.attr("colindex")),u=e.rowOffset+r,f=s;if(!k.ctrlKey){c.clearSelection()}if(e.selectionMode=="row"){var g=Math.min(e.focus.row,u),p=Math.max(e.focus.row,u);for(var j=g;j<=p;j++){e.rowSelections[j]=true;c.contentTable.find("tr[rowindex="+(j-e.rowOffset)+"]").addClass("selected")}}else{if(e.selectionMode=="column"){var h=Math.min(e.focus.col,f),t=Math.max(e.focus.col,f);for(var j=h;j<=t;j++){e.colSelections[j]=true;c.contentTable.find("td[colindex="+j+"]").addClass("selected")}}else{var g=Math.min(e.focus.row,u),p=Math.max(e.focus.row,u),h=Math.min(e.focus.col,f),t=Math.max(e.focus.col,f);for(var u=g;u<=p;u++){if(!e.cellSelections[u]){e.cellSelections[u]=[]}for(var f=h;f<=t;f++){e.cellSelections[u][f]=true;c.contentTable.find("td[rowindex="+(u-e.rowOffset)+"][colindex="+f+"]").addClass("selected")}}}}}}).delegate(".content td","dblclick.agilegrid click.agilegrid",function(h){var g=a(this),i=parseInt(g.attr("rowindex")),f=parseInt(g.attr("colindex"));c._trigger(h.type=="dblclick"?"celldblclick":"cellclick",h,{row:e.rowOffset+i,column:f})});e.topHeaderActions=e.topHeaderActions||function(g,f){var i={};i.hide={type:"menuItem",text:"Hide",handler:function(){c.hideColumn(f)}};if(e.columnEditable){i.add={type:"menuItem",text:"Add",handler:function(){c.editColumn(f,"add")}};i.edit={type:"menuItem",text:"Edit",handler:function(){c.editColumn(f)}};i.del={type:"menuItem",text:"Delete",handler:function(){c.removeColumn(f)}}}if(!a.isEmptyObject(g)){var h={};a.each(g,function(p,j){h[j.name]={name:j.name,type:"checkbox",text:j.label,checked:!j.hide,handler:function(r,q){var k=c.option("visibleColCount");if(k<=1&&!q){a(r.target).prop("checked",true)}else{c[q?"showColumn":"hideColumn"](p)}}}});i.show={type:"submenu",text:"Show",children:h}}return i};e.leftHeaderActions=e.leftHeaderActions||function(g){var f={};return f};e.contentActions=e.contentActions||function(h,f){var g={};return g};this.element.bind("mouseup.agilegrid",function(){delete c.mouseDownContent;delete c.mouseDownLeftHeader;delete c.mouseDownTopHeader}).bind("contextmenu2.agilegrid contextmenu.agilegrid",function(k){if((e.contextmenu2&&k.type=="contextmenu2")||(!e.contextmenu2&&k.type=="contextmenu")){var r=a(k.target),j=r.closest(".top-header table"),f=r.parent("th"),i={},q=e.colModel;if(j.length>0&&f.length>0){a.extend(i,e.topHeaderActions(q,parseInt(r.closest("th").attr("index"))))}var p=r.closest(".content"),h=r.closest("td");if(p.length>0&&h.length>0){var s=e.rowOffset+parseInt(h.attr("rowindex")),g=parseInt(h.attr("rowindex"));a.extend(i,e.contentActions(s,g))}if(!a.isEmptyObject(i)){r.menu({autoShow:true,menuPosition:{of:k,my:"left top",at:"left bottom"},actions:i,select:function(u,t){a(this).menu("destroy")},collapseAll:function(t){a(this).menu("destroy")}})}k.preventDefault()}}).attr("tabIndex",-1).css("outline",0).bind("keydown.agilegrid",function(f){c._keydown(f)})},_init:function(){this.refresh()},_refreshLeftHeader:function(){var j=this.options,h=j.rowModel,e=j.rowOffset,g=this.leftHeaderTable.find("thead");g.empty();for(var c=0;c<j.rowCount;c++){var f=a("<tr/>");a("<th/>").attr("index",e+c).css("display",h[e+c]&&h[e+c].hide?"none":"block").append(a("<div/>").css({width:j.leftHeaderWidth,height:(h[e+c]&&h[e+c].height)||j.defaultRowHeight,"line-height":(h[e+c]&&h[e+c].height)||j.defaultRowHeight+"px"}).html((h[e+c]&&h[e+c].render)||j.leftHeaderRender(e+c,h[e+c]))).appendTo(f);f.appendTo(g)}},_refreshTopHeader:function(){var g=this.options,c=g.colModel,f=this.topHeaderTable.find("tr");f.empty();for(var e=0;e<g.totalColCount;e++){a("<th/>").attr("index",e).css("display",c[e]&&c[e].hide?"none":"table-cell").append(a("<div/>").css({width:(c[e]&&c[e].width)||g.defaultColWidth,height:g.topHeaderHeight,"line-height":g.topHeaderHeight+"px"}).html((c[e]&&c[e].render)||g.topHeaderRender(e,c[e]))).appendTo(f)}},_refreshContent:function(){var e=this.options,r=e.colModel,j=e.rowModel,h=e.rowOffset,g=this.contentTable.children("tbody"),q=a("<tr/>");g.detach().empty();for(var p=0;p<e.totalColCount;p++){td=a("<td/>").attr("colindex",p).css("display",r[p]&&r[p].hide?"none":"table-cell").append(a("<div/>").css("width",r[p]&&r[p].width?r[p].width:e.defaultColWidth)).appendTo(q)}for(var f=0;f<e.rowCount;f++){var s=j[h+f]&&j[h+f].height?j[h+f].height:e.defaultRowHeight,k=q.clone();k.css("display",j[h+f]&&j[h+f].hide?"none":"table-row").attr("rowindex",f).toggleClass("selected",e.rowSelections[h+f]||(e.selectionMode=="row"&&e.focus.row==h+f)).children("td").attr("rowindex",f).each(function(){var i=a(this),t=parseInt(i.attr("colindex"));i.toggleClass("selected",(e.cellSelections[h+f]&&e.cellSelections[h+f][t])||e.colSelections[t]||(e.focus.row==h+f&&e.focus.col==t)||(e.focus.col==t&&e.selectionMode=="column"));i.children("div").css({height:s,"line-height":s+"px"}).html(e.cellRender(h+f,t))});k.appendTo(g)}this.contentTable.append(g)},option:function(c,e){if(c==="visibleColCount"&&e===b){return this.topHeaderTable.find("th:visible").length}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(e,f){var g=this.options,c=g[e];if(!equals(f,c)){a.Widget.prototype._setOption.apply(this,arguments);if(g.showPager&&(e=="currentPage"||e=="totalPage")){this._refreshPager()}this._trigger("optionchanged",null,{key:e,value:f,oldValue:c})}return this},_refreshPager:function(){var c=this.options;if(c.totalPage<=1){this.pager.find(".pager-button").button("disable")}else{this.pager.find(".pager-button").button("enable");if(c.currentPage<=1){this.pager.find("#first").button("disable");this.pager.find("#prev").button("disable")}else{if(c.currentPage>=c.totalPage){this.pager.find("#last").button("disable");this.pager.find("#next").button("disable")}}}this.pager.find("input.current-page").val(c.currentPage);this.pager.find(".total-page").html(c.totalPage);this.pager.find(".info").html("Displaying "+(c.rowOffset+1)+" to "+(c.rowOffset+c.rowCount)+" of "+c.totalRowCount+" items.")},select:function(u,g,s){var f=this.options;if(s=="ctrl"){if(f.selectionMode=="row"){if(f.rowSelections[u]){delete f.rowSelections[u]}else{f.rowSelections[u]=true}this.contentTable.find("tr[rowindex="+(u-f.rowOffset)+"]").toggleClass("selected",f.rowSelections[u]==true?true:false)}else{if(f.selectionMode=="column"){if(f.colSelections[g]){delete f.colSelections[g]}else{f.colSelections[g]=true}this.contentTable.find("td[colindex="+g+"]").toggleClass("selected",f.colSelections[g]==true?true:false)}else{if(!f.cellSelections[u]){f.cellSelections[u]=[];f.cellSelections[u][g]=true}else{if(f.cellSelections[u][g]){delete f.cellSelections[u][g]}else{f.cellSelections[u][g]=true}}this.contentTable.find("td[rowindex="+(u-f.rowOffset)+"][colindex="+g+"]").toggleClass("selected",f.cellSelections[u][g]=true?true:false)}}f.focus=a.extend(f.focus,{row:u,col:g})}else{if(s=="shift"){if(f.selectionMode=="row"){var h=Math.min(f.focus.row,u),p=Math.max(f.focus.row,u);this.clearSelection();for(var k=h;k<=p;k++){f.rowSelections[k]=true;this.contentTable.find("tr[rowindex="+(k-f.rowOffset)+"]").addClass("selected")}}else{if(f.selectionMode=="column"){var j=Math.min(f.focus.col,g),t=Math.max(f.focus.col,g);this.clearSelection();for(var k=j;k<=t;k++){f.colSelections[k]=true;this.contentTable.find("td[colindex="+k+"]").addClass("selected")}}else{var h=Math.min(f.focus.row,u),p=Math.max(f.focus.row,u),j=Math.min(f.focus.col,g),t=Math.max(f.focus.col,g);this.clearSelection();for(var e=h;e<=p;e++){f.cellSelections[e]=f.cellSelections[e]||[];for(var q=j;q<=t;q++){f.cellSelections[e][q]=true;this.contentTable.find("td[rowindex="+(e-f.rowOffset)+"][colindex="+q+"]").addClass("selected")}}}}}else{this.clearSelection();if(f.selectionMode=="row"){f.rowSelections[u]=true;this.contentTable.find("tr[rowindex="+(u-f.rowOffset)+"]").addClass("selected")}else{if(f.selectionMode=="column"){f.colSelections[g]=true;this.contentTable.find("td[colindex="+g+"]").addClass("selected")}else{f.cellSelections[u]=[];f.cellSelections[u][g]=true;this.contentTable.find("td[rowindex="+(u-f.rowOffset)+"][colindex="+g+"]").addClass("selected")}}f.focus=a.extend(f.focus,{row:u,col:g})}}},clearSelection:function(){var c=this.options;c.cellSelections=[];c.rowSelections={};c.colSelections={};if(c.showTopHeader){this.topHeaderTable.find(".selected").removeClass("selected")}if(c.showLeftHeader){this.leftHeaderTable.find(".selected").removeClass("selected")}this.contentTable.find(".selected").removeClass("selected")},_keydown:function(c){var e=a.ui.keyCode,f=this.options;if(c.shiftKey&&!this.shiftKeyDown){this.shiftKeyDown={row:f.focus.row,col:f.focus.col}}else{if(!c.shiftKey){delete this.shiftKeyDown}}switch(c.keyCode){case e.LEFT:if(f.focus.col>0){this.select(f.focus.row,c.shiftKey?--this.shiftKeyDown.col:f.focus.col-1,c.shiftKey?"shift":null)}break;case e.RIGHT:if(f.focus.col<f.totalColCount-1){this.select(f.focus.row,c.shiftKey?++this.shiftKeyDown.col:f.focus.col+1,c.shiftKey?"shift":null)}break;case e.UP:if(f.focus.row>0){this.select(c.shiftKey?--this.shiftKeyDown.row:f.focus.row-1,f.focus.col,c.shiftKey?"shift":null)}break;case e.DOWN:if(f.focus.row<f.rowCount-1){this.select(c.shiftKey?++this.shiftKeyDown.row:f.focus.row+1,f.focus.col,c.shiftKey?"shift":null)}break;case e.SPACE:case e.ENTER:break}return true},_columnWidth:function(e,f){var h=this.options,c=h.colModel,g=a.extend({},c);c[e]=c[e]||{name:e,label:e};oldWidth=c[e].width||h.defaultColWidth;c[e].width=f;if(h.showTopHeader){this.topHeaderTable.find("th[index="+e+"]>div").css("width",f)}this.contentTable.find("td[colindex="+e+"]>div").css("width",f);this._trigger("optionchanged",null,{key:"colModel",value:c,oldValue:g})},_rowHeight:function(f,e,c){var j=this.options,h=j.rowModel,i=f+e,g=a.extend({},h);h[i]=h[i]||{};oldHeight=h[i].height||j.defaultRowHeight;h[i].height=c;if(j.showLeftHeader){this.leftHeaderTable.find("th[index="+e+"]>div").css({height:c,"line-height":c+"px"})}this.contentTable.find("td[rowindex="+e+"]>div").css("height",c);this._trigger("optionchanged",null,{key:"rowModel",value:h,oldValue:g})},insertColumn:function(f,c){var h=this.options,g=a.extend(true,{},h.colModel),e={};a.each(g,function(j,i){if(j<f){e[j]=i}else{e[parseInt(j)+1]=i}});e[f]=c;h.colModel=e;h.totalColCount=h.totalColCount+1;this._adjustWidth();this._trigger("optionchanged",null,{key:"colModel",value:e,oldValue:g})},removeColumn:function(e){var g=this.options,c=g.colModel,f=a.extend(true,{},c);a.each(c,function(i,h){if(i>=e&&i<g.totalColCount-1){c[i]=f[parseInt(i)+1]}else{if(i==g.totalColCount-1){delete c[i]}}});g.totalColCount=g.totalColCount-1;this._adjustWidth();this._trigger("optionchanged",null,{key:"colModel",value:c,oldValue:f})},showColumn:function(e){var g=this.options,c=g.colModel,f=a.extend(true,{},c);if(c[e]&&c[e].hide){c[e].hide=false}else{return}this.topHeaderTable.find("th[index="+e+"]").show();this.contentTable.find("td[colindex="+e+"]").show();this._trigger("optionchanged",null,{key:"colModel",value:c,oldValue:f})},editColumn:function(g,j){var f=this,i=this.options,c=i.colModel,h=a.extend(true,{},c),e=(j=="add"?{name:"",label:""}:c[g]);a("<div/>").dialog({title:j=="add"?"Add Column":"Edit Column",height:260,width:380,modal:true,create:function(k,p){var q=a(this);a.ans.getDoc(i.dbId,"50acda5e9555dbe125000004",null,function(s,r){q.editor({document:e,forms:[r],dbId:i.dbId,mode:"edit",ignoreEscape:true})})},buttons:{OK:function(){var p=a(this),k=p.editor("option","document");if(j=="add"){f.insertColumn(g,k)}else{c[g]=c[g]||{};a.extend(c[g],k);f._refreshTopHeader();f._trigger("optionchanged",null,{key:"colModel",value:c,oldValue:h})}f.option("isDirty",true);p.dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(p,k){a(this).remove()}})},hideColumn:function(e){var g=this.options,c=g.colModel,f=a.extend(true,{},c);c[e]=c[e]||{name:e,label:e};c[e].hide=true;this.topHeaderTable.find("th[index="+e+"]").hide();this.contentTable.find("td[colindex="+e+"]").hide();this._trigger("optionchanged",null,{key:"colModel",value:c,oldValue:f})},showRow:function(g){var f=this.options,e=f.rowModel,c=a.extend(true,{},e);if(e[g]&&e[g].hide){delete e[g].hide}else{return}this.leftHeaderTable.find("th[index="+g+"]").hide();this.contentTable.find("td[rowindex="+g+"]").hide();this._trigger("optionchanged",null,{key:"rowModel",value:e,oldValue:c})},hideRow:function(g){var f=this.options,e=f.rowModel,c=a.extend(true,{},e);e[g]=e[g]?e[g]:{};e[g].hide=true;this._adjustHeight();this._trigger("optionchanged",null,{key:"rowModel",value:e,oldValue:c})},_adjustWidth:function(){this._refreshTopHeader();this._refreshContent();return this},_adjustHeight:function(){this._refreshLeftHeader();this._refreshContent();return this},refresh:function(){var c=this.options;if(c.showTopHeader){this._refreshTopHeader()}if(c.showLeftHeader){this._refreshLeftHeader()}this._refreshContent();if(c.showPager){this._refreshPager()}return this},destroy:function(){this.element.removeClass("an-agilegrid").unbind(".agilegrid").undelegate(".top-header th>div",".agilegrid").undelegate(".left-header th>div",".agilegri").undelegate(".content td>div",".agilegrid");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.toolbar",{options:{},_create:function(){this.element.addClass("an-toolbar");var c=this.options;if(c.startAction||c.globalActionSet||c.actionSets){this.element.empty();this._createActionSets();this.refresh()}},_createActionSets:function(){var e=this,f=this.options,c=[];if(f.startAction){c.push(f.startAction)}if(f.globalActionSet){c.push(f.globalActionSet)}c=c.concat(f.actionSets||[]);this.actionSets=c;a.each(c,function(h,g){a.each(g,function(q,p){var s=null;switch(p.type){case"button":if(q=="startAction"){p.element=a("<button class='action start-menu'/>").button({label:p.label,icons:{primary:"ui-icon-home",secondary:"ui-icon-triangle-1-s"}}).prependTo(e.element);p.element.menu({triggerEvent:"click",menuPosition:{of:p.element,my:"left top",at:"left bottom"},actions:p.actions,select:function(){a(this).menu("collapseAll")}})}else{p.element=a("<button class='action'/>").button({label:p.label,text:p.text,icons:p.icons}).appendTo(e.element).click(function(k){if(p.handler){p.handler(k)}k.preventDefault();k.stopImmediatePropagation()})}break;case"checkbox":var j=a("<input class='action' type='checkbox' id = '"+new ObjectId().toString()+"'/>").appendTo(e.element);a("<label for='"+j.attr("id")+"' class='action'></label>").insertAfter(j);p.element=j.button({label:p.label,text:p.text,icons:p.icons}).click(function(k){if(p.handler){p.handler(k)}k.preventDefault();k.stopImmediatePropagation()});break;case"radio":var j=a("<input class='action' type='radio' name = '"+p.name+"' id = '"+new ObjectId().toString()+"'/>").appendTo(e.element);a("<label for='"+j.attr("id")+"' class='action'></label>").insertAfter(j);p.element=j.button({label:p.label,text:p.text,icons:p.icons}).click(function(k){if(p.handler){p.handler(k)}k.preventDefault();k.stopImmediatePropagation()});break;case"select":s=a("<acronym class='action'/>").attr("title",p.label).elSelect({labelTpl:p.labelTpl,tpl:p.tpl,select:p.select,src:p.src}).appendTo(e.element);s.data("select",s);p.element=s;break;case"colorPicker":s=a("<button class='action'/>").button({label:p.label,text:p.text,icons:p.icons}).appendTo(e.element).ColorPicker({color:p.color,handler:p.handler});s.data("select",s);p.element=s;break;default:break}if(p.iconFile){var r;if(p.type=="checkbox"){var i=p.element.attr("id");r=p.element.siblings("label[for="+i+"]").find("."+p.icons.primary)}else{r=p.element.find("."+p.icons.primary)}r.css("background-image","url("+p.iconFile+")")}})})},refresh:function(){a.each(this.actionSets,function(e,c){a.each(c,function(g,f){switch(f.type){case"button":case"checkbox":case"radio":if(f.enabled()){f.element.button("enable");if(f.type=="checkbox"||f.type=="radio"){f.element.prop("checked",f.checked());f.element.button("refresh")}}else{f.element.button("disable")}break;case"colorPicker":case"select":f.element.toggleClass("disabled",!f.enabled());break}})})},value:function(c,e){this.element.find("#"+c).data("select").val(e);return this},option:function(c,e){if(c=="isEmpty"&&e===b){return this.element.children().length==0}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(e,f){var g=this.options,c=g[e];if(!equals(f,c)){a.Widget.prototype._setOption.apply(this,arguments);if(e=="actionSets"){this.element.empty();this._createActionSets();this.refresh()}this._trigger("optionchanged",null,{key:e,value:f,oldValue:c,"transient":g["transient"]})}return this},destroy:function(){this.element.removeClass("an-toolbar");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.view",{options:{skip:0,limit:10,total:0,mode:"browser",actionSets:[]},_create:function(){var o=this.options,el=this.element;el.addClass("an-view").addClass(o.view.name).empty();$('<style type="text/css">'+(o.view.stylesheet||"")+"</style>").appendTo(el);if(o.view&&o.view.limit){o.limit=o.view.limit=parseInt(o.view.limit)}$.extend(this,eval("try{("+(o.view.methods||"{}")+")}catch(e){}"));var data={};data[this.widgetName]=this;$.each(eval("("+(o.view.actions||"[]")+")"),function(k,action){el.bind(action.events,data,action.handler)});this.docs=[];this._loadDocs()},option:function(key,value){var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var oldValue=this.options[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);this._handleChange&&this._handleChange(key,value,oldValue);this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},_handleChange:function(key,value,oldValue){if(key==="mode"||key==="view"){this.refresh()}},refresh:function(){var o=this.options;this["_"+o.mode]&&this["_"+o.mode]()},reload:function(){this._loadDocs()},_loadDocs:function(){var self=this,o=this.options,sel=o.view.selector,opts={skip:o.skip,limit:o.limit};if($.type(o.view.sort)=="string"){opts.sort=eval("("+o.view.sort+")")}if($.type(sel)=="string"){sel=eval("("+sel+")");$.ans.getDoc(o.dbId,null,{selector:sel,options:opts},function(err,data){self.docs=data.docs;o.total=data.total;self._docsLoaded&&self._docsLoaded()})}},_getRow:function(row){return this.docs[row-this.options.skip]},_delRow:function(row){var self=this,o=this.options;Model.deleteDocument(o.dbId,this.docs[row-o.skip]._id,null,function(err,result){self._loadDocs()})},save:function(){var self=this,o=this.options,view=o.view;Model.updateDocument(o.dbId,view._id,view,null,function(err,result){self.option("isDirty",false)})},destroy:function(){this.element.children("style").remove();this.element.unbind(".view").empty();$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.gridview",$.an.view,{options:{printable:false},_create:function(){$.an.view.prototype._create.apply(this,arguments);this.element.addClass("an-gridview");var self=this,o=this.options;o.showPager=o.view.showPager;if(o.view.cellRender){o.cellRender=eval("("+o.view.cellRender+")")}this.element.agilegrid($.extend({rowOffset:o.skip,showPager:o.showPager,dbId:o.dbId,leftHeaderRender:function(row){return row+1},cellRender:function(row,col){var value="",r=self._getRow(row),cm=this.colModel,c=cm[col];if(o.cellRender){value=o.cellRender(row,col,doc,cm)}else{if(r&&c){value=eval("try{r['"+c.name+"']}catch(e){}")}}return value?value+"":""},firstpage:function(e,data){o.skip=0;self._loadDocs()},prevpage:function(e,data){o.skip=o.skip-o.limit;self._loadDocs()},gotopage:function(e,data){o.skip=(data.page-1)*o.limit;self._loadDocs()},nextpage:function(e,data){o.skip=o.skip+o.limit;self._loadDocs()},lastpage:function(e,data){o.skip=Math.floor(o.total/o.limit)*o.limit;self._loadDocs()},celldblclick:function(e,data){self._trigger("docdblclick",e,self.docs[data.row-o.skip])},cellclick:function(e,data){self._trigger("docclick",e,self.docs[data.row-o.skip])},contentActions:function(row,col){return o.contentActions(self.docs[row-o.skip])},optionchanged:function(e,data){if(data.key=="colModel"&&o.mode=="design"){self.option("isDirty",true)}}},o.view.options));this.refresh()},_docsLoaded:function(){var o=this.options,rc=this.docs.length;this.element.agilegrid({currentPage:Math.floor(o.skip/o.limit+1),totalPage:Math.ceil(o.total/o.limit),rowOffset:o.skip,rowCount:rc,totalRowCount:o.total})},_design:function(){this.element.agilegrid({columnEditable:true,isColumnResizable:true,isRowResizable:true})},_browser:function(){this.element.agilegrid($.extend({columnEditable:false,isColumnResizable:false,isRowResizable:false},this.options.view.options))},save:function(){$.extend(this.options.view.options,this._viewOptions());return $.an.view.prototype.save.apply(this,arguments)},option:function(key,value){if(key==="viewOptions"&&value===undefined){return this._viewOptions()}return $.an.view.prototype.option.apply(this,arguments)},_viewOptions:function(){var self=this,value={};$.each(["showTopHeader","showLeftHeader","isColumnResizable","isRowResizable","topHeaderHeight","leftHeaderWidth","defaultColWidth","defaultRowHeight","colModel","rowModel","totalColCount"],function(k,v){value[v]=self.element.agilegrid("option",v)});return value},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&viewid="+o.view._id;print(url)},destroy:function(){this.element.agilegrid("destroy").unbind(".gridview").removeClass("an-gridview");$.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.formview",a.an.view,{options:{printable:false,pagerPosition:"bottom",itemWidth:320,itemHeight:280},_create:function(){a.an.view.prototype._create.apply(this,arguments);var e=this.options,c=this.element;e.showPager=e.view.showPager;e.itemWidth=e.view.itemWidth;e.itemHeight=e.view.itemHeight;c.addClass("an-formview");this.documents=a("<div class='content'/>").appendTo(c)},_showDocuments:function(){var c=this,f=this.options;this.documents.empty();var e=document.createDocumentFragment();a.each(this.docs,function(h,i){var g=a("<div class='grid-item'/>").css({width:f.itemWidth,height:f.itemHeight});e.appendChild(g[0]);g.editor({dbId:f.dbId,document:i,forms:[f.form],readOnly:true})});c.documents[0].appendChild(e)},_docsLoaded:function(){var c=this.options;c.currentPage=Math.floor(c.skip/c.limit+1);c.totalPage=Math.ceil(c.total/c.limit);this._refreshPager();this.refresh()},_refreshPager:function(){var c=this,e=this.options;if(!e.showPager||e.totalPage<=1){this.element.removeClass("show-pager");this.pager&&this.pager.remove();delete this.pager;return this}if(!this.pager){this.pager=a("<div class='pager'/>").appendTo(a("<div class='bottom'/>").appendTo(this.element));a.each(["first","prev","goto","next","last"],function(g,f){if(f=="goto"){c.pager.append("<div class='goto-page'><input class='current-page' type='text' value='"+e.currentPage+"'>of<div class='total-page'>"+e.totalPage+"</div></div>");c.pager.delegate("input","change.formview",function(){var i=a(this),h=a(this).val();if(h<=0){h=1;i.val(h)}else{if(h>e.totalPage){h=e.totalPage;i.val(h)}}c.gotopage(h)})}else{a("<button class='pager-button'/>").attr("id",f).appendTo(c.pager).button({label:f,icons:{primary:"ui-icon-"+f+"-page"},text:false,disabled:true}).click(function(h){h.preventDefault();h.stopImmediatePropagation();c[f+"page"]()})}})}this.pager.find(".pager-button").button("enable");if(e.currentPage<=1){this.pager.find("#first").button("disable");this.pager.find("#prev").button("disable")}else{if(e.currentPage>=e.totalPage){this.pager.find("#last").button("disable");this.pager.find("#next").button("disable")}}this.pager.find("input.current-page").val(e.currentPage);this.pager.find(".total-page").html(e.totalPage)},firstpage:function(f,c){this.options.skip=0;this._loadDocs()},prevpage:function(){var c=this.options;c.skip=c.skip-c.limit;this._loadDocs()},gotopage:function(c){var e=this.options;e.skip=(c-1)*e.limit;this._loadDocs()},nextpage:function(){var c=this.options;c.skip=c.skip+c.limit;this._loadDocs()},lastpage:function(){var c=this.options;c.skip=Math.floor(c.total/c.limit)*c.limit;this._loadDocs()},_design:function(){this._showDocuments()},_browser:function(){this._showDocuments()},save:function(){var c=this,e={};a.extend(this.options.view.options,e);return a.an.view.prototype.save.apply(this,arguments)},print:function(){var f=this.options,e=window.location,c=e.protocol+"//"+e.host+"/pdfs?dbid="+f.dbId+"&viewid="+f.view._id;print(c)},destroy:function(){this.element.unbind(".formview").removeClass("an-formview show-pager");a.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.page",a.an.form,{options:{printable:false,mode:"edit",wrapper:"<div/>",document:new DocWrapper({})},_create:function(){a.an.form.prototype._create.apply(this,arguments);this.element.addClass("an-page")},option:function(e,f){var g=this.options;if(e==="page"&&f===b){return g.form}else{if(e==="currentForm"&&f===b){return this}}var c=a.an.form.prototype.option.apply(this,arguments);return c===b?null:c},print:function(){var f=this.options,e=window.location,c=e.protocol+"//"+e.host+"/pdfs?dbid="+f.dbId+"&pageid="+f.form._id;print(c);return this},destroy:function(){this.element.removeClass("an-page");return a.an.form.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.editor",{options:{printable:true,mode:"browser",document:{},forms:[],actionSets:[],parseDot:true,isDocDirty:false},_create:function(){this.element.addClass("an-editor");var self=this,o=this.options,el=this.element,doc=o.document,docType=doc.type,forms={};this.doc=new DocWrapper(doc,o.parseDot);var id=doc._id;if(id){o.url="/dbs/"+o.dbId+"/"+id+"/attachments"}if(o.forms.length<=1){el.addClass("tabs-nav-hide")}if(o.design&&(docType==Model.FORM||docType==Model.PAGE||docType==Model.VIEW)){forms[doc._id+"-design"]=doc}$.each(o.forms||[],function(k,v){forms[v._id]=v});el.append("<ul/>").tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a></li>",show:function(event,ui){var $p=$(ui.panel),id=$p.attr("id"),d=forms[id],type=d.type;if($p.is(".an-form,.an-page,.an-gridview,.an-formview")){var data=$p.data();for(var i in data){if($.inArray(i,["form","page","gridview","formview"])!=-1){if(!o.design||!(/-design$/.test(id))){data[i].option("mode",o.mode)}self._trigger("tabshow",event,data[i]);break}}}else{var opt={dbId:o.dbId,mode:(o.design&&/-design$/.test(id))?"design":o.mode,ignoreEscape:o.ignoreEscape,change:function(){o.change()},widgetselect:o.widgetselect,optionchanged:function(e,data){if(data.key=="isDirty"){if(data.value){self.option("isFormDirty",true)}else{var isFormDirty=false;el.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview"])!=-1){isFormDirty=data[i].option("isDirty");if(isFormDirty){break}}}});self.option("isFormDirty",isFormDirty)}}else{if(data.key=="mode"){self.option(data.key,data.value)}}}};if(type==Model.FORM){$p.form($.extend(true,{form:d,document:(o.design&&/-design$/.test(id))?{}:function(){return self.doc},url:o.url,editor:self,create:function(){self._trigger("tabcreated",event,$(this).data("form"))}},opt))}else{if(type==Model.PAGE){$p.page($.extend(true,{form:d,create:function(){self._trigger("tabcreated",event,$(this).data("page"))}},opt))}else{if(type==Model.VIEW){var vt=d.viewType||"gridview",vt=vt.toLowerCase(),optsx={view:d,create:function(){self._trigger("tabcreated",event,$(this).data(vt))}};if(vt=="formview"){optsx.form=o.form}$p[vt]($.extend(true,optsx,opt))}}}}}});$.each(forms||[],function(k,v){el.tabsx("add","#"+k,v.title)});if(o.tabsPosition=="bottom"){el.addClass("tabs-bottom").children(".ui-tabs-nav, .ui-tabs-nav > *").removeClass("ui-corner-all ui-corner-top").addClass("ui-corner-bottom")}el.attr("tabIndex",-1).css("outline",0).keydown(function(e){var form=self._currentForm();if(e.keyCode===$.ui.keyCode.ESCAPE&&!o.ignoreEscape&&!e.isDefaultPrevented()&&form.validate()){e.preventDefault();self.option("mode","browser");form.option("mode","browser")}}).bind("dblclick.form",function(e){var form=self._currentForm();if(o.mode=="browser"&&!o.readOnly){self.option("mode","edit");form.option("mode","edit")}});$(this.doc).bind("propchanged.editor",function(e,id,value,oldValue,trans){if(!trans){self.option("isDocDirty",true)}if(o.design&&(docType==Model.FORM||docType==Model.PAGE||docType==Model.VIEW)){var docId=doc._id+"-design",form=$.extend(true,{},doc);el.children("#"+docId+".ui-tabs-panel").each(function(){var $this=$(this);if($this.is(".an-form")){$this.form("option","form",form)}else{if($this.is(".an-page")){$this.page("option","form",form)}else{if($this.is(".an-gridview")){$this.gridview("option","view",form)}else{if($this.is(".an-formview")){$this.formview("option","view",form)}}}}})}self._trigger("docpropchanged",e,{id:id,value:value,oldValue:oldValue,"transient":trans})});$(document).bind("documentChanged.editor",function(e,data){var ds=$.isArray(data)?data:[data],id;for(var i in ds){id=ds[i]._id;if(id==o.document._id){$.extend(true,o.document,ds[i]);el.children(".ui-tabs-panel").each(function(){var $this=$(this);$this.is(".an-form")&&$this.form("refresh")})}if(forms[id]||forms[id+"-design"]){if(forms[id+"-design"]){id=id+"-design"}forms[id]=$.extend(true,{},ds[i]);for(var j in o.forms){if(o.forms[j]._id==ds[i]._id){o.forms[j]=forms[id];break}}el.children("#"+id+".ui-tabs-panel").each(function(){var $this=$(this);if($this.is(".an-form")){$this.form("option","form",forms[id])}else{if($this.is(".an-page")){$this.page("option","form",forms[id])}else{if($this.is(".an-gridview")){$this.gridview("option","view",forms[id])}else{if($this.is(".an-formview")){$this.formview("option","view",forms[id])}}}}})}}}).bind("documentDeleted.editor",function(e,data){var ds=$.isArray(data)?data:[data],id;for(var i in ds){id=ds[i]._id;if(forms[id]||forms[id+"-design"]){if(forms[id+"-design"]){id=id+"-design"}for(var j in o.forms){if(o.forms[j]._id==ds[i]._id){o.forms.splice(j,1);delete forms[id];el.tabsx("remove",id);break}}}}})},_validate:function(){var self=this,valid=true;this.element.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page"])!=-1&&data[i].option("mode")!="design"&&!data[i].option("isValid")){self.element.tabsx("select",data[i].option("form")._id);valid=false;return false}}});return valid},save:function(opts){opts=opts||{};var self=this,o=this.options,dbId=o.dbId,valid=true;this.element.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page"])!=-1){if((data[i].option("form")._id==o.document._id)&&data[i].option("isDirty")){o.document.content=data[i].option("content");data[i].option("isDirty",false);o.isDocDirty=true}else{data[i].save()}if(opts.validate&&valid&&form.option("mode")!="design"){valid=form.option("isValid");if(!valid){self.element.tabsx("select",form.option("form")._id)}}}else{if($.inArray(i,["gridview","formview"])!=-1){if((data[i].option("view")._id==o.document._id)&&data[i].option("isDirty")){o.document.options=$.extend(true,o.document.options,data[i].option("viewOptions"));data[i].option("isDirty",false);o.isDocDirty=true}else{data[i].save()}}}}});this.option("isFormDirty",false);if(valid&&o.isDocDirty){var doc=this._getDocument();if($.type(opts.beforesave)=="function"){opts.beforesave(doc)}if(o.isNew){var def=o["default"]&&o["default"]._id;Model.postDocument(dbId,doc,def?{options:{"default":def}}:null,function(err,result){if(!err){delete o.isNew;$.extend(o.document,result);self.option("option","url","/dbs/"+dbId+"/"+doc._id+"/attachments");self.option("isDocDirty",false)}if($.type(opts.saved)=="function"){opts.saved(err,doc,true)}else{o.saved&&o.saved(err,doc,true)}})}else{Model.updateDocument(dbId,doc._id,doc,null,function(err,result){if(!err){$.extend(o.document,result);self.option("isDocDirty",false)}if($.type(opts.saved)=="function"){opts.saved(err,doc,true)}else{o.saved&&o.saved(err,doc,true)}})}}},_getDocument:function(){var o=this.options,doc=$.extend(true,{},o.document);$.each(o.forms,function(){$(this.content).find(".field[transient=true]").each(function(){var $this=$(this),id=$this.attr("id");if(id){id=id.replace(/-/g,".");if($this.attr("transient")){try{delete eval("doc."+id)}catch(e){}}}})});return doc},print:function(){this._currentForm().print()},option:function(key,value){var self=this,o=this.options;if(key==="actionSets"&&value===undefined){var cf=this._currentForm();return cf&&cf.option("actionSets")}else{if(key==="outline"&&value===undefined){return this._currentForm().option("outline")}else{if(key==="document"&&value===undefined){return this._getDocument()}else{if(key==="namedValues"&&value===undefined){var nv={};$.each(o.forms,function(k,form){$(form.form).find(".field:not(.button)").each(function(){var id=$(this).attr("id");if(id){id=id.replace(/-/g,".");nv[id]=self.doc.prop(id)}})});return nv}else{if(key=="currentForm"&&value==undefined){return this._currentForm()}else{if(key=="isValid"&&value==undefined){return this._validate()}}}}}}var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var oldValue=this.options[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);if(key==="document"){this.doc.setDoc(value);this._setOption("isDocDirty",false)}else{if(key==="url"){this.element.tabsx("option","panels").each(function(){$(this).form("option",key,value)})}else{if(key==="mode"){this._currentForm().option(key,value)}}}this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},getForm:function(id){var o=this.options;if(o.design&&(id==o.document._id)){id=id+"-design"}var data=this.element.tabsx("panel",id).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview"])!=-1){return data[i]}}return null},_currentForm:function(){var data=$(this.element.tabsx("option","selectedPanel")).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview"])!=-1){return data[i]}}return null},refresh:function(){this._currentForm().refresh();return this},highlightWidget:function(id,highlight){return this._currentForm().highlightWidget(id,highlight)},destroy:function(){$(document).unbind(".editor");this.element.tabsx("destroy").removeClass("an-editor tabs-bottom").unbind(".editor").undelegate(".an-form",".editor").empty();$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.sideview",{options:{},_create:function(){var c=this,e=this.options;this.element.tree({checkbox:e.checkbox,checkedNodes:e.checkedNodes,contentProvider:{getRoots:function(g){var f={$or:[]};a.each((e.roots&&e.roots.split(","))||[],function(){f.$or.push({_id:this})});a.ans.getDoc(e.dbId,null,{selector:f},function(i,j){var h=[];a.each(j.docs||[],function(q,p){h.push({id:p._id,text:p.title,data:p,"class":"folder root"})});g(h)})},getChildren:function(f,i){var h=f.data,g={_path:{$regex:"^"+h._path+"[^,]+,$"}};if(e.showUser&&(h.type==Model.GROUP)){g={$or:[g,{type:Model.USER,_groupPaths:h._path}]}}else{if(!e.showUser){g={$and:[g,{type:{$ne:Model.USER}}]}}}a.ans.getDoc(e.dbId,null,{selector:g},function(k,p){var j=[];a.each(p.docs,function(q,r){j.push({id:r._id,text:r.title,data:r,parent:f,"class":(r.type==Model.CATEGORY||r.type==Model.OU||r.type==Model.GROUP||r.type==Model.ROLE)?"folder":"file"})});i(j)})},hasChildren:function(g){var f=g.data.type;return f==Model.CATEGORY||f==Model.OU||f==Model.GROUP||f==Model.ROLE},getId:function(f){return f.id?f.id:null}},nodeclick:e.nodeclick,nodedblclick:e.nodedblclick,contextmenu:e.contextmenu,drop:function(g,f){c._trigger("drop",null,f)}});a(document).bind("documentCreated.sideview documentChanged.sideview documentDeleted.sideview",function(g,f){a.each(a.isArray(f)?f:[f],function(i,h){if(g.type=="documentCreated"&&h._path){var j=h._path.split(","),p=j[j.length-3];c.refresh(p)}else{c.refresh(h._id);c.refresh(Model.GROUP_ROOT)}})})},option:function(c,f){var e=this.element;if(c=="checkedNodes"&&f===b){return e.tree("option","checkedNodes")}else{if(c==="roots"&&f===b){return e.tree("option","roots")}else{if(c==="selectedNodes"&&f===b){return e.tree("option","selectedNodes")}}}return a.Widget.prototype.option.apply(this,arguments)},refresh:function(c){this.element.tree("refresh",c)},add:function(e,c){this.element.tree("add",e,c).tree("refresh",c.id)},"delete":function(c){this.element.tree("delete",c)},expand:function(c){this.element.tree("expand",c)},collapse:function(c){this.element.tree("collapse",c)},destroy:function(){a(document).unbind(".sideview");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.workbench",{options:{westWidth:320,eastWidth:260,westViews:"",eastViews:"",sideViews:[{id:"50faab53a092004045000001",anchor:"west"}],openedDocuments:[]},_create:function(){this.element.addClass("an-workbench");var self=this,o=this.options;document.title=o.title||"Agile Notes";this.element.border({north:{selector:".north",height:28},west:{selector:".west",width:0,resizable:false},east:{selector:".east",width:0,resizable:false},south:{selector:".south",height:18},center:{selector:".center"},optionchanged:function(e,data){if(data.key=="west"||data.key=="east"){if(data.value.width){o[data.key+"Width"]=data.value.width}self._saveOptions()}}});$(["center","west","east"]).each(function(k,v){var node=$("#"+v+"-tabs",self.element);node.tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a> <span class='ui-icon ui-icon-close'>Remove Tab</span></li>",showTabsContextMenu:true,add:function(e,ui){if(v=="center"){node.tabsx("select","#"+ui.panel.id)}},show:function(e,ui){var panel=$(ui.panel),editor;$.each(["editor","gridview","formview","page"],function(k,v){editor=panel.data(v);if(editor){var title=editor.option("title");document.title=o.title+" - "+title;self.reloadToolbar();self._notifyOutline();return false}})},remove:function(e,ui){if(v=="center"){if(node.tabsx("length")==0){document.title=o.title;self.reloadToolbar();self._notifyOutline()}self._afterCloseEditor({workbench:self,id:$(ui.panel).attr("id")})}else{if(v=="west"||v=="east"){var id=$(ui.panel).attr("id"),index=-1;$.each(o.sideViews,function(k,sv){if(id==sv.id&&v==sv.anchor){index=k;return false}});o.sideViews.splice(index,1);self._saveOptions();if(node.tabsx("length")==0){self.element.border("option",v,{width:0,resizable:false})}}}}});node.delegate("span.ui-icon-close","click",function(){var index=$("li",node).index($(this).parent());var saveBtn=self.toolbar.find('button[title="Save"]');if(!saveBtn.attr("disabled")&&$("li",node).eq(index).hasClass("ui-tabs-selected")){showDialog("Confirm","Do you want to save the changes?",{buttons:[{text:"OK",handler:function(dialog){saveBtn.trigger("click");node.tabsx("remove",index);dialog.close()}},{text:"Cancel",handler:function(dialog){node.tabsx("remove",index);dialog.close()}}]});return}node.tabsx("remove",index)});self[v+"Tabs"]=node});this.statusBar=$(".south",self.element);this.element.ajaxComplete(function(event,request,settings){switch(request.status){case 401:self._login();break;default:break}});$.ans.getDoc(o.dbId,null,{selector:{type:Model.VALIDATE_METHOD}},function(err,data){if(err){console.log("Load validate methods error: "+err)}else{$.each(data.docs,function(){$.validator.addMethod(this.name,eval("(0,"+this.handler+")"),this.message)})}});this._loadActions(function(){self._initMainToolbar();$.each(o.openedDocuments||[],function(){self[this.method](this.id,this.options)});$.each(o.sideViews,function(){self.showSideView(this.id,this.anchor,this.options)})});this.element.bind("rteoptionchanged.workbench",function(e,data){if(data.key=="path"){self.statusBar.html(data.value);self.toolbar.toolbar("refresh")}else{if(data.key=="undoable"||data.key=="redoable"){self.toolbar.toolbar("refresh")}}}).bind("selectionChanged.workbench",function(e){self.toolbar.toolbar("refresh")});this._proxy=$.proxy(function(e){if(e.target===window){if(this.toolbar.toolbar("option","isEmpty")){$(this.element).border("option",{north:{height:"0"}})}else{var height=this.toolbar.outerHeight(true);$(this.element).border("option","north",{height:height?height:0})}}},this);$(window).bind("resize.workbench",this._proxy);$(document).bind("documentChanged.workbench documentCreated.workbench",function(e,data){var hit=false;$.each($.isArray(data)?data:[data],function(k,v){self.centerTabs.find("a[href^=#"+v._id+"]").html(v.title);if(v.type==Model.ACTION){hit=true}});if(hit){self._loadActions(function(){self._initMainToolbar()})}}).bind("documentDeleted.workbench",function(e,data){$.each($.isArray(data)?data:[data],function(k,v){self.centerTabs.find("a[href^=#"+v._id+"]").each(function(){var href=$(this).attr("href");if(href){self.centerTabs.tabsx("remove",href.substring(1))}})});self._loadActions(function(){self._initMainToolbar()})});window.workbench=this},_afterOpenEditor:function(data){var o=this.options,hit=false;o.openedDocuments=o.openedDocuments||[];$.each(o.openedDocuments,function(){if(this.id==data.id&&this.method==data.method){hit=true}});if(!hit&&!(data.options&&data.options.isNew)){o.openedDocuments.push(data);this._saveOptions()}},_afterCloseEditor:function(data){var o=this.options,m=data.id.match(/([^-]+)-([^-]+)/),index=-1,type=m[2].substring(0,1).toUpperCase()+m[2].substring(1);$.each(o.openedDocuments,function(k,v){if(v.method==("open"+type)&&v.id==m[1]){index=k;return false}});o.openedDocuments.splice(index,1);this._saveOptions()},_afterShowSideView:function(data){var o=this.options,hit=false;$.each(o.sideViews,function(){if(this.id==data.id&&this.anchor==data.anchor){hit=true}});if(!hit){o.sideViews.push(data);this._saveOptions()}},_loadActions:function(afterLoad){var self=this,o=this.options,sel={$or:[]};this.startNewActions=[];this.toolbarGlobalActions=[];this.toolbarHeaderActions=[];this.toolbarMiddleActions=[];this.toolbarTailActions=[];this.showSideViewActions=[];this.documentClickActions=[];this.documentDoubleClickActions=[];this.categoryContextMenuNewActions=[];this.documentContextMenuCenterActions=[];this.documentContextMenuTopActions=[];this.documentContextMenuBottomActions=[];$.each(["startNew","toolbarGlobal","toolbarHeader","toolbarMiddle","toolbarTail","showSideView","documentClick","documentDoubleClick","categoryContextMenuNew","documentContextMenuCenter","documentContextMenuTop","documentContextMenuBottom"],function(){sel.$or.push({type:Model.ACTION,extendPoint:this})});$.ans.getDoc(o.dbId,null,{selector:sel},function(err,data){if(err){console.log("Load Actions Error","Load actions error: "+err)}else{$.each(data.docs,function(){self[this.extendPoint+"Actions"].push(this)});afterLoad()}})},_initMainToolbar:function(){var self=this,o=this.options;var startActions=[],children=[];$.each(this.startNewActions,function(k,v){children.push({id:k,type:"menuItem",text:v.title||v.name||k,handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")")})});if(this.startNewActions.length>0){children.push({type:"seperator"})}children.push({id:"others",type:"menuItem",text:"Others ...",handler:function(){$("<div class='workbench'/>").dialog({title:"New Document",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this);$this.sideview({dbId:o.dbId,roots:Model.META_ROOT,docdblclick:function(e,doc){self.newDocument(doc._id);$this.dialog("close")}});setTimeout(function(){$this.sideview("expand",Model.META_ROOT)},200)},buttons:{OK:function(){var $this=$(this),docIds=$this.sideview("option","selectedNodes");$.each(docIds,function(){self.newDocument(this)});$this.dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},enabled:function(){return true}});startActions.push({type:"submenu",text:"New",children:children});children=[];$.each(this.showSideViewActions,function(k,v){children.push({id:k,type:"menuItem",text:v.title||v.name||k,handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")")})});if(this.showSideViewActions.length>0){children.push({type:"seperator"})}children.push({id:"others",type:"menuItem",text:"Others ...",handler:function(){$("<div class='workbench'/>").dialog({title:"Show Side View",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this);$this.sideview({dbId:o.dbId,roots:Model.SIDE_VIEW_ROOT,docdblclick:function(e,doc){self.showSideView(doc._id);$this.dialog("close")}});setTimeout(function(){$this.sideview("expand",Model.SIDE_VIEW_ROOT)},200)},buttons:{OK:function(){var $this=$(this);$.each($this.sideview("option","selectedNodes"),function(){self.showSideView(this)});$this.dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},enabled:function(){return true}});startActions.push({type:"submenu",text:$.i18n.showSideView,children:children});startActions.push({type:"seperator"});startActions.push({id:"login",type:"menuItem",text:"Login ...",handler:function(){self._login()},enabled:function(){return true}});startActions.push({id:"logout",type:"menuItem",text:"Logout",handler:function(){self._logout()},enabled:function(){return true}});var globalActions={};$.each(this.toolbarGlobalActions,function(k,v){globalActions[v._id]={_id:v._id,type:"button",label:v.title||v.name,text:false,icons:{primary:"ui-icon-"+v.name},handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")")};if(v.icon&&(v.icon.length>0)&&v.icon[0].metadata){globalActions[v._id].iconFile="/dbs/"+o.dbId+"/"+v._id+"/attachments/"+v.icon[0].metadata.filepath}});if(this.toolbar){this.toolbar.remove()}this.toolbar=$("<div id='main' class='ui-corner-all'/>").appendTo($(".north",self.element)).toolbar({startAction:{startAction:{type:"button",label:"Agile Notes",icons:{primary:"ui-icon-home",secondary:"ui-icon-triangle-1-s"},actions:startActions,enabled:function(){return true}}},globalActionSet:globalActions});this.reloadToolbar()},reloadToolbar:function(){console.log("reloadToolbar............................!");var editor=this.currentEditor(),actionSets=[];if(editor){function createActionSet(actions,context){var actionSet={};$.each(actions,function(k,v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){actionSet[v._id]={_id:v._id,type:v.actionType||"button",label:v.title||v.name,text:false,icons:{primary:"ui-icon-"+v.name},iconFile:v.icon,handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")"),checked:eval("(0,"+(v.checked||"function(){return false;}")+")")};if(v.icon&&(v.icon.length>0)&&v.icon[0].metadata){actionSet[v._id].iconFile="/dbs/"+context.dbId+"/"+v._id+"/attachments/"+v.icon[0].metadata.filepath}}});return actionSet}var tas=editor.widget().data("toolbarActions"),dbId=editor.widget().data("dbid")||this.options.dbId,context={editor:editor,dbId:dbId},ass=editor.option("actionSets"),actionSet={},filter;actionSet=createActionSet((tas&&tas.toolbarHeaderActions)||this.toolbarHeaderActions,context);if(!$.isEmptyObject(actionSet)){actionSets.push(actionSet)}if($.isArray(ass)){actionSets=actionSets.concat(ass)}actionSet=createActionSet((tas&&tas.toolbarHeaderActions)||this.toolbarMiddleActions,context);if(!$.isEmptyObject(actionSet)){actionSets.push(actionSet)}actionSet=createActionSet((tas&&tas.toolbarHeaderActions)||this.toolbarTailActions,context);if(!$.isEmptyObject(actionSet)){actionSets.push(actionSet)}}this.toolbar.toolbar("option","actionSets",actionSets);if(this.toolbar.toolbar("option","isEmpty")){this.element.border("option","north",{height:"0"})}else{var height=this.toolbar.outerHeight(true);this.element.border("option","north",{height:height?height:"0"})}},currentEditor:function(){var panel=$(this.centerTabs.tabsx("option","selectedPanel")),data=panel.data(),editor=null;$.each(data||{},function(k,v){if($.inArray(k,["editor","gridview","formview","page"])!=-1){editor=v;return false}});return editor},_saveOptions:function(){var o=this.options,opts={};if(o.openedDocuments.length){opts.openedDocuments=o.openedDocuments}if(o.westWidth){opts.westWidth=o.westWidth}if(o.eastWidth){opts.eastWidth=o.eastWidth}if(o.sideViews.length){opts.sideViews=o.sideViews}$.cookie(o.dbId,$.toJSON(opts))},_login:function(){var o=this.options;var login=function($this){$.ans.login($this.editor("option","document"),function(err,result,real){if(real.success){window.location.reload()}else{showDialog("Login Failed","Login failed: "+real.msg)}$this.dialog("close")})};$("<div class='workbench'/>").dialog({title:"Login",height:260,width:380,modal:true,create:function(event,ui){var $this=$(this);$.ans.getDoc(o.dbId,"50accac59555dbe125000002",null,function(err,form){if(err){console.log("Load Form Error","Load form error: "+err)}else{$this.editor({document:{},forms:[form],dbId:o.dbId,mode:"edit",ignoreEscape:true})}});$this.bind("keyup",function(e){if(e.keyCode==$.ui.keyCode.ENTER){login($(this))}})},buttons:{OK:function(){login($(this))},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},_logout:function(){$.ans.logout(function(err,result){window.location.reload()})},showSideView:function(viewId,anchor,opts){var self=this,o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,viewId,null,function(err,sideView){if(err){console.log("Load view "+viewId+"error: "+err)}else{if(sideView&&sideView.category=="treeView"){if(dbId!=o.dbId){var sel={$or:[]},actions={};actions.documentClickActions=[];actions.documentDoubleClickActions=[];actions.categoryContextMenuNewActions=[];actions.documentContextMenuCenterActions=[];actions.documentContextMenuTopActions=[];actions.documentContextMenuBottomActions=[];$.each(["documentClick","documentDoubleClick","categoryContextMenuNew","documentContextMenuCenter","documentContextMenuTop","documentContextMenuBottom"],function(){sel.$or.push({type:Model.ACTION,extendPoint:this})});$.ans.getDoc(dbId,null,{selector:sel},function(err,data){if(err){console.log("Load actions error:"+err)}else{$.each(data.docs,function(){actions[this.extendPoint+"Actions"].push(this)});self._doShowSideView(sideView,anchor||"west",actions,opts)}})}else{self._doShowSideView(sideView,anchor||"west",null,opts)}}else{if(sideView&&sideView.category=="outline"){self._doShowOutline(sideView,anchor||"east",opts)}}}})},_docClick:function(context,actions){var filter,action={};$.each(actions,function(k,v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){$.extend(true,action,v);action.context=context;action.handler=eval("(0,"+(v.handler||"function(){}")+")");action.handler();return false}})},_docDblClick:function(context,actions){var filter,action={},hit=false;$.each(actions,function(k,v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){$.extend(true,action,v);action.context=context;action.handler=eval("(0,"+(v.handler||"function(){}")+")");action.handler();hit=true;return false}});if(!hit){this.openDocument(context.document._id,{dbId:context.dbId})}},_docContextMenuActions:function(inActions,context,outActions){function addAction(v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){outActions.push({type:"menuItem",text:v.title,context:context,handler:eval("(0,"+(v.handler||"function(){}")+")")})}}$.each((inActions&&inActions.documentContextMenuTopActions)||this.documentContextMenuTopActions,function(k,v){addAction(v)});if(outActions.length>0){outActions.push({type:"seperator"})}$.each((inActions&&inActions.documentContextMenuCenterActions)||this.documentContextMenuCenterActions,function(k,v){addAction(v)});if(outActions.length>=1&&outActions[outActions.length-1].type!="seperator"){outActions.push({type:"seperator"})}$.each((inActions&&inActions.documentContextMenuBottomActions)||this.documentContextMenuBottomActions,function(k,v){addAction(v)});if(outActions.length>=1&&outActions[outActions.length-1].type=="seperator"){outActions.pop()}return outActions},_doShowSideView:function(sideView,anchor,actions,opts){var self=this,o=this.options,title=sideView.title||sideView.name||sideView._id,dbId=(opts&&opts.dbId)||o.dbId,tabs=this[anchor+"Tabs"],id=sideView._id,el=this.element,panel=tabs.find("#"+id);if(panel.size()>0){return}var a=el.border("option",anchor);if(!a.width){el.border("option",anchor,{width:o[anchor+"Width"],resizable:o[anchor+"Width"]>0})}tabs.tabsx("add","#"+id,title);var sv=$("#"+id,tabs).sideview($.extend({dbId:dbId,drop:function(e,data){var $this=$(this),s=data.source.data,t=data.target.data;if(s._path==(t._path+s._id+",")){return}$.ans.getDoc(dbId,"50d820e0a09200787e000000",{options:{exec:true,docId:s._id,parentId:t._id}},function(err,result){if(!err){$this.sideview("delete",s._id).sideview("add",t._id,data.source)}self.statusBar.html("Move "+s.name+" "+(err||result))})},nodeclick:function(e,node){var doc=node.data,context={dbId:dbId,sideview:sv.sideview("option","sideview"),document:doc},as=(actions&&actions.documentClickActions)||self.documentClickActions;self._docClick(context,as)},nodedblclick:function(e,node){var doc=node.data,context={dbId:dbId,sideview:sv.sideview("option","sideview"),document:doc},as=(actions&&actions.documentDoubleClickActions)||self.documentDoubleClickActions;self._docDblClick(context,as)},contextmenu:function(e,node){e.preventDefault();e.stopImmediatePropagation();var doc=node.data,oe=e.originalEvent,outActions=[],rootId=$(e.currentTarget).closest("li.root").attr("id"),filter,context={dbId:dbId,document:doc,rootId:rootId,parent:(node.parent&&node.parent.data)||null,sideview:sv.data("sideview")};if(doc.type==Model.CATEGORY||doc.type==Model.OU||doc.type==Model.GROUP||doc.type==Model.ROLE){var children=[];$.each((actions&&actions.categoryContextMenuNewActions)||self.categoryContextMenuNewActions,function(k,v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){children.push({type:"menuItem",text:v.title,context:context,handler:eval("(0,"+(v.handler||"function(){}")+")")})}});if(!$.isEmptyObject(children)){outActions.push({type:"submenu",text:"New",children:children})}}outActions=self._docContextMenuActions(actions,context,outActions);if(outActions.length>0){$(oe.target).menu({autoShow:true,menuPosition:{of:oe},actions:outActions,select:function(e,ui){$(this).menu("destroy")},collapseAll:function(e){$(this).menu("destroy")}})}},create:function(e,data){self._afterShowSideView({id:sideView._id,anchor:anchor,options:opts})}},sideView,opts))},_doShowOutline:function(sideView,anchor,opts){var self=this,o=this.options,title=sideView.title||sideView.name||sideView._id,tabs=this[anchor+"Tabs"],id=sideView._id,el=this.element,panel=tabs.find("#"+id);if(panel.size()>0){return}var a=el.border("option",anchor),editor=this.currentEditor();if(!a.width){el.border("option",anchor,{width:o[anchor+"Width"],resizable:o[anchor+"Width"]>0})}tabs.tabsx("add","#"+id,title).children("#"+id).outline({contentProvider:editor?editor.option("outline"):null,create:function(e,data){self._afterShowSideView({id:sideView._id,anchor:anchor,options:opts})},nodehover:function(e,node){var widget=node.data;widget&&widget.highlight();e.preventDefault()},nodeclick:function(e,node){var widget=node.data;widget&&widget.scrollTo({onlyIfOutside:true,offsetTop:100,offsetLeft:100})},nodedblclick:function(e,node){var widget=node.data;widget&&widget.widget().dblclick()}})},authorization:function(docId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,docId,null,function(err,doc){if(err){console.log("Load document "+docId+" error: "+err)}else{var sel;if(doc.type==Model.META){sel={$or:[{_id:"a417d20f9fa10c25dad56974"},{_id:"e2922e5edc79a1b28c0199e9"}]}}else{sel={_id:"a417d20f9fa10c25dad56974"}}$.ans.getDoc(Model.ADMINDBID,null,{selector:sel},function(err,data){if(err){console.log("Load forms error: "+err)}else{$("<div/>").authorization({title:"Authorization - "+(doc.title||doc.name||doc._id),dbId:Model.ADMINDBID,document:doc,forms:data.docs,buttons:[{text:"Save",click:function(){var $this=$(this),doc=$this.authorization("option","document");Model.updateDocument(dbId,doc._id,doc,null,function(err,result){if(err){console.log("Save authorization error: "+err)}$this.authorization("close")})}},{text:"Cancel",click:function(){$(this).authorization("close")}}],close:function(e,ui){$(this).remove()}})}})}})},execute:function(doc,opts){var self=this,o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,doc._id,{options:{exec:true}},function(err,doc){if(opts.notify){self.statusBar.html("Execute "+doc.name+" "+(doc.result||doc.error))}})},_notifyOutline:function(){$(window).trigger($.Event("outline",{workbench:this}))},_notifyWidgetSelect:function(widget){$(window).trigger($.Event("widgetselect",{workbench:this}),widget)},newDocument:function(typeId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId,id=new ObjectId().toString(),title=opts.title||id,pid=id,optsx=$.extend(true,{id:id,tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()},saved:function(err,doc,bl){var type={"000000000000000000000001":"openDocument","000000000000000000000002":"openForm","000000000000000000000003":"openView","000000000000000000000004":"openPage"};var data={method:type[doc.type],id:doc._id};if(bl){self.options.openedDocuments.push(data);self._saveOptions()}}},opts);if(typeId==Model.FORM){pid=pid+"-form"}else{if(typeId==Model.PAGE){pid=pid+"-page"}else{if(typeId==Model.VIEW){pid=pid+"-view"}else{pid=pid+"-document"}}}var el=this.centerTabs.tabsx("add","#"+pid,title).children("#"+pid);optsx.opened=function(editor){document.title=o.title+" - "+title;self.reloadToolbar();opts.opened&&opts.opened(editor)};Model.newDocument(el,dbId,typeId,optsx)},copyDocument:function(docId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId;$.ans.getDoc(dbId,docId,null,function(err,doc){if(err){console.log("Load document "+docId+" error: "+err)}else{self.newDocument(doc.type,$.extend(true,{"default":doc,title:doc.title||doc.name},opts))}})},openDocument:function(docId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=docId+"-document";if(tabs.tabsx("panel",pid).size()>0){tabs.tabsx("select",pid);return}function doOpenDoc(el,dbId,docId,opts){var optsx=$.extend(true,{id:docId,tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);optsx.opened=function(editor){var doc=editor.option("document"),title=doc.title||doc.name||docId;tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;self._afterOpenEditor({method:"openDocument",id:docId,options:opts});opts.opened&&opts.opened(editor)};Model.openDocument(el,dbId,docId,optsx)}var el=tabs.tabsx("add","#"+pid,"...").children("#"+pid);if(dbId!=o.dbId){Model.loadToolbarActions(dbId,function(err,toolbarActions){if(err){showDialog("Load Toolbar Actions","Load toolbar actions: "+err)}else{el.data("toolbarActions",toolbarActions).data("dbId",dbId)}doOpenDoc(el,dbId,docId,opts)})}else{doOpenDoc(el,dbId,docId,opts)}},openForm:function(formId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=formId+"-form";if(!opts.preview&&tabs.tabsx("panel",pid).size()>0){tabs.tabsx("select",pid);return}function doOpenForm(el,dbId,formId,opts){var optsx=$.extend(true,{tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},widgetselect:function(e,widget){self._notifyWidgetSelect(widget)},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);optsx.opened=function(editor){var doc=editor.option("document"),title=doc.title||doc.name||formId;tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;self._afterOpenEditor({method:"openForm",id:formId,options:opts});opts.opened&&opts.opened(editor)};Model.openForm(el,dbId,formId,optsx)}var el=null;if(!opts.preview){el=this.centerTabs.tabsx("add","#"+pid,"...").children("#"+pid)}if(dbId!=o.dbId){Model.loadToolbarActions(dbId,function(err,toolbarActions){if(err){showDialog("Load Toolbar Actions","Load toolbar actions: "+err)}else{el.data("toolbarActions",toolbarActions).data("dbId",dbId)}doOpenForm(el,dbId,formId,opts)})}else{doOpenForm(el,dbId,formId,opts)}return this},openPage:function(pageId,opts){opts=opts||{};$.extend(true,opts,{isPageEditor:true});var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=pageId+"-page";if(!opts.preview&&tabs.tabsx("panel",pid).size()>0){tabs.tabsx("select",pid);return}function doOpenPage(el,dbId,pageId,opts){var optsx=$.extend(true,{tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},widgetselect:function(e,widget){self._notifyWidgetSelect(widget)},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);optsx.opened=function(editor){var doc=editor.option("document"),title=doc.title||doc.name||doc._id;tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;self._afterOpenEditor({method:"openPage",id:pageId,options:opts});opts.opened&&opts.opened(editor)};Model.openForm(el,dbId,pageId,optsx)}var el=null;if(!opts.preview){el=this.centerTabs.tabsx("add","#"+pid,"...").children("#"+pid)}if(dbId!=o.dbId){Model.loadToolbarActions(dbId,function(err,toolbarActions){if(err){showDialog("Load Toolbar Actions","Load toolbar actions: "+err)}else{el.data("toolbarActions",toolbarActions).data("dbId",dbId)}doOpenPage(el,dbId,pageId,opts)})}else{doOpenPage(el,dbId,pageId,opts)}return this},openView:function(viewId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=viewId+"-view",el=tabs.tabsx("panel",pid);if(el.size()>0){tabs.tabsx("select",pid);if(el.is(".an-editor")&&opts.mode!="design"){el.editor("destroy")}else{if(el.is(".an-formview, .an-gridview")&&opts.mode=="design"){var data=el.data();for(var i in data){if($.inArray(i,["formview","gridview"])!=-1){data[i].destroy()}}}else{return}}}else{el=tabs.tabsx("add","#"+pid,"...").children("#"+pid),sel={$or:[]},actions={}}function doOpenView(el,dbId,viewId,actions,opts){var optsx=$.extend(true,{tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);var tas={};$.each(["Header","Middle","Tail"],function(){var name="toolbar"+this+"Actions";if(actions[name]){tas[name]=actions[name]}});tas=$.isEmptyObject(tas)?undefined:tas;el.data("toolbarActions",tas).data("dbId",dbId);$.each(actions.editorEventActions||[],function(k,action){var handler=eval("(0,"+(action.handler||"function(){}")+")");el.bind(action.events,function(e){handler.apply(self,arguments)})});optsx.opened=function(editor){var view=editor;if(editor.widgetName=="editor"){view=editor.getForm(viewId)}var v=view.option("view"),title=v.title||v.name||viewId,viewType=v.viewType||"gridview";tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;viewType=viewType.toLowerCase();view.option("docclick",function(e,doc){var context={dbId:dbId,view:el.data(viewType),document:doc},as=actions.documentClickActions||self.documentClickActions;self._docClick(context,as)});view.option("docdblclick",function(e,doc){var context={dbId:dbId,view:el.data(viewType),document:doc},as=actions.documentDoubleClickActions||self.documentDoubleClickActions;self._docDblClick(context,as)});view.option("contentActions",function(doc){var context={dbId:dbId,view:el.data(viewType),document:doc};return self._docContextMenuActions(actions,context,[])});self.reloadToolbar();self._afterOpenEditor({method:"openView",id:viewId,options:opts});opts.opened&&opts.opened(view)};Model.openView(el,dbId,viewId,optsx)}if(dbId!=o.dbId){$.each(["toolbarHeader","toolbarMiddle","toolbarTail","documentClick","documentDoubleClick","documentContextMenuCenter","documentContextMenuTop","documentContextMenuBottom","editorEvent"],function(){var s={type:Model.ACTION,extendPoint:this};if(this=="editorEvent"){s.targetId=viewId}sel.$or.push(s);actions[this+"Actions"]=[]});$.ans.getDoc(dbId,null,{selector:sel},function(err,data){if(err){console.log("Load actions error: "+err)}else{$.each(data.docs,function(){actions[this.extendPoint+"Actions"].push(this)});doOpenView(el,dbId,viewId,actions,opts)}})}else{sel={type:Model.ACTION,viewId:viewId,extendPoint:"editorEvent"};$.ans.getDoc(dbId,null,{selector:sel},function(err,data){if(err){console.log("Load actions error: "+err)}else{actions.editorEventActions=data.docs;doOpenView(el,dbId,viewId,actions,opts)}})}return this},openDatabase:function(dbId,opts){window.open("workbench.html?dbid="+dbId);return this},removeDocument:function(doc,opts){opts=opts||{};var dbId=(opts&&opts.dbId)||this.options.dbId,targetName=doc.title||doc.name||doc._id,title="Remove "+targetName,message="Are you sure to remove "+targetName;message+=(doc.type==Model.CATEGORY)?" and all its child nodes?":"?";showDialog(title,message,{buttons:[{text:"OK",handler:function(dialog){if(doc.type==Model.CATEGORY){Model.deleteDocument(dbId,null,{selector:{_path:{$regex:"^"+doc._path}}},function(err,result){if(err){console.log("Remove document error: "+err)}else{if($.type(opts.removed)=="function"){opts.removed()}}})}else{Model.deleteDocument(dbId,doc._id,null,function(err,result){if(err){console.log("Remove document error: "+err)}else{if($.type(opts.removed)=="function"){opts.removed()}}})}dialog.close()}},{text:"Cancel",handler:function(dialog){dialog.close()}}]});return this},joinInGroup:function(userId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,userId,null,function(err,user){if(err){console.log("Load user document "+userId+" error: "+err)}else{$("<div class='workbench'/>").dialog({title:"Join In Group",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this),ids=[];$.each(user._groupPaths||[],function(k,v){var a=v.split(",");ids.push(a[a.length-2])});$this.sideview({dbId:dbId,roots:Model.GROUP_ROOT,checkbox:true,checkedNodes:ids});setTimeout(function(){$this.sideview("expand",Model.GROUP_ROOT)},200)},buttons:{OK:function(){var $this=$(this),nodes=$this.sideview("option","checkedNodes");user._groupPaths=[];$.each(nodes||[],function(k,node){user._groupPaths.push(node.data._path)});Model.updateDocument(dbId,userId,user,null,function(err,result){if(err){console.log("Join in group error: "+err)}$this.dialog("close")})},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})}});return this},quitGroup:function(userId,groupId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,userId,null,function(err,user){if(err){console.log("Load user document "+userId+" error: "+err)}else{var paths=[];$.each(user._groupPaths||[],function(k,path){var matcher=new RegExp(groupId+",$");if(!matcher.test(path)){paths.push(path)}});user._groupPaths=paths;Model.updateDocument(dbId,userId,user,null,function(err,result){if(err){console.log("Quit group error: "+err)}})}});return this},assignRole:function(docId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,docId,null,function(err,doc){if(err){console.log("Load document "+docId+" error: "+err)}else{$("<div class='workbench'/>").dialog({title:"Assign Roles",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this),ids=[];$.each(doc._rolePaths||[],function(k,v){var a=v.split(",");ids.push(a[a.length-2])});$this.sideview({dbId:dbId,roots:Model.ROLE_ROOT,checkbox:true,checkedNodes:ids});setTimeout(function(){$this.sideview("expand",Model.ROLE_ROOT)},200)},buttons:{OK:function(){var $this=$(this),nodes=$this.sideview("option","checkedNodes"),paths=doc._rolePaths=[];$.each(nodes||[],function(k,node){paths.push(node.data._path)});Model.updateDocument(dbId,docId,doc,null,function(err,result){if(err){console.log("Assign role error:"+err)}$this.dialog("close")})},Cancel:function(){$(this).dialog("close")}},close:function(){$(this).remove()}})}});return this},destroy:function(){this.element.border("destroy");$(window).unbind("resize.workbench",this._proxy);$(document).unbind(".workbench");this.element.removeClass("an-workbench");return $.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.authorization",a.ui.dialog,{options:{title:"Authorization",westWidth:220,width:620,height:480,forms:[]},_create:function(){a.ui.dialog.prototype._create.apply(this,arguments);var c=this.element.addClass("an-authorization");this.west=a("<div class='west'/>").appendTo(c);this.organization=a("<div class='organization ui-corner-all'/>").appendTo(this.west);this.center=a("<div class='center'/>").appendTo(c);this.operation=a("<div class='operation ui-corner-all'><h4 class='title'/></div>").appendTo(this.center);this.content=a("<div class='content'/>").appendTo(this.operation)},_init:function(){a.ui.dialog.prototype._init.apply(this,arguments);var c=this,e=this.options;this.element.border({west:{selector:".west",width:e.westWidth,resizable:true},center:{selector:".center"}});this.organization.sideview({dbId:e.dbId,roots:Model.OU_ROOT+","+Model.GROUP_ROOT+","+Model.ROLE_ROOT,nodeclick:function(h,f){var g=f.data;c.center.find(".title").html(g.title||g.name||g._id);c.content.editor({document:c._getACLAuthz(g),forms:e.forms,dbId:e.dbId,mode:"edit",ignoreEscape:true,docpropchanged:function(j,i){c._updateDocument(g,i)}})}});e.resize=function(){c.element.border("refresh")}},_getACLAuthz:function(h){var e=this.options,k=e.document,t=(h.type==Model.USER?h._id:h._path),s=null,c={title:k.title||k.name||k._id,typeName:"Document"},g=this._getPathsName(h),r=k._acl,j=k._authz,f,p,i,q;if(r){s=r.get&&r.get[g];f=s&&(a.inArray(t,s)!=-1)?true:false;s=r.put&&r.put[g];i=s&&(a.inArray(t,s)!=-1)?true:false;s=r["delete"]&&r["delete"][g];q=s&&(a.inArray(t,s)!=-1)?true:false;c._acl={get:f,put:i,"delete":q}}if(k.type==Model.META){c.typeName=Model.typeName(k._id)||"Document";if(j){s=j.post&&j.post[g];p=s&&(a.inArray(t,s)!=-1)?true:false;s=j.get&&j.get[g];f=s&&(a.inArray(t,s)!=-1)?true:false;s=j.put&&j.put[g];i=s&&(a.inArray(t,s)!=-1)?true:false;s=j["delete"]&&j["delete"][g];q=s&&(a.inArray(t,s)!=-1)?true:false;c._authz={get:f,post:p,put:i,"delete":q}}}return c},_updateDocument:function(g,h){var k=this.options.document,e=h.id.split("."),j=k[e[0]]=k[e[0]]||{},c=j[e[1]]=j[e[1]]||{},f=this._getPathsName(g),q=c[f]=c[f]||[],p=(g.type==Model.USER?g._id:g._path),i=a.inArray(p,q);if(h.value&&(i==-1)){q.push(p)}else{if(!h.value&&i!=-1){q.splice(i,1);if(q.length<=0){delete c[f];if(a.isEmptyObject(c)){delete j[e[1]];if(a.isEmptyObject(j)){}}}}}},_getPathsName:function(c){var e=null;if(c.type==Model.USER){e="users"}else{if(c.type==Model.OU){e="ouPaths"}else{if(c.type==Model.GROUP){e="groupPaths"}else{if(c.type==Model.ROLE){e="rolePaths"}}}}return e},destroy:function(){this.element.border("destroy").removeClass("an-authorization");a.ui.dialog.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(b){function e(g){var f=["transform","WebkitTransform","msTransform","MozTransform","OTransform"];var h;while(h=f.shift()){if(typeof g.style[h]!="undefined"){return h}}return"transform"}var c=null;var a=b.fn.css;b.fn.css=function(f,g){if(c===null){if(typeof b.cssProps!="undefined"){c=b.cssProps}else{if(typeof b.props!="undefined"){c=b.props}else{c={}}}}if(typeof c.transform=="undefined"&&(f=="transform"||(typeof f=="object"&&typeof f.transform!="undefined"))){c.transform=e(this.get(0))}if(c.transform!="transform"){if(f=="transform"){f=c.transform;if(typeof g=="undefined"&&jQuery.style){return jQuery.style(this.get(0),f)}}else{if(typeof f=="object"&&typeof f.transform!="undefined"){f[c.transform]=f.transform;delete f.transform}}}return a.apply(this,arguments)}})(jQuery);jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,f,a,h,g){return jQuery.easing[jQuery.easing.def](e,f,a,h,g)},easeInQuad:function(e,f,a,h,g){return h*(f/=g)*f+a},easeOutQuad:function(e,f,a,h,g){return -h*(f/=g)*(f-2)+a},easeInOutQuad:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f+a}return -h/2*((--f)*(f-2)-1)+a},easeInCubic:function(e,f,a,h,g){return h*(f/=g)*f*f+a},easeOutCubic:function(e,f,a,h,g){return h*((f=f/g-1)*f*f+1)+a},easeInOutCubic:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f+a}return h/2*((f-=2)*f*f+2)+a},easeInQuart:function(e,f,a,h,g){return h*(f/=g)*f*f*f+a},easeOutQuart:function(e,f,a,h,g){return -h*((f=f/g-1)*f*f*f-1)+a},easeInOutQuart:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f+a}return -h/2*((f-=2)*f*f*f-2)+a},easeInQuint:function(e,f,a,h,g){return h*(f/=g)*f*f*f*f+a},easeOutQuint:function(e,f,a,h,g){return h*((f=f/g-1)*f*f*f*f+1)+a},easeInOutQuint:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f*f+a}return h/2*((f-=2)*f*f*f*f+2)+a},easeInSine:function(e,f,a,h,g){return -h*Math.cos(f/g*(Math.PI/2))+h+a},easeOutSine:function(e,f,a,h,g){return h*Math.sin(f/g*(Math.PI/2))+a},easeInOutSine:function(e,f,a,h,g){return -h/2*(Math.cos(Math.PI*f/g)-1)+a},easeInExpo:function(e,f,a,h,g){return(f==0)?a:h*Math.pow(2,10*(f/g-1))+a},easeOutExpo:function(e,f,a,h,g){return(f==g)?a+h:h*(-Math.pow(2,-10*f/g)+1)+a},easeInOutExpo:function(e,f,a,h,g){if(f==0){return a}if(f==g){return a+h}if((f/=g/2)<1){return h/2*Math.pow(2,10*(f-1))+a}return h/2*(-Math.pow(2,-10*--f)+2)+a},easeInCirc:function(e,f,a,h,g){return -h*(Math.sqrt(1-(f/=g)*f)-1)+a},easeOutCirc:function(e,f,a,h,g){return h*Math.sqrt(1-(f=f/g-1)*f)+a},easeInOutCirc:function(e,f,a,h,g){if((f/=g/2)<1){return -h/2*(Math.sqrt(1-f*f)-1)+a}return h/2*(Math.sqrt(1-(f-=2)*f)+1)+a},easeInElastic:function(f,h,e,q,k){var i=1.70158;var j=0;var g=q;if(h==0){return e}if((h/=k)==1){return e+q}if(!j){j=k*0.3}if(g<Math.abs(q)){g=q;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(q/g)}return -(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+e},easeOutElastic:function(f,h,e,q,k){var i=1.70158;var j=0;var g=q;if(h==0){return e}if((h/=k)==1){return e+q}if(!j){j=k*0.3}if(g<Math.abs(q)){g=q;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(q/g)}return g*Math.pow(2,-10*h)*Math.sin((h*k-i)*(2*Math.PI)/j)+q+e},easeInOutElastic:function(f,h,e,q,k){var i=1.70158;var j=0;var g=q;if(h==0){return e}if((h/=k/2)==2){return e+q}if(!j){j=k*(0.3*1.5)}if(g<Math.abs(q)){g=q;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(q/g)}if(h<1){return -0.5*(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+e}return g*Math.pow(2,-10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j)*0.5+q+e},easeInBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}return i*(f/=h)*f*((g+1)*f-g)+a},easeOutBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}return i*((f=f/h-1)*f*((g+1)*f+g)+1)+a},easeInOutBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}if((f/=h/2)<1){return i/2*(f*f*(((g*=(1.525))+1)*f-g))+a}return i/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+a},easeInBounce:function(e,f,a,h,g){return h-jQuery.easing.easeOutBounce(e,g-f,0,h,g)+a},easeOutBounce:function(e,f,a,h,g){if((f/=g)<(1/2.75)){return h*(7.5625*f*f)+a}else{if(f<(2/2.75)){return h*(7.5625*(f-=(1.5/2.75))*f+0.75)+a}else{if(f<(2.5/2.75)){return h*(7.5625*(f-=(2.25/2.75))*f+0.9375)+a}else{return h*(7.5625*(f-=(2.625/2.75))*f+0.984375)+a}}}},easeInOutBounce:function(e,f,a,h,g){if(f<g/2){return jQuery.easing.easeInBounce(e,f*2,0,h,g)*0.5+a}return jQuery.easing.easeOutBounce(e,f*2-g,0,h,g)*0.5+h*0.5+a}});(function(e){var c="deg";e.fn.rotate=function(h){var g=e(this).css("transform")||"none";if(typeof h=="undefined"){if(g){var f=g.match(/rotate\(([^)]+)\)/);if(f&&f[1]){return f[1]}}return 0}var f=h.toString().match(/^(-?\d+(\.\d+)?)(.+)?$/);if(f){if(f[3]){c=f[3]}e(this).css("transform",g.replace(/none|rotate\([^)]*\)/,"")+"rotate("+f[1]+c+")")}return this};e.fn.scale=function(j,i,g){var h=e(this).css("transform");if(typeof j=="undefined"){if(h){var f=h.match(/scale\(([^)]+)\)/);if(f&&f[1]){return f[1]}}return 1}e(this).css("transform",h.replace(/none|scale\([^)]*\)/,"")+"scale("+j+")");return this};var b=e.fx.prototype.cur;e.fx.prototype.cur=function(){if(this.prop=="rotate"){return parseFloat(e(this.elem).rotate())}else{if(this.prop=="scale"){return parseFloat(e(this.elem).scale())}}return b.apply(this,arguments)};e.fx.step.rotate=function(f){e(f.elem).rotate(f.now+c)};e.fx.step.scale=function(f){e(f.elem).scale(f.now)};var a=e.fn.animate;e.fn.animate=function(g){if(typeof g.rotate!="undefined"){var f=g.rotate.toString().match(/^(([+-]=)?(-?\d+(\.\d+)?))(.+)?$/);if(f&&f[5]){c=f[5]}g.rotate=f[1]}return a.apply(this,arguments)}})(jQuery);(function(a){a.fn.quicksand=function(f,b){var e={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"auto",useScaling:true,enhancement:function(g){},selector:"> *",dx:0,dy:0};a.extend(e,b);if(a.browser.msie||(typeof(a.fn.scale)=="undefined")){e.useScaling=false}var c;if(typeof(arguments[1])=="function"){var c=arguments[1]}else{if(typeof(arguments[2]=="function")){var c=arguments[2]}}return this.each(function(z){var E;var C=[];var j=a(f).clone();var D=a(this);var h=a(this).css("height");var s;var k=false;var p=a(D).offset();var q=[];var B=a(this).find(e.selector);if(a.browser.msie&&a.browser.version.substr(0,1)<7){D.html("").append(j);return}var r=0;var v=function(){if(!r){r=1;$toDelete=D.find("> *");D.prepend(w.find("> *"));$toDelete.remove();if(k){D.css("height",s)}e.enhancement(D);if(typeof c=="function"){c.call(this)}}};var A=D.offsetParent();var x=A.offset();if(A.css("position")=="relative"){if(A.get(0).nodeName.toLowerCase()=="body"){}else{x.top+=(parseFloat(A.css("border-top-width"))||0);x.left+=(parseFloat(A.css("border-left-width"))||0)}}else{x.top-=(parseFloat(A.css("border-top-width"))||0);x.left-=(parseFloat(A.css("border-left-width"))||0);x.top-=(parseFloat(A.css("margin-top"))||0);x.left-=(parseFloat(A.css("margin-left"))||0)}if(isNaN(x.left)){x.left=0}if(isNaN(x.top)){x.top=0}x.left-=e.dx;x.top-=e.dy;D.css("height",a(this).height());B.each(function(F){q[F]=a(this).offset()});a(this).stop();var u=0;var t=0;B.each(function(F){a(this).stop();var G=a(this).get(0);if(G.style.position=="absolute"){u=-e.dx;t=-e.dy}else{u=e.dx;t=e.dy}G.style.position="absolute";G.style.margin="0";G.style.top=(q[F].top-parseFloat(G.style.marginTop)-x.top+t)+"px";G.style.left=(q[F].left-parseFloat(G.style.marginLeft)-x.left+u)+"px"});var w=a(D).clone();var g=w.get(0);g.innerHTML="";g.setAttribute("id","");g.style.height="auto";g.style.width=D.width()+"px";w.append(j);w.insertBefore(D);w.css("opacity",0);g.style.zIndex=-1;g.style.margin="0";g.style.position="absolute";g.style.top=p.top-x.top+"px";g.style.left=p.left-x.left+"px";if(e.adjustHeight==="dynamic"){D.animate({height:w.height()},e.duration,e.easing)}else{if(e.adjustHeight==="auto"){s=w.height();if(parseFloat(h)<parseFloat(s)){D.css("height",s)}else{k=true}}}B.each(function(F){var G=[];if(typeof(e.attribute)=="function"){E=e.attribute(a(this));j.each(function(){if(e.attribute(this)==E){G=a(this);return false}})}else{G=j.filter("["+e.attribute+"="+a(this).attr(e.attribute)+"]")}if(G.length){if(!e.useScaling){C.push({element:a(this),animation:{top:G.offset().top-x.top,left:G.offset().left-x.left,opacity:1}})}else{C.push({element:a(this),animation:{top:G.offset().top-x.top,left:G.offset().left-x.left,opacity:1,scale:"1.0"}})}}else{if(!e.useScaling){C.push({element:a(this),animation:{opacity:"0.0"}})}else{C.push({element:a(this),animation:{opacity:"0.0",scale:"0.0"}})}}});j.each(function(H){var G=[];var J=[];if(typeof(e.attribute)=="function"){E=e.attribute(a(this));B.each(function(){if(e.attribute(this)==E){G=a(this);return false}});j.each(function(){if(e.attribute(this)==E){J=a(this);return false}})}else{G=B.filter("["+e.attribute+"="+a(this).attr(e.attribute)+"]");J=j.filter("["+e.attribute+"="+a(this).attr(e.attribute)+"]")}var I;if(G.length===0){if(!e.useScaling){I={opacity:"1.0"}}else{I={opacity:"1.0",scale:"1.0"}}d=J.clone();var F=d.get(0);F.style.position="absolute";F.style.margin="0";F.style.top=J.offset().top-x.top+"px";F.style.left=J.offset().left-x.left+"px";d.css("opacity",0);if(e.useScaling){d.css("transform","scale(0.0)")}d.appendTo(D);C.push({element:a(d),animation:I})}});w.remove();e.enhancement(D);for(z=0;z<C.length;z++){C[z].element.animate(C[z].animation,e.duration,e.easing,v)}})}})(jQuery);(function(a){a.fn.ColorPicker=function(g){var b=this;var e=a.extend({},a.fn.ColorPicker.defaults,g);this.hidden=a('<input type="hidden" />').attr("name",e.name).appendTo(this);this.palette=null;this.preview=null;this.input=null;this.indicator=a("<div />").addClass("color-indicator").appendTo(this);function c(h){b.val(h);e.handler&&e.handler(b.val());b.palette.slideUp()}function f(){b.palette=a("<div />").addClass(e.paletteClass+" rounded-3");for(var h=0;h<e.colors.length;h++){a("<div />").addClass("color").css("background-color",e.colors[h]).attr({title:e.colors[h],unselectable:"on"}).appendTo(b.palette).mouseenter(function(){var i=a(this).attr("title");b.input.val(i);b.preview.css("background-color",i)}).click(function(i){i.stopPropagation();c(a(this).attr("title"))})}b.input=a('<input type="text" />').addClass("rounded-3").attr("size",8).click(function(i){i.stopPropagation();a(this).focus()}).keydown(function(j){if(j.ctrlKey||j.metaKey){return true}var i=j.keyCode;if(i==27){return b.mouseleave()}if(i!=8&&i!=13&&i!=46&&i!=37&&i!=39&&(i<48||i>57)&&(i<65||i>70)){return false}var p=a(this).val();if(p.length==7||p.length==0){if(i==13){j.stopPropagation();j.preventDefault();c(p);b.palette.slideUp()}if(j.keyCode!=8&&j.keyCode!=46&&i!=37&&i!=39){return false}}}).keyup(function(i){var j=a(this).val();j.length==7&&/^#[0-9abcdef]{6}$/i.test(j)&&b.val(j)});b.preview=a("<div />").addClass("preview rounded-3").click(function(i){i.stopPropagation();c(b.input.val())});b.palette.append(a("<div />").addClass("clearfix")).append(a("<div />").addClass("panel").append(b.input).append(b.preview));if(e.palettePosition=="outer"){b.palette.hide().appendTo(b.parents("body").eq(0)).mouseleave(function(){if(!b.palette.is(":animated")){a(this).slideUp();b.val(b.val())}});b.mouseleave(function(i){if(i.relatedTarget!=b.palette.get(0)){if(!b.palette.is(":animated")){b.palette.slideUp();b.val(b.val())}}})}else{b.append(b.palette.hide()).mouseleave(function(i){b.palette.slideUp();b.val(b.val())})}b.val(b.val())}this.click(function(j){if(!b.hasClass("disabled")){!b.palette&&f();if(e.palettePosition=="outer"&&b.palette.css("display")=="none"){var k=a(this).offset(),i=b.palette.width();var h=b.parents("body").width()-k.left>=i?k.left:k.left+a(this).outerWidth()-i;b.palette.css({left:h+"px",top:k.top+a(this).height()+1+"px"})}b.palette.slideToggle()}});this.val=function(h){if(!h&&h!==""){return this.hidden.val()}else{this.hidden.val(h);if(e.update){e.update.apply(this,[this.hidden.val()])}else{this.css("background-color",h)}if(b.palette){b.preview.css("background-color",h);b.input.val(h)}}return this};this.val(e.color||"");return this};a.fn.ColorPicker.defaults={"class":"colorpicker",paletteClass:"palette",palettePosition:"outer",name:"color",color:"",update:function(b){this.indicator.css("background-color",b)},handler:function(b){},colors:["#ffffff","#cccccc","#999999","#666666","#333333","#000000","#ffcccc","#cc9999","#996666","#663333","#330000","#ff9999","#cc6666","#cc3333","#993333","#660000","#ff6666","#ff3333","#ff0000","#cc0000","#990000","#ff9966","#ff6633","#ff3300","#cc3300","#993300","#ffcc99","#cc9966","#cc6633","#996633","#663300","#ff9933","#ff6600","#ff9900","#cc6600","#cc9933","#ffcc66","#ffcc33","#ffcc00","#cc9900","#996600","#ffffcc","#cccc99","#999966","#666633","#333300","#ffff99","#cccc66","#cccc33","#999933","#666600","#ffff66","#ffff33","#ffff00","#cccc00","#999900","#ccff66","#ccff33","#ccff00","#99cc00","#669900","#ccff99","#99cc66","#99cc33","#669933","#336600","#99ff33","#99ff00","#66ff00","#66cc00","#66cc33","#99ff66","#66ff33","#33ff00","#33cc00","#339900","#ccffcc","#99cc99","#669966","#336633","#003300","#99ff99","#66cc66","#33cc33","#339933","#006600","#66ff66","#33ff33","#00ff00","#00cc00","#009900","#66ff99","#33ff66","#00ff33","#00cc33","#009933","#99ffcc","#66cc99","#33cc66","#339966","#006633","#33ff99","#00ff66","#00ff99","#00cc66","#33cc99","#66ffcc","#33ffcc","#00ffcc","#00cc99","#009966","#ccffff","#99cccc","#669999","#336666","#003333","#99ffff","#66cccc","#33cccc","#339999","#006666","#66cccc","#33ffff","#00ffff","#00cccc","#009999","#66ccff","#33ccff","#00ccff","#0099cc","#006699","#99ccff","#6699cc","#3399cc","#336699","#003366","#3399ff","#0099ff","#0066ff","#066ccc","#3366cc","#6699ff","#3366ff","#0033ff","#0033cc","#003399","#ccccff","#9999cc","#666699","#333366","#000033","#9999ff","#6666cc","#3333cc","#333399","#000066","#6666ff","#3333ff","#0000ff","#0000cc","#009999","#9966ff","#6633ff","#3300ff","#3300cc","#330099","#cc99ff","#9966cc","#6633cc","#663399","#330066","#9933ff","#6600ff","#9900ff","#6600cc","#9933cc","#cc66ff","#cc33ff","#cc00ff","#9900cc","#660099","#ffccff","#cc99cc","#996699","#663366","#330033","#ff99ff","#cc66cc","#cc33cc","#993399","#660066","#ff66ff","#ff33ff","#ff00ff","#cc00cc","#990099","#ff66cc","#ff33cc","#ff00cc","#cc0099","#990066","#ff99cc","#cc6699","#cc3399","#993366","#660033","#ff3399","#ff0099","#ff0066","#cc0066","#cc3366","#ff6699","#ff3366","#ff0033","#cc0033","#990033"]}})(jQuery);(function(a){a.fn.elBorderSelect=function(g){var i=this;var k=this.eq(0);var b=a.extend({},a.fn.elBorderSelect.defaults,g);var e=a('<input type="text" />').attr({name:b.name+"[width]",size:3}).css("text-align","right").change(function(){i.change()});var h=a("<div />").css("position","relative").ColorPicker({"class":"el-colorpicker ui-icon ui-icon-pencil",name:b.name+"[color]",palettePosition:"outer",change:function(){i.change()}});var c=a("<div />").elSelect({tpl:'<div style="border-bottom:4px %val #000;width:100%;margin:7px 0"> </div>',tpls:{"":"%label"},maxHeight:b.styleHeight||null,select:function(){i.change()},src:{"":"none",solid:"solid",dashed:"dashed",dotted:"dotted","double":"double",groove:"groove",ridge:"ridge",inset:"inset",outset:"outset"}});k.empty().addClass(b["class"]).attr("name",b.name||"").append(a("<table />").attr("cellspacing",0).append(a("<tr />").append(a("<td />").append(e).append(" px")).append(a("<td />").append(c)).append(a("<td />").append(h))));function f(r){function q(s){hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return !s?"00":hexDigits[(s-s%16)/16]+hexDigits[s%16]}var p=(r||"").match(/\(([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})\)/);return p?"#"+q(p[1])+q(p[2])+q(p[3]):""}function j(q){if(!q){return q}var p=q.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(p){q=p[1];unit=p[2]}if(q[0]=="."){q="0"+q}q=parseFloat(q);if(isNaN(q)){return""}var r=parseInt(a(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(q*r);case"pt":return parseInt(q*r/12);case"%":return parseInt(q*r/100)}return q}this.change=function(){b.change&&b.change(this.val())};this.val=function(t){var r,u,x,q,p;if(!t&&t!==""){r=parseInt(e.val());r=!isNaN(r)?r+"px":"";u=c.val();x=h.val();return{width:r,style:u,color:x,css:a.trim(r+" "+u+" "+x)}}else{q="";if(t.nodeName||t.css){if(!t.css){t=a(t)}q=t.css("border");if((q=t.css("border"))){r=u=x=q}else{r=t.css("border-width");u=t.css("border-style");x=t.css("border-color")}}else{r=t.width||"";u=t.style||"";x=t.color||""}e.val(j(r));p=u?u.match(/(solid|dashed|dotted|double|groove|ridge|inset|outset)/i):"";c.val(p?p[1]:"");h.val(x.indexOf("#")===0?x:f(x));return this}};this.val(b.value);return this};a.fn.elBorderSelect.defaults={name:"el-borderselect","class":"el-borderselect",value:{},change:null}})(jQuery);(function(a){a.fn.elPaddingInput=function(f){var c=this;var e=a.extend({},a.fn.elPaddingInput.defaults,{name:this.attr("name")},f);this.regexps={main:new RegExp(e.type=="padding"?'paddings*:s*([^;"]+)':'margins*:s*([^;"]+)',"im"),left:new RegExp(e.type=="padding"?'padding-lefts*:s*([^;"]+)':'margin-lefts*:s*([^;"]+)',"im"),top:new RegExp(e.type=="padding"?'padding-tops*:s*([^;"]+)':'margin-tops*:s*([^;"]+)',"im"),right:new RegExp(e.type=="padding"?'padding-rights*:s*([^;"]+)':'margin-rights*:s*([^;"]+)',"im"),bottom:new RegExp(e.type=="padding"?'padding-bottoms*:s*([^;"]+)':'margin-bottoms*:s*([^;"]+)',"im")};a.each(["left","top","right","bottom"],function(){c[this]=a('<input type="text" />').attr("size",3).css("text-align","right").css("border-"+this,"2px solid red").bind("change",function(){a(this).val(b(a(this).val()));g()}).attr("name",e.name+"["+this+"]")});a.each(["uleft","utop","uright","ubottom"],function(){c[this]=a("<select />").append('<option value="px">px</option>').append('<option value="em">em</option>').append('<option value="pt">pt</option>').bind("change",function(){g()}).attr("name",e.name+"["+this+"]");if(e.percents){c[this].append('<option value="%">%</option>')}});this.empty().addClass(e["class"]).append(this.left).append(this.uleft).append(" x ").append(this.top).append(this.utop).append(" x ").append(this.right).append(this.uright).append(" x ").append(this.bottom).append(this.ubottom);this.val=function(w){if(!w&&w!==""){var p=b(this.left.val());var x=b(this.top.val());var h=b(this.right.val());var u=b(this.bottom.val());var s={left:p=="auto"||p==0?p:(p!==""?p+this.uleft.val():""),top:x=="auto"||x==0?x:(x!==""?x+this.utop.val():""),right:h=="auto"||h==0?h:(h!==""?h+this.uright.val():""),bottom:u=="auto"||u==0?u:(u!==""?u+this.ubottom.val():""),css:""};if(s.left!==""&&s.right!==""&&s.top!==""&&s.bottom!==""){if(s.left==s.right&&s.top==s.bottom){s.css=s.top+" "+s.left}else{s.css=s.top+" "+s.right+" "+s.bottom+" "+s.left}}return s}else{if(w.nodeName||w.css){if(!w.css){w=a(w)}var j={left:"",top:"",right:"",bottom:""};var i=(w.attr("style")||"").toLowerCase();if(i){i=a.trim(i);var k=i.match(this.regexps.main);if(k){var q=a.trim(k[1]).replace(/\s+/g," ").split(" ",4);j.top=q[0];j.right=q[1]&&q[1]!==""?q[1]:j.top;j.bottom=q[2]&&q[2]!==""?q[2]:j.top;j.left=q[3]&&q[3]!==""?q[3]:j.right}else{a.each(["left","top","right","bottom"],function(){var r=this.toString();k=i.match(c.regexps[r]);if(k){j[r]=k[1]}})}}var w=j}a.each(["left","top","right","bottom"],function(){var t=this.toString();c[t].val("");c["u"+t].val();if(typeof(w[t])!="undefined"&&w[t]!==null){w[t]=w[t].toString();var v=b(w[t]);c[t].val(v);var r=w[t].match(/(px|em|pt|%)/i);c["u"+t].val(r?r[1]:"px")}});return this}};function b(h){h=a.trim(h.toString());if(h[0]=="."){h="0"+h}n=parseFloat(h);return !isNaN(n)?n:(h=="auto"?h:"")}function g(){e.change&&e.change(c)}this.val(e.value);return this};a.fn.elPaddingInput.defaults={name:"el-paddinginput","class":"el-paddinginput",type:"padding",value:{},percents:true,change:null}})(jQuery);(function(a){a.fn.elSelect=function(c){var p=this;var s=this.eq(0);var b=a.extend({},a.fn.elSelect.defaults,c);var f=a('<input type="hidden" />').attr("name",b.name);var k=a("<label />").attr({unselectable:"on"}).addClass("rounded-left-3");var g=null;var j=null;if(s.get(0).nodeName=="SELECT"){b.src={};s.children("option").each(function(){b.src[a(this).val()]=a(this).text()});b.value=s.val();b.name=s.attr("name");s.replaceWith((s=a("<div />")))}if(!b.value||!b.src[b.val]){b.value=null;var e=0;for(var q in b.src){if(e++==0){b.value=q}}}this.val=function(i){if(!i&&i!==""){return f.val()}else{if(b.src[i]){f.val(i);h(i);if(g){g.children().each(function(){if(a(this).attr("name")==i){a(this).addClass("active")}else{a(this).removeClass("active")}})}}return this}};function h(i){var t=b.labelTpl||b.tpls[i]||b.tpl;k.html(t.replace(/%val/g,i).replace(/%label/,b.src[i])).children().attr({unselectable:"on"})}s.empty().addClass(b["class"]+" rounded-3").attr({unselectable:"on"}).append(f).append(k).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).click(function(i){!g&&r();g.slideToggle();if(a.browser.msie&&!j){g.children().each(function(){j=Math.max(j,a(this).width())});if(j>g.width()){g.width(j+40)}}});this.val(b.value);function r(){g=a("<div style='z-index:99999;'/>").addClass(b.listClass+" rounded-3").hide().appendTo(s.mouseleave(function(v){g.slideUp()}));for(var t in b.src){var u=b.tpls[t]||b.tpl;a('<div class="item"/>').attr("name",t).append(a(u.replace(/%val/g,t).replace(/%label/g,b.src[t])).attr({unselectable:"on"})).appendTo(g).click(function(z){z.stopPropagation();z.preventDefault();var w=a(this).attr("name");p.val(w);b.select(w);g.slideUp()})}var i=s.outerWidth();if(g.width()<i){g.width(i)}var x=g.height();if(b.maxHeight>0&&x>b.maxHeight){g.height(b.maxHeight)}p.val(f.val())}return this};a.fn.elSelect.defaults={name:"rte-select","class":"rte-select",listClass:"list",labelTpl:null,tpl:"<%val>%label</%val>",tpls:{},value:null,src:{},select:function(b){window.console&&window.console.log&&window.console.log("selected: "+b)},maxHeight:410}})(jQuery);function rteDom(a){this.rte=a;this.regExp={textNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TD|TH|TT|VAR)$/,textContainsNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DL|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|OL|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|TT|UL|VAR)$/,block:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|UL)$/,selectionBlock:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TD|TH|TR|UL)$/,header:/^H[1-6]$/,formElement:/^(FORM|INPUT|HIDDEN|TEXTAREA|SELECT|BUTTON)$/}}rteDom.prototype.createBookmark=function(){var a=this.rte.options.doc.createElement("span");a.id="rte-bm-"+Math.random().toString().substr(2);$(a).addClass("rtebm rte-protected");return a};rteDom.prototype.attr=function(c,a){var b="";if(c&&c.nodeType==1){b=$(c).attr(a);if(b&&a!="src"&&a!="href"&&a!="title"&&a!="alt"){b=b.toString().toLowerCase()}}return b||""};rteDom.prototype.findCommonAncestor=function(f,e){if(!f||!e){return}if(f==e){return f}else{if(f.nodeName=="BODY"||e.nodeName=="BODY"){return this.rte.options.doc.body}}var h=$(f).parents(),g=$(e).parents(),a=g.length-1,j=g[a];for(var b=h.length-1;b>=0;b--,a--){if(h[b]==g[a]){j=h[b]}else{break}}return j};rteDom.prototype.isEmpty=function(a){if(a.nodeType==1){return this.regExp.textNodes.test(a.nodeName)?$.trim($(a).text()).length==0:false}else{if(a.nodeType==3){return/^(TABLE|THEAD|TFOOT|TBODY|TR|UL|OL|DL)$/.test(a.parentNode.nodeName)||a.nodeValue==""||($.trim(a.nodeValue).length==0&&!(a.nextSibling&&a.previousSibling&&a.nextSibling.nodeType==1&&a.previousSibling.nodeType==1&&!this.regExp.block.test(a.nextSibling.nodeName)&&!this.regExp.block.test(a.previousSibling.nodeName)))}}return true};rteDom.prototype.next=function(a){while(a.nextSibling&&(a=a.nextSibling)){if(a.nodeType==1||(a.nodeType==3&&!this.isEmpty(a))){return a}}return null};rteDom.prototype.prev=function(a){while(a.previousSibling&&(a=a.previousSibling)){if(a.nodeType==1||(a.nodeType==3&&!this.isEmpty(a))){return a}}return null};rteDom.prototype.isPrev=function(b,a){while((b=this.prev(b))){if(b==a){return true}}return false};rteDom.prototype.nextAll=function(b){var a=[];while((b=this.next(b))){a.push(b)}return a};rteDom.prototype.prevAll=function(b){var a=[];while((b=this.prev(b))){a.push(b)}return a};rteDom.prototype.toLineEnd=function(b){var a=[];while((b=this.next(b))&&b.nodeName!="BR"&&b.nodeName!="HR"&&this.isInline(b)){a.push(b)}return a};rteDom.prototype.toLineStart=function(b){var a=[];while((b=this.prev(b))&&b.nodeName!="BR"&&b.nodeName!="HR"&&this.isInline(b)){a.unshift(b)}return a};rteDom.prototype.isFirstNotEmpty=function(a){while((a=this.prev(a))){if(a.nodeType==1||(a.nodeType==3&&$.trim(a.nodeValue)!="")){return false}}return true};rteDom.prototype.isLastNotEmpty=function(a){while((a=this.next(a))){if(!this.isEmpty(a)){return false}}return true};rteDom.prototype.isOnlyNotEmpty=function(a){return this.isFirstNotEmpty(a)&&this.isLastNotEmpty(a)};rteDom.prototype.findLastNotEmpty=function(a){if(a.nodeType==1&&(l=a.lastChild)){if(!this.isEmpty(l)){return l}while(l.previousSibling&&(l=l.previousSibling)){if(!this.isEmpty(l)){return l}}}return false};rteDom.prototype.isInline=function(c){if(c.nodeType==3){return true}else{if(c.nodeType==1){c=$(c);var b=c.css("display");var a=c.css("float");return b=="inline"||b=="inline-block"||a=="left"||a=="right"}}return true};rteDom.prototype.is=function(b,a){if(b&&b.nodeName){if(typeof(a)=="string"){a=this.regExp[a]||/.?/}if(a instanceof RegExp&&b.nodeName){return a.test(b.nodeName)}else{if(typeof(a)=="function"){return a(b)}}}return false};rteDom.prototype.filter=function(e,c){var a=[],b;if(!e.push){return this.is(e,c)?e:null}for(b=0;b<e.length;b++){if(this.is(e[b],c)){a.push(e[b])}}return a};rteDom.prototype.parents=function(c,b){var a=[];while(c&&(c=c.parentNode)&&c.nodeName!="BODY"&&c.nodeName!="HTML"){if(this.is(c,b)){a.push(c)}}return a};rteDom.prototype.parent=function(b,a){return this.parents(b,a)[0]||null};rteDom.prototype.selfOrParent=function(c,b,a){return this.is(c,b)?c:this.parent(c,a||b)};rteDom.prototype.selfOrParentLink=function(a){a=this.selfOrParent(a,/^A$/);return a?a:null};rteDom.prototype.selfOrParentAnchor=function(a){a=this.selfOrParent(a,/^A$/);return a&&!a.href&&a.name?a:null};rteDom.prototype.childLinks=function(b){var a=[];$("a[href]",b).each(function(){a.push(this)});return a};rteDom.prototype.selectionHas=function(c,b){var e=c.cloneContents(),a;if(e&&e.childNodes&&e.childNodes.length){for(a=0;a<e.childNodes.length;a++){if(typeof(b)=="function"){if(b(e.childNodes[a])){return true}}else{if(e instanceof RegExp){if(b.test(e.childNodes[a].nodeName)){return true}}}}}return false};rteDom.prototype.wrap=function(b,a){b=$.isArray(b)?b:[b];a=a.nodeName?a:this.rte.options.doc.createElement(a);if(b[0]&&b[0].nodeType&&b[0].parentNode){a=b[0].parentNode.insertBefore(a,b[0]);$(b).each(function(){if(this!=a){a.appendChild(this)}})}return a};rteDom.prototype.unwrap=function(a){if(a&&a.parentNode){while(a.firstChild){a.parentNode.insertBefore(a.firstChild,a)}a.parentNode.removeChild(a)}};rteDom.prototype.wrapContents=function(c,a){a=a.nodeName?a:this.rte.options.doc.createElement(a);for(var b=0;b<c.childNodes.length;b++){a.appendChild(c.childNodes[b])}c.appendChild(a);return a};rteDom.prototype.cleanNode=function(a){if(a.nodeType!=1){return}if(/^(P|LI)$/.test(a.nodeName)&&(l=this.findLastNotEmpty(a))&&l.nodeName=="BR"){$(l).remove()}$n=$(a);$n.children().each(function(){this.cleanNode(this)});if(a.nodeName!="BODY"&&!/^(TABLE|TR|TD)$/.test(a)&&this.isEmpty(a)){return $n.remove()}if($n.attr("style")===""){$n.removeAttr("style")}if($.browser.safari&&$n.hasClass("Apple-span")){$n.removeClass("Apple-span")}if(a.nodeName=="SPAN"&&!$n.attr("style")&&!$n.attr("class")&&!$n.attr("id")){$n.replaceWith($n.html())}};rteDom.prototype.cleanChildNodes=function(b){var a=this.cleanNode;$(b).children().each(function(){a(this)})};rteDom.prototype.tableMatrix=function(e){var c=[];if(e&&e.nodeName=="TABLE"){var b=0;function a(g){for(var f=0;f<=b;f++){if(!c[g][f]){return f}}}$(e).find("tr").each(function(f){if(!$.isArray(c[f])){c[f]=[]}$(this).children("td,th").each(function(){var j=parseInt($(this).attr("colspan")||1);var q=parseInt($(this).attr("rowspan")||1);var p=a(f);for(var s=0;s<q;s++){for(var g=0;g<j;g++){var k=f+s;if(!$.isArray(c[k])){c[k]=[]}var r=g==0&&s==0?this:(s==0?g:"-");c[k][p+g]=r}}b=Math.max(b,c[f].length)})})}return c};rteDom.prototype.indexesOfCell=function(e,c){for(var a=0;a<c.length;a++){for(var b=0;b<c[a].length;b++){if(c[a][b]==e){return[a,b]}}}};rteDom.prototype.fixTable=function(b){if(b&&b.nodeName=="TABLE"){var f=$(b);var j=this.tableMatrix(b);var h=0;$.each(j,function(){h=Math.max(h,this.length)});if(h==0){return f.remove()}for(var a=0;a<j.length;a++){var e=j[a].length;if(e==0){f.find("tr").eq(a).remove()}else{if(e<h){var c=h-e;var k=f.find("tr").eq(a);for(var g=0;g<c;g++){k.append("<td>&nbsp;</td>")}}}}}};rteDom.prototype.tableColumn=function(c,b,g){c=this.selfOrParent(c,/^TD|TH$/);var e=this.selfOrParent(c,/^TABLE$/);ret=[];info={offset:[],delta:[]};if(c&&e){g&&this.fixTable(e);var k=this.tableMatrix(e);var p=false;var j;for(var a=0;a<k.length;a++){for(var i=0;i<k[a].length;i++){if(k[a][i]==c){j=i;p=true;break}}if(p){break}}if(j>=0){for(var a=0;a<k.length;a++){var f=k[a][j]||null;if(f){if(f.nodeName){ret.push(f);if(b){info.delta.push(0);info.offset.push(j)}}else{var h=parseInt(f);if(!isNaN(h)&&k[a][j-h]&&k[a][j-h].nodeName){ret.push(k[a][j-h]);if(b){info.delta.push(h);info.offset.push(j)}}}}}}}return !b?ret:{column:ret,info:info}};function rteSelection(b){this.rte=b;this.w3cRange=null;var a=this,c=b.options.doc;$(c).keyup(function(f){if(f.ctrlKey||f.metaKey||(f.keyCode>=8&&f.keyCode<=13)||(f.keyCode>=32&&f.keyCode<=40)||f.keyCode==46||(f.keyCode>=96&&f.keyCode<=111)){a.cleanCache()}}).mousedown(function(f){a.start=(f.target.nodeName=="HTML"?c.body:f.target);a.end=a.node=null}).mouseup(function(f){a.end=(f.target.nodeName=="HTML"?c.body:f.target);a.node=null}).click()}rteSelection.prototype.getSelection=function(){var a=this.rte.options.win;return a.getSelection?a.getSelection():a.document.selection};rteSelection.prototype.realSelected=function(e,b,a){var c=this.rte.options.dom;while(e.nodeName!="BODY"&&e.parentNode&&e.parentNode.nodeName!="BODY"&&(b?e!==b&&e.parentNode!=b:1)&&((a=="left"&&c.isFirstNotEmpty(e))||(a=="right"&&c.isLastNotEmpty(e))||(c.isFirstNotEmpty(e)&&c.isLastNotEmpty(e)))){e=e.parentNode}return e};rteSelection.prototype.collapsed=function(){return this.getRangeAt().isCollapsed()};rteSelection.prototype.collapse=function(a){var b=this.getRangeAt();b.collapse(a?true:false);if(!$.browser.msie){this.getSelection().removeAllRanges();this.getSelection().addRange(b)}return this};rteSelection.prototype.getRangeAt=function(c){if($.browser.msie){if(!this.w3cRange){this.w3cRange=new w3cRange(this.rte.options.win)}c&&this.w3cRange.update();return this.w3cRange}var a=this.getSelection(),b=a&&a.rangeCount>0?a.getRangeAt(0):this.rte.options.win.document.createRange();b.getStart=function(){return this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(this.startOffset,this.startContainer.childNodes.length-1)]:this.startContainer};b.getEnd=function(){return this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(this.startOffset==this.endOffset?this.endOffset:this.endOffset-1,this.endContainer.childNodes.length-1)]:this.endContainer};b.isCollapsed=function(){return this.collapsed};return b};rteSelection.prototype.saveIERange=function(){if($.browser.msie){bm=this.getRangeAt().getBookmark()}};rteSelection.prototype.restoreIERange=function(){$.browser.msie&&bm&&this.getRangeAt().moveToBookmark(bm)};rteSelection.prototype.cloneContents=function(){var g=this.rte.options.doc,j=g.createElement("div"),b,h,a;if($.browser.msie){try{b=this.getSelection().createRange()}catch(f){b=g.body.createTextRange()}$(j).html(b.htmlText)}else{h=this.getRangeAt().cloneContents();for(a=0;a<h.childNodes.length;a++){j.appendChild(h.childNodes[a].cloneNode(true))}}return j};rteSelection.prototype.select=function(c,h){h=h||c;if($.browser.msie){var f=this.rte.options.doc.body.createTextRange(),b=f.duplicate(),a=f.duplicate();b.moveToElementText(c);a.moveToElementText(h);f.setEndPoint("StartToStart",b);f.setEndPoint("EndToEnd",a);f.select()}else{var g=this.getSelection(),f=this.getRangeAt();f.setStartBefore(c);f.setEndAfter(h);g.removeAllRanges();g.addRange(f)}return this.cleanCache()};rteSelection.prototype.selectContents=function(f){var b=this.getRangeAt();if(f&&f.nodeType==1){if($.browser.msie){b.range();b.r.moveToElementText(f.parentNode);b.r.select()}else{try{b.selectNodeContents(f)}catch(c){return}var a=this.getSelection();a.removeAllRanges();a.addRange(b)}}return this};rteSelection.prototype.deleteContents=function(){if(!$.browser.msie){this.getRangeAt().deleteContents()}return this};rteSelection.prototype.insertNode=function(e,c){if(c&&!this.collapsed()){this.collapse()}if($.browser.msie){var b=this.getRangeAt();b.insertNode(e.nodeType==3?e.nodeValue:$("span").append($(e)).html())}else{var b=this.getRangeAt();b.insertNode(e);b.setStartAfter(e);b.setEndAfter(e);var a=this.getSelection();a.removeAllRanges();a.addRange(b)}return this.cleanCache()};rteSelection.prototype.insertHtml=function(a,b){if(b&&!this.collapsed()){this.collapse()}if($.browser.msie){this.getRangeAt().range().pasteHTML(a)}else{var c=$(this.rte.options.doc.create("span")).html(a||"").get(0);this.insertNode(c);$(c).replaceWith($(c).html())}return this.cleanCache()};rteSelection.prototype.insertText=function(b,a){var c=this.rte.options.doc.createTextNode(b);return this.insertHtml(c.nodeValue)};rteSelection.prototype.getBookmark=function(){this.rte.options.win.focus();var a,g,c,p,i,h=this.rte.options.dom,q=h.createBookmark(),j=h.createBookmark(),k=this.rte.options.doc;if($.browser.msie){try{a=this.getSelection().createRange()}catch(j){a=k.body.createTextRange()}if(a.item){var f=a.item(0);a=k.body.createTextRange();a.moveToElementText(f)}g=a.duplicate();c=a.duplicate();p=k.createElement("span");i=k.createElement("span");p.appendChild(q);i.appendChild(j);g.collapse(true);g.pasteHTML(p.innerHTML);c.collapse(false);c.pasteHTML(i.innerHTML)}else{var b=this.getSelection(),a=b&&b.rangeCount>0?b.getRangeAt(0):k.createRange();g=a.cloneRange();c=a.cloneRange();c.collapse(false);c.insertNode(j);g.collapse(true);g.insertNode(q);this.select(q,j)}return[q.id,j.id]};rteSelection.prototype.moveToBookmark=function(a){this.rte.options.win.focus();if(a&&a.length==2){var i=this.rte.options.doc,c=i.getElementById(a[0]),h=i.getElementById(a[1]),g,f;if(c&&h){this.select(c,h);if(this.rte.options.dom.next(c)==h){this.collapse(true)}if(!$.browser.msie){g=this.getSelection();f=g.rangeCount>0?g.getRangeAt(0):i.createRange();g.removeAllRanges();g.addRange(f)}c.parentNode.removeChild(c);h.parentNode.removeChild(h)}}return this};rteSelection.prototype.removeBookmark=function(a){this.rte.options.win.focus();if(a.length==2){var g=this.rte.options.doc,c=g.getElementById(a[0]),f=g.getElementById(a[1]);if(c&&f){c.parentNode.removeChild(c);f.parentNode.removeChild(f)}}};rteSelection.prototype.cleanCache=function(){this.start=this.end=this.node=null;return this};rteSelection.prototype.getStart=function(){if(!this.start){this.start=this.getRangeAt().getStart()}return this.start};rteSelection.prototype.getEnd=function(){if(!this.end){this.end=this.getRangeAt().getEnd()}return this.end};rteSelection.prototype.getNode=function(){if(!this.node){this.node=this.rte.options.dom.findCommonAncestor(this.getStart(),this.getEnd())}return this.node};rteSelection.prototype.selected=function(c){var a={collapsed:false,blocks:false,filter:false,wrap:"text",tag:"span"},h=this.rte.options.dom;a=$.extend({},a,c);if(a.blocks){var g=this.getNode(),f=null;if(f=h.selfOrParent(g,"selectionBlock")){return[f]}}var e=this.selectedRaw(a.collapsed,a.blocks),q=[],j=[],r=null;function b(){function s(){for(var u=0;u<j.length;u++){if(j[u].nodeType==1&&(h.selfOrParent(j[u],/^P$/)||$(j[u]).find("p").length>0)){return false}}return true}if(j.length>0){var i=a.tag=="p"&&!s()?"div":a.tag;var t=h.wrap(j,i);q[r]=t;r=null;j=[]}}function p(t){if(t.nodeType==1){if(/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(t.nodeName)){$(t).find("td,th").each(function(){var u=a.tag=="p"&&$(this).find("p").length>0?"div":a.tag;var v=h.wrapContents(this,u);return q.push(v)})}else{if(/^(CAPTION|TD|TH|LI|DT|DD)$/.test(t.nodeName)){var i=a.tag=="p"&&$(t).find("p").length>0?"div":a.tag;var t=h.wrapContents(t,i);return q.push(t)}}}var s=j.length>0?j[j.length-1]:null;if(s&&s!=h.prev(t)){b()}j.push(t);if(r===null){r=q.length;q.push("dummy")}}if(e.nodes.length>0){for(var k=0;k<e.nodes.length;k++){var g=e.nodes[k];if(g.nodeType==3&&(k==0||k==e.nodes.length-1)&&$.trim(g.nodeValue).length>0){if(k==0&&e.so>0){g=g.splitText(e.so)}if(k==e.nodes.length-1&&e.eo>0){g.splitText(k==0&&e.so>0?e.eo-e.so:e.eo)}}switch(a.wrap){case"text":if((g.nodeType==1&&g.nodeName=="BR")||(g.nodeType==3&&$.trim(g.nodeValue).length>0)){p(g)}else{if(g.nodeType==1){q.push(g)}}break;case"inline":if(h.isInline(g)){p(g)}else{if(g.nodeType==1){q.push(g)}}break;case"all":if(g.nodeType==1||!h.isEmpty(g)){p(g)}break;default:if(g.nodeType==1||!h.isEmpty(g)){q.push(g)}}}b()}if(q.length){this.rte.options.win.focus();this.select(q[0],q[q.length-1])}return a.filter?h.filter(q,a.filter):q};rteSelection.prototype.selectedRaw=function(k,a){var w={so:null,eo:null,nodes:[]};var b=this.getRangeAt(true);var h=b.commonAncestorContainer;var z,v;var u=false;var q=false;var j=this.rte.options.dom;function t(B,r,A){if(B.nodeType==3){A=A>=0?A:B.nodeValue.length;return(r==0&&A==B.nodeValue.length)||$.trim(B.nodeValue).length==$.trim(B.nodeValue.substring(r,A)).length}return true}function i(B,r,A){if(B.nodeType==1){return j.isEmpty(B)}else{if(B.nodeType==3){return $.trim(B.nodeValue.substring(r||0,A>=0?A:B.nodeValue.length)).length==0}}return true}if(b.startContainer.nodeType==1){if(b.startOffset<b.startContainer.childNodes.length){z=b.startContainer.childNodes[b.startOffset];w.so=z.nodeType==1?null:0}else{z=b.startContainer.childNodes[b.startOffset-1];w.so=z.nodeType==1?null:z.nodeValue.length}}else{z=b.startContainer;w.so=b.startOffset}if(b.collapsed){if(k){if(a){z=this.realSelected(z);if(!j.isEmpty(z)||(z=j.next(z))){w.nodes=[z]}if(j.isInline(z)){w.nodes=j.toLineStart(z).concat(w.nodes,j.toLineEnd(z))}if(w.nodes.length>0){w.so=w.nodes[0].nodeType==1?null:0;w.eo=w.nodes[w.nodes.length-1].nodeType==1?null:w.nodes[w.nodes.length-1].nodeValue.length}}else{if(!j.isEmpty(z)){w.nodes=[z]}}}return w}if(b.endContainer.nodeType==1){v=b.endContainer.childNodes[b.endOffset-1];w.eo=v.nodeType==1?null:v.nodeValue.length}else{v=b.endContainer;w.eo=b.endOffset}if(z.nodeType==1||a||t(z,w.so,z.nodeValue.length)){z=this.realSelected(z,h,"left");u=true;w.so=z.nodeType==1?null:0}if(v.nodeType==1||a||t(v,0,w.eo)){v=this.realSelected(v,h,"right");q=true;w.eo=v.nodeType==1?null:v.nodeValue.length}if(a){if(z.nodeType!=1&&z.parentNode!=h&&z.parentNode.nodeName!="BODY"){z=z.parentNode;w.so=null}if(v.nodeType!=1&&v.parentNode!=h&&v.parentNode.nodeName!="BODY"){v=v.parentNode;w.eo=null}}if(z.parentNode==v.parentNode&&z.parentNode.nodeName!="BODY"&&(u&&j.isFirstNotEmpty(z))&&(q&&j.isLastNotEmpty(v))){z=v=z.parentNode;w.so=z.nodeType==1?null:0;w.eo=v.nodeType==1?null:v.nodeValue.length}if(z==v){if(!j.isEmpty(z)){w.nodes.push(z)}return w}var c=z;while(c.nodeName!="BODY"&&c.parentNode!==h&&c.parentNode.nodeName!="BODY"){c=c.parentNode}var x=v;while(x.nodeName!="BODY"&&x.parentNode!==h&&x.parentNode.nodeName!="BODY"){x=x.parentNode}if(!i(z,w.so,z.nodeType==3?z.nodeValue.length:null)){w.nodes.push(z)}var g=z;while(g!==c){var f=g;while((f=j.next(f))){w.nodes.push(f)}g=g.parentNode}g=c;while((g=j.next(g))&&g!=x){w.nodes.push(g)}var p=[];g=v;while(g!==x){var f=g;while((f=j.prev(f))){p.push(f)}g=g.parentNode}if(p.length){w.nodes=w.nodes.concat(p.reverse())}if(!i(v,0,v.nodeType==3?w.eo:null)){w.nodes.push(v)}if(a){if(j.isInline(z)){w.nodes=j.toLineStart(z).concat(w.nodes);w.so=w.nodes[0].nodeType==1?null:0}if(j.isInline(v)){w.nodes=w.nodes.concat(j.toLineEnd(v));w.eo=w.nodes[w.nodes.length-1].nodeType==1?null:w.nodes[w.nodes.length-1].nodeValue.length}}return w};function w3cRange(a){this.win=a;this.r=null;this.collapsed=true;this.startContainer=null;this.endContainer=null;this.startOffset=0;this.endOffset=0;this.commonAncestorContainer=null}w3cRange.prototype.range=function(){doc=this.win.document;try{this.r=doc.selection.createRange()}catch(a){this.r=doc.body.createTextRange()}return this.r};w3cRange.prototype.insertNode=function(a){this.range();this.r.collapse(false);var b=this.r.duplicate();b.pasteHTML(a)};w3cRange.prototype.getBookmark=function(){this.range();if(this.r.item){var a=this.r.item(0);this.r=this.win.document.body.createTextRange();this.r.moveToElementText(a)}return this.r.getBookmark()};w3cRange.prototype.moveToBookmark=function(a){this.win.focus();this.range().moveToBookmark(a);this.r.select()};w3cRange.prototype.update=function(){var b=this,e=this.win.document;function f(v){var h="\uFEFF";var j=offset=0;var q=b.r.duplicate();q.collapse(v);var s=q.parentElement();if(!s||s.nodeName=="HTML"){return{parent:e.body,ndx:j,offset:offset}}q.pasteHTML(h);childs=s.childNodes;for(var k=0;k<childs.length;k++){var u=childs[k];if(k>0&&(u.nodeType!==3||childs[k-1].nodeType!==3)){j++}if(u.nodeType!==3){offset=0}else{var t=u.nodeValue.indexOf(h);if(t!==-1){offset+=t;break}offset+=u.nodeValue.length}}q.moveStart("character",-1);q.text="";return{parent:s,ndx:Math.min(j,s.childNodes.length-1),offset:offset}}this.range();this.startContainer=this.endContainer=null;if(this.r.item){this.collapsed=false;var c=this.r.item(0);this.setStart(c.parentNode,$(c).index());this.setEnd(c.parentNode,this.startOffset+1)}else{this.collapsed=this.r.boundingWidth==0;var g=f(true),a=f(false);g.parent.normalize();a.parent.normalize();g.ndx=Math.min(g.ndx,g.parent.childNodes.length-1);a.ndx=Math.min(a.ndx,a.parent.childNodes.length-1);if(g.parent.childNodes[g.ndx].nodeType&&g.parent.childNodes[g.ndx].nodeType==1){this.setStart(g.parent,g.ndx)}else{this.setStart(g.parent.childNodes[g.ndx],g.offset)}if(a.parent.childNodes[a.ndx].nodeType&&a.parent.childNodes[a.ndx].nodeType==1){this.setEnd(a.parent,a.ndx)}else{this.setEnd(a.parent.childNodes[a.ndx],a.offset)}this.select()}return this};w3cRange.prototype.isCollapsed=function(){this.range();this.collapsed=this.r.item?false:this.r.boundingWidth==0;return this.collapsed};w3cRange.prototype.collapse=function(a){this.range();if(this.r.item){var b=this.r.item(0);this.r=this.win.document.body.createTextRange();this.r.moveToElementText(b)}this.r.collapse(a);this.r.select();this.collapsed=true};w3cRange.prototype.getStart=function(){this.range();if(this.r.item){return this.r.item(0)}var b=this.r.duplicate();b.collapse(true);var a=b.parentElement();return a&&a.nodeName=="BODY"?a.firstChild:a};w3cRange.prototype.getEnd=function(){this.range();if(this.r.item){return this.r.item(0)}var a=this.r.duplicate();a.collapse(false);var b=a.parentElement();return b&&b.nodeName=="BODY"?b.lastChild:b};w3cRange.prototype.setStart=function(a,b){this.startContainer=a;this.startOffset=b;if(this.endContainer){this.commonAncestorContainer=this.findCommonAncestor(this.startContainer,this.endContainer)}};w3cRange.prototype.setEnd=function(a,b){this.endContainer=a;this.endOffset=b;if(this.startContainer){this.commonAncestorContainer=this.findCommonAncestor(this.startContainer,this.endContainer)}};w3cRange.prototype.setStartBefore=function(a){if(a.parentNode){this.setStart(a.parentNode,$(a).index())}};w3cRange.prototype.setStartAfter=function(a){if(a.parentNode){this.setStart(a.parentNode,$(a).index()+1)}};w3cRange.prototype.setEndBefore=function(a){if(a.parentNode){this.setEnd(a.parentNode,$(a).index())}};w3cRange.prototype.setEndAfter=function(a){if(a.parentNode){this.setEnd(a.parentNode,$(a).index()+1)}};w3cRange.prototype.select=function(){var i=this.win.document.body;function h(w,u){if(w.nodeType!=3){return -1}var v="\uFEFF",t=w.nodeValue,e=i.createTextRange();w.nodeValue=t.substring(0,u)+v+t.substring(u);e.moveToElementText(w.parentNode);e.findText(v);var s=Math.abs(e.moveStart("character",-1048575));w.nodeValue=t;return s}this.r=i.createTextRange();var g=this.startOffset,b=this.endOffset;var q=this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(g,this.startContainer.childNodes.length-1)]:this.startContainer;var j=this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(g==b?b:b-1,this.endContainer.childNodes.length-1)]:this.endContainer;if(this.collapsed){if(q.nodeType==3){var f=h(q,g);this.r.move("character",f)}else{this.r.moveToElementText(q);this.r.collapse(true)}}else{var a=i.createTextRange();var c=h(q,g);var k=h(j,b);if(q.nodeType==3){this.r.move("character",c)}else{this.r.moveToElementText(q)}if(j.nodeType==3){a.move("character",k)}else{a.moveToElementText(j)}this.r.setEndPoint("EndToEnd",a)}try{this.r.select()}catch(j){}if(a){a=null}};w3cRange.prototype.findCommonAncestor=function(f,e){if(!f||!e){return}if(f==e){return f}else{if(f.nodeName=="BODY"||e.nodeName=="BODY"){return doc.body}}var h=$(f).parents(),g=$(e).parents(),a=g.length-1,j=g[a];for(var b=h.length-1;b>=0;b--,a--){if(h[b]==g[a]){j=h[b]}else{break}}return j};if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/* JsRender v1.0pre: http://github.com/BorisMoore/jsrender */
(function(a,D,u){if(D&&D.views||a.jsviews){return}var an="v1.0pre",S,aj,z,E,s="{",r="{",h="}",g="}",af="^",F=/^(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,ag=/(\()(?=\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*((\))(?=\s*\.|\s*\^)|\)|\])([([]?))|(\s+)/g,aa=/\s*\n/g,f=/\\(['"])/g,al=/([\\'"])/g,t=/\x08(~)?([^\x08]+)\x08/g,k=/^if\s/,w=/<(\w+)[>\s]/,U=/<(\w+)[^>\/]*>[^>]*$/,V=/[<"'&]/g,Q=/[><"'&]/g,ao=0,am=0,R={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;"},ad="data-jsv-tmpl",x=[].slice,W={},Z={template:{compile:b},tag:{compile:v},helper:{},converter:{}},T={jsviews:an,render:W,View:ak,settings:{delimiters:B,debugMode:true,tryCatch:true},sub:{Error:K,tmplFn:I,parse:C,extend:A,error:M,syntaxError:Y},_cnvt:N,_tag:c,_err:function(ap){return ab.debugMode?("Error: "+(ap.message||ap))+". ":""}};function K(aq,ap){if(ap&&ap.onError){if(ap.onError(aq)===false){return}}this.name="JsRender Error";this.message=aq||"JsRender error"}function A(ar,aq){var ap;ar=ar||{};for(ap in aq){ar[ap]=aq[ap]}return ar}(K.prototype=new Error()).constructor=K;function B(ap,ar,aq){if(!ac.rTag||arguments.length){s=ap?ap.charAt(0):s;r=ap?ap.charAt(1):r;h=ar?ar.charAt(0):h;g=ar?ar.charAt(1):g;af=aq||af;ap="\\"+s+"(\\"+af+")?\\"+r;ar="\\"+h+"\\"+g;z="(?:(?:(\\w+(?=[\\/\\s\\"+h+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+h+"]|\\"+h+"(?!\\"+g+"))*?)";ac.rTag=z+")";z=new RegExp(ap+z+"(\\/)?|(?:\\/(\\w+)))"+ar,"g");E=new RegExp("<.*>|([^\\\\]|^)[{}]|"+ap+".*"+ar)}return[s,r,h,g,af]}function P(au,aw){if(!aw){aw=au;au=u}var at,av,ar,ax,aq=this,ap=!aw||aw==="root";if(au){ax=aq.type===aw?aq:u;if(!ax){at=aq.views;if(aq._.useKey){for(av in at){if(ax=at[av].get(au,aw)){break}}}else{for(av=0,ar=at.length;!ax&&av<ar;av++){ax=at[av].get(au,aw)}}}}else{if(ap){while(aq.parent.parent){ax=aq=aq.parent}}else{while(aq&&!ax){ax=aq.type===aw?aq:u;aq=aq.parent}}}return ax}function O(){var ap=this.get("item");return ap?ap.index:u}O.depends=function(){return[this.get("item"),"index"]};function ae(at){var aq,ap=this,ar=(ap.ctx||{})[at];ar=ar===u?ap.getRsc("helpers",at):ar;if(ar){if(typeof ar==="function"){aq=function(){return ar.apply(ap,arguments)};A(aq,ar)}}return aq||ar}function N(av,at,au){var ar,aq,ax,aw=+au===au&&au,ap=at.linkCtx;if(aw){au=(aw=at.tmpl.bnds[aw-1])(at.data,at,T)}ax=au.args[0];if(av||aw){aq=ap&&ap.tag||{_:{inline:!ap},tagName:av+":",flow:true,_is:"tag"};aq._.bnd=aw;if(ap){ap.tag=aq;aq.linkCtx=ap;au.ctx=ai(au.ctx,ap.view.ctx)}aq.tagCtx=au;au.view=at;aq.ctx=au.ctx||{};delete au.ctx;at._.tag=aq;av=av!=="true"&&av;if(av&&((ar=at.getRsc("converters",av))||M("Unknown converter: {{"+av+":"))){aq.depends=ar.depends;ax=ar.apply(aq,au.args)}ax=aw&&at._.onRender?at._.onRender(ax,at,aw):ax;at._.tag=u}return ax}function G(ar,au){var at,ap=this,aq=T[ar];at=aq&&aq[au];while((at===u)&&ap){aq=ap.tmpl[ar];at=aq&&aq[au];ap=ap.parent}return at}function c(ar,au,ax,ay){var aM,aN,aA,aC,aK,aG,aH,aE,aJ,az,ap,aF,aI,aw,aL="",av=+ay===ay&&ay,at=au.linkCtx||0,aD=au.ctx,aq=ax||au.tmpl,aB=au._;if(ar._is==="tag"){aN=ar;ar=aN.tagName}if(av){ay=(aI=aq.bnds[av-1])(au.data,au,T)}aE=ay.length;aN=aN||at.tag;for(aH=0;aH<aE;aH++){az=ay[aH];aF=az.tmpl;aF=az.content=aF&&aq.tmpls[aF-1];ax=az.props.tmpl;if(!aH&&(!ax||!aN)){aw=au.getRsc("tags",ar)||M("Unknown tag: {{"+ar+"}}")}ax=ax||!aH&&aw.template||aF;ax=""+ax===ax?au.getRsc("templates",ax)||L(ax):ax;A(az,{tmpl:ax,render:q,index:aH,view:au,ctx:ai(az.ctx,aD)});if(!aN){if(aw.init){aN=new aw.init(az,at,aD);aN.attr=aN.attr||aw.attr||u}else{aN={render:aw.render}}aN._={inline:!at};if(at){at.attr=aN.attr=at.attr||aN.attr;at.tag=aN;aN.linkCtx=at}if(aN._.bnd=aI||at){aN._.arrVws={}}aN.tagName=ar;aN.parent=aG=aD&&aD.tag,aN._is="tag"}aB.tag=aN;az.tag=aN;aN.tagCtxs=ay;aN.rendering={};if(!aN.flow){ap=az.ctx=az.ctx||{};aA=ap.parentTags=aD&&ai(ap.parentTags,aD.parentTags)||{};if(aG){aA[aG.tagName]=aG}ap.tag=aN}}for(aH=0;aH<aE;aH++){az=aN.tagCtx=ay[aH];aN.ctx=az.ctx;if(aM=aN.render){aJ=aM.apply(aN,az.args)}aL+=aJ!==u?aJ:az.tmpl?az.render():""}delete aN.rendering;aN.tagCtx=aN.tagCtxs[0];aN.ctx=aN.tagCtx.ctx;if(aN._.inline&&(aC=aN.attr)&&aC!=="html"){aL=aC==="text"?ah.html(aL):""}return aL=av&&au._.onRender?au._.onRender(aL,au,av):aL}function ak(ap,av,aB,aq,aw,ax,aA,aD){var ay,au,aC,at=av==="array",ar={key:0,useKey:at?0:1,id:""+am++,onRender:aD,bnds:{}},az={data:aq,tmpl:aw,content:aA,views:at?[]:{},parent:aB,ctx:ap,type:av,get:P,getIndex:O,getRsc:G,hlp:ae,_:ar,_is:"view"};if(aB){ay=aB.views;au=aB._;if(au.useKey){ay[ar.key="_"+au.useKey++]=az;aC=au.tag;ar.bnd=at&&(!aC||!!aC._.bnd&&aC)}else{ay.splice(ar.key=az.index=ax!==u?ax:ay.length,0,az)}az.ctx=ap||aB.ctx}return az}function p(au){var ap,av,aq,ar,at;for(ap in Z){ar=Z[ap];if((at=ar.compile)&&(av=au[ap+"s"])){for(aq in av){av[aq]=at(aq,av[aq],au,ap,ar)}}}}function v(aq,ar,at){var au,ap;if(typeof ar==="function"){ar={depends:ar.depends,render:ar}}else{if(ap=ar.template){ar.template=""+ap===ap?(L[ap]||L(ap)):ap}if(ar.init!==false){au=ar.init=ar.init||function(av){};au.prototype=ar;(au.prototype=ar).constructor=au}}if(at){ar._parentTmpl=at}return ar}function b(ap,aw,ax,av,aq,ay){function at(az){if((""+az===az)||az.nodeType>0){try{ar=az.nodeType>0?az:!E.test(az)&&D&&D(a.document).find(az)[0]}catch(aA){}if(ar){az=ar.getAttribute(ad);ap=ap||az;az=L[az];if(!az){ap=ap||"_"+ao++;ar.setAttribute(ad,ap);az=L[ap]=b(ap,ar.innerHTML,ax,av,aq,ay)}}return az}}var au,ar;aw=aw||"";au=at(aw);ay=ay||(aw.markup?aw:{});ay.tmplName=ap;if(ax){ay._parentTmpl=ax}if(!au&&aw.markup&&(au=at(aw.markup))){if(au.fn&&(au.debug!==aw.debug||au.allowCode!==aw.allowCode)){au=au.markup}}if(au!==u){if(ap&&!ax){W[ap]=function(){return aw.render.apply(aw,arguments)}}if(au.fn||aw.fn){if(au.fn){if(ap&&ap!==au.tmplName){aw=ai(ay,au)}else{aw=au}}}else{aw=i(au,ay);I(au,aw)}p(ay);return aw}}function i(at,au){var ap,aq=ab.wrapMap||{},ar=A({markup:at,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:q},au);if(!au.htmlTag){ap=w.exec(at);ar.htmlTag=ap?ap[1].toLowerCase():""}ap=aq[ar.htmlTag];if(ap&&ap!==aq.div){ar.markup=S.trim(ar.markup);ar._elCnt=true}return ar}function e(ar,aq){function at(au,aw,aA){var av,az,ay,ax;if(au&&""+au!==au&&!au.nodeType&&!au.markup){for(ay in au){at(ay,au[ay],aw)}return T}ax=aA?aA[ap]=aA[ap]||{}:at;if(aw===u){aw=au;au=u}az=aq.compile;if(av=ac.onBeforeStoreItem){az=av(ax,au,aw,az)||az}if(!au){aw=az(u,aw)}else{if(""+au===au){if(aw===null){delete ax[au]}else{ax[au]=az?(aw=az(au,aw,aA,ar,aq)):aw}}}if(aw){aw._is=ar}if(av=ac.onStoreItem){av(ax,au,aw,az)}return aw}var ap=ar+"s";T[ap]=at;Z[ar]=aq}function q(aK,ar,at,aL,av,au){var aF,aE,ax,aH,aJ,aC,aB,ay,aq,aI,aG,ap,aw,aD=this,aA=!aD.attr||aD.attr==="html",az="";if(aL===true){aB=true;aL=0}if(aD.tag){ay=aD;aD=aD.tag;aI=aD._;ap=aD.tagName;aw=ay.tmpl;ar=ai(ar,aD.ctx);aq=ay.content;if(ay.props.link===false){ar=ar||{};ar.link=false}at=at||ay.view;aK=aK===u?at:aK}else{aw=aD.jquery&&(aD[0]||M('Unknown template: "'+aD.selector+'"'))||aD}if(aw){if(!at&&aK&&aK._is==="view"){at=aK}if(at){aq=aq||at.content;au=au||at._.onRender;if(aK===at){aK=at.data;av=true}ar=ai(ar,at.ctx)}if(!at||at.data===u){(ar=ar||{}).root=aK}if(!aw.fn){aw=L[aw]||L(aw)}if(aw){au=(ar&&ar.link)!==false&&aA&&au;aG=au;if(au===true){aG=u;au=at._.onRender}if(S.isArray(aK)&&!av){aH=aB?at:(aL!==u&&at)||ak(ar,"array",at,aK,aw,aL,aq,au);for(aF=0,aE=aK.length;aF<aE;aF++){ax=aK[aF];aJ=ak(ar,"item",aH,ax,aw,(aL||0)+aF,aq,au);aC=aw.fn(ax,aJ,T);az+=aH._.onRender?aH._.onRender(aC,aJ):aC}}else{aH=aB?at:ak(ar,ap||"data",at,aK,aw,aL,aq,au);if(aI&&!aD.flow){aH.tag=aD}az+=aw.fn(aK,aH,T)}return aG?aG(az,aH):az}}return""}function M(ap){if(ab.debugMode){throw new T.sub.Error(ap)}}function Y(ap){M("Syntax error\n"+ap)}function I(aD,az,aC,av){function ar(aE){aE-=au;if(aE){ax.push(aD.substr(au,aE).replace(aa,"\\n"))}}function aB(aE){aE&&Y('Unmatched or missing tag: "{{/'+aE+'}}" in template:\n'+aD)}function ap(aI,aW,aJ,aT,aR,aM,aG,aQ,aS,aO,aV,aK){if(aM){aR=":";aT="html"}aO=aO||aC;var aE,aN,aU=aW&&[],aF="",aH="",aP="",aL=!aO&&!aR&&!aG;aJ=aJ||aR;ar(aK);au=aK+aI.length;if(aQ){if(at){ax.push(["*","\n"+aS.replace(f,"$1")+"\n"])}}else{if(aJ){if(aJ==="else"){if(k.test(aS)){Y('for "{{else if expr}}" use "{{else expr}}"')}aU=aw[6];aw[7]=aD.substring(aw[7],aK);aw=ay.pop();ax=aw[3];aL=true}if(aS){aS=aS.replace(aa," ");aF=C(aS,aU).replace(t,function(aX,aY,aZ){if(aY){aP+=aZ+","}else{aH+=aZ+","}return""})}aH=aH.slice(0,-1);aF=aF.slice(0,-1);aE=aH&&(aH.indexOf("noerror:true")+1)&&aH||"";aA=[aJ,aT||!!av||"",aF,aL&&[],'params:"'+aS+'",props:{'+aH+"}"+(aP?",ctx:{"+aP.slice(0,-1)+"}":""),aE,aU||0];ax.push(aA);if(aL){ay.push(aw);aw=aA;aw[7]=au}}else{if(aV){aN=aw[0];aB(aV!==aN&&aN!=="else"&&aV);aw[7]=aD.substring(aw[7],aK);aw=ay.pop()}}}aB(!aw&&aV);ax=aw[3]}var aA,at=az&&az.allowCode,aq=[],au=0,ay=[],ax=aq,aw=[,,,aq];aD=aD.replace(al,"\\$1");aB(ay[0]&&ay[0][3].pop()[0]);aD.replace(z,ap);ar(aD.length);if(au=aq[aq.length-1]){aB(""+au!==au&&(+au[7]===au[7])&&au[0])}return H(aq,az||aD,aC)}function H(ap,aC,aw){var aW,aI,aD,aG,ar,aQ,aV,aJ,at,aX,aP,aF,ax,aA,aB,aN,au,aH,aM,ay,aO,aq,a0,aK,aZ,aE,aL,aT,az=0,av="",aR="",aU={},aS=ap.length;if(""+aC===aC){aN=aw?'data-link="'+aC.replace(aa," ").slice(1,-1)+'"':aC;aC=0}else{aN=aC.tmplName||"unnamed";if(aM=aC.allowCode){aU.allowCode=true}if(aC.debug){aU.debug=true}aP=aC.bnds;aB=aC.tmpls}for(aW=0;aW<aS;aW++){aI=ap[aW];if(""+aI===aI){av+='\nret+="'+aI+'";'}else{aD=aI[0];if(aD==="*"){av+=""+aI[1]}else{aG=aI[1];ar=aI[2];ay=aI[3];aQ=aI[4];aR=aI[5];aO=aI[7];if(!(aZ=aD==="else")){az=0;if(aP&&(aF=aI[6])){az=aP.push(aF)}}if(aE=aD===":"){if(aG){aD=aG==="html"?">":aG+aD}if(aR){aL="prm"+aW;aR="try{var "+aL+"=["+ar+"][0];}catch(e){"+aL+'="";}\n';ar=aL}}else{if(ay){au=i(aO,aU);au.tmplName=aN+"/"+aD;H(ay,au);aB.push(au)}if(!aZ){aH=aD;aK=av;av="";ax=aW}a0=ap[aW+1];a0=a0&&a0[0]==="else"}aQ+=",args:["+ar+"]}";if(aE&&aF||aG&&aD!==">"){aT=new Function("data,view,j,u"," // "+aN+" "+az+" "+aD+"\n"+aR+"return {"+aQ+";");aT.paths=aF;aT._ctxs=aD;if(aw){return aT}aX=true}av+=(aE?"\n"+(aF?"":aR)+(aw?"return ":"ret+=")+(aX?(aX=true,'c("'+aG+'",view,'+(aF?((aP[az-1]=aT),az):"{"+aQ)+");"):aD===">"?(aJ=true,"h("+ar+");"):(at=true,"(v="+ar+")!="+(aw?"=":"")+'u?v:"";')):(aV=true,"{tmpl:"+(ay?aB.length:"0")+","+aQ+","));if(aH&&!a0){av="["+av.slice(0,-1)+"]";if(aw||aF){av=new Function("data,view,j,u"," // "+aN+" "+az+" "+aH+"\nreturn "+av+";");if(aF){(aP[az-1]=av).paths=aF}av._ctxs=aD;if(aw){return av}}av=aK+'\nret+=t("'+aH+'",view,this,'+(az||av)+");";aF=0;aH=0}}}}av="// "+aN+"\nvar j=j||"+(D?"jQuery.":"js")+"views"+(at?",v":"")+(aV?",t=j._tag":"")+(aX?",c=j._cnvt":"")+(aJ?",h=j.converters.html":"")+(aw?";\n":',ret="";\n')+(ab.tryCatch?"try{\n":"")+(aU.debug?"debugger;":"")+av+(aw?"\n":"\nreturn ret;\n")+(ab.tryCatch?"\n}catch(e){return j._err(e);}":"");try{av=new Function("data,view,j,u",av)}catch(aY){Y("Compiled template code:\n\n"+av,aY)}if(aC){aC.fn=av}return av}function C(au,aq){function az(aB,aT,aD,aL,aI,aE,aU,aA,aJ,aS,aR,aN,aQ,aG,aO,aC,aP,aF,aH){aI=aI||"";aD=aD||aT||aR;aL=aL||aA;if(aq&&aO){aq.push({_jsvOb:aH.slice(ay[ar-1]+1,aF+1)})}aJ=aJ||aC||"";function aM(aY,aX,a0,aV,a2,a1,aZ){if(aX){aq&&!aw&&aq.push(aL);if(aX!=="."){var aW=(a0?'view.hlp("'+a0+'")':aV?"view":"data")+(aZ?(a2?"."+a2:a0?"":(aV?"":"."+aX))+(a1||""):(aZ=a0?"":aV?a2||"":aX,""));aW=aW+(aZ?"."+aZ:"");return aW.slice(0,9)==="view.data"?aW.slice(5):aW}}return aY}if(aE){Y(au)}else{var aK=(ax?(ax=!aN,(ax?aB:'"')):at?(at=!aQ,(at?aB:'"')):((aD?(ar++,ay[ar]=aF,aD):"")+(aP?(ar?"":av?(av=aw=false,"\b"):","):aU?(ar&&Y(au),av=aL,aw=aL.charAt(0)==="~","\b"+aL+":"):aL?(aL.split("^").join(".").replace(F,aM)+(aJ?(ap[++ar]=true,aJ):aI)):aI?aI:aG?((ap[ar--]=false,aG)+(aJ?(ap[++ar]=true,aJ):"")):aS?(ap[ar]||Y(au),","):aT?"":(ax=aN,at=aQ,'"'))));return aK}}var av,aw,ap={},ay={0:-1},ar=0,at=false,ax=false;return(au+" ").replace(ag,az)}function ai(aq,ap){return aq&&aq!==ap?(ap?A(A({},ap),aq):aq):ap&&A({},ap)}for(aj in Z){e(aj,Z[aj])}var L=T.templates,ah=T.converters,J=T.helpers,X=T.tags,ac=T.sub,ab=T.settings;if(D){S=D;S.fn.render=q}else{S=a.jsviews={};S.isArray=Array&&Array.isArray||function(ap){return Object.prototype.toString.call(ap)==="[object Array]"}}S.render=W;S.views=T;S.templates=L=T.templates;X({"else":function(){},"if":{render:function(ar){var ap=this,aq=(ap.rendering.done||!ar&&(arguments.length||!ap.tagCtx.index))?"":(ap.rendering.done=true,ap.selected=ap.tagCtx.index,ap.tagCtx.render());return aq},onUpdate:function(au,at,ar){var aq,ap,av;for(aq=0;(ap=this.tagCtxs[aq])&&ap.args.length;aq++){ap=ap.args[0];av=!ap!==!ar[aq].args[0];if(!!ap||av){return av}}return false},flow:true},"for":{render:function(ax){var aw,aq,au=this,at=au.tagCtx,av=!arguments.length,ap="",ar=av||0;if(!au.rendering.done){if(av){ap=u}else{if(ax!==u){ap+=at.render(ax);ar+=S.isArray(ax)?ax.length:1}}if(au.rendering.done=ar){au.selected=at.index}}return ap},onUpdate:function(ar,aq,ap){},onArrayChange:function(at,aq){var ar,ap=this,au=aq.change;if(this.tagCtxs[1]&&(au==="insert"&&at.target.length===aq.items.length||au==="remove"&&!at.target.length||au==="refresh"&&!aq.oldItems.length!==!at.target.length)){this.refresh()}else{for(ar in ap._.arrVws){ar=ap._.arrVws[ar];if(ar.data===at.target){ar._.onArrayChange.apply(ar,arguments)}}}at.done=true},flow:true},include:{flow:true},"*":{render:function(ap){return ap},flow:true}});function j(ap){return R[ap]}ah({html:function(ap){return ap!=u?String(ap).replace(Q,j):""},attr:function(ap){return ap!=u?String(ap).replace(V,j):ap===null?null:""},url:function(ap){return ap!=u?encodeURI(String(ap)):ap===null?null:""}});B()})(this,this.jQuery);
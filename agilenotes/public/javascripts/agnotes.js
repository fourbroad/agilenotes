/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
 * This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
var Model={ADMINDBID:"000000000000000000000000",META:"000000000000000000000001",FORM:"000000000000000000000002",VIEW:"000000000000000000000003",PAGE:"000000000000000000000004",TASK:"000000000000000000000005",USER:"000000000000000000000006",OU:"000000000000000000000007",GROUP:"000000000000000000000008",ROLE:"000000000000000000000009",SIDE_VIEW:"00000000000000000000000a",VALIDATE_METHOD:"00000000000000000000000c",EXTENSION_POINT:"00000000000000000000000d",CATEGORY:"00000000000000000000000e",DATABASE:"00000000000000000000000f",META_ROOT:"0000000000000000000e0001",FORM_ROOT:"0000000000000000000e0002",VIEW_ROOT:"0000000000000000000e0003",PAGE_ROOT:"0000000000000000000e0004",TASK_ROOT:"0000000000000000000e0005",OU_ROOT:"0000000000000000000e0007",GROUP_ROOT:"0000000000000000000e0008",ROLE_ROOT:"0000000000000000000e0009",SIDE_VIEW_ROOT:"0000000000000000000e000a",EXTENSION_ROOT:"0000000000000000000e000b",DATABASE_ROOT:"0000000000000000000e000f",dbs:{},types:{},pages:{},views:{},sideViews:{},extension:{},rootId:function(a){if(a==this.META){return this.META_ROOT}else{if(a==this.FORM){return this.FORM_ROOT}else{if(a==this.VIEW){return this.VIEW_ROOT}else{if(a==this.PAGE){return this.PAGE_ROOT}else{if(a==this.TASK){return this.TASK_ROOT}else{if(a==this.OU||a==this.USER){return this.OU_ROOT}else{if(a==this.GROUP){return this.GROUP_ROOT}else{if(a==this.ROLE){return this.ROLE_ROOT}else{if(a==this.SIDE_VIEW){return this.SIDE_VIEW_ROOT}else{if(a==this.EXTENSION_POINT){return this.EXTENSION_ROOT}else{if(a==this.DATABASE){return this.DATABASE_ROOT}}}}}}}}}}}},getDb:function(b,e){if(this.dbs[b]){e(null,this.dbs[b])}else{var a=this;$.ans.getDB(b,null,function(g,f){if(f){a.dbs[b]=f}e(g,f)})}},getPages:function(h,a,k){var p=this,b={$or:[]},e=[],j;for(var i in a){j=this.pages[a[i]];if(j){e.push(j)}else{b.$or.push({_id:a[i]})}}function g(u,f){var t=[];if(f.length>0){for(var r in u){for(var q in f){if(f[q]._id==u[r]){var s=f[q].type;if(s==Model.PAGE||s==Model.FORM){t.push(f[q]);p.pages[f[q]._id]=f[q]}break}}}}return t}if(b.$or.length>0){$.ans.getDoc(h,null,{selector:b},function(f,q){k(f,g(a,e.concat(q.docs)))})}else{k(null,g(a,e))}},loadExtensions:function(b,g,h){var a=this,f={$or:[]},e={};$.each(g,function(){if(a.extension[b]&&a.extension[b][this]){e[this]=a.extension[b][this]}else{f.$or.push({extensionPoint:this})}});if(f.$or.length>0){$.ans.getDoc(b,null,{selector:f},function(i,j){if(j){$.each(j.docs,function(){a.extension[b]=a.extension[b]||{};a.extension[b][this.extensionPoint]=e[this.extensionPoint]=e[this.extensionPoint]||[];e[this.extensionPoint].push(this)})}h(i,e)})}else{h(null,e)}},newDocument:function(g,f,h,i){i=i||{};i.isNew=true;var e=this,b=Model.rootId(h),j=$.extend(true,{},i["default"],{_id:i.id||new ObjectId().toString(),type:h});if(j._path){j._path=j._path.replace(/[^,]+,$/,j._id+",")}else{if(b){j._path=b+","+j._id+","}}function a(k){if(k.type==e.FORM||k.type==e.PAGE){k.content=k.content||"";e._doOpenPage(g,f,k,$.extend(true,{mode:"design"},i))}else{if(k.type==e.VIEW){k.viewType=i.viewType;e._doOpenView(g,f,k,$.extend(true,{mode:"design"},i))}else{e._doOpenDocument(g,f,k,$.extend(true,{mode:"edit"},i))}}}if($.type(i.parent)=="string"){$.ans.getDoc(f,i.parent,null,function(k,q){if(k){console.log("Get parent document "+i.parent+" error:"+k)}else{if(q&&q._path){j._path=q._path+j._id+","}a(j)}})}else{if(i.parent&&i.parent._path){j._path=i.parent._path+j._id+","}a(j)}},_doOpenDocument:function(element,dbId,doc,opts){var optsx=$.extend(true,{title:opts.title||doc.title||doc.name||doc._id,dbId:dbId,document:doc,isDocumentEditor:true},opts),self=this;if(optsx.formIds){this.getPages(dbId,optsx.formIds,function(err,forms){if(err){console.log("Load forms "+optsx.formIds+" error: "+err)}else{optsx.forms=forms;element.editor(optsx);optsx.opened&&optsx.opened(element.data("editor"))}})}else{var type=this.types[doc.type];function openEditor(type){if(optsx.isNew){var obj=type.defaultValues||"{}";$.extend(true,optsx.document,eval("("+obj+")"))}self.getPages(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{optsx.mobile=doc.mobile;optsx.forms=forms;element.editor(optsx);opts.opened&&opts.opened(element.data("editor"))}})}if(type){openEditor(type)}else{$.ans.getDoc(dbId,doc.type,null,function(err,type){if(err||!type){console.log("Load document type "+doc.type+" error: "+err)}else{self.types[doc.type]=type;openEditor(type)}})}}},openDocument:function(f,b,e,g){g=g||{};var a=this;if(!e&&g.document){this._doOpenDocument(f,b,g.document,g)}else{$.ans.getDoc(b,e,null,function(h,i){if(h){console.log("Load document "+e+" error: "+h)}else{a._doOpenDocument(f,b,i,g)}})}},_doOpenPage:function(element,dbId,page,opts){var self=this,title=opts.title||page.title||page.name||page._id,type=this.types[page.type];function openEditor(type){if(opts.mode=="design"){self.getPages(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{if(opts.isNew){$.extend(true,page,eval("("+type.defaultValues+")"||"{}"))}element.editor($.extend(true,{title:title,dbId:dbId,document:page,forms:forms,design:true},$.extend(true,{},opts,{mode:"edit"})));opts.opened&&opts.opened(element.data("editor"))}})}else{if(page.type==Model.PAGE){if(opts.mobile){element.mpage($.extend(true,{title:title,dbId:dbId,page:page,mobile:true},opts));opts.opened&&opts.opened(element.data("mpage"))}else{element.page($.extend(true,{title:title,dbId:dbId,page:page},opts));opts.opened&&opts.opened(element.data("page"))}}else{if(page.type==Model.FORM){var doc={};if(opts.isNew){$.extend(true,doc,eval("("+type.defaultValues+")"||"{}"))}element.editor($.extend(true,{title:title,dbId:dbId,document:doc,forms:[page]},opts));opts.opened&&opts.opened(element.data("editor"))}}}}if(type){openEditor(type)}else{$.ans.getDoc(dbId,page.type,null,function(err,type){if(err){console.log("Load document type "+page.type+" error: "+err)}else{self.types[page.type]=type;openEditor(type)}})}},openPage:function(f,e,b,g){g=g||{};var a=this;if(this.pages[b]){g.mobile=this.pages[b].mobile;this._doOpenPage(f,e,this.pages[b],g)}else{$.ans.getDoc(e,b,null,function(h,i){if(h){console.log("Load page "+b+" error: "+h)}else{a.pages[b]=i;g.mobile=i.mobile;a._doOpenPage(f,e,i,g)}})}},_doOpenView:function(element,dbId,view,opts){var self=this;function openView(element,dbId,viewDoc,opts){var title=viewDoc.title||viewDoc.name||viewDoc._id,vt=viewDoc.viewType||"gridview";vt=vt.toLowerCase();if(opts.mode=="design"){function openEditor(type){if(opts.isNew){$.extend(true,viewDoc,eval("("+type.defaultValues+")"||"{}"))}self.getPages(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{if(opts.mobile){var cb=viewDoc.viewType;if(cb=="mobilelistview"){element.mobilelistview({view:viewDoc,dbId:dbId,mode:"design"})}else{if(cb=="customview"){element.customview({view:viewDoc,dbId:dbId,mode:"design"})}else{element.view({view:viewDoc,dbId:dbId,mode:"design"})}}opts.opened&&opts.opened(element.data(cb))}else{element.editor($.extend(true,{title:title,dbId:dbId,document:viewDoc,forms:forms,design:true,isViewEditor:true},$.extend(true,{},opts,{mode:"edit"})));opts.opened&&opts.opened(element.data("editor"))}}})}var type=self.types[viewDoc.type];if(type){openEditor(type)}else{$.ans.getDoc(dbId,viewDoc.type,null,function(err,type){if(err){console.log("Load document type "+viewDoc.type+" error: "+err)}else{self.types[viewDoc.type]=type;openEditor(type)}})}}else{vt=(vt=="customizedview"?"view":vt);element[vt]($.extend(true,{title:title,dbId:dbId,view:viewDoc,isViewEditor:true},opts));opts.opened&&opts.opened(element.data(vt))}}if(view.viewType=="formView"){var form=this.pages[view.formId];if(form){opts.form=form;openView(element,dbId,view,opts)}else{$.ans.getDoc(dbId,view.formId,null,function(err,form){if(err){console.log("Load form "+view.formId+" error: "+err)}else{opts.form=self.pages[view.formId]=form;openView(element,dbId,view,opts)}})}}else{openView(element,dbId,view,opts)}},openView:function(g,f,a,h){h=h||{};var e=this,b=this.views[a];if(b){this._doOpenView(g,f,b,h)}else{$.ans.getDoc(f,a,null,function(j,i){if(j){console.log("Load view "+a+" error: "+j)}else{e.views[a]=i;e._doOpenView(g,f,i,h)}})}},_doOpenSideView:function(e,b,a,f){if(a){e.sideview($.extend(true,{dbId:b},a,f));f.opened&&f.opened(e.data("sideview"))}},openSideView:function(f,e,g,h){h=h||{};var b=this,a=this.sideViews[g];if(a){this._doOpenSideView(f,e,a,h)}else{$.ans.getDoc(e,g,null,function(j,i){if(j){console.log("Load side view "+g+" error: "+j)}else{b.sideViews[g]=i;b._doOpenSideView(f,e,i,h)}})}},postDocument:function(a,e,b,f){$.ans.postDoc(a,e,b,f)},updateDocument:function(b,e,a,f,g){this._cleanCache(e);$.ans.putDoc(b,e,a,f,g)},deleteDocument:function(a,e,b,f){this._cleanCache(e);$.ans.delDoc(a,e,b,f)},_cleanCache:function(a){delete this.types[a];delete this.pages[a];delete this.views[a];delete this.sideViews[a]}};function DocWrapper(doc,parseDot){this._doc=doc;this._parseDot=parseDot;this.setDoc=function(doc){var oldDoc=this._doc;this._doc=doc;$(this).trigger("docchanged",[doc,oldDoc])};this.getDoc=function(){return this._doc};this.prop=function(id,value,isTransient){if(!id){return null}if(value===undefined){try{return eval("this._doc."+id)}catch(e){}}else{var oldValue=this.prop(id);if(value==oldValue){return this}if(this._parseDot){var parts=id.split(".");function assign(doc,parts,val){var part=parts.shift(),r=part.match(/([a-zA-Z0-9_]+)\[([0-9]+)\]/);if(r){doc[r[1]]=doc[r[1]]||[];if(parts.length>0){doc[r[1]][r[2]]=doc[r[1]][r[2]]||{};assign(doc[r[1]][r[2]],parts,val)}else{doc[r[1]][r[2]]=val}}else{if(parts.length>0){doc[part]=doc[part]||{};assign(doc[part],parts,val)}else{doc[part]=val}}}assign(this._doc,parts,value)}else{this._doc[id]=value}$(this).trigger("propchanged",[id,value,oldValue,isTransient])}}}
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
Date.prototype.format=function(a){var e={"m+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"M+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in e){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(e[b]):(("00"+e[b]).substr((""+e[b]).length)))}}return a};Date.prototype.add=function(e){var h=this.getFullYear(),a=this.getMonth()+1,g=this.getDate(),f=0;if(typeof e!="object"){return this}for(var b in e){if(b=="year"){h+=e[b]}else{if(b=="month"){a+=e[b];if(a>12){h+=parseInt(a/12);a=a%12}if(a<1){h+=parseInt(a/12)-1;a=12+a%12}}else{if(b=="day"){f+=e[b]}}}}return new Date(new Date(h+"/"+a+"/"+g).getTime()+f*24*60*60*1000)};function emptyEqual(b,a){if(b===null&&a===null){return 1}else{if(b===null||a===null){return -1}}if(b===undefined&&a===undefined){return 1}else{if(b===undefined||a===undefined){return -1}}if(b===""&&a===""){return 1}else{if(b===""||a===""){return -1}}return 0}function isBothObject(b,a){if(typeof b==="object"&&typeof a==="object"){return 0}else{if(typeof b==="object"||typeof a==="object"){return -1}}return 1}function equals(f,b){var e=0;var a=true;e=emptyEqual(f,b);if(e==1){return true}else{if(e==-1){return false}}e=isBothObject(f,b);if(e==-1){return false}if(e==1){if(f===b){return true}else{return false}}else{for(var g in f){var h=arguments.callee(f[g],b[g]);if(!h){a=false;break}}for(var g in b){var h=arguments.callee(b[g],f[g]);if(!h){a=false;break}}}return a}function getUrlParam(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),e=window.location.search.substr(1).match(b);return e!=null?unescape(e[2]):null}function attributes(f){var b={},a=f.attributes;for(var e=0;e<a.length;e++){if(a[e].name!="metadata"){b[a[e].name]=a[e].value}}return b}function print(a){var b=$("body").children("iframe#printer");if(b.length==0){b=$("<iframe id='printer'>").hide().appendTo("body")}b.attr("src",a)}function showDialog(h,g,f){var b=window.database.local;f=f||{};var e=[];$.each(f.buttons||[],function(){var i=this;e.push({text:i.text,click:function(){i.handler&&i.handler($(this).data("dialog"))}})});var a="OK";if(b&&b!="en"){a=$.i18n.dialog.ok}if(e.length==0){e.push({text:a,click:function(){$(this).dialog("close")}})}$("<div/>").dialog({title:h,height:220,width:360,modal:true,create:function(i,j){$(this).html(g)},buttons:e,close:function(j,i){$(this).remove()}})}function openDialog(a,f,b,e){$("<div/>").dialog($.extend(true,{height:220,width:360,modal:true,create:function(g,h){Model[e]($(this),a,f,b)},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}],close:function(h,g){$(this).remove()}},b))}function newDocument(a,b,e){openDialog(a,b,e,"newDocument")}function openDocument(a,b,e){openDialog(a,b,e,"openDocument")}var openPage,openView,openPage,openSideView;openForm=openPage=function(b,a,e){openDialog(b,a,e,"openPage")};openView=function(b,a,e){openDialog(b,a,e,"openView")};openSideView=function(b,a,e){openDialog(b,a,e,"openSideView")};var hexcase=0;function hex_md5(b){return rstr2hex(rstr_md5(str2rstr_utf8(b)))}function hex_hmac_md5(f,e){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(f),str2rstr_utf8(e)))}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(b){return binl2rstr(binl_md5(rstr2binl(b),b.length*8))}function rstr_hmac_md5(r,k){var p=rstr2binl(r);if(p.length>16){p=binl_md5(p,r.length*8)}var i=Array(16),q=Array(16);for(var h=0;h<16;h++){i[h]=p[h]^909522486;q[h]=p[h]^1549556828}var j=binl_md5(i.concat(rstr2binl(k)),512+k.length*8);return binl2rstr(binl_md5(q.concat(j),512+128))}function rstr2hex(p){try{hexcase}catch(i){hexcase=0}var j=hexcase?"0123456789ABCDEF":"0123456789abcdef";var e="";var h;for(var k=0;k<p.length;k++){h=p.charCodeAt(k);e+=j.charAt((h>>>4)&15)+j.charAt(h&15)}return e}function str2rstr_utf8(j){var f="";var i=-1;var g,h;while(++i<j.length){g=j.charCodeAt(i);h=i+1<j.length?j.charCodeAt(i+1):0;if(55296<=g&&g<=56319&&56320<=h&&h<=57343){g=65536+((g&1023)<<10)+(h&1023);i++}if(g<=127){f+=String.fromCharCode(g)}else{if(g<=2047){f+=String.fromCharCode(192|((g>>>6)&31),128|(g&63))}else{if(g<=65535){f+=String.fromCharCode(224|((g>>>12)&15),128|((g>>>6)&63),128|(g&63))}else{if(g<=2097151){f+=String.fromCharCode(240|((g>>>18)&7),128|((g>>>12)&63),128|((g>>>6)&63),128|(g&63))}}}}}return f}function rstr2binl(e){var f=Array(e.length>>2);for(var g=0;g<f.length;g++){f[g]=0}for(var g=0;g<e.length*8;g+=8){f[g>>5]|=(e.charCodeAt(g/8)&255)<<(g%32)}return f}function binl2rstr(e){var f="";for(var g=0;g<e.length*32;g+=8){f+=String.fromCharCode((e[g>>5]>>>(g%32))&255)}return f}function binl_md5(a,s){a[s>>5]|=128<<((s)%32);a[(((s+64)>>>9)<<4)+14]=s;var b=1732584193;var i=-271733879;var q=-1732584194;var r=271733878;for(var v=0;v<a.length;v+=16){var t=b;var u=i;var w=q;var x=r;b=md5_ff(b,i,q,r,a[v+0],7,-680876936);r=md5_ff(r,b,i,q,a[v+1],12,-389564586);q=md5_ff(q,r,b,i,a[v+2],17,606105819);i=md5_ff(i,q,r,b,a[v+3],22,-1044525330);b=md5_ff(b,i,q,r,a[v+4],7,-176418897);r=md5_ff(r,b,i,q,a[v+5],12,1200080426);q=md5_ff(q,r,b,i,a[v+6],17,-1473231341);i=md5_ff(i,q,r,b,a[v+7],22,-45705983);b=md5_ff(b,i,q,r,a[v+8],7,1770035416);r=md5_ff(r,b,i,q,a[v+9],12,-1958414417);q=md5_ff(q,r,b,i,a[v+10],17,-42063);i=md5_ff(i,q,r,b,a[v+11],22,-1990404162);b=md5_ff(b,i,q,r,a[v+12],7,1804603682);r=md5_ff(r,b,i,q,a[v+13],12,-40341101);q=md5_ff(q,r,b,i,a[v+14],17,-1502002290);i=md5_ff(i,q,r,b,a[v+15],22,1236535329);b=md5_gg(b,i,q,r,a[v+1],5,-165796510);r=md5_gg(r,b,i,q,a[v+6],9,-1069501632);q=md5_gg(q,r,b,i,a[v+11],14,643717713);i=md5_gg(i,q,r,b,a[v+0],20,-373897302);b=md5_gg(b,i,q,r,a[v+5],5,-701558691);r=md5_gg(r,b,i,q,a[v+10],9,38016083);q=md5_gg(q,r,b,i,a[v+15],14,-660478335);i=md5_gg(i,q,r,b,a[v+4],20,-405537848);b=md5_gg(b,i,q,r,a[v+9],5,568446438);r=md5_gg(r,b,i,q,a[v+14],9,-1019803690);q=md5_gg(q,r,b,i,a[v+3],14,-187363961);i=md5_gg(i,q,r,b,a[v+8],20,1163531501);b=md5_gg(b,i,q,r,a[v+13],5,-1444681467);r=md5_gg(r,b,i,q,a[v+2],9,-51403784);q=md5_gg(q,r,b,i,a[v+7],14,1735328473);i=md5_gg(i,q,r,b,a[v+12],20,-1926607734);b=md5_hh(b,i,q,r,a[v+5],4,-378558);r=md5_hh(r,b,i,q,a[v+8],11,-2022574463);q=md5_hh(q,r,b,i,a[v+11],16,1839030562);i=md5_hh(i,q,r,b,a[v+14],23,-35309556);b=md5_hh(b,i,q,r,a[v+1],4,-1530992060);r=md5_hh(r,b,i,q,a[v+4],11,1272893353);q=md5_hh(q,r,b,i,a[v+7],16,-155497632);i=md5_hh(i,q,r,b,a[v+10],23,-1094730640);b=md5_hh(b,i,q,r,a[v+13],4,681279174);r=md5_hh(r,b,i,q,a[v+0],11,-358537222);q=md5_hh(q,r,b,i,a[v+3],16,-722521979);i=md5_hh(i,q,r,b,a[v+6],23,76029189);b=md5_hh(b,i,q,r,a[v+9],4,-640364487);r=md5_hh(r,b,i,q,a[v+12],11,-421815835);q=md5_hh(q,r,b,i,a[v+15],16,530742520);i=md5_hh(i,q,r,b,a[v+2],23,-995338651);b=md5_ii(b,i,q,r,a[v+0],6,-198630844);r=md5_ii(r,b,i,q,a[v+7],10,1126891415);q=md5_ii(q,r,b,i,a[v+14],15,-1416354905);i=md5_ii(i,q,r,b,a[v+5],21,-57434055);b=md5_ii(b,i,q,r,a[v+12],6,1700485571);r=md5_ii(r,b,i,q,a[v+3],10,-1894986606);q=md5_ii(q,r,b,i,a[v+10],15,-1051523);i=md5_ii(i,q,r,b,a[v+1],21,-2054922799);b=md5_ii(b,i,q,r,a[v+8],6,1873313359);r=md5_ii(r,b,i,q,a[v+15],10,-30611744);q=md5_ii(q,r,b,i,a[v+6],15,-1560198380);i=md5_ii(i,q,r,b,a[v+13],21,1309151649);b=md5_ii(b,i,q,r,a[v+4],6,-145523070);r=md5_ii(r,b,i,q,a[v+11],10,-1120210379);q=md5_ii(q,r,b,i,a[v+2],15,718787259);i=md5_ii(i,q,r,b,a[v+9],21,-343485551);b=safe_add(b,t);i=safe_add(i,u);q=safe_add(q,w);r=safe_add(r,x)}return Array(b,i,q,r)}function md5_cmn(a,j,k,p,b,i){return safe_add(bit_rol(safe_add(safe_add(j,a),safe_add(p,i)),b),k)}function md5_ff(r,s,a,b,t,p,q){return md5_cmn((s&a)|((~s)&b),r,s,t,p,q)}function md5_gg(r,s,a,b,t,p,q){return md5_cmn((s&b)|(a&(~b)),r,s,t,p,q)}function md5_hh(r,s,a,b,t,p,q){return md5_cmn(s^a^b,r,s,t,p,q)}function md5_ii(r,s,a,b,t,p,q){return md5_cmn(a^(s|(~b)),r,s,t,p,q)}function safe_add(f,g){var h=(f&65535)+(g&65535);var e=(f>>16)+(g>>16)+(h>>16);return(e<<16)|(h&65535)}function bit_rol(f,e){return(f<<e)|(f>>>(32-e))}function md5(a){return hex_md5(a)}var ObjectId=(function(){var a=0;var b=Math.floor(Math.random()*(32767));var j=Math.floor(Math.random()*(16777216));if(localStorage&&typeof(localStorage)!="undefined"){var h=parseInt(localStorage.mongoMachineId);if(h>=0&&h<=16777215){j=Math.floor(localStorage.mongoMachineId)}localStorage.mongoMachineId=j;document.cookie="mongoMachineId="+j+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var e=document.cookie.split("; ");for(var g in e){var f=e[g].split("=");if(f[0]=="mongoMachineId"&&f[1]>=0&&f[1]<=16777215){j=f[1];break}}document.cookie="mongoMachineId="+j+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return function(){if(!(this instanceof ObjectId)){return new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}if(typeof(arguments[0])=="object"){this.timestamp=arguments[0].timestamp;this.machine=arguments[0].machine;this.pid=arguments[0].pid;this.increment=arguments[0].increment}else{if(typeof(arguments[0])=="string"&&arguments[0].length==24){this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))}else{if(arguments.length==4&&arguments[0]!=null){this.timestamp=arguments[0];this.machine=arguments[1];this.pid=arguments[2];this.increment=arguments[3]}else{this.timestamp=Math.floor(new Date().valueOf()/1000);this.machine=j;this.pid=b;if(a>16777215){a=0}this.increment=a++}}}}})();ObjectId.prototype.getDate=function(){return new Date(this.timestamp*1000)};ObjectId.prototype.toString=function(){var f=this.timestamp.toString(16);var e=this.machine.toString(16);var b=this.pid.toString(16);var a=this.increment.toString(16);return"00000000".substr(0,6-f.length)+f+"000000".substr(0,6-e.length)+e+"0000".substr(0,4-b.length)+b+"000000".substr(0,6-a.length)+a};
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(g){g.ans=g.ans||{};function j(v,t,r){var q=v.getResponseHeader("content-type")||"",p=t==="xml"||!t&&q.indexOf("xml")>=0,u=p?v.responseXML:v.responseText;if(p&&u.documentElement.nodeName==="parsererror"){jQuery.error("parsererror")}if(r&&r.dataFilter){u=r.dataFilter(u,t)}if(typeof u==="string"){if(t==="json"||!t&&q.indexOf("json")>=0){u=jQuery.parseJSON(u)}else{if(t==="script"||!t&&q.indexOf("javascript")>=0){jQuery.globalEval(u)}}}return u}function e(p,r){if(typeof hex_sha1=="undefined"){alert("creating a user doc requires sha1.js to be loaded in the page");return}var q="org.notesdb.user:";p._id=p._id||q+p.name;if(r){p.salt=g.notes.newUUID();p.password_sha=hex_sha1(r+p.salt)}p.type="user";if(!p.roles){p.roles=[]}return p}function h(r){var q=[];if(typeof(r)==="object"&&r!==null){for(var p in r){var s=r[p];if(typeof(s==="object")){s=k(s)}q.push(encodeURIComponent(p)+"="+encodeURIComponent(s))}}return q.length?"?"+q.join("&"):""}function k(p){return p!==null?JSON.stringify(p):null}function i(q,r,p){g.ajax(g.extend(true,{type:"GET",url:q,cache:!(g.browser.msie),dataType:"json",complete:function(u){var v=j(u,"json"),t,s;if(u.status==200){s=v}else{t={status:u.status,error:v.error,reason:v.reason}}r(t,s)}},p))}function a(p,q,r){g.ajax({type:"POST",url:p,dataType:"json",contentType:"application/json",data:JSON.stringify(q),complete:function(u){var v=j(u,"json"),t=null,s=null;if(u.status==201||u.status==200){s=v}else{t={status:u.status,error:v.error,reason:v.reason}}r(t,s,v)}})}function b(p,q,r){g.ajax({type:"PUT",url:p,dataType:"json",contentType:"application/json",data:JSON.stringify(q),complete:function(u){var v=j(u,"json"),t,s;if(u.status==200){s=v}else{t={status:u.status,error:v.error,reason:v.reason}}r(t,s)}})}function f(p,q){g.ajax({type:"DELETE",url:p,dataType:"json",complete:function(t){var u=j(t,"json"),s,r;if(t.status==200){r=u}else{s={status:t.status,error:u.error,reason:u.reason}}q(s,r)}})}g.extend(g.ans,{login:function(p,q){a("/login",p,q)},logout:function(p){i("/logout",p)},dbAttachmentUri:function(p,q){return"/dbs/"+Model.ADMINDBID+"/"+p+"/attachments/"+q},getDB:function(p,q,r){q=q||{};g.extend(true,q,{selector:{type:Model.DATABASE}});i("/dbs/"+Model.ADMINDBID+"/"+(p||h(q)),r)},postDB:function(p,q){a("/dbs/"+Model.ADMINDBID,p,function(s,r){q(s,r);if(!s){g(document).trigger("databaseCreated",r)}})},putDB:function(p,r,q,s){q=q||{};g.extend(true,q,{selector:{type:Model.DATABASE}});b("/dbs/"+Model.ADMINDBID+"/"+(p||h(q)),r,function(u,t){s(u,t);if(!u){g(document).trigger("databaseChanged",r)}})},delDB:function(p,q,r){q=q||{};g.extend(true,q,{selector:{type:Model.DATABASE}});f("/dbs/"+Model.ADMINDBID+"/"+(p||h(q)),function(t,s){r(t,s);if(!t){g(document).trigger("databaseDeleted",{_id:p})}})},getDBAttachment:function(p,q){},postDBAttachment:function(q,p,r){var s=g('<form action="" method="POST"></form>').append(p.clone().attr("name","attachment"));var t={url:"/dbs/"+Model.ADMINDBID+"/"+q._id+"/attachments"};g.extend(t,r);s.ajaxSubmit(t)},delDBAttachment:function(p,q){},getDoc:function(q,t,s,u){var p={},r="/dbs/"+q;if(s&&s.headers){g.extend(p,{headers:s.headers});delete s.headers}if(t){r+="/"+t}if(s){r+=h(s)}i(r,u,p)},postDoc:function(p,r,q,s){if(q&&q.redirect){g.ajax({type:"POST",url:"/dbs/"+p,dataType:"json",contentType:"application/json",data:JSON.stringify(r),success:function(t){s(t)}})}else{a("/dbs/"+p+h(q),r,function(u,t){s(u,t);if(!u){g(document).trigger("documentCreated",r)}})}},putDoc:function(q,t,p,s,u){var r="/dbs/"+q+"/"+t;if(s){r+=h(s)}b(r,p,function(w,v){u(w,v);if(!w){g(document).trigger("documentChanged",p)}})},delDoc:function(p,s,r,t){var q="/dbs/"+p;if(s){q+="/"+s}if(r){q+=h(r)}f(q,function(v,u){t(v,u);if(!v){g(document).trigger("documentDeleted",{_id:s})}})},getAttachmentPath:function(p,q,r){return"/dbs/"+p+"/"+q+"/attachments/"+r},delAttachment:function(p,q,r){},getTempPath:function(p){return"/tmp/"+p},postTemp:function(p,q){var r=g('<form action="" method="POST"></form>').append(p.attr("name","file")),s={url:"/tmp"};g.extend(s,q);r.ajaxSubmit(s)},downPdf:function(p){window.location.href=p}})})(jQuery);(function($){$.extend({metadata:{defaults:{type:"elem",name:"script",single:"script"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts),elem=$(elem);settings.single=settings.single||"metadata";var data=$.data(elem,settings.single);if(!$.isEmptyObject(data)){return data}data="{}";if(settings.type=="elem"){data=$.trim(elem.children(settings.name+"[type='text/json']").html())||data}else{if(settings.type=="attr"){data=elem.attr(settings.name)||data}}if(data.indexOf("{")<0){data="{"+data+"}"}try{data=eval("("+data+")")}catch(e){}if(!$.isEmptyObject(data)){$.data(elem,settings.single,data)}return data},set:function(elem,metadata,opts){var settings=$.extend({},this.defaults,opts),elem=$(elem);settings.single=settings.single||"metadata";if(settings.type=="elem"){elem.children("script[type='text/json']").remove();if(!$.isEmptyObject(metadata)){$("<script type='text/json'>"+$.toJSON(metadata)+"<\/script>").prependTo(elem)}}else{if(settings.type=="attr"){elem.removeAttr(settings.name);if(!$.isEmptyObject(metadata)){elem.attr(settings.name,$.toJSON(metadata))}}}$.data(elem,settings.single,metadata)}}});$.fn.metadata=function(opts){return $.metadata.get(this,opts)};$.fn.getMetadata=function(opts){return $.metadata.get(this,opts)};$.fn.setMetadata=function(metadata,opts){$.metadata.set(this,metadata,opts)}})(jQuery);(function(a){a.extend(a.fn,{validate:function(b){if(!this.length){b&&b.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var e=a.data(this[0],"validator");if(e){return e}this.attr("novalidate","novalidate");e=new a.validator(b,this[0]);a.data(this[0],"validator",e);if(e.settings.onsubmit){var f=this.find("input, button");f.filter(".cancel").click(function(){e.cancelSubmit=true});if(e.settings.submitHandler){f.filter(":submit").click(function(){e.submitButton=this})}this.submit(function(g){if(e.settings.debug){g.preventDefault()}function h(){if(e.settings.submitHandler){if(e.submitButton){var i=a("<input type='hidden'/>").attr("name",e.submitButton.name).val(e.submitButton.value).appendTo(e.currentForm)}e.settings.submitHandler.call(e,e.currentForm);if(e.submitButton){i.remove()}return false}return true}if(e.cancelSubmit){e.cancelSubmit=false;return h()}if(e.form()){if(e.pendingRequest){e.formSubmitted=true;return false}return h()}else{e.focusInvalid();return false}})}return e},valid:function(){if(a(this[0]).is("form")){return this.validate().form()}else{var e=true;var b=a(this[0].form).validate();this.each(function(){e&=b.element(this)});return e}},removeAttrs:function(f){var b={},e=this;a.each(f.split(/\s/),function(g,h){b[h]=e.attr(h);e.removeAttr(h)});return b},rules:function(g,b){var i=this[0];if(g){var f=a.data(i.form,"validator").settings;var k=f.rules;var p=a.validator.staticRules(i);switch(g){case"add":a.extend(p,a.validator.normalizeRule(b));k[i.name]=p;if(b.messages){f.messages[i.name]=a.extend(f.messages[i.name],b.messages)}break;case"remove":if(!b){delete k[i.name];return p}var j={};a.each(b.split(/\s/),function(q,r){j[r]=p[r];delete p[r]});return j}}var h=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(i),a.validator.classRules(i),a.validator.attributeRules(i),a.validator.staticRules(i)),i);if(h.required){var e=h.required;delete h.required;h=a.extend({required:e},h)}return h}});a.extend(a.expr[":"],{blank:function(b){return !a.trim(""+b.value)},filled:function(b){return !!a.trim(""+b.value)},unchecked:function(b){return !b.checked}});a.validator=function(b,e){this.settings=a.extend(true,{},a.validator.defaults,b);this.currentForm=e;this.init()};a.validator.format=function(b,e){if(arguments.length==1){return function(){var f=a.makeArray(arguments);f.unshift(b);return a.validator.format.apply(this,f)}}if(arguments.length>2&&e.constructor!=Array){e=a.makeArray(arguments).slice(1)}if(e.constructor!=Array){e=[e]}a.each(e,function(f,g){b=b.replace(new RegExp("\\{"+f+"\\}","g"),g)});return b};a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(b,e){this.lastActive=b;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,b,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(b)).hide()}},onfocusout:function(b,e){if(!this.checkable(b)&&(b.name in this.submitted||!this.optional(b))){this.element(b)}},onkeyup:function(b,e){if(b.name in this.submitted||b==this.lastElement){this.element(b)}},onclick:function(b,e){if(b.name in this.submitted){this.element(b)}else{if(b.parentNode.name in this.submitted){this.element(b.parentNode)}}},highlight:function(f,b,e){if(f.type==="radio"){this.findByName(f.name).addClass(b).removeClass(e)}else{a(f).addClass(b).removeClass(e)}},unhighlight:function(f,b,e){if(f.type==="radio"){this.findByName(f.name).removeClass(b).addClass(e)}else{a(f).removeClass(b).addClass(e)}}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=a(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm);this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=(this.groups={});a.each(this.settings.groups,function(g,h){a.each(h.split(/\s/),function(j,i){b[i]=g})});var f=this.settings.rules;a.each(f,function(g,h){f[g]=a.validator.normalizeRule(h)});function e(i){var h=a.data(this[0].form,"validator"),g="on"+i.type.replace(/^validate/,"");h.settings[g]&&h.settings[g].call(h,this[0],i)}a(this.currentForm).validateDelegate("input[type='text'], input[type='password'], input[type='file'], select, textarea, input[type='number'], input[type='search'] ,input[type='tel'], input[type='url'], input[type='email'], input[type='datetime'], input[type='date'], input[type='month'], input[type='week'], input[type='time'], input[type='datetime-local'], input[type='range'], input[type='color'] ","focusin focusout keyup",e).validateDelegate("input[type='radio'], input[type='checkbox'], select, option","click",e);if(this.settings.invalidHandler){a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();a.extend(this.submitted,this.errorMap);this.invalid=a.extend({},this.errorMap);if(!this.valid()){a(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var b=0,e=(this.currentElements=this.elements());e[b];b++){this.check(e[b])}return this.valid()},element:function(e){e=this.validationTargetFor(this.clean(e));this.lastElement=e;this.prepareElement(e);this.currentElements=a(e);var b=this.check(e);if(b){delete this.invalid[e.name]}else{this.invalid[e.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return b},showErrors:function(e){if(e){a.extend(this.errorMap,e);this.errorList=[];for(var b in e){this.errorList.push({message:e[b],element:this.findByName(b)[0]})}this.successList=a.grep(this.successList,function(f){return !(f.name in e)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if(a.fn.resetForm){a(this.currentForm).resetForm()}this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(f){var e=0;for(var b in f){e++}return e},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}}},findLastActive:function(){var b=this.lastActive;return b&&a.grep(this.errorList,function(e){return e.element.name==b.name}).length==1&&b},elements:function(){var e=this,b={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!e.objectLength(a(this).rules())){return false}b[this.name]=true;return true})},clean:function(b){return a(b)[0]},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=a([]);this.toHide=a([]);this.currentElements=a([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(b){this.reset();this.toHide=this.errorsFor(b)},check:function(f){f=this.validationTargetFor(this.clean(f));var j=a(f).rules();var g=false;for(var k in j){var i={method:k,parameters:j[k]};try{var b=a.validator.methods[k].call(this,f.value.replace(/\r/g,""),f,i.parameters);if(b=="dependency-mismatch"){g=true;continue}g=false;if(b=="pending"){this.toHide=this.toHide.not(this.errorsFor(f));return}if(!b){this.formatAndAdd(f,i);return false}}catch(h){this.settings.debug&&window.console&&console.log("exception occured when checking element "+f.id+", check the '"+i.method+"' method",h);throw h}}if(g){return}if(this.objectLength(j)){this.successList.push(f)}return true},customMetaMessage:function(b,f){if(!a.metadata){return}var e=this.settings.meta?a(b).metadata()[this.settings.meta]:a(b).metadata();return e&&e.messages&&e.messages[f]},customMessage:function(e,f){var b=this.settings.messages[e];return b&&(b.constructor==String?b:b[f])},findDefined:function(){for(var b=0;b<arguments.length;b++){if(arguments[b]!==undefined){return arguments[b]}}return undefined},defaultMessage:function(b,e){return this.findDefined(this.customMessage(b.name,e),this.customMetaMessage(b,e),!this.settings.ignoreTitle&&b.title||undefined,a.validator.messages[e],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(e,g){var f=this.defaultMessage(e,g.method),b=/\$?\{(\d+)\}/g;if(typeof f=="function"){f=f.call(this,g.parameters,e)}else{if(b.test(f)){f=jQuery.format(f.replace(b,"{$1}"),g.parameters)}}this.errorList.push({message:f,element:e});this.errorMap[e.name]=f;this.submitted[e.name]=f},addWrapper:function(b){if(this.settings.wrapper){b=b.add(b.parent(this.settings.wrapper))}return b},defaultShowErrors:function(){for(var e=0;this.errorList[e];e++){var b=this.errorList[e];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var e=0;this.successList[e];e++){this.showLabel(this.successList[e])}}if(this.settings.unhighlight){for(var e=0,f=this.validElements();f[e];e++){this.settings.unhighlight.call(this,f[e],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(e,f){var b=this.errorsFor(e);if(b.length){b.removeClass(this.settings.validClass).addClass(this.settings.errorClass);b.attr("generated")&&b.html(f)}else{b=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(e),generated:true}).addClass(this.settings.errorClass).html(f||"");if(this.settings.wrapper){b=b.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(b).length){this.settings.errorPlacement?this.settings.errorPlacement(b,a(e)):b.insertAfter(e)}}if(!f&&this.settings.success){b.text("");typeof this.settings.success=="string"?b.addClass(this.settings.success):this.settings.success(b)}this.toShow=this.toShow.add(b)},errorsFor:function(e){var b=this.idOrName(e);return this.errors().filter(function(){return a(this).attr("for")==b})},idOrName:function(b){return this.groups[b.name]||(this.checkable(b)?b.name:b.id||b.name)},validationTargetFor:function(b){if(this.checkable(b)){b=this.findByName(b.name).not(this.settings.ignore)[0]}return b},checkable:function(b){return/radio|checkbox/i.test(b.type)},findByName:function(b){var e=this.currentForm;return a(document.getElementsByName(b)).map(function(f,g){return g.form==e&&g.name==b&&g||null})},getLength:function(e,b){switch(b.nodeName.toLowerCase()){case"select":return a("option:selected",b).length;case"input":if(this.checkable(b)){return this.findByName(b.name).filter(":checked").length}}return e.length},depend:function(e,b){return this.dependTypes[typeof e]?this.dependTypes[typeof e](e,b):true},dependTypes:{"boolean":function(e,b){return e},string:function(e,b){return !!a(e,b.form).length},"function":function(e,b){return e(b)}},optional:function(b){return !a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch"},startRequest:function(b){if(!this.pending[b.name]){this.pendingRequest++;this.pending[b.name]=true}},stopRequest:function(b,e){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[b.name];if(e&&this.pendingRequest==0&&this.formSubmitted&&this.form()){a(this.currentForm).submit();this.formSubmitted=false}else{if(!e&&this.pendingRequest==0&&this.formSubmitted){a(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}}},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:true,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(b,e){b.constructor==String?this.classRuleSettings[b]=e:a.extend(this.classRuleSettings,b)},classRules:function(e){var f={};var b=a(e).attr("class");b&&a.each(b.split(" "),function(){if(this in a.validator.classRuleSettings){a.extend(f,a.validator.classRuleSettings[this])}});return f},attributeRules:function(e){var g={};var b=a(e);for(var h in a.validator.methods){var f;if(h==="required"&&typeof a.fn.prop==="function"){f=b.prop(h)}else{f=b.attr(h)}if(f){g[h]=f}else{if(b[0].getAttribute("type")===h){g[h]=true}}}if(g.maxlength&&/-1|2147483647|524288/.test(g.maxlength)){delete g.maxlength}return g},metadataRules:function(b){if(!a.metadata){return{}}var e=a.data(b.form,"validator").settings.meta;return e?a(b).metadata()[e]:a(b).metadata()},staticRules:function(e){var f={};var b=a.data(e.form,"validator");if(b.settings.rules){f=a.validator.normalizeRule(b.settings.rules[e.name])||{}}return f},normalizeRules:function(e,b){a.each(e,function(h,g){if(g===false){delete e[h];return}if(g.param||g.depends){var f=true;switch(typeof g.depends){case"string":f=!!a(g.depends,b.form).length;break;case"function":f=g.depends.call(b,b);break}if(f){e[h]=g.param!==undefined?g.param:true}else{delete e[h]}}});a.each(e,function(f,g){e[f]=a.isFunction(g)?g(b):g});a.each(["minlength","maxlength","min","max"],function(){if(e[this]){e[this]=Number(e[this])}});a.each(["rangelength","range"],function(){if(e[this]){e[this]=[Number(e[this][0]),Number(e[this][1])]}});if(a.validator.autoCreateRanges){if(e.min&&e.max){e.range=[e.min,e.max];delete e.min;delete e.max}if(e.minlength&&e.maxlength){e.rangelength=[e.minlength,e.maxlength];delete e.minlength;delete e.maxlength}}if(e.messages){delete e.messages}return e},normalizeRule:function(e){if(typeof e=="string"){var b={};a.each(e.split(/\s/),function(){b[this]=true});e=b}return e},addMethod:function(b,f,e){a.validator.methods[b]=f;a.validator.messages[b]=e!=undefined?e:a.validator.messages[b];if(f.length<3){a.validator.addClassRules(b,a.validator.normalizeRule(b))}},methods:{required:function(e,b,g){if(!this.depend(g,b)){return"dependency-mismatch"}switch(b.nodeName.toLowerCase()){case"select":var f=a(b).val();return f&&f.length>0;case"input":if(this.checkable(b)){return this.getLength(e,b)>0}default:return a.trim(e).length>0}},remote:function(h,e,i){if(this.optional(e)){return"dependency-mismatch"}var f=this.previousValue(e);if(!this.settings.messages[e.name]){this.settings.messages[e.name]={}}f.originalMessage=this.settings.messages[e.name].remote;this.settings.messages[e.name].remote=f.message;i=typeof i=="string"&&{url:i}||i;if(this.pending[e.name]){return"pending"}if(f.old===h){return f.valid}f.old=h;var b=this;this.startRequest(e);var g={};g[e.name]=h;a.ajax(a.extend(true,{url:i,mode:"abort",port:"validate"+e.name,dataType:"json",data:g,success:function(k){b.settings.messages[e.name].remote=f.originalMessage;var q=k===true;if(q){var j=b.formSubmitted;b.prepareElement(e);b.formSubmitted=j;b.successList.push(e);b.showErrors()}else{var r={};var p=k||b.defaultMessage(e,"remote");r[e.name]=f.message=a.isFunction(p)?p(h):p;b.showErrors(r)}f.valid=q;b.stopRequest(e,q)}},i));return"pending"},minlength:function(e,b,f){return this.optional(b)||this.getLength(a.trim(e),b)>=f},maxlength:function(e,b,f){return this.optional(b)||this.getLength(a.trim(e),b)<=f},rangelength:function(f,b,g){var e=this.getLength(a.trim(f),b);return this.optional(b)||(e>=g[0]&&e<=g[1])},min:function(e,b,f){return this.optional(b)||e>=f},max:function(e,b,f){return this.optional(b)||e<=f},range:function(e,b,f){return this.optional(b)||(e>=f[0]&&e<=f[1])},email:function(e,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},url:function(e,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},date:function(e,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(e))},dateISO:function(e,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(e)},number:function(e,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(e)},digits:function(e,b){return this.optional(b)||/^\d+$/.test(e)},creditcard:function(h,e){if(this.optional(e)){return"dependency-mismatch"}if(/[^0-9 -]+/.test(h)){return false}var i=0,g=0,b=false;h=h.replace(/\D/g,"");for(var j=h.length-1;j>=0;j--){var f=h.charAt(j);var g=parseInt(f,10);if(b){if((g*=2)>9){g-=9}}i+=g;b=!b}return(i%10)==0},accept:function(e,b,f){f=typeof f=="string"?f.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||e.match(new RegExp(".("+f+")$","i"))},equalTo:function(e,b,g){var f=a(g).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(b).valid()});return e==f.val()}}});a.format=a.validator.format})(jQuery);(function(e){var a={};if(e.ajaxPrefilter){e.ajaxPrefilter(function(h,g,i){var f=h.port;if(h.mode=="abort"){if(a[f]){a[f].abort()}a[f]=i}})}else{var b=e.ajax;e.ajax=function(g){var h=("mode" in g?g:e.ajaxSettings).mode,f=("port" in g?g:e.ajaxSettings).port;if(h=="abort"){if(a[f]){a[f].abort()}return(a[f]=b.apply(this,arguments))}return b.apply(this,arguments)}}})(jQuery);(function(a){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){a.each({focus:"focusin",blur:"focusout"},function(e,b){a.event.special[b]={setup:function(){this.addEventListener(e,f,true)},teardown:function(){this.removeEventListener(e,f,true)},handler:function(g){arguments[0]=a.event.fix(g);arguments[0].type=b;return a.event.handle.apply(this,arguments)}};function f(g){g=a.event.fix(g);g.type=b;return a.event.handle.call(this,g)}})}a.extend(a.fn,{validateDelegate:function(f,e,b){return this.bind(e,function(g){var h=a(g.target);if(h.is(f)){return b.apply(h,arguments)}})}})})(jQuery);(function($){$.toJSON=function(o){if(typeof(JSON)=="object"&&JSON.stringify){return JSON.stringify(o)}var type=typeof(o);if(o===null){return"null"}if(type=="undefined"){return undefined}if(type=="number"||type=="boolean"){return o+""}if(type=="string"){return $.quoteString(o)}if(type=="object"){if(typeof o.toJSON=="function"){return $.toJSON(o.toJSON())}if(o.constructor===Date){var month=o.getUTCMonth()+1;if(month<10){month="0"+month}var day=o.getUTCDate();if(day<10){day="0"+day}var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10){hours="0"+hours}var minutes=o.getUTCMinutes();if(minutes<10){minutes="0"+minutes}var seconds=o.getUTCSeconds();if(seconds<10){seconds="0"+seconds}var milli=o.getUTCMilliseconds();if(milli<100){milli="0"+milli}if(milli<10){milli="0"+milli}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(o.constructor===Array){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i])||"null")}return"["+ret.join(",")+"]"}var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}if(typeof o[k]=="function"){continue}var val=$.toJSON(o[k]);pairs.push(name+":"+val)}return"{"+pairs.join(", ")+"}"}};$.evalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}return eval("("+src+")")};$.secureEvalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}};$.quoteString=function(string){if(string.match(_escapeable)){return'"'+string.replace(_escapeable,function(a){var c=_meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}})(jQuery);
/* Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(f){var b=["DOMMouseScroll","mousewheel"];if(f.event.fixHooks){for(var a=b.length;a;){f.event.fixHooks[b[--a]]=f.event.mouseHooks}}f.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var g=b.length;g;){this.addEventListener(b[--g],e,false)}}else{this.onmousewheel=e}},teardown:function(){if(this.removeEventListener){for(var g=b.length;g;){this.removeEventListener(b[--g],e,false)}}else{this.onmousewheel=null}}};f.fn.extend({mousewheel:function(g){return g?this.bind("mousewheel",g):this.trigger("mousewheel")},unmousewheel:function(g){return this.unbind("mousewheel",g)}});function e(p){var j=p||window.event,i=[].slice.call(arguments,1),q=0,k=true,h=0,g=0;p=f.event.fix(j);p.type="mousewheel";if(j.wheelDelta){q=j.wheelDelta/120}if(j.detail){q=-j.detail/3}g=q;if(j.axis!==undefined&&j.axis===j.HORIZONTAL_AXIS){g=0;h=-1*q}if(j.wheelDeltaY!==undefined){g=j.wheelDeltaY/120}if(j.wheelDeltaX!==undefined){h=-1*j.wheelDeltaX/120}i.unshift(p,q,h,g);return(f.event.dispatch||f.event.handle).apply(this,i)}})(jQuery);(function(b,g){var f,e,a;f=e=b.jQuery;a=e.ScrollTo=e.ScrollTo||{config:{duration:400,easing:"swing",callback:g,durationMode:"each",offsetTop:0,offsetLeft:0},configure:function(h){e.extend(a.config,h||{});return this},scroll:function(u,C){var t,w,r,h,p,E,A,s,B,x,z,i,q,v,F,D,k,j;t=u.pop();w=t.$container;r=w.get(0);h=t.$target;p=e("<span/>").css({position:"absolute",top:"0px",left:"0px"});E=w.css("position");w.css("position","relative");p.appendTo(w);z=p.offset().top;i=h.offset().top;q=i-z-parseInt(C.offsetTop,10);v=p.offset().left;F=h.offset().left;D=F-v-parseInt(C.offsetLeft,10);A=r.scrollTop;s=r.scrollLeft;p.remove();w.css("position",E);k={};j=function(G){if(u.length===0){if(typeof C.callback==="function"){C.callback.apply(this,[G])}}else{a.scroll(u,C)}return true};if(C.onlyIfOutside){B=A+w.height();x=s+w.width();if(A<q&&q<B){q=A}if(s<D&&D<x){D=s}}if(q!==A){k.scrollTop=q}if(D!==s){k.scrollLeft=D}if(e.browser.safari&&r===document.body){b.scrollTo(k.scrollLeft,k.scrollTop);j()}else{if(k.scrollTop||k.scrollLeft){w.animate(k,C.duration,C.easing,j)}else{j()}}return true},fn:function(k){var p,j,s,i;p=[];var h=e(this);if(h.length===0){return this}j=e.extend({},a.config,k);s=h.parent();i=s.get(0);while((s.length===1)&&(i!==document.body)&&(i!==document)){var q,r;q=s.css("overflow-y")!=="visible"&&i.scrollHeight!==i.clientHeight;r=s.css("overflow-x")!=="visible"&&i.scrollWidth!==i.clientWidth;if(q||r){p.push({"$container":s,"$target":h});h=s}s=s.parent();i=s.get(0)}p.push({"$container":e((e.browser.msie||e.browser.mozilla)?"html,body":"body"),"$target":h});if(j.durationMode==="all"){j.duration/=p.length}a.scroll(p,j);return this}};e.fn.ScrollTo=e.ScrollTo.fn})(window);(function($){$.ui.timepicker=$.ui.timepicker||{};if($.ui.timepicker.version){return}$.extend($.ui,{timepicker:{version:"1.0.3"}});function Timepicker(){this.regional=[];this.regional[""]={currentText:"Now",closeText:"Done",ampm:false,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm tt",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",timezoneText:"Time Zone"};this._defaults={showButtonPanel:true,timeOnly:false,showHour:true,showMinute:true,showSecond:false,showMillisec:false,showTimezone:false,showTime:true,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:null,useLocalTimezone:false,defaultTimezone:"+0000",hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:true,separator:" ",altFieldTimeOnly:true,altSeparator:null,altTimeSuffix:null,showTimepicker:true,timezoneIso8601:false,timezoneList:null,addSliderAccess:false,sliderAccessArgs:null,defaultValue:null};$.extend(this._defaults,this.regional[""])}$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:null,defaultTimezone:"+0000",hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec"],setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_newInst:function($input,o){var tp_inst=new Timepicker(),inlineSettings={};for(var attrName in this._defaults){if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue){try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}}tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(input,dp_inst){if($.isFunction(o.beforeShow)){return o.beforeShow(input,dp_inst,tp_inst)}},onChangeMonthYear:function(year,month,dp_inst){tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onChangeMonthYear)){o.onChangeMonthYear.call($input[0],year,month,dp_inst,tp_inst)}},onClose:function(dateText,dp_inst){if(tp_inst.timeDefined===true&&$input.val()!==""){tp_inst._updateDateTime(dp_inst)}if($.isFunction(o.onClose)){o.onClose.call($input[0],dateText,dp_inst,tp_inst)}},timepicker:tp_inst});tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(val){return val.toUpperCase()});tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(val){return val.toUpperCase()});if(tp_inst._defaults.timezoneList===null){var timezoneList=["-1200","-1100","-1000","-0930","-0900","-0800","-0700","-0600","-0500","-0430","-0400","-0330","-0300","-0200","-0100","+0000","+0100","+0200","+0300","+0330","+0400","+0430","+0500","+0530","+0545","+0600","+0630","+0700","+0800","+0845","+0900","+0930","+1000","+1030","+1100","+1130","+1200","+1245","+1300","+1400"];if(tp_inst._defaults.timezoneIso8601){timezoneList=$.map(timezoneList,function(val){return val=="+0000"?"Z":(val.substring(0,3)+":"+val.substring(3))})}tp_inst._defaults.timezoneList=timezoneList}tp_inst.timezone=tp_inst._defaults.timezone;tp_inst.hour=tp_inst._defaults.hour;tp_inst.minute=tp_inst._defaults.minute;tp_inst.second=tp_inst._defaults.second;tp_inst.millisec=tp_inst._defaults.millisec;tp_inst.ampm="";tp_inst.$input=$input;if(o.altField){tp_inst.$altInput=$(o.altField).css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})}if(tp_inst._defaults.minDate===0||tp_inst._defaults.minDateTime===0){tp_inst._defaults.minDate=new Date()}if(tp_inst._defaults.maxDate===0||tp_inst._defaults.maxDateTime===0){tp_inst._defaults.maxDate=new Date()}if(tp_inst._defaults.minDate!==undefined&&tp_inst._defaults.minDate instanceof Date){tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())}if(tp_inst._defaults.minDateTime!==undefined&&tp_inst._defaults.minDateTime instanceof Date){tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())}if(tp_inst._defaults.maxDate!==undefined&&tp_inst._defaults.maxDate instanceof Date){tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())}if(tp_inst._defaults.maxDateTime!==undefined&&tp_inst._defaults.maxDateTime instanceof Date){tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())}tp_inst.$input.bind("focus",function(){tp_inst._onFocus()});return tp_inst},_addTimePicker:function(dp_inst){var currDT=(this.$altInput&&this._defaults.altFieldTimeOnly)?this.$input.val()+" "+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(currDT);this._limitMinMaxDateTime(dp_inst,false);this._injectTimePicker()},_parseTime:function(timeString,withDate){if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0])}if(withDate||!this._defaults.timeOnly){var dp_dateFormat=$.datepicker._get(this.inst,"dateFormat");try{var parseRes=parseDateTimeInternal(dp_dateFormat,this._defaults.timeFormat,timeString,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!parseRes.timeObj){return false}$.extend(this,parseRes.timeObj)}catch(err){return false}return true}else{var timeObj=$.datepicker.parseTime(this._defaults.timeFormat,timeString,this._defaults);if(!timeObj){return false}$.extend(this,timeObj);return true}},_injectTimePicker:function(){var $dp=this.inst.dpDiv,o=this.inst.settings,tp_inst=this,litem="",uitem="",max={},gridSize={},size=null;if($dp.find("div.ui-timepicker-div").length===0&&o.showTimepicker){var noDisplay=' style="display:none;"',html='<div class="ui-timepicker-div"><dl><dt class="ui_tpicker_time_label"'+((o.showTime)?"":noDisplay)+">"+o.timeText+'</dt><dd class="ui_tpicker_time"'+((o.showTime)?"":noDisplay)+"></dd>";for(var i=0,l=this.units.length;i<l;i++){litem=this.units[i];uitem=litem.substr(0,1).toUpperCase()+litem.substr(1);max[litem]=parseInt((o[litem+"Max"]-((o[litem+"Max"]-o[litem+"Min"])%o["step"+uitem])),10);gridSize[litem]=0;html+='<dt class="ui_tpicker_'+litem+'_label"'+((o["show"+uitem])?"":noDisplay)+">"+o[litem+"Text"]+'</dt><dd class="ui_tpicker_'+litem+'"><div class="ui_tpicker_'+litem+'_slider"'+((o["show"+uitem])?"":noDisplay)+"></div>";if(o["show"+uitem]&&o[litem+"Grid"]>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';if(litem=="hour"){for(var h=o[litem+"Min"];h<=max[litem];h+=parseInt(o[litem+"Grid"],10)){gridSize[litem]++;var tmph=(o.ampm&&h>12)?h-12:h;if(tmph<10){tmph="0"+tmph}if(o.ampm){if(h===0){tmph=12+"a"}else{if(h<12){tmph+="a"}else{tmph+="p"}}}html+='<td data-for="'+litem+'">'+tmph+"</td>"}}else{for(var m=o[litem+"Min"];m<=max[litem];m+=parseInt(o[litem+"Grid"],10)){gridSize[litem]++;html+='<td data-for="'+litem+'">'+((m<10)?"0":"")+m+"</td>"}}html+="</tr></table></div>"}html+="</dd>"}html+='<dt class="ui_tpicker_timezone_label"'+((o.showTimezone)?"":noDisplay)+">"+o.timezoneText+"</dt>";html+='<dd class="ui_tpicker_timezone" '+((o.showTimezone)?"":noDisplay)+"></dd>";html+="</dl></div>";var $tp=$(html);if(o.timeOnly===true){$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+o.timeOnlyTitle+"</div></div>");$dp.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()}this.hour_slider=$tp.find(".ui_tpicker_hour_slider").prop("slide",null).slider({orientation:"horizontal",value:this.hour,min:o.hourMin,max:max.hour,step:o.stepHour,slide:function(event,ui){tp_inst.hour_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});this.minute_slider=$tp.find(".ui_tpicker_minute_slider").prop("slide",null).slider({orientation:"horizontal",value:this.minute,min:o.minuteMin,max:max.minute,step:o.stepMinute,slide:function(event,ui){tp_inst.minute_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});this.second_slider=$tp.find(".ui_tpicker_second_slider").prop("slide",null).slider({orientation:"horizontal",value:this.second,min:o.secondMin,max:max.second,step:o.stepSecond,slide:function(event,ui){tp_inst.second_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});this.millisec_slider=$tp.find(".ui_tpicker_millisec_slider").prop("slide",null).slider({orientation:"horizontal",value:this.millisec,min:o.millisecMin,max:max.millisec,step:o.stepMillisec,slide:function(event,ui){tp_inst.millisec_slider.slider("option","value",ui.value);tp_inst._onTimeChange()},stop:function(event,ui){tp_inst._onSelectHandler()}});for(var i=0,l=tp_inst.units.length;i<l;i++){litem=tp_inst.units[i];uitem=litem.substr(0,1).toUpperCase()+litem.substr(1);if(o["show"+uitem]&&o[litem+"Grid"]>0){size=100*gridSize[litem]*o[litem+"Grid"]/(max[litem]-o[litem+"Min"]);$tp.find(".ui_tpicker_"+litem+" table").css({width:size+"%",marginLeft:(size/(-2*gridSize[litem]))+"%",borderCollapse:"collapse"}).find("td").click(function(e){var $t=$(this),h=$t.html(),f=$t.data("for");if(f=="hour"&&o.ampm){var ap=h.substring(2).toLowerCase(),aph=parseInt(h.substring(0,2),10);if(ap=="a"){if(aph==12){h=0}else{h=aph}}else{if(aph==12){h=12}else{h=aph+12}}}tp_inst[f+"_slider"].slider("option","value",parseInt(h,10));tp_inst._onTimeChange();tp_inst._onSelectHandler()}).css({cursor:"pointer",width:(100/gridSize[litem])+"%",textAlign:"center",overflow:"hidden"})}}this.timezone_select=$tp.find(".ui_tpicker_timezone").append("<select></select>").find("select");$.fn.append.apply(this.timezone_select,$.map(o.timezoneList,function(val,idx){return $("<option />").val(typeof val=="object"?val.value:val).text(typeof val=="object"?val.label:val)}));if(typeof(this.timezone)!="undefined"&&this.timezone!==null&&this.timezone!==""){var local_date=new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12);var local_timezone=$.timepicker.timeZoneOffsetString(local_date);if(local_timezone==this.timezone){selectLocalTimeZone(tp_inst)}else{this.timezone_select.val(this.timezone)}}else{if(typeof(this.hour)!="undefined"&&this.hour!==null&&this.hour!==""){this.timezone_select.val(o.defaultTimezone)}else{selectLocalTimeZone(tp_inst)}}this.timezone_select.change(function(){tp_inst._defaults.useLocalTimezone=false;tp_inst._onTimeChange()});var $buttonPanel=$dp.find(".ui-datepicker-buttonpane");if($buttonPanel.length){$buttonPanel.before($tp)}else{$dp.append($tp)}this.$timeObj=$tp.find(".ui_tpicker_time");if(this.inst!==null){var timeDefined=this.timeDefined;this._onTimeChange();this.timeDefined=timeDefined}if(this._defaults.addSliderAccess){var sliderAccessArgs=this._defaults.sliderAccessArgs;setTimeout(function(){if($tp.find(".ui-slider-access").length===0){$tp.find(".ui-slider:visible").sliderAccess(sliderAccessArgs);var sliderAccessWidth=$tp.find(".ui-slider-access:eq(0)").outerWidth(true);if(sliderAccessWidth){$tp.find("table:visible").each(function(){var $g=$(this),oldWidth=$g.outerWidth(),oldMarginLeft=$g.css("marginLeft").toString().replace("%",""),newWidth=oldWidth-sliderAccessWidth,newMarginLeft=((oldMarginLeft*newWidth)/oldWidth)+"%";$g.css({width:newWidth,marginLeft:newMarginLeft})})}}},10)}}},_limitMinMaxDateTime:function(dp_inst,adjustSliders){var o=this._defaults,dp_date=new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay);if(!this._defaults.showTimepicker){return}if($.datepicker._get(dp_inst,"minDateTime")!==null&&$.datepicker._get(dp_inst,"minDateTime")!==undefined&&dp_date){var minDateTime=$.datepicker._get(dp_inst,"minDateTime"),minDateTimeDate=new Date(minDateTime.getFullYear(),minDateTime.getMonth(),minDateTime.getDate(),0,0,0,0);if(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null){this.hourMinOriginal=o.hourMin;this.minuteMinOriginal=o.minuteMin;this.secondMinOriginal=o.secondMin;this.millisecMinOriginal=o.millisecMin}if(dp_inst.settings.timeOnly||minDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMin=minDateTime.getHours();if(this.hour<=this._defaults.hourMin){this.hour=this._defaults.hourMin;this._defaults.minuteMin=minDateTime.getMinutes();if(this.minute<=this._defaults.minuteMin){this.minute=this._defaults.minuteMin;this._defaults.secondMin=minDateTime.getSeconds();if(this.second<=this._defaults.secondMin){this.second=this._defaults.secondMin;this._defaults.millisecMin=minDateTime.getMilliseconds()}else{if(this.millisec<this._defaults.millisecMin){this.millisec=this._defaults.millisecMin}this._defaults.millisecMin=this.millisecMinOriginal}}else{this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}else{this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}else{this._defaults.hourMin=this.hourMinOriginal;this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}if($.datepicker._get(dp_inst,"maxDateTime")!==null&&$.datepicker._get(dp_inst,"maxDateTime")!==undefined&&dp_date){var maxDateTime=$.datepicker._get(dp_inst,"maxDateTime"),maxDateTimeDate=new Date(maxDateTime.getFullYear(),maxDateTime.getMonth(),maxDateTime.getDate(),0,0,0,0);if(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null){this.hourMaxOriginal=o.hourMax;this.minuteMaxOriginal=o.minuteMax;this.secondMaxOriginal=o.secondMax;this.millisecMaxOriginal=o.millisecMax}if(dp_inst.settings.timeOnly||maxDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMax=maxDateTime.getHours();if(this.hour>=this._defaults.hourMax){this.hour=this._defaults.hourMax;this._defaults.minuteMax=maxDateTime.getMinutes();if(this.minute>=this._defaults.minuteMax){this.minute=this._defaults.minuteMax;this._defaults.secondMax=maxDateTime.getSeconds()}else{if(this.second>=this._defaults.secondMax){this.second=this._defaults.secondMax;this._defaults.millisecMax=maxDateTime.getMilliseconds()}else{if(this.millisec>this._defaults.millisecMax){this.millisec=this._defaults.millisecMax}this._defaults.millisecMax=this.millisecMaxOriginal}}}else{this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal}}else{this._defaults.hourMax=this.hourMaxOriginal;this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal}}if(adjustSliders!==undefined&&adjustSliders===true){var hourMax=parseInt((this._defaults.hourMax-((this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour)),10),minMax=parseInt((this._defaults.minuteMax-((this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute)),10),secMax=parseInt((this._defaults.secondMax-((this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond)),10),millisecMax=parseInt((this._defaults.millisecMax-((this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec)),10);if(this.hour_slider){this.hour_slider.slider("option",{min:this._defaults.hourMin,max:hourMax}).slider("value",this.hour)}if(this.minute_slider){this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:minMax}).slider("value",this.minute)}if(this.second_slider){this.second_slider.slider("option",{min:this._defaults.secondMin,max:secMax}).slider("value",this.second)}if(this.millisec_slider){this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:millisecMax}).slider("value",this.millisec)}}},_onTimeChange:function(){var hour=(this.hour_slider)?this.hour_slider.slider("value"):false,minute=(this.minute_slider)?this.minute_slider.slider("value"):false,second=(this.second_slider)?this.second_slider.slider("value"):false,millisec=(this.millisec_slider)?this.millisec_slider.slider("value"):false,timezone=(this.timezone_select)?this.timezone_select.val():false,o=this._defaults;if(typeof(hour)=="object"){hour=false}if(typeof(minute)=="object"){minute=false}if(typeof(second)=="object"){second=false}if(typeof(millisec)=="object"){millisec=false}if(typeof(timezone)=="object"){timezone=false}if(hour!==false){hour=parseInt(hour,10)}if(minute!==false){minute=parseInt(minute,10)}if(second!==false){second=parseInt(second,10)}if(millisec!==false){millisec=parseInt(millisec,10)}var ampm=o[hour<12?"amNames":"pmNames"][0];var hasChanged=(hour!=this.hour||minute!=this.minute||second!=this.second||millisec!=this.millisec||(this.ampm.length>0&&(hour<12)!=($.inArray(this.ampm.toUpperCase(),this.amNames)!==-1))||((this.timezone===null&&timezone!=this.defaultTimezone)||(this.timezone!==null&&timezone!=this.timezone)));if(hasChanged){if(hour!==false){this.hour=hour}if(minute!==false){this.minute=minute}if(second!==false){this.second=second}if(millisec!==false){this.millisec=millisec}if(timezone!==false){this.timezone=timezone}if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0])}this._limitMinMaxDateTime(this.inst,true)}if(o.ampm){this.ampm=ampm}this.formattedTime=$.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults);if(this.$timeObj){this.$timeObj.text(this.formattedTime+o.timeSuffix)}this.timeDefined=true;if(hasChanged){this._updateDateTime()}},_onSelectHandler:function(){var onSelect=this._defaults.onSelect||this.inst.settings.onSelect;var inputEl=this.$input?this.$input[0]:null;if(onSelect&&inputEl){onSelect.apply(inputEl,[this.formattedDateTime,this])}},_formatTime:function(time,format){time=time||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var tmptime=(format||this._defaults.timeFormat).toString();tmptime=$.datepicker.formatTime(tmptime,time,this._defaults);if(arguments.length){return tmptime}else{this.formattedTime=tmptime}},_updateDateTime:function(dp_inst){dp_inst=this.inst||dp_inst;var dt=$.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay)),dateFmt=$.datepicker._get(dp_inst,"dateFormat"),formatCfg=$.datepicker._getFormatConfig(dp_inst),timeAvailable=dt!==null&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(dateFmt,(dt===null?new Date():dt),formatCfg);var formattedDateTime=this.formattedDate;if(this._defaults.timeOnly===true){formattedDateTime=this.formattedTime}else{if(this._defaults.timeOnly!==true&&(this._defaults.alwaysSetTime||timeAvailable)){formattedDateTime+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix}}this.formattedDateTime=formattedDateTime;if(!this._defaults.showTimepicker){this.$input.val(this.formattedDate)}else{if(this.$altInput&&this._defaults.altFieldTimeOnly===true){this.$altInput.val(this.formattedTime);this.$input.val(this.formattedDate)}else{if(this.$altInput){this.$input.val(formattedDateTime);var altFormattedDateTime="",altSeparator=this._defaults.altSeparator?this._defaults.altSeparator:this._defaults.separator,altTimeSuffix=this._defaults.altTimeSuffix?this._defaults.altTimeSuffix:this._defaults.timeSuffix;if(this._defaults.altFormat){altFormattedDateTime=$.datepicker.formatDate(this._defaults.altFormat,(dt===null?new Date():dt),formatCfg)}else{altFormattedDateTime=this.formattedDate}if(altFormattedDateTime){altFormattedDateTime+=altSeparator}if(this._defaults.altTimeFormat){altFormattedDateTime+=$.datepicker.formatTime(this._defaults.altTimeFormat,this,this._defaults)+altTimeSuffix}else{altFormattedDateTime+=this.formattedTime+altTimeSuffix}this.$altInput.val(altFormattedDateTime)}else{this.$input.val(formattedDateTime)}}}this.$input.trigger("change")},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var inst=$.datepicker._getInst(this.$input.get(0)),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst)}catch(err){$.datepicker.log(err)}}}}}});$.fn.extend({timepicker:function(o){o=o||{};var tmp_args=Array.prototype.slice.call(arguments);if(typeof o=="object"){tmp_args[0]=$.extend(o,{timeOnly:true})}return $(this).each(function(){$.fn.datetimepicker.apply($(this),tmp_args)})},datetimepicker:function(o){o=o||{};var tmp_args=arguments;if(typeof(o)=="string"){if(o=="getDate"){return $.fn.datepicker.apply($(this[0]),tmp_args)}else{return this.each(function(){var $t=$(this);$t.datepicker.apply($t,tmp_args)})}}else{return this.each(function(){var $t=$(this);$t.datepicker($.timepicker._newInst($t,o)._defaults)})}}});$.datepicker.parseDateTime=function(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings){var parseRes=parseDateTimeInternal(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings);if(parseRes.timeObj){var t=parseRes.timeObj;parseRes.date.setHours(t.hour,t.minute,t.second,t.millisec)}return parseRes.date};$.datepicker.parseTime=function(timeFormat,timeString,options){var getPatternAmpm=function(amNames,pmNames){var markers=[];if(amNames){$.merge(markers,amNames)}if(pmNames){$.merge(markers,pmNames)}markers=$.map(markers,function(val){return val.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")});return"("+markers.join("|")+")?"};var getFormatPositions=function(timeFormat){var finds=timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),orders={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(finds){for(var i=0;i<finds.length;i++){if(orders[finds[i].toString().charAt(0)]==-1){orders[finds[i].toString().charAt(0)]=i+1}}}return orders};var o=extendRemove(extendRemove({},$.timepicker._defaults),options||{});var regstr="^"+timeFormat.toString().replace(/h{1,2}/ig,"(\\d?\\d)").replace(/m{1,2}/ig,"(\\d?\\d)").replace(/s{1,2}/ig,"(\\d?\\d)").replace(/l{1}/ig,"(\\d?\\d?\\d)").replace(/t{1,2}/ig,getPatternAmpm(o.amNames,o.pmNames)).replace(/z{1}/ig,"(z|[-+]\\d\\d:?\\d\\d|\\S+)?").replace(/\s/g,"\\s?")+o.timeSuffix+"$",order=getFormatPositions(timeFormat),ampm="",treg;treg=timeString.match(new RegExp(regstr,"i"));var resTime={hour:0,minute:0,second:0,millisec:0};if(treg){if(order.t!==-1){if(treg[order.t]===undefined||treg[order.t].length===0){ampm="";resTime.ampm=""}else{ampm=$.inArray(treg[order.t].toUpperCase(),o.amNames)!==-1?"AM":"PM";resTime.ampm=o[ampm=="AM"?"amNames":"pmNames"][0]}}if(order.h!==-1){if(ampm=="AM"&&treg[order.h]=="12"){resTime.hour=0}else{if(ampm=="PM"&&treg[order.h]!="12"){resTime.hour=parseInt(treg[order.h],10)+12}else{resTime.hour=Number(treg[order.h])}}}if(order.m!==-1){resTime.minute=Number(treg[order.m])}if(order.s!==-1){resTime.second=Number(treg[order.s])}if(order.l!==-1){resTime.millisec=Number(treg[order.l])}if(order.z!==-1&&treg[order.z]!==undefined){var tz=treg[order.z].toUpperCase();switch(tz.length){case 1:tz=o.timezoneIso8601?"Z":"+0000";break;case 5:if(o.timezoneIso8601){tz=tz.substring(1)=="0000"?"Z":tz.substring(0,3)+":"+tz.substring(3)}break;case 6:if(!o.timezoneIso8601){tz=tz=="Z"||tz.substring(1)=="00:00"?"+0000":tz.replace(/:/,"")}else{if(tz.substring(1)=="00:00"){tz="Z"}}break}resTime.timezone=tz}return resTime}return false};$.datepicker.formatTime=function(format,time,options){options=options||{};options=$.extend({},$.timepicker._defaults,options);time=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:"+0000"},time);var tmptime=format;var ampmName=options.amNames[0];var hour=parseInt(time.hour,10);if(options.ampm){if(hour>11){ampmName=options.pmNames[0];if(hour>12){hour=hour%12}}if(hour===0){hour=12}}tmptime=tmptime.replace(/(?:hh?|mm?|ss?|[tT]{1,2}|[lz]|('.*?'|".*?"))/g,function(match){switch(match.toLowerCase()){case"hh":return("0"+hour).slice(-2);case"h":return hour;case"mm":return("0"+time.minute).slice(-2);case"m":return time.minute;case"ss":return("0"+time.second).slice(-2);case"s":return time.second;case"l":return("00"+time.millisec).slice(-3);case"z":return time.timezone;case"t":case"tt":if(options.ampm){if(match.length==1){ampmName=ampmName.charAt(0)}return match.charAt(0)==="T"?ampmName.toUpperCase():ampmName.toLowerCase()}return"";default:return match.replace(/\'/g,"")||"'"}});tmptime=$.trim(tmptime);return tmptime};$.datepicker._base_selectDate=$.datepicker._selectDate;$.datepicker._selectDate=function(id,dateStr){var inst=this._getInst($(id)[0]),tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._limitMinMaxDateTime(inst,true);inst.inline=inst.stay_open=true;this._base_selectDate(id,dateStr);inst.inline=inst.stay_open=false;this._notifyChange(inst);this._updateDatepicker(inst)}else{this._base_selectDate(id,dateStr)}};$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){var input=inst.input[0];if($.datepicker._curInst&&$.datepicker._curInst!=inst&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=input){return}if(typeof(inst.stay_open)!=="boolean"||inst.stay_open===false){this._base_updateDatepicker(inst);var tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._addTimePicker(inst);if(tp_inst._defaults.useLocalTimezone){var date=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay,12);selectLocalTimeZone(tp_inst,date);tp_inst._onTimeChange()}}}};$.datepicker._base_doKeyPress=$.datepicker._doKeyPress;$.datepicker._doKeyPress=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if($.datepicker._get(inst,"constrainInput")){var ampm=tp_inst._defaults.ampm,dateChars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat")),datetimeChars=tp_inst._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,ampm?"APM":"").replace(/Tt/g,ampm?"AaPpMm":"").replace(/tT/g,ampm?"AaPpMm":"").replace(/T/g,ampm?"AP":"").replace(/tt/g,ampm?"apm":"").replace(/t/g,ampm?"ap":"")+" "+tp_inst._defaults.separator+tp_inst._defaults.timeSuffix+(tp_inst._defaults.showTimezone?tp_inst._defaults.timezoneList.join(""):"")+(tp_inst._defaults.amNames.join(""))+(tp_inst._defaults.pmNames.join(""))+dateChars,chr=String.fromCharCode(event.charCode===undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<" "||!dateChars||datetimeChars.indexOf(chr)>-1)}}return $.datepicker._base_doKeyPress(event)};$.datepicker._base_doKeyUp=$.datepicker._doKeyUp;$.datepicker._doKeyUp=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst)}catch(err){$.datepicker.log(err)}}}return $.datepicker._base_doKeyUp(event)};$.datepicker._base_gotoToday=$.datepicker._gotoToday;$.datepicker._gotoToday=function(id){var inst=this._getInst($(id)[0]),$dp=inst.dpDiv;this._base_gotoToday(id);var tp_inst=this._get(inst,"timepicker");selectLocalTimeZone(tp_inst);var now=new Date();this._setTime(inst,now);$(".ui-datepicker-today",$dp).click()};$.datepicker._disableTimepickerDatepicker=function(target){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");$(target).datepicker("getDate");if(tp_inst){tp_inst._defaults.showTimepicker=false;tp_inst._updateDateTime(inst)}};$.datepicker._enableTimepickerDatepicker=function(target){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");$(target).datepicker("getDate");if(tp_inst){tp_inst._defaults.showTimepicker=true;tp_inst._addTimePicker(inst);tp_inst._updateDateTime(inst)}};$.datepicker._setTime=function(inst,date){var tp_inst=this._get(inst,"timepicker");if(tp_inst){var defaults=tp_inst._defaults,hour=date?date.getHours():defaults.hour,minute=date?date.getMinutes():defaults.minute,second=date?date.getSeconds():defaults.second,millisec=date?date.getMilliseconds():defaults.millisec;var hourEq=hour===defaults.hourMin,minuteEq=minute===defaults.minuteMin,secondEq=second===defaults.secondMin;var reset=false;if(hour<defaults.hourMin||hour>defaults.hourMax){reset=true}else{if((minute<defaults.minuteMin||minute>defaults.minuteMax)&&hourEq){reset=true}else{if((second<defaults.secondMin||second>defaults.secondMax)&&hourEq&&minuteEq){reset=true}else{if((millisec<defaults.millisecMin||millisec>defaults.millisecMax)&&hourEq&&minuteEq&&secondEq){reset=true}}}}if(reset){hour=defaults.hourMin;minute=defaults.minuteMin;second=defaults.secondMin;millisec=defaults.millisecMin}tp_inst.hour=hour;tp_inst.minute=minute;tp_inst.second=second;tp_inst.millisec=millisec;if(tp_inst.hour_slider){tp_inst.hour_slider.slider("value",hour)}if(tp_inst.minute_slider){tp_inst.minute_slider.slider("value",minute)}if(tp_inst.second_slider){tp_inst.second_slider.slider("value",second)}if(tp_inst.millisec_slider){tp_inst.millisec_slider.slider("value",millisec)}tp_inst._onTimeChange();tp_inst._updateDateTime(inst)}};$.datepicker._setTimeDatepicker=function(target,date,withDate){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");if(tp_inst){this._setDateFromField(inst);var tp_date;if(date){if(typeof date=="string"){tp_inst._parseTime(date,withDate);tp_date=new Date();tp_date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec)}else{tp_date=new Date(date.getTime())}if(tp_date.toString()=="Invalid Date"){tp_date=undefined}this._setTime(inst,tp_date)}}};$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker;$.datepicker._setDateDatepicker=function(target,date){var inst=this._getInst(target);if(!inst){return}var tp_date=(date instanceof Date)?new Date(date.getTime()):date;this._updateDatepicker(inst);this._base_setDateDatepicker.apply(this,arguments);this._setTimeDatepicker(target,tp_date,true)};$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker;$.datepicker._getDateDatepicker=function(target,noDefault){var inst=this._getInst(target);if(!inst){return}var tp_inst=this._get(inst,"timepicker");if(tp_inst){var date=this._getDate(inst);if(date&&tp_inst._parseTime($(target).val(),tp_inst.timeOnly)){date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec)}return date}return this._base_getDateDatepicker(target,noDefault)};$.datepicker._base_parseDate=$.datepicker.parseDate;$.datepicker.parseDate=function(format,value,settings){var splitRes=splitDateTime(format,value,settings);return $.datepicker._base_parseDate(format,splitRes[0],settings)};$.datepicker._base_formatDate=$.datepicker._formatDate;$.datepicker._formatDate=function(inst,day,month,year){var tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._updateDateTime(inst);return tp_inst.$input.val()}return this._base_formatDate(inst)};$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker;$.datepicker._optionDatepicker=function(target,name,value){var inst=this._getInst(target);if(!inst){return null}var tp_inst=this._get(inst,"timepicker");if(tp_inst){var min=null,max=null,onselect=null;if(typeof name=="string"){if(name==="minDate"||name==="minDateTime"){min=value}else{if(name==="maxDate"||name==="maxDateTime"){max=value}else{if(name==="onSelect"){onselect=value}}}}else{if(typeof name=="object"){if(name.minDate){min=name.minDate}else{if(name.minDateTime){min=name.minDateTime}else{if(name.maxDate){max=name.maxDate}else{if(name.maxDateTime){max=name.maxDateTime}}}}}}if(min){if(min===0){min=new Date()}else{min=new Date(min)}tp_inst._defaults.minDate=min;tp_inst._defaults.minDateTime=min}else{if(max){if(max===0){max=new Date()}else{max=new Date(max)}tp_inst._defaults.maxDate=max;tp_inst._defaults.maxDateTime=max}else{if(onselect){tp_inst._defaults.onSelect=onselect}}}}if(value===undefined){return this._base_optionDatepicker(target,name)}return this._base_optionDatepicker(target,name,value)};function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]===null||props[name]===undefined){target[name]=props[name]}}return target}var splitDateTime=function(dateFormat,dateTimeString,dateSettings,timeSettings){try{var separator=timeSettings&&timeSettings.separator?timeSettings.separator:$.timepicker._defaults.separator,format=timeSettings&&timeSettings.timeFormat?timeSettings.timeFormat:$.timepicker._defaults.timeFormat,ampm=timeSettings&&timeSettings.ampm?timeSettings.ampm:$.timepicker._defaults.ampm,timeParts=format.split(separator),timePartsLen=timeParts.length,allParts=dateTimeString.split(separator),allPartsLen=allParts.length;if(!ampm){timeParts=$.trim(format.replace(/t/gi,"")).split(separator);timePartsLen=timeParts.length}if(allPartsLen==1){return allParts}if(allPartsLen>1){return[allParts.splice(0,allPartsLen-timePartsLen).join(separator),allParts.splice(timePartsLen*-1).join(separator)]}}catch(err){if(err.indexOf(":")>=0){var dateStringLength=dateTimeString.length-(err.length-err.indexOf(":")-2),timeString=dateTimeString.substring(dateStringLength);return[$.trim(dateTimeString.substring(0,dateStringLength)),$.trim(dateTimeString.substring(dateStringLength))]}else{throw err}}return[dateTimeString,""]};var parseDateTimeInternal=function(dateFormat,timeFormat,dateTimeString,dateSettings,timeSettings){var date;var splitRes=splitDateTime(dateFormat,dateTimeString,dateSettings,timeSettings);date=$.datepicker._base_parseDate(dateFormat,splitRes[0],dateSettings);if(splitRes[1]!==""){var timeString=splitRes[1],parsedTime=$.datepicker.parseTime(timeFormat,timeString,timeSettings);if(parsedTime===null){throw"Wrong time format"}return{date:date,timeObj:parsedTime}}else{return{date:date}}};var selectLocalTimeZone=function(tp_inst,date){if(tp_inst&&tp_inst.timezone_select){tp_inst._defaults.useLocalTimezone=true;var now=typeof date!=="undefined"?date:new Date();var tzoffset=$.timepicker.timeZoneOffsetString(now);if(tp_inst._defaults.timezoneIso8601){tzoffset=tzoffset.substring(0,3)+":"+tzoffset.substring(3)}tp_inst.timezone_select.val(tzoffset)}};$.timepicker=new Timepicker();$.timepicker.timeZoneOffsetString=function(date){var off=date.getTimezoneOffset()*-1,minutes=off%60,hours=(off-minutes)/60;return(off>=0?"+":"-")+("0"+(hours*101).toString()).substr(-2)+("0"+(minutes*101).toString()).substr(-2)};$.timepicker.timeRange=function(startTime,endTime,options){return $.timepicker.handleRange("timepicker",startTime,endTime,options)};$.timepicker.dateTimeRange=function(startTime,endTime,options){$.timepicker.dateRange(startTime,endTime,options,"datetimepicker")};$.timepicker.dateRange=function(startTime,endTime,options,method){method=method||"datepicker";$.timepicker.handleRange(method,startTime,endTime,options)};$.timepicker.handleRange=function(method,startTime,endTime,options){$.fn[method].call(startTime,$.extend({onClose:function(dateText,inst){checkDates(this,endTime,dateText)},onSelect:function(selectedDateTime){selected(this,endTime,"minDate")}},options,options.start));$.fn[method].call(endTime,$.extend({onClose:function(dateText,inst){checkDates(this,startTime,dateText)},onSelect:function(selectedDateTime){selected(this,startTime,"maxDate")}},options,options.end));if(method!="timepicker"&&options.reformat){$([startTime,endTime]).each(function(){var format=$(this)[method].call($(this),"option","dateFormat"),date=new Date($(this).val());if($(this).val()&&date){$(this).val($.datepicker.formatDate(format,date))}})}checkDates(startTime,endTime,startTime.val());function checkDates(changed,other,dateText){if(other.val()&&(new Date(startTime.val())>new Date(endTime.val()))){other.val(dateText)}}selected(startTime,endTime,"minDate");selected(endTime,startTime,"maxDate");function selected(changed,other,option){if(!$(changed).val()){return}var date=$(changed)[method].call($(changed),"getDate");if(date.getTime){$(other)[method].call($(other),"option",option,date)}}return $([startTime.get(0),endTime.get(0)])};$.timepicker.version="1.0.3"})(jQuery);
/*
 * jQuery Form Plugin
 * version: 3.32.0-2013.04.09
 * @requires jQuery v1.5 or later
 * Copyright (c) 2013 M. Alsup
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses.
 * https://github.com/malsup/form#copyright-and-license
 */
(function(h){var e={};e.fileapi=h("<input type='file'/>").get(0).files!==undefined;e.formdata=window.FormData!==undefined;var g=!!h.fn.prop;h.fn.attr2=function(){if(!g){return this.attr.apply(this,arguments)}var i=this.prop.apply(this,arguments);if((i&&i.jquery)||typeof i==="string"){return i}return this.attr.apply(this,arguments)};h.fn.ajaxSubmit=function(p){if(!this.length){f("ajaxSubmit: skipping submit process - no element selected");return this}var j,G,s,u=this;if(typeof p=="function"){p={success:p}}j=this.attr2("method");G=this.attr2("action");s=(typeof G==="string")?h.trim(G):"";s=s||window.location.href||"";if(s){s=(s.match(/^([^#]+)/)||[])[1]}p=h.extend(true,{url:s,success:h.ajaxSettings.success,type:j||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},p);var A={};this.trigger("form-pre-serialize",[this,p,A]);if(A.veto){f("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(p.beforeSerialize&&p.beforeSerialize(this,p)===false){f("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var t=p.traditional;if(t===undefined){t=h.ajaxSettings.traditional}var x=[];var J,K=this.formToArray(p.semantic,x);if(p.data){p.extraData=p.data;J=h.param(p.data,t)}if(p.beforeSubmit&&p.beforeSubmit(K,this,p)===false){f("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[K,this,p,A]);if(A.veto){f("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var E=h.param(K,t);if(J){E=(E?(E+"&"+J):J)}if(p.type.toUpperCase()=="GET"){p.url+=(p.url.indexOf("?")>=0?"&":"?")+E;p.data=null}else{p.data=E}var M=[];if(p.resetForm){M.push(function(){u.resetForm()})}if(p.clearForm){M.push(function(){u.clearForm(p.includeHidden)})}if(!p.dataType&&p.target){var r=p.success||function(){};M.push(function(q){var k=p.replaceTarget?"replaceWith":"html";h(p.target)[k](q).each(r,arguments)})}else{if(p.success){M.push(p.success)}}p.success=function(P,q,Q){var O=p.context||this;for(var N=0,k=M.length;N<k;N++){M[N].apply(O,[P,q,Q||u,u])}};var I=h('input[type=file]:enabled[value!=""]',this);var v=I.length>0;var H="multipart/form-data";var D=(u.attr("enctype")==H||u.attr("encoding")==H);var C=e.fileapi&&e.formdata;f("fileAPI :"+C);var w=(v||D)&&!C;var B;if(p.iframe!==false&&(p.iframe||w)){if(p.closeKeepAlive){h.get(p.closeKeepAlive,function(){B=L(K)})}else{B=L(K)}}else{if((v||D)&&C){B=z(K)}else{B=h.ajax(p)}}u.removeData("jqxhr").data("jqxhr",B);for(var F=0;F<x.length;F++){x[F]=null}this.trigger("form-submit-notify",[this,p]);return this;function i(P){var Q=h.param(P).split("&");var q=Q.length;var k=[];var O,N;for(O=0;O<q;O++){Q[O]=Q[O].replace(/\+/g," ");N=Q[O].split("=");k.push([decodeURIComponent(N[0]),decodeURIComponent(N[1])])}return k}function z(q){var k=new FormData();for(var N=0;N<q.length;N++){k.append(q[N].name,q[N].value)}if(p.extraData){var Q=i(p.extraData);for(N=0;N<Q.length;N++){if(Q[N]){k.append(Q[N][0],Q[N][1])}}}p.data=null;var P=h.extend(true,{},h.ajaxSettings,p,{contentType:false,processData:false,cache:false,type:j||"POST"});if(p.uploadProgress){P.xhr=function(){var R=jQuery.ajaxSettings.xhr();if(R.upload){R.upload.addEventListener("progress",function(V){var U=0;var S=V.loaded||V.position;var T=V.total;if(V.lengthComputable){U=Math.ceil(S/T*100)}p.uploadProgress(V,S,T,U)},false)}return R}}P.data=null;var O=P.beforeSend;P.beforeSend=function(S,R){R.data=k;if(O){O.call(this,S,R)}};return h.ajax(P)}function L(ak){var Q=u[0],P,ag,aa,ai,ad,S,V,T,U,ae,ah,Y;var an=h.Deferred();if(ak){for(ag=0;ag<x.length;ag++){P=h(x[ag]);if(g){P.prop("disabled",false)}else{P.removeAttr("disabled")}}}aa=h.extend(true,{},h.ajaxSettings,p);aa.context=aa.context||aa;ad="jqFormIO"+(new Date().getTime());if(aa.iframeTarget){S=h(aa.iframeTarget);ae=S.attr2("name");if(!ae){S.attr2("name",ad)}else{ad=ae}}else{S=h('<iframe name="'+ad+'" src="'+aa.iframeSrc+'" />');S.css({position:"absolute",top:"-1000px",left:"-1000px"})}V=S[0];T={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(ao){var ap=(ao==="timeout"?"timeout":"aborted");f("aborting upload... "+ap);this.aborted=1;try{if(V.contentWindow.document.execCommand){V.contentWindow.document.execCommand("Stop")}}catch(aq){}S.attr("src",aa.iframeSrc);T.error=ap;if(aa.error){aa.error.call(aa.context,T,ap,ao)}if(ai){h.event.trigger("ajaxError",[T,aa,ap])}if(aa.complete){aa.complete.call(aa.context,T,ap)}}};ai=aa.global;if(ai&&0===h.active++){h.event.trigger("ajaxStart")}if(ai){h.event.trigger("ajaxSend",[T,aa])}if(aa.beforeSend&&aa.beforeSend.call(aa.context,T,aa)===false){if(aa.global){h.active--}an.reject();return an}if(T.aborted){an.reject();return an}U=Q.clk;if(U){ae=U.name;if(ae&&!U.disabled){aa.extraData=aa.extraData||{};aa.extraData[ae]=U.value;if(U.type=="image"){aa.extraData[ae+".x"]=Q.clk_x;aa.extraData[ae+".y"]=Q.clk_y}}}var Z=1;var W=2;function X(aq){var ap=null;try{if(aq.contentWindow){ap=aq.contentWindow.document}}catch(ao){f("cannot get iframe.contentWindow document: "+ao)}if(ap){return ap}try{ap=aq.contentDocument?aq.contentDocument:aq.document}catch(ao){f("cannot get iframe.contentDocument: "+ao);ap=aq.document}return ap}var O=h("meta[name=csrf-token]").attr("content");var N=h("meta[name=csrf-param]").attr("content");if(N&&O){aa.extraData=aa.extraData||{};aa.extraData[N]=O}function af(){var aq=u.attr2("target"),ao=u.attr2("action");Q.setAttribute("target",ad);if(!j){Q.setAttribute("method","POST")}if(ao!=aa.url){Q.setAttribute("action",aa.url)}if(!aa.skipEncodingOverride&&(!j||/post/i.test(j))){u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(aa.timeout){Y=setTimeout(function(){ah=true;ac(Z)},aa.timeout)}function ar(){try{var aw=X(V).readyState;f("state = "+aw);if(aw&&aw.toLowerCase()=="uninitialized"){setTimeout(ar,50)}}catch(ax){f("Server abort: ",ax," (",ax.name,")");ac(W);if(Y){clearTimeout(Y)}Y=undefined}}var ap=[];try{if(aa.extraData){for(var av in aa.extraData){if(aa.extraData.hasOwnProperty(av)){if(h.isPlainObject(aa.extraData[av])&&aa.extraData[av].hasOwnProperty("name")&&aa.extraData[av].hasOwnProperty("value")){ap.push(h('<input type="hidden" name="'+aa.extraData[av].name+'">').val(aa.extraData[av].value).appendTo(Q)[0])}else{ap.push(h('<input type="hidden" name="'+av+'">').val(aa.extraData[av]).appendTo(Q)[0])}}}}if(!aa.iframeTarget){S.appendTo("body");if(V.attachEvent){V.attachEvent("onload",ac)}else{V.addEventListener("load",ac,false)}}setTimeout(ar,15);try{console.log(Q.target);Q.submit()}catch(at){var au=document.createElement("form").submit;au.apply(Q)}}finally{Q.setAttribute("action",ao);if(aq){Q.setAttribute("target",aq)}else{u.removeAttr("target")}h(ap).remove()}}if(aa.forceSync){af()}else{setTimeout(af,10)}var al,am,aj=50,R;function ac(av){if(T.aborted||R){return}am=X(V);if(!am){f("cannot access response document");av=W}if(av===Z&&T){T.abort("timeout");an.reject(T,"timeout");return}else{if(av==W&&T){T.abort("server abort");an.reject(T,"error","server abort");return}}if(!am||am.location.href==aa.iframeSrc){if(!ah){return}}if(V.detachEvent){V.detachEvent("onload",ac)}else{V.removeEventListener("load",ac,false)}var at="success",ax;try{if(ah){throw"timeout"}var ar=aa.dataType=="xml"||am.XMLDocument||h.isXMLDoc(am);f("isXml="+ar);if(!ar&&window.opera&&(am.body===null||!am.body.innerHTML)){if(--aj){f("requeing onLoad callback, DOM not available");setTimeout(ac,250);return}}var ay=am.body?am.body:am.documentElement;T.responseText=ay?ay.innerHTML:null;T.responseXML=am.XMLDocument?am.XMLDocument:am;if(ar){aa.dataType="xml"}T.getResponseHeader=function(aB){var aA={"content-type":aa.dataType};return aA[aB]};if(ay){T.status=Number(ay.getAttribute("status"))||T.status;T.statusText=ay.getAttribute("statusText")||T.statusText}var ao=(aa.dataType||"").toLowerCase();var aw=/(json|script|text)/.test(ao);if(aw||aa.textarea){var au=am.getElementsByTagName("textarea")[0];if(au){T.responseText=au.value;T.status=Number(au.getAttribute("status"))||T.status;T.statusText=au.getAttribute("statusText")||T.statusText}else{if(aw){var ap=am.getElementsByTagName("pre")[0];var az=am.getElementsByTagName("body")[0];if(ap){T.responseText=ap.textContent?ap.textContent:ap.innerText}else{if(az){T.responseText=az.textContent?az.textContent:az.innerText}}}}}else{if(ao=="xml"&&!T.responseXML&&T.responseText){T.responseXML=ab(T.responseText)}}try{al=k(T,ao,aa)}catch(aq){at="parsererror";T.error=ax=(aq||at)}}catch(aq){f("error caught: ",aq);at="error";T.error=ax=(aq||at)}if(T.aborted){f("upload aborted");at=null}if(T.status){at=(T.status>=200&&T.status<300||T.status===304)?"success":"error"}if(at==="success"){if(aa.success){aa.success.call(aa.context,al,"success",T)}an.resolve(T.responseText,"success",T);if(ai){h.event.trigger("ajaxSuccess",[T,aa])}}else{if(at){if(ax===undefined){ax=T.statusText}if(aa.error){aa.error.call(aa.context,T,at,ax)}an.reject(T,"error",ax);if(ai){h.event.trigger("ajaxError",[T,aa,ax])}}}if(ai){h.event.trigger("ajaxComplete",[T,aa])}if(ai&&!--h.active){h.event.trigger("ajaxStop")}if(aa.complete){aa.complete.call(aa.context,T,at)}R=true;if(aa.timeout){clearTimeout(Y)}setTimeout(function(){if(!aa.iframeTarget){S.remove()}T.responseXML=null},100)}var ab=h.parseXML||function(ao,ap){if(window.ActiveXObject){ap=new ActiveXObject("Microsoft.XMLDOM");ap.async="false";ap.loadXML(ao)}else{ap=(new DOMParser()).parseFromString(ao,"text/xml")}return(ap&&ap.documentElement&&ap.documentElement.nodeName!="parsererror")?ap:null};var q=h.parseJSON||function(ao){return window["eval"]("("+ao+")")};var k=function(au,ar,aq){var ap=au.getResponseHeader("content-type")||"",ao=ar==="xml"||!ar&&ap.indexOf("xml")>=0,at=ao?au.responseXML:au.responseText;if(ao&&at.documentElement.nodeName==="parsererror"){if(h.error){h.error("parsererror")}}if(aq&&aq.dataFilter){at=aq.dataFilter(at,ar)}if(typeof at==="string"){if(ar==="json"||!ar&&ap.indexOf("json")>=0){at=q(at)}else{if(ar==="script"||!ar&&ap.indexOf("javascript")>=0){h.globalEval(at)}}}return at};return an}};h.fn.ajaxForm=function(i){i=i||{};i.delegation=i.delegation&&h.isFunction(h.fn.on);if(!i.delegation&&this.length===0){var j={s:this.selector,c:this.context};if(!h.isReady&&j.s){f("DOM not ready, queuing ajaxForm");h(function(){h(j.s,j.c).ajaxForm(i)});return this}f("terminating; zero elements found by selector"+(h.isReady?"":" (DOM not ready)"));return this}if(i.delegation){h(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,a).on("submit.form-plugin",this.selector,i,b).on("click.form-plugin",this.selector,i,a);return this}return this.ajaxFormUnbind().bind("submit.form-plugin",i,b).bind("click.form-plugin",i,a)};function b(j){var i=j.data;if(!j.isDefaultPrevented()){j.preventDefault();h(this).ajaxSubmit(i)}}function a(q){var p=q.target;var j=h(p);if(!(j.is("[type=submit],[type=image]"))){var i=j.closest("[type=submit]");if(i.length===0){return}p=i[0]}var k=this;k.clk=p;if(p.type=="image"){if(q.offsetX!==undefined){k.clk_x=q.offsetX;k.clk_y=q.offsetY}else{if(typeof h.fn.offset=="function"){var r=j.offset();k.clk_x=q.pageX-r.left;k.clk_y=q.pageY-r.top}else{k.clk_x=q.pageX-p.offsetLeft;k.clk_y=q.pageY-p.offsetTop}}}setTimeout(function(){k.clk=k.clk_x=k.clk_y=null},100)}h.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};h.fn.formToArray=function(D,k){var C=[];if(this.length===0){return C}var r=this[0];var u=D?r.getElementsByTagName("*"):r.elements;if(!u){return C}var x,w,t,E,s,A,q;for(x=0,A=u.length;x<A;x++){s=u[x];t=s.name;if(!t||s.disabled){continue}if(D&&r.clk&&s.type=="image"){if(r.clk==s){C.push({name:t,value:h(s).val(),type:s.type});C.push({name:t+".x",value:r.clk_x},{name:t+".y",value:r.clk_y})}continue}E=h.fieldValue(s,true);if(E&&E.constructor==Array){if(k){k.push(s)}for(w=0,q=E.length;w<q;w++){C.push({name:t,value:E[w]})}}else{if(e.fileapi&&s.type=="file"){if(k){k.push(s)}var p=s.files;if(p.length){for(w=0;w<p.length;w++){C.push({name:t,value:p[w],type:s.type})}}else{C.push({name:t,value:"",type:s.type})}}else{if(E!==null&&typeof E!="undefined"){if(k){k.push(s)}C.push({name:t,value:E,type:s.type,required:s.required})}}}}if(!D&&r.clk){var z=h(r.clk),B=z[0];t=B.name;if(t&&!B.disabled&&B.type=="image"){C.push({name:t,value:z.val()});C.push({name:t+".x",value:r.clk_x},{name:t+".y",value:r.clk_y})}}return C};h.fn.formSerialize=function(i){return h.param(this.formToArray(i))};h.fn.fieldSerialize=function(j){var i=[];this.each(function(){var r=this.name;if(!r){return}var p=h.fieldValue(this,j);if(p&&p.constructor==Array){for(var q=0,k=p.length;q<k;q++){i.push({name:r,value:p[q]})}}else{if(p!==null&&typeof p!="undefined"){i.push({name:this.name,value:p})}}});return h.param(i)};h.fn.fieldValue=function(s){for(var r=[],p=0,j=this.length;p<j;p++){var q=this[p];var k=h.fieldValue(q,s);if(k===null||typeof k=="undefined"||(k.constructor==Array&&!k.length)){continue}if(k.constructor==Array){h.merge(r,k)}else{r.push(k)}}return r};h.fieldValue=function(j,u){var p=j.name,B=j.type,C=j.tagName.toLowerCase();if(u===undefined){u=true}if(u&&(!p||j.disabled||B=="reset"||B=="button"||(B=="checkbox"||B=="radio")&&!j.checked||(B=="submit"||B=="image")&&j.form&&j.form.clk!=j||C=="select"&&j.selectedIndex==-1)){return null}if(C=="select"){var w=j.selectedIndex;if(w<0){return null}var z=[],k=j.options;var r=(B=="select-one");var x=(r?w+1:k.length);for(var q=(r?w:0);q<x;q++){var s=k[q];if(s.selected){var A=s.value;if(!A){A=(s.attributes&&s.attributes.value&&!(s.attributes.value.specified))?s.text:s.value}if(r){return A}z.push(A)}}return z}return h(j).val()};h.fn.clearForm=function(i){return this.each(function(){h("input,select,textarea",this).clearFields(i)})};h.fn.clearFields=h.fn.clearInputs=function(i){var j=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var p=this.type,k=this.tagName.toLowerCase();if(j.test(p)||k=="textarea"){this.value=""}else{if(p=="checkbox"||p=="radio"){this.checked=false}else{if(k=="select"){this.selectedIndex=-1}else{if(p=="file"){if(/MSIE/.test(navigator.userAgent)){h(this).replaceWith(h(this).clone(true))}else{h(this).val("")}}else{if(i){if((i===true&&/hidden/.test(p))||(typeof i=="string"&&h(this).is(i))){this.value=""}}}}}}})};h.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};h.fn.enable=function(i){if(i===undefined){i=true}return this.each(function(){this.disabled=!i})};h.fn.selected=function(i){if(i===undefined){i=true}return this.each(function(){var j=this.type;if(j=="checkbox"||j=="radio"){this.checked=i}else{if(this.tagName.toLowerCase()=="option"){var k=h(this).parent("select");if(i&&k[0]&&k[0].type=="select-one"){k.find("option").selected(false)}this.selected=i}}})};h.fn.ajaxSubmit.debug=false;function f(){if(!h.fn.ajaxSubmit.debug){return}var i="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(i)}else{if(window.opera&&window.opera.postError){window.opera.postError(i)}}}})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.widget",{options:{mode:"browser"},_create:function(){var e=this,g=this.options,f=this.element;g.mode=g.readonly&&g.mode=="edit"?"browser":g.mode;f.addClass("an-widget "+g.mode)[0].contentEditable=false;g.metadata=f.getMetadata()||{};g.attributes=attributes(f.get(0));g["transient"]=g.attributes["transient"];g.id=f.attr("id");if(g.id){g.id=g.id.replace(/-/g,".")}g.type=f.attr("type");if(a.type(g.parent)=="function"){g.parent=g.parent()}this.content=f.children("div.content");if(this.content.size()==0){this.content=a("<div class='content'/>").appendTo(f)}this._makeResizable();f.bind("metadatachanged.widget",function(j,i,h){j.stopImmediatePropagation();e._reloadMetadata(i,h)}).bind("attributeschanged.widget",function(j,h,i){j.stopImmediatePropagation();g.attributes=h;e._trigger("optionchanged",null,{key:"attributes",value:h,oldValue:i})}).bind("dblclick.widget click.widget change.widget",function(h){if(a(h.target).closest(".widget")[0]==e.element[0]){setTimeout(function(){f.trigger(a.Event(h,{type:"widget"+h.type}),e)},20)}})},_init:function(){this.refresh()},selectable:function(f){return this.options.mode=="design"},_makeResizable:function(){var e=this,h=this.options,g=this.element,f=null;g.removeClass("fill-width auto-width fill-height auto-height");if(h.width=="fill"||h.width=="auto"){g.css("width","").addClass(h.width+"-width")}else{f="e"}if(h.height=="fill"||h.height=="auto"){g.css("height","").addClass(h.height+"-height")}else{f=f?(f+",s,se"):"s"}if(f&&(h.mode=="design"||h.resizable)){g.resizable({handles:f,stop:function(j,i){e._trigger("resize",null,{size:i.size,oldSize:i.originalSize})}})}},option:function(e,f){var g=this.options;if(e==="mode"&&f==="edit"&&g.readonly){f="browser"}if(e==="value"&&f===b){return g.value}if(e==="actionSet"&&f===b){return g.actioSet}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(f,g){var h=this.options,e=h[f];if(!equals(g,e)){a.Widget.prototype._setOption.apply(this,arguments);this._handleChange(f,g,e);this._trigger("optionchanged",null,{key:f,value:g,oldValue:e,isTransient:h.isTransient})}return this},_handleChange:function(f,g,e){if(f==="mode"||f==="value"){if(f==="mode"){this.element.removeClass(e).addClass(g)}this.refresh()}else{if(f=="width"||f=="height"){this._makeResizable()}else{if(f=="readonly"){if(g){this.option("mode","browser")}else{this.option("mode","edit")}}}}},_reloadMetadata:function(f,e){this.options.metadata=f;this.option(f[this.widgetName]);this.refresh();this._trigger("optionchanged",null,{key:"metadata",value:f,oldValue:e})},_updateMetadata:function(){var g=this.options,f=this.element,e=f.getMetadata();if(!equals(g.metadata,e)){f.setMetadata(g.metadata);this._trigger("optionchanged",null,{key:"metadata",value:g.metadata,oldValue:e})}},refresh:function(){var e=this.options;this["_"+e.mode]&&this["_"+e.mode]()},highlight:function(e){this.element.toggleClass("an-state-hover",e)},scrollTo:function(){var f=this.options,e={onlyIfOutside:true,offsetTop:50,offsetLeft:50};if(f.mode=="design"){f.parent.scrollTo(f.id,e)}else{this.element.ScrollTo(e)}},destroy:function(){this.element.resizable("destroy").unbind(".widget").removeAttr("contenteditable").removeClass("an-widget browser design edit selected");return a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.field",a.an.widget,{options:{value:"",},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var g=this.options,f=this.element;f.addClass("an-field");var e={};if(g.width){e.width=g.width}if(g.height){e.height=g.height}this.content.empty();if(!a.isEmptyObject(e)){this.content.css(e)}g.isTransient=f.attr("transient");this._createControl();this._createLabel()},_createControl:function(){},_createLabel:function(){var f=this.options,e=this.element;if(f.label){a("<label/>").attr("for",f.id).html(f.label).prependTo(e)}},destroy:function(){this.content.remove();this.element.removeClass("an-field").children("label").remove();return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.box",a.an.widget,{options:{visibleButtonCount:3,link:"raw"},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var f=this.options,e=this.element;e.addClass("an-box ui-corner-all").addClass(f.link=="raw"?"raw":"link").children(".title-bar").remove();this._showTitleBar(!f.hideTitleBar);this._showFootButtons(f.footAreaButtons||[]);e.bind("contextmenu2.box contextmenu.box",function(g){if((f.contextmenu2&&g.type=="contextmenu2")||(!f.contextmenu2&&g.type=="contextmenu")){var h={};if(f.mode=="design"){h.select={type:"menuItem",text:"Select",handler:function(){e.trigger("click")}}}if(!a.isEmptyObject(h)){a(g.target).menu({autoShow:true,menuPosition:{of:g,my:"left top",at:"left bottom"},actions:h,select:function(j,i){a(this).menu("destroy")},collapseAll:function(i){a(this).menu("destroy")}})}}g.preventDefault()})},selectable:function(g){var h=this.options,f=g.target;if(h.hideTitleBar){return f==this.element[0]}else{return a(f).closest("div.title-bar")[0]==this.titleBar[0]}},_showTitleBar:function(e){var g=this.options,f=this.element;if(e){if(!this.titleBar){this.titleBar=a("<div class='title-bar ui-widget-header ui-corner-top'/>").prependTo(this.element);this.title=a("<div class='title'/>").html(g.title).appendTo(this.titleBar);this.toolbar=a("<div class='toolbar'/>").appendTo(this.titleBar)}this._refreshToolbarButtons()}else{f.removeClass("title-bar");this.titleBar&&this.titleBar.remove();delete this.titleBar}},_refreshToolbarButtons:function(){var g=this,k=this.options,j=k.toolbarButtons||[];a.each(j,function(i,p){if(i>=k.visibleButtonCount){return false}a("<button class='title-button'/>").appendTo(g.toolbar).button({label:p.label}).click(function(q){g.element.trigger("boxtoolbarbuttonclick",[g,p.id]);q.preventDefault();q.stopImmediatePropagation()})});if(j.length>k.visibleButtonCount){var f=[];for(var h=k.visibleButtonCount;h<j.length;h++){f.push({id:j[h].id,type:"menuItem",text:j[h].label,handler:function(){g.element.trigger("toolbarbuttonclick",[g,this.id])},enabled:function(){return true}})}var e=a("<button class='box-menu'/>").button({label:"Box Menu",text:false,icons:{primary:"box-menu-icon"}}).appendTo(g.toolbar);e.menu({triggerEvent:"click",menuPosition:{of:e,my:"right top",at:"right bottom"},actions:f,select:function(){a(this).menu("collapseAll")}}).click(function(i){i.preventDefault()}).blur(function(i){e.menu("collapseAll")})}},_showFootButtons:function(g){var e=this,f=this.element;if(g&&g.length>0){if(!this.footArea){this.footArea=a("<div class='foot-area'/>").appendTo(f)}else{this.footArea.empty()}a.each(g,function(h,i){a("<button class='foot-button'/>").attr("id",i.id).html(i.label).prependTo(e.footArea).button().click(function(j){e.element.trigger("boxfootareabuttonclick",[e,i.id]);j.preventDefault();j.stopImmediatePropagation()})})}else{f.removeClass("foot-area");this.footArea&&this.footArea.remove();delete this.footArea}},newDocument:function(h,i){i=i||{};var f=this,k=this.options,e=i.dbId||k.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),j=a.extend(true,{},i,{opened:function(p){var q=p.option("document"),r=i.title||q.title||q._id;f._showFootButtons(i.footAreaButtons||[]);f.option("title",r);i.opened&&i.opened(p)}});j.mode=j.mode!="design"?"edit":j.mode;j.mobile=i.mobile;if(i.mobile&&i.mode=="design"){a.ans.getDoc(e,i.parent,null,function(r,t){if(r){console.log("Get parent document "+i.parent+" error:"+r)}else{var q=Model.rootId(h),s=a.extend(true,{},i["default"],{_id:i.id||new ObjectId().toString(),type:h});if(s._path){s._path=s._path.replace(/[^,]+,$/,s._id+",")}else{if(q){s._path=q+","+s._id+","}}if(t&&t._path){s._path=t._path+s._id+","}if(s.type==Model.FORM||s.type==Model.PAGE){g.page({mode:"design",mobile:true,page:s})}else{Model.newDocument(g,e,h,j)}}})}else{Model.newDocument(g,e,h,j)}return this},openDocument:function(g,i){i=i||{};var f=this,k=this.options,e=i.dbId||k.dbId,h=a("<div class='target'/>").appendTo(this.content.empty()),j=a.extend(true,{},i,{opened:function(p){var q=p.option("document"),r=i.title||q.title||q._id;f._showFootButtons(i.footAreaButtons||[]);f.option("title",r);i.opened&&i.opened(p)}});if(k.mobile&&k.mode=="design"){Model.getPages(e,[g],function(p,q){h.page({mode:"design",page:q[0],mobile:true})})}else{Model.openDocument(h,e,g,j)}return this},saveDocument:function(e){e=e||{};var f=this.linkedWidget();if(f&&f.option("isDocumentEditor")){f.save(e)}return this},openForm:function(k,h){h=h||{};a.extend(true,h,{isFormEditor:true});var f=this,j=this.options,e=h.dbId||j.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{mode:h.mode!="design"?"edit":h.mode},h,{opened:function(p){var q=p.option("currentForm"),r=h.title||q.title||q._id;f._showFootButtons(h.footAreaButtons||[]);f.option("title",r);h.opened&&h.opened(p)}});if(j.mobile&&j.mode=="design"){Model.getPages(e,[k],function(q,p){g.page({mode:"design",page:p[0],document:p[0],mobile:true})})}else{Model.openPage(g,e,k,i)}return this},openView:function(e,i){i=i||{};var g=this,k=this.options,f=i.dbId||k.dbId,h=a("<div class='target'/>").appendTo(this.content.empty()),j=a.extend(true,{},i,{opened:function(p){var q=p.option("view"),r=i.title||q.title||q._id;g._showFootButtons(i.footAreaButtons||[]);g.option("title",r);i.opened&&i.opened(p)}});Model.openView(h,f,e,j);return this},openPage:function(g,i){i=i||{};a.extend(true,i,{isPageEditor:true});var f=this,k=this.options,e=i.dbId||k.dbId,h=a("<div class='target'/>").appendTo(this.content.empty()),j=a.extend(true,{mode:i.mode!="design"?"edit":i.mode},i,{opened:function(q){var r,s;if(q.option("mobile")){s=i.title}else{r=q.option("page"),s=i.title||r.title||r._id}f._showFootButtons(i.footAreaButtons||[]);f.option("title",s);i.opened&&i.opened(q)}});if(k.mobile&&k.mode=="design"){Model.getPages(e,[g],function(q,p){h.page({mode:"design",page:p[0],mobile:true})})}else{Model.openPage(h,e,g,j)}return this},openSideView:function(h,i){i=i||{};var f=this,k=this.options,e=i.dbId||k.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),j=a.extend(true,{},i,{opened:function(p){var q=i.title||p.option("title")||p.option("_id");f._showFootButtons(i.footAreaButtons||[]);f.option("title",q);i.opened&&i.opened(page)}});Model.openSideView(g,e,h,j);return this},_browser:function(){var p=this.options,g=p.link;this.option("contextmenu2",false);this.content[0].contentEditable=false;if(g&&g!="raw"){var k=this.content.children(".target"),j=k.data(),h=false;for(var e in j){if(a.inArray(e,["editor","gridview","formview","customview","customizedview","page","sideview","explorer","mobilelistview"])!=-1){j[e].option("mode","browser");h=true}}if(!h){var f={dbId:p.odbId||p.dbId,mobile:p.mobile},q=p.targetId;if(p.mobile&&p.mode=="design"){f.mode=p.mode}if(g=="documentType"){this.newDocument(q,f)}else{if(g=="document"){this.openDocument(q,f)}else{if(g=="form"){this.openForm(q,f)}else{if(g=="view"){this.openView(q,f)}else{if(g=="page"){this.openPage(q,f)}else{if(g=="sideView"){this.openSideView(q,f)}}}}}}}}},linkedWidget:function(){var f=this.content.children(".an-view,.an-page,.an-editor,.an-mpage").data(),e=null;if(f){a.each(f,function(){if(a.inArray(this.widgetName,["editor","gridview","formview","customview","view","page","mobilelistview"])!=-1){e=this;return false}})}return e},_edit:function(){var h=this.options,q=h.link;this.option("contextmenu2",false);this.content[0].contentEditable=false;if(q&&q!="raw"){var p=this.content.children(".target"),j=p.data(),e=false;for(var k in j){if(k=="editor"){j[k].option("mode","edit");e=true}if(a.inArray(k,["gridview","formview","view","page","sideview","explorer"])!=-1){j[k].option("mode","browser");e=true}}if(!e){var f=h.targetId,g={dbId:h.odbId||h.dbId},r={mode:"edit",dbId:h.odbId||h.dbId};if(q=="documentType"){this.newDocument(f,r)}else{if(q=="document"){this.openDocument(f,r)}else{if(q=="form"){this.openForm(f,r)}else{if(q=="view"){this.openView(f,g)}else{if(q=="page"){this.openPage(f,r)}else{if(q=="sideView"){this.openSideView(f,g)}}}}}}}}},_design:function(){var f=this.options,e=f.link;if(f.mobile){f.mode="design"}this._browser();this.option("contextmenu2",true);if(e=="raw"){this.content[0].contentEditable=true}},_handleChange:function(f,g,e){if(f==="title"){this.title&&this.title.html(g)}else{if(f==="hideTitleBar"){this._showTitleBar(!g)}}return a.an.widget.prototype._handleChange.apply(this,arguments)},destroy:function(){var f=this.options,e=f.link;if(e&&e!="raw"){this.content.remove()}else{this.content.removeAttr("contenteditable")}this.titleBar&&this.titleBar.remove();this.footArea&&this.footArea.remove();this.element.unbind(".box").removeClass("an-box ui-corner-all title-bar");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
 * This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.inputfield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-inputfield")},_createControl:function(){var e=this,g=this.options;if(g.mobile){var f=this.element.find(".content").eq(0);f.addClass("ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c ui-input-text");this.input=a("<input type='"+g.type+"'/>").attr({name:g.id}).addClass("ui-body-c ui-input-text").bind("change.inputfield keyup.inputfield",function(j){var i=e.input.val(),h=g.value;if(i!=h){g.value=i;e._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}}).bind("dblclick.inputfield",function(h){h.stopImmediatePropagation()}).bind("focus.inputfield",function(h){f.addClass("ui-focus")}).bind("blur.inputfield",function(h){f.removeClass("ui-focus")}).bind("keyup.inputfield",function(h){});if(g.placeholder){this.input.attr("placeholder",g.placeholder)}if(g.value){this.input.attr("value",g.value);this._trigger("optionchanged",null,{key:"value",value:g.value,oldValue:"",isTransient:g.isTransient})}if(g.data_mini){this.input.attr("data-mini",g.data_mini)}}else{this.input=a("<input type='"+g.type+"'/>").attr({name:g.id}).addClass("ui-widget-content ui-corner-all").bind("change.inputfield keyup.inputfield",function(j){var i=e.input.val(),h=g.value;if(i!=h){g.value=i;e._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}}).bind("dblclick.inputfield",function(h){h.stopImmediatePropagation()})}if(!a.isEmptyObject(g.validate)){this.input.addClass(a.toJSON({validate:g.validate}))}this.input.css({width:g.width,height:g.height})},_makeResizable:function(){},_browser:function(){this.input.detach();var e=this.content;if(e.is(".ui-resizable")){e.resizable("destroy")}e.html(this.options.value+"").css("display","")},_edit:function(){this.input.detach().val(this.options.value).appendTo(this.content.empty())},_design:function(){this.input.detach();var e=this,f=this.options,g=this.content;if(g.is(".ui-resizable")){g.resizable("destroy")}g.html(f.value+"").css({width:f.width,height:f.height,display:""}).resizable({stop:function(i,h){f.width=g.width();f.height=g.height();a.extend(true,f.metadata[e.widgetName],{width:f.width,height:f.height});e._updateMetadata();e._trigger("resize",null,{size:h.size,oldSize:h.originalSize})}})},_handleChange:function(f,g,e){if(f==="label"){this.input&&this.input.remove();this.element.children("label").remove();this._createControl();this._createLabel()}else{a.an.field.prototype._handleChange.apply(this,arguments)}},highlight:function(e){(this.options.mode=="edit"?this.input:this.element).toggleClass("an-state-hover",e)},destroy:function(){this.input&&this.input.unbind(".inputfield").remove();this.element.removeClass("an-inputfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(b,e){var a="C:\\fakepath\\";b.widget("an.fileinput",{options:{browserButtonText:"Browse",uploadParams:{},uploadURL:"",uploadButtonText:"Upload",inputText:""},_create:function(){var f=this,g=this.options;this.parent=this.element.parent();this.fileFile=this.element;this.wrapper=b("<div class='wrapper' />").insertAfter(this.fileFile);this.fileWrapper=b("<div class='fileinput-wrapper' />").hover(function(){f.browserButton.addClass("ui-state-hover")},function(){f.browserButton.removeClass("ui-state-hover ui-state-active")}).bind("mousemove.fileinput",function(i){var h=f.fileFile,j=b(this).offset();h.css({left:(i.pageX-j.left)-(h.width()/1.2),top:(i.pageY-j.top)-(h.height()/2)})}).bind("mousedown.fileinput",function(h){f.browserButton.addClass("ui-state-active")}).bind("mouseup.fileinput",function(h){f.browserButton.removeClass("ui-state-active")}).appendTo(this.wrapper);this.fileFile.addClass("fileinput-file").appendTo(this.fileWrapper);this.fileInput=b("<div class='fileinput-input ui-widget-content ui-corner-left' />").text(this._getText()).insertBefore(this.fileFile);this.browserButtonText=b("<span class='fileinput-button-text' />").text(g.browserButtonText);this.browserButton=b("<span class='fileinput-button ui-state-default ui-widget-header ui-corner-right' />").append(this.browserButtonText).insertAfter(this.fileInput);if(g.upload){this.uploadButtonText=b("<span class='fileinput-button-text' />").text(g.uploadButtonText);this.uploadButton=b("<span class='upload-button ui-state-default ui-widget-header ui-corner-right' />").append(this.uploadButtonText).insertAfter(this.fileWrapper).click(function(i){f.fileInput.progressbar();var h=b('<form action="" method="POST"></form>');f.fileFile.clone().attr("name","attachment").appendTo(h);b.each(g.uploadParams,function(p,j){b('<input type="hidden">').attr("name",p).attr("value",j).appendTo(h)});h.ajaxSubmit({url:g.uploadURL,uploadProgress:function(q,j,p,k){f.fileInput.progressbar("option","value",k*100)},success:function(j){f.fileInput.progressbar("destroy").addClass("ui-widget-content");f.element.trigger("uploaded",[j]);f.reset()}})})}this.fileFile.bind("change.fileinput mouseout.fileinput",function(h){f.fileInput.text(f._getText())}).bind("focusin.fileinput",function(){f.browserButton.addClass("ui-state-hover")}).bind("focusout.fileinput",function(){f.browserButton.removeClass("ui-state-hover")})},_getText:function(){var f=this.getValue(),g=this.options.inputText;if(f==""){return g}else{return f}},getValue:function(){return fileValue=this.fileFile.val().replace(a,"")},reset:function(){this.fileInput.text(this.options.inputText)},destroy:function(){this.fileFile.removeClass("fileinput-file").appendTo(this.parent);this.wrapper.remove();b.Widget.prototype.destroy.call(this)},hide:function(){this.wrapper.hide()},show:function(){this.wrapper.show()},_setOption:function(f,g){b.Widget.prototype._setOption.apply(this,arguments);switch(f){case"browserButtonText":this.browserButtonText.text(g);break;case"inputText":this.fileInput.text(this._getText());break}}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.textfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-textfield")},destroy:function(){this.element.removeClass("an-textfield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.radiofield",a.an.inputfield,{options:{orientation:"horizontal"},_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-radiofield");this.content.remove()},_createControl:function(){var f=this,i=this.options,g=this.element;if(i.mobile){var h=a("<div class='ui-controlgroup-controls' />");h.append(a("<label />").attr("for",i.id).html(i.label).css("display","block"));a.each(i.selectItems||[],function(p,j){var s=a("<div class='ui-radio' />");a("<input type='radio'/>").attr({id:i.id+p,name:i.id,value:this.value}).addClass("ui-widget-content").appendTo(s);a("<div class='content'/>").hide().appendTo(g);var q='<span class="ui-btn-inner"><span class="ui-btn-text">'+this.label+'</span> 					<span class="ui-icon ui-icon-radio-on ui-icon-shadow"> </span>					</span>';var r=a("<label class='ui-radio-off ui-btn ui-btn-up-c ui-fullsize ui-btn-icon-left' style='margin:0'  />").attr("for",i.id+p);if(!i.data_theme){i.data_theme="c"}if(p==0){r.addClass("ui-first-child")}if(p==(i.selectItems.length-1)){r.addClass("ui-last-child")}r.addClass("ui-btn-up-"+i.data_theme);r.html(q).appendTo(s);s.appendTo(h)});var e=a("<div border='1' class='ui-controlgroup ui-corner-all ui-controlgroup-"+i.orientation+"'/>");if(i.isMini){e.addClass("ui-mini")}h.appendTo(e.appendTo(g));h.delegate(".ui-radio","click",function(k){var j=a(this);if(i.orientation=="vertical"){j.removeClass("ui-icon-radio-off").addClass("ui-radio-on").siblings().removeClass("ui-radio-on")}else{j.find(">label").addClass("ui-btn-active");j.siblings().find(">label").removeClass("ui-btn-active")}j.find("input").attr("checked","checked");j.siblings().find("input").removeAttr("checked");j.find("input").trigger("change.radiofield")})}else{a.each(i.selectItems||[],function(p,j){a("<input type='radio'/>").attr({id:i.id+p,name:i.id,value:this.value}).addClass("ui-widget-content ui-corner-all").appendTo(g);a("<div class='content'/>").hide().appendTo(g);a("<label/>").attr("for",i.id+p).html(this.label).appendTo(g);if(i.orientation=="vertical"){g.append("<br>")}})}this.inputs=g.find("input");this.contents=g.children(".content");if(!a.isEmptyObject(i.validate)){this.inputs.addClass(a.toJSON({validate:i.validate}))}this.inputs.filter("[value="+i.value+"]").prop("checked",true);this.inputs.bind("change.radiofield",function(p){var k=a(p.target).attr("value"),j=i.value;if(k!=j){i.value=k;f._trigger("optionchanged",null,{key:"value",value:k,oldValue:j,isTransient:i.isTransient})}}).bind("dblclick.radiofield",function(j){j.stopImmediatePropagation()})},_createLabel:function(){},_makeResizable:function(){},_handleChange:function(f,g,e){var h=this.options;if(f=="value"){this.inputs.filter("[value="+h.value+"]").prop("checked",true)}else{if(f=="selectItems"){this.inputs.remove();this.contents.remove();this.element.children("label,br").remove();this._createControl()}else{if(f=="orientation"){this.inputs.remove();this.contents.remove();this.element.children("label,br").remove();this._createControl()}else{return a.an.inputfield.prototype._handleChange.apply(this,arguments)}}}},_browser:function(){this.contents.css("display","none");this.inputs.attr("disabled","disabled")},_edit:function(){this.contents.css("display","none");this.inputs.removeAttr("disabled")},_design:function(){if(!this.options.mobile){this.inputs.hide();this.contents.css("display","")}},highlight:function(e){this.element.toggleClass("an-state-hover",e)},destroy:function(){if(this.options.mobile){this.element.children(".ui-controlgroup").unbind(".radiofield").remove()}this.inputs.unbind(".radiofield").remove();this.contents.remove();this.element.removeClass("an-radiofield").children("br").remove();a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.checkboxfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-checkboxfield");this.content.hide()},_createControl:function(){var f=this,i=this.options,g=this.element,j=this.content;if(i.mobile){var h={};if(i.selectItems.length>1){var e=a("<fieldset data-role='controlgroup' />").appendTo(j);if(i.orientation=="horizontal"){e.attr({"data-type":"horizontal"})}a.each(i.selectItems||[],function(q,p){this.input=a("<input type='checkbox'/>").attr({id:i.id+q,name:i.id+q,value:this.value}).appendTo(e);a("<label />").attr({"for":i.id+q}).html(this.label).appendTo(e)})}else{a.each(i.selectItems||[],function(q,p){this.input=a("<input type='checkbox'/>").attr({id:i.id,name:i.id,value:this.value}).addClass("custom").appendTo(j);a("<label  />").attr({"for":i.id}).html(this.label).appendTo(j)})}if(!i.data_theme){i.data_theme="c"}h.theme=i.data_theme;if(i.isMini){h.mini=true}if(a("input[type='checkbox']").checkboxradio){a("input[type='checkbox']").checkboxradio(h);a("fieldset[data-role='controlgroup']").controlgroup()}}else{this.input=a("<input type='checkbox'/>").attr({name:i.id}).addClass("ui-widget-content ui-corner-all").bind("change.checkboxfield",function(q){var p=f.input.prop("checked"),k=i.value;if(p!=k){i.value=p;f._trigger("optionchanged",null,{key:"value",value:p,oldValue:k,isTransient:i.isTransient})}}).bind("dblclick.checkboxfield",function(k){k.stopImmediatePropagation()});if(!a.isEmptyObject(i.validate)){this.input.addClass(a.toJSON({validate:i.validate}))}this.input.appendTo(this.element)}},_handleChange:function(f,g,e){var h=this.options;if(f=="value"){this.input.filter("[value="+h.value+"]").prop("checked",true)}else{if(f=="selectItems"){this.input.remove();this.contents.remove();this.element.children("label,br").remove();this._createControl()}else{return a.an.inputfield.prototype._handleChange.apply(this,arguments)}}},_makeResizable:function(){},_createLabel:function(){var f=this.options,e=this.element;if(f.label){if(!f.mobile){a("<label/>").attr("for",f.id).html(f.label).appendTo(e)}}},_browser:function(){if(!this.options.mobile){this.input.prop("checked",this.options.value).attr("disabled","disabled")}else{this.content.css("display","")}},_edit:function(){if(!this.options.mobile){this.input.prop("checked",this.options.value).removeAttr("disabled")}else{this.content.css("display","")}},_design:function(){var g=this.options,h=this.content;if(g.mobile){if(!g.data_theme){g.data_theme="c"}h.html("");if(g.selectItems.length>1){var e=a("<fieldset class='ui-corner-all ui-controlgroup' />").appendTo(h);if(g.orientation=="horizontal"){e.addClass("ui-controlgroup-horizontal")}var f=a("<div class='ui-controlgroup-controls' />").appendTo(e);a.each(g.selectItems||[],function(j,i){var q=a("<div class='ui-checkbox' />").html('<input type="checkbox" id="'+g.id+j+'" name="'+g.id+j+'" value="'+i+'">').appendTo(f);var p=a("<label class='ui-checkbox-off ui-btn ui-btn-corner-all ui-fullsize ui-btn-icon-left ui-btn-up-"+g.data_theme+"' />").html('<span class="ui-btn-inner"><span class="ui-btn-text">'+this.label+'</span><span class="ui-icon ui-icon-checkbox-off ui-icon-shadow">&nbsp;</span></span>').appendTo(q);if(j==0){p.addClass("ui-first-child")}if(j==g.selectItems.length-1){p.addClass("ui-last-child")}})}else{a.each(g.selectItems||[],function(j,i){a("<div class='ui-checkbox' />").html('<input type="checkbox" id="'+g.id+j+'" name="'+g.id+j+'" value="'+i+'"><label for="1230" class="ui-checkbox-off ui-btn ui-btn-corner-all ui-fullsize ui-btn-icon-left ui-btn-up-'+g.data_theme+'"><span class="ui-btn-inner"><span class="ui-btn-text">'+this.label+'</span><span class="ui-icon ui-icon-checkbox-off ui-icon-shadow">&nbsp;</span></span></label>').appendTo(h)})}this.content.css("display","")}else{this.input.hide();this.content.css("display","")}},highlight:function(e){this.element.toggleClass("an-state-hover",e)},destroy:function(){if(!this.options.mobile){this.input.unbind(".checkboxfield")}this.element.removeClass("an-checkboxfield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.passwordfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-passwordfield")},_browser:function(){a.an.inputfield.prototype._browser.apply(this,arguments);this.content.html("********")},_design:function(){this.input.hide();var e=this,f=this.options,g=this.content;if(g.is(".ui-resizable")){g.resizable("destroy")}g.html("********").css({width:f.width,height:f.height,display:""}).resizable({stop:function(i,h){f.width=g.width();f.height=g.height();a.extend(true,f.metadata[e.widgetName],{width:f.width,height:f.height});e._updateMetadata();e._trigger("resize",null,{size:h.size,oldSize:h.originalSize})}})},destroy:function(){this.element.removeClass("an-passwordfield");a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.datetimefield",$.an.inputfield,{_create:function(){$.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-datetimefield")},_edit:function(){var date=new Date(),lng=window.database.local,opts={hour:date.getHours(),minute:date.getMinutes(),dateFormat:this.options.dateFormat?this.options.dateFormat:"mm/dd/yy",minDate:this.options.minDate&&eval("("+this.options.minDate+")")||null,maxDate:this.options.maxDate&&eval("("+this.options.maxDate+")")||null,yearRange:this.options.yearRange?this.options.yearRange:"c-10:c+10",changeMonth:true,changeYear:true,onClose:function(){var $this=$(this);$this.valid&&$this.valid()}};if(lng&&lng!="en"){$.extend(opts,$.i18n.datepicker)}$.an.inputfield.prototype._edit.apply(this,arguments);this.input.removeClass("hasDatepicker");if(this.options.time=="y"){this.input.datetimepicker(opts)}else{this.input.datepicker(opts)}},destroy:function(){this.input.datepicker("destroy");this.element.removeClass("an-datetimefield");return $.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.textareafield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-textareafield")},_createControl:function(){var e=this,g=this.options,f=this.element;if(g.mobile){f.find(".content").addClass("codiqa-control");this.textarea=a("<textarea type='"+g.type+"'/>").attr("name",g.id).addClass("ui-input-text ui-body-c ui-corner-all ui-shadow-inset");this.textarea.bind("change.textareafield keyup.textareafield",function(j){j.preventDefault();var i=e.textarea.val(),h=g.value;if(i!=h){g.value=i;e._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}}).bind("dblclick.textareafield",function(h){h.stopImmediatePropagation()}).bind("focus.textareafield",function(h){a(this).addClass("ui-focus")}).bind("blur.textareafield",function(h){a(this).removeClass("ui-focus")})}else{this.textarea=a("<textarea type='"+g.type+"'/>").attr("name",g.id).addClass("ui-widget-content ui-corner-all");this.textarea.bind("change.textareafield keyup.textareafield",function(j){j.preventDefault();var i=e.textarea.val(),h=g.value;if(i!=h){g.value=i;e._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}}).bind("dblclick.textareafield",function(h){h.stopImmediatePropagation()})}if(g.resizable){this.content.resizable()}if(!a.isEmptyObject(g.validate)){this.textarea.addClass(a.toJSON({validate:g.validate}))}},_makeResizable:function(){},_browser:function(){this.textarea.detach();var e=this.options,f=this.content;if(f.is(".ui-resizable")){f.resizable("destroy")}f.html(e.pre?"<pre>"+e.value+"</pre>":e.value).css("display","")},_edit:function(){this.textarea.detach().val(this.options.value).appendTo(this.content.empty())},_design:function(){this.textarea.detach();var e=this,f=this.options,g=this.content;if(g.is(".ui-resizable")){g.resizable("destroy")}g.html(f.pre?"<pre>"+f.value+"</pre>":f.value).css({width:f.width,height:f.height,display:""}).resizable({stop:function(i,h){f.width=g.width();f.height=g.height();a.extend(true,f.metadata[e.widgetName],{width:f.width,height:f.height});e._updateMetadata();e._trigger("resize",null,{size:h.size,oldSize:h.originalSize})}})},_handleChange:function(f,g,e){if(f==="label"){this.textarea.remove();this.element.children("label").remove();this._createControl();this._createLabel()}else{a.an.field.prototype._handleChange.apply(this,arguments)}},destroy:function(){this.textarea.unbind(".textareafield").parent().remove();this.element.removeClass("an-textareafield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.rtefield",a.an.field,{options:{showToolbar:true},_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-rtefield");var e=this,f=this.options;this.content.bind("change.rtefield",function(i){i.preventDefault();var h=e.content.rte("option","content"),g=f.value;if(h!=g){f.value=h;e._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}})},_browser:function(){this.content.rte("destroy").html(this.options.value);this.content.find(".widget[type=tabsx]").each(function(){var e=a(this);if(e.is(".an-tabsxwidget")){e.data("tabsxwidget").option("mode","browser")}else{e.tabsxwidget({parent:function(){return self},mode:"browser"})}})},_edit:function(){var e=this.options;this.content.rte({content:e.value,dbId:e.dbId,showToolbar:e.showToolbar,stylesheet:e.stylesheet,cssClass:e.cssClass,resizable:e.resizable,cssfiles:["stylesheets/rte/rte-design.css","stylesheets/jquery-ui-1.8.24.custom.css","stylesheets/base.css"].concat(e.globalCSSFiles).concat(e.localCSSFiles),jsfiles:[].concat(e.globalJSFiles).concat(e.localJSFiles)})},_design:function(){this._browser()},destroy:function(){this.content.rte("destroy");this.element.removeClass("an-rtefield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.selectfield",a.an.field,{options:{nativeMenu:true},_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-selectfield")},_createControl:function(){var e=this,g=this.options;var f=this.select=a("<select />").attr("name",g.id);if(!g.mobile){a("<option/>").attr("value","").html("").appendTo(f)}a.each(g.selectItems||[],function(){a("<option/>").attr("value",this.value).html(this.label).appendTo(f)});f.bind("change.selectfield",function(j){j.preventDefault();var i=f.val(),h=g.value;if(i!=h){g.value=i;e._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}});if(!a.isEmptyObject(g.validate)){f.addClass(a.toJSON({validate:g.validate}))}if(g.mobile){if(!g.value&&g.selectItems[0]){g.value=g.selectItems[0].value}}},_makeResizable:function(){},_browser:function(){var e=this,f=this.options;this.select.detach();a.each(f.selectItems,function(){if(this.value==f.value){e.content.html('<span style="padding: .6em 20px;display:inline-block;">'+this.label+"</span>").show();return false}})},_edit:function(){var f=this.options;this.select.detach().val(this.options.value).appendTo(this.content.empty());this._trigger("optionchanged",null,{key:"value",value:f.value,oldValue:"",isTransient:f.isTransient});if(f.mobile){var e={};e.icon="arrow-r";if(f.corners){e.conrners=false}if(f.icon){e.icon=f.icon}if(f.iconpos){e.iconpos=f.iconpos}if(f.iconshadow){e.iconshadow=false}if(f.inline){e.inline=true}if(f.mini){e.mini=true}if(f.nativeMenu){e.nativeMenu=false}if(f.overlayTheme){e.overlayTheme=f.overlayTheme}if(f.preventFocusZoom){e.preventFocusZoom=false}if(f.shadow){e.shadow=false}if(f.theme){e.theme=f.theme}if(this.select.data("mobileSelectmenu")){this.select.data("mobileSelectmenu").destroy()}this.select.selectmenu(e)}},_design:function(){this.select.detach();var e=this,f=this.options,g=this.content;if(f.mobile){g.html('<div class="ui-select">					<a class="ui-btn ui-shadow ui-btn-corner-all ui-btn-icon-right ui-btn-up-c">					<span class="ui-btn-inner">					<span class="ui-btn-text"><span>'+f.selectItems[0].label+'</span></span><span class="ui-icon ui-icon-arrow-d ui-icon-shadow">&nbsp;</span></span></a>					<select>					  </select>					    </div>')}else{if(g.is(".ui-resizable")){g.resizable("destroy")}a.each(f.selectItems,function(){if(this.value==f.value){g.html(this.label);return false}});g.css({width:f.width,height:f.height}).resizable({stop:function(i,h){f.width=g.width();f.height=g.height();a.extend(true,f.metadata[e.widgetName],{width:f.width,height:f.height});e._updateMetadata();e._trigger("resize",null,{size:h.size,oldSize:h.originalSize})}})}},_handleChange:function(f,g,e){if(f==="label"){this.element.children("label").remove();this._createLabel()}else{if(f=="selectItems"){this.select.remove();this._createControl()}else{if(this.options.mobile){this.select.remove();this._createControl()}else{a.an.field.prototype._handleChange.apply(this,arguments)}}}},destroy:function(){this.select.unbind(".selectfield").remove();this.element.removeClass("an-selectfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.filefield",a.an.inputfield,{options:{tags:[],sortBy:"name",mode:"browser",value:[],maxCount:Number.MAX_VALUE,itemWidth:64,itemHeight:64},_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-filefield wrapper")},_createControl:function(){var e=this,f=this.options,g=this.content;this.files=a("<ul class='grid'/>").appendTo(g);g.delegate("li[data-id][data-id!=uploadButton]","hover.filefield",function(h){if(f.mode!="edit"){return}if(h.type=="mouseenter"){a(this).find("img.button").remove();a("<img class='button' width='24' height='24' src='stylesheets/images/delete.png' />").appendTo(this).position({of:a(this),my:"right top",at:"right top"})}else{if(h.type=="mouseleave"){a(this).find("img.button").remove()}}}).delegate("img.button","hover.filefield",function(h){if(h.type=="mouseenter"){a(this).addClass("ui-state-hover")}else{if(h.type=="mouseleave"){a(this).removeClass("ui-state-hover ui-state-active")}}}).delegate("img.button","mousedown.filefield",function(h){a(this).addClass("ui-state-active")}).delegate("img.button","mouseup.filefield",function(h){a(this).removeClass("ui-state-active")}).delegate("img.button","click.filefield",function(k){k.preventDefault();k.stopImmediatePropagation();var p=a(this).closest("li").attr("data-id"),h=[].concat(f.value);for(var j=0;j<f.value.length;j++){if(f.value[j]._id==p){f.value.splice(j,1);break}}e._trigger("optionchanged",null,{key:"value",value:f.value,oldValue:h,isTransient:f.isTransient});e.loadIcons()});this.input=a("<input type='file'/>").hide().appendTo(this.element);this.element.append(a('<input id="btnCancel" type="button" value="Cancel" disabled="disabled" style="display:none;" />'))},_createSwfUpload:function(f,g){var e={flash_url:"javascripts/swfupload/swfupload.swf",button_window_mode:"transparent",upload_url:"/tmp",file_post_name:"file",post_params:{file:""},file_size_limit:"10 MB",file_types:"*.*",file_types_description:"All Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{cancelButtonId:"btnCancel"},debug:false,button_image_url:"stylesheets/images/selection.png",button_width:"64",button_height:"64",button_placeholder:f,button_text:"",button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE,file_queued_handler:fileQueued,file_queue_error_handler:fileQueueError,file_dialog_complete_handler:fileDialogComplete,upload_start_handler:uploadStart,upload_progress_handler:uploadProgress,upload_error_handler:uploadError,upload_success_handler:g,upload_complete_handler:uploadComplete,queue_complete_handler:function(){}};this.swfUpload=new SWFUpload(e)},loadIcons:function(){var f=this,p=this.options,g=this.files.children(),k=0;for(var j=0;j<g.size();j++){if(g.eq(j).attr("data-id")!="uploadButton"){g.eq(j).remove()}}a.each(p.value,function(q,i){k++;f._addIcon(i)});if(p.mode=="edit"||p.mode=="design"){var e=this.files.find('li[data-id="uploadButton"]');if(e.length==0){e=a("<li/>").attr("data-id","uploadButton");var h=a("<img/>");h.css({width:p.itemWidth,height:p.itemHeight}).appendTo(e);e.appendTo(this.files);if(p.mode=="design"){h.css("backgroundImage","url(stylesheets/images/selection.png)")}else{if(!f.swfUpload){f._createSwfUpload(e.children("img")[0],function(q,r){r=a.parseJSON(r);r._tmp=true;if(!p.value){p.value=[]}var i=[].concat(p.value);p.value.push(r);if(f.files.children().size()>=p.maxCount){setTimeout(function(){e.hide()},50)}f._addIcon(r);f._trigger("optionchanged",null,{key:"value",value:p.value,oldValue:i,isTransient:p.isTransient})})}}}if(k>=p.maxCount){e.hide()}else{e.show()}}},_addIcon:function(h){var k=this.options,e=a("<li/>").attr("data-id",h._id),j="stylesheets/images/file.png",g="";var i="jpg,jpeg,png,gif";if(h._tmp){g="/tmp/"+h._id;if(i.match(h.filename.match(/(?=.)[^.]+$/g)[0])){j=g}}else{if(h.metadata){g=k.url+"/"+h.metadata.filepath;if(i.match(h.filename.match(/(?=.)[^.]+$/g)[0])){j=g}else{j+="#"+g}}}var f=a("<img/>").css({width:k.itemWidth,height:k.itemHeight}).attr("src",j);if(k.downloadable){f.wrap("<a target='_blank'/>").parent().attr("href",g).appendTo(e)}else{f.appendTo(e)}if(k.showFileName){a("<strong/>").text(h.filename).appendTo(e)}if(k.showFileSize){a("<span/>").text(h.length).appendTo(e)}e.prependTo(this.files)},_addUploadButton:function(f){var g=this.options;if((f.size()>=g.maxCount)||(f.size()>=1&&g.maxCount==1)){return f}var e=a("<li/>").attr("data-id","uploadButton");a("<img/>").css({width:g.itemWidth,height:g.itemHeight}).attr("src","stylesheets/images/selection.png").appendTo(e);return f.add(e.get())},_delUploadButton:function(){this.files.find("li#uploadButton").remove()},sort:function(f,h){var i=this.options,g=null;if(f&&f.length){g=this.data.find("li."+f.join("."))}else{g=this.data.find("li")}function e(p,j){var k={reversed:false,by:function(q){return q.text()}};a.extend(k,j);arr=p.get();arr.sort(function(s,q){var t=k.by(a(s));var r=k.by(a(q));if(k.reversed){return(t<r)?1:(t>r)?-1:0}else{return(t<r)?-1:(t>r)?1:0}});return a(arr)}if(h=="size"){g=e(g,{by:function(j){return parseFloat(a(j).find("span").text())}})}else{g=e(g,{by:function(j){return a(j).find("strong").text().toLowerCase()}})}if(i.mode=="edit"||i.mode=="design"){g=this._addUploadButton(g)}this.files.quicksand(g,{duration:800,easing:"easeInOutQuad",useScaling:true},function(){})},_handleChange:function(f,g,e){if(f==="sortBy"){var h=this.options;this.sort(h.tags,h.sortBy)}else{if(f=="label"){this.element.children("label").remove();this._createLabel()}else{a.an.inputfield.prototype._handleChange.apply(this,arguments)}}},refresh:function(){var e=this,f=this.options,g=this.content;if(g.is(".ui-resizable")){g.resizable("destroy")}g.css({width:f.width,height:f.height,display:""});if(f.mode=="design"||f.resizable){g.resizable({stop:function(i,h){f.width=g.width();f.height=g.height();a.extend(true,f.metadata[e.widgetName],{width:f.width,height:f.height});e._updateMetadata();e._trigger("resize",null,{size:h.size,oldSize:h.originalSize})}})}this.loadIcons()},destroy:function(){this.swfUpload&&this.swfUpload.destroy();this.content.undelegate(".filefield");this.element.removeClass("an-filefield wrapper");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.gridfield",$.an.field,{options:{mode:"browser",addItemLabel:"Add",editItemLabel:"Edit",deleteItemLabel:"Delete",value:[]},_create:function(){$.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-gridfield")},_createControl:function(){var self=this,o=this.options,c=this.content;this.titlebar=$("<div class='titlebar ui-widget-header'/>").appendTo(c);this.title=$("<span class='title'/>").html(o.label).appendTo(this.titlebar);this.toolbar=$("<span class='toolbar'/>").appendTo(this.titlebar);if(o.converter){o.converter=eval("("+o.converter+")");if(!$.isFunction(o.converter)){o.converter=function(row,col,v){return v}}}var lng=window.database.local;if(lng&&lng!="en"){$.extend(o,$.i18n.gridfield)}this.grid=$("<div/>").appendTo(c).agilegrid($.extend({dbId:o.dbId,cellRender:function(row,col){var v="",r=o.value[row],cm=this.colModel;if(r){try{v=eval("r."+cm[col].name)}catch(e){}v=v||""}return o.converter?o.converter(row,col,v):v},leftHeaderRender:function(row){return row+1},columnResize:function(e,data){if(o.mode=="design"){self._updateMetadata()}},optionchanged:function(e,data){if(o.mode=="design"&&data.key=="colModel"){self._updateMetadata()}}},o.gridOptions));$.each(["addItem","editItem","deleteItem"],function(k,v){$("<button class='title-button'/>").attr("id",v).html(o[v+"Label"]).appendTo(self.toolbar).button().click(function(e){self["_"+$(e.target).closest("button").attr("id")]();return false})})},_createLabel:function(){},_makeResizable:function(){},_updateMetadata:function(){var opts={colModel:this.grid.agilegrid("option","colModel"),totalColCount:this.grid.agilegrid("option","totalColCount")};$.extend(true,this.options.metadata,{gridfield:{gridOptions:opts}});return $.an.field.prototype._updateMetadata.apply(this,arguments)},_addItem:function(){this._createItemEditor(this.options.formId)},_editItem:function(){var o=this.options,row=0;$.each(this.grid.agilegrid("option","rowSelections"),function(k,v){if(v){row=k;return false}});this._createItemEditor(o.formId,row)},_deleteItem:function(){var o=this.options,sel=this.grid.agilegrid("option","rowSelections"),value=[];$.each(o.value,function(k,v){if(!sel[k]){value.push(v)}});this._setValue(value)},_setValue:function(value){var o=this.options;var oldValue=o.value;o.value=value;this.grid.agilegrid("option","rowCount",value.length).agilegrid("refresh");this.element.trigger("change");this._trigger("optionchanged",null,{key:"value",value:value,oldValue:oldValue,isTransient:o.isTransient})},_createItemEditor:function(formId,row){var self=this,o=this.options;o.value=o.value||[];$.ans.getDoc(o.dbId,formId,null,function(err,form){$("<div/>").dialog($.extend({title:form.title||form.name||form._id,autoOpen:true,height:500,width:600,modal:true,open:function(event,ui){var doc=new DocWrapper(o.value[row]||{});$(this).form({form:form,document:doc,url:o.url,dbId:o.dbId,mode:"edit",ignoreEscape:true})},buttons:{OK:function(){if(!(o.gridOptions.validate)||(o.gridOptions.validate&&$(this).form("validate"))){var $this=$(this),doc=$this.form("option","document").getDoc(),value=[].concat(o.value);if(row!==undefined){value.splice(row,1,doc)}else{value.push(doc)}self._setValue(value);$this.dialog("close")}},Cancel:function(){$(this).dialog("close")}},close:function(){$(this).form("destroy").remove()}},o.dialogOptions))})},_handleChange:function(key,value,oldValue){$.an.field.prototype._handleChange.apply(this,arguments);if(key==="label"){this.title.html(value)}},_browser:function(){var o=this.options;this.grid.agilegrid($.extend(true,{},{rowCount:(o.value&&o.value.length)||0,isColumnResizable:false,isRowResizable:false,contextmenu2:false},o.gridOptions)).agilegrid("refresh");this.toolbar.hide()},_edit:function(){this._browser();this.toolbar.show()},_design:function(){var self=this,o=this.options,c=this.content;if(c.is(".ui-resizable")){c.resizable("destroy")}c.resizable({stop:function(e,ui){o.width=c.width();o.height=c.height();$.extend(true,o.metadata[self.widgetName],{width:o.width,height:o.height});self._updateMetadata();self._trigger("resize",null,{size:ui.size,oldSize:ui.originalSize})}});this.grid.agilegrid($.extend(true,{},{rowCount:(o.value&&o.value.length)||0,isColumnResizable:true,isRowResizable:true,columnEditable:true,contextmenu2:true},o.gridOptions)).agilegrid("refresh");this.toolbar.show()},destroy:function(){$(window).unbind("resize.an-gridfield",this._proxy);this.element.removeClass("an-gridfield");return $.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.jsrenderfield",$.an.field,{options:{mode:"browser",selector:"",browserTemplate:"",editorTemplate:"",value:[]},_create:function(){$.an.field.prototype._create.apply(this,arguments);var o=this.options,c=this.content;this.element.addClass("an-jsrenderfield");try{c.html(o.content)}catch(e){}if(o.template){o.template=$.templates(o.template)}if(o.converters){var conv={};var tmp=null;for(var j=0;j<o.converters.length;j++){tmp=eval("(0,"+o.converters[j]["function"]+")");if(!$.isFunction(tmp)){conv[o.converters[j]["name"]]=function(v){return v}}else{conv[o.converters[j]["name"]]=tmp}}$.views.converters(conv)}},_notify:function(oldValue,value){var o=this.options;if(value!=oldValue){o.value=value;this._trigger("optionchanged",null,{key:"value",value:value,oldValue:oldValue,isTransient:o.isTransient})}},appendValue:function(value){var o=this.options,oldValue=[].concat(o.value);o.value.push(value);this.refresh();this._notify(oldValue,o.value)},insertValue:function(index,value){var o=this.options,oldValue=[].concat(o.value);o.value.splice(index,1,value);this.refresh();this._notify(oldValue,o.value)},delValue:function(index){var o=this.options,oldValue=[].concat(o.value);o.value.splice(index,1);this.refresh();this._notify(oldValue,o.value)},getValue:function(index){var o=this.options;return o.value[index]},replaceValue:function(index,value){var o=this.options,oldValue=[].concat(o.value);o.value[index]=value;this.refresh();this._notify(oldValue,o.value)},_browser:function(){var o=this.options;if(o.browserTemplate!=undefined&&o.browserTemplate!=""){var html=$.render[o.browserTemplate](o.value);$(o.selector,this.element).html(html)}else{if(o.template){var html=o.template.render(o.value);$(o.selector,this.element).html(html)}}},_edit:function(){var o=this.options;if(o.editorTemplate!=undefined&&o.editorTemplate!=""){var html=$.render[o.editorTemplate](o.value);$(o.selector,this.element).html(html)}else{if(o.template){var html=o.template.render(o.value);$(o.selector,this.element).html(html)}}},_design:function(){this._browser()},destroy:function(){this.element.removeClass("an-jsrenderfield");return $.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.buttonwidget",a.an.widget,{_create:function(){var g=this.options;a.an.widget.prototype._create.apply(this,arguments);this.element.addClass("an-buttonwidget");var f={label:this.options.label};if(g.mobile){f.corners=true;f.iconshadow=false;if(g.data_transition){f.transition=g.data_transition}if(g.data_icon){f.icon=g.data_icon}if(g.data_iconpos){f.iconpos=g.data_iconpos}if(g.data_theme){f.theme=g.data_theme}if(g.data_inline){f.inline=g.data_inline}if(g.isMini){f.mini=true}var e=this.content.button(f);a(a(a(a(e).parent()).find(">span")).find(">span").eq(0)).html(this.options.label)}else{this.content.button(f)}},_makeResizable:function(){},_handleChange:function(f,g,e){if(f==="label"){this.content.button("option","label",g)}else{a.an.widget.prototype._handleChange.apply(this,arguments)}},_design:function(){var g=this.options;if(g.mobile){var f='<div data-corners="true" data-shadow="true" data-iconshadow="false"				data-wrapperels="span"  data-disabled="true" data-label="'+g.label+'"				aria-disabled="false">				<span class="ui-btn-inner">					<span class="ui-btn-text">'+g.label+"</span>";if(g.data_icon){f+='<span class="ui-icon ui-icon-arrow-d">&nbsp;</span>'}f+='</span>				<div class="content ui-btn-hidden" data-disabled="false"></div>			</div>';var e=a(f);if(g.data_icon){e.addClass("ui-btn-icon-"+g.data_icon)}if(g.data_iconpos){e.addClass("ui-btn-icon-"+g.data_iconpos)}if(g.data_theme){e.addClass("ui-btn-up-"+g.data_theme)}if(g.data_inline){e.addClass("ui-btn-inline")}if(g.isMini){e.addClass("ui-mini")}e.addClass("ui-btn ui-shadow ui-btn-corner-all");this.content.html(e)}},destroy:function(){this.content.button("destroy").remove();this.element.removeClass("an-buttonwidget");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.tabsxwidget",$.an.widget,{_create:function(){$.an.widget.prototype._create.apply(this,arguments);var self=this,o=this.options,el=this.element,c=this.content,ul=c.children("ul");el.addClass("an-tabsxwidget");if(ul.length<=0){ul=$("<ul/>").appendTo(c)}c.tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a></li>",destroyTabs:false,duration:o.duration,slideshow:o.slideshow,fxs:eval("("+o.fx+")"),mode:o.mode}).bind("contextmenu2.tabsxwidget contextmenu.tabsxwidget",function(e){if((o.contextmenu2&&e.type=="contextmenu2")||(!o.contextmenu2&&e.type=="contextmenu")){var t=$(e.target),actions={},index=t.closest("li").index(),ul=t.closest("ul");if(o.mode=="design"){actions.add={type:"menuItem",text:"Add Tab",handler:function(){self.insertTab(index)}};if(ul.size()!=0){actions.edit={type:"menuItem",text:"Edit Tab",handler:function(){self.editTab(index)}};actions.del={type:"menuItem",text:"Delete Tab",handler:function(){self.removeTab(index)}}}}if(!$.isEmptyObject(actions)){t.menu({autoShow:true,menuPosition:{of:e,my:"left top",at:"left bottom"},actions:actions,select:function(e,ui){$(this).menu("destroy")},collapseAll:function(e){$(this).menu("destroy")}})}e.preventDefault()}});this._updateContentHeight();if(o.mode=="design"){this._contentEditable(true)}},selectable:function(e){return e.target==this.content.children(".ui-tabs-nav")[0]||e.target==this.element[0]},select:function(id){this.content.tabsx("select",id)},_updateContentHeight:function(){var o=this.options,c=this.content,css={},ul=c.children("ul");if(o.minHeight){css["min-height"]=o.minHeight-ul.outerHeight(true)-16}else{if(o.height){css.height=o.height-ul.outerHeight(true)-16}}c.children(".ui-tabs-panel").css(css)},_doEditTab:function(index,isNew){var self=this,o=this.options,c=this.content,doc={},a,p;if(!isNew){a=c.children("ul").find("li").eq(index).children("a");doc.id=a.attr("href").substring(1);doc.label=a.html();p=c.find("#"+doc.id)}$("<div/>").dialog({title:isNew?"Insert Tab":"Edit Tab",height:400,width:500,modal:true,create:function(event,ui){var $this=$(this);$.ans.getDoc(o.dbId,"50a4f883d6c6603d0a000018",null,function(err,form){$this.editor({document:doc,forms:[form],dbId:o.dbId,ignoreEscape:true,mode:"edit"})})},buttons:{OK:function(){var $this=$(this),doc=$this.editor("option","document");if(isNew){c.tabsx("add","#"+doc.id,doc.label,index);self._updateContentHeight();c.children("#"+doc.id)[0].contentEditable=true}else{a.attr("href","#"+doc.id).html(doc.label);p.attr("id",doc.id)}self.element.trigger("contentchange");$this.dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},insertTab:function(index){if(index<0||index>this.content.tabsx("length")){index=this.content.tabsx("length")}this._doEditTab(index,true)},editTab:function(index){if(index>=0&&index<this.content.tabsx("length")){this._doEditTab(index)}},removeTab:function(index){this.content.tabsx("remove",index).trigger("contentchange")},_browser:function(){this.option("contextmenu2",false);this._contentEditable(false)},_edit:function(){this.option("contextmenu2",false);this._contentEditable(false)},_design:function(){this.option("contextmenu2",true);this._contentEditable(true)},_contentEditable:function(editable){this.content.children(".ui-tabs-panel").each(function(){this.contentEditable=editable})},destroy:function(){this.content.children(".ui-tabs-panel").css({height:"","min-height":""});this.content.tabsx("destroy");this.element.unbind(".tabsxwidget").removeClass("an-tabsxwidget");return $.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
 * This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.searchfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-searchfield")},_createControl:function(){a.an.inputfield.prototype._createControl.apply(this,arguments);if(this.options.mobile){this.input.attr("data-type","search");var e=this.element.find(".content").eq(0);e.removeClass("ui-input-text");e.addClass("ui-input-search ui-icon-search ui-icon-searchfield")}},_makeResizable:function(){},_browser:function(){a.an.inputfield.prototype._browser.apply(this,arguments)},_edit:function(){this.input.detach().val(this.options.value).appendTo(this.content.empty(),arguments);if(this.options.mobile){var e=this;var f='<a style="position: absolute;right: 20px; top: 17px;display:none;" class="ui-input-clear ui-btn ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-btn-up-c" href="#" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false">					<span class="ui-btn-inner">					<span class="ui-btn-text">clear text</span>					<span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span>					</span></a>';a(f).bind("click",function(g){e.input.val("");a(this).hide()}).appendTo(this.content);this.input.bind("keyup.inputfield",function(g){a(a(g.target).siblings()).show()}).bind("keydown.inputfield",function(g){a(a(g.target).siblings()).show()})}},_design:function(){a.an.inputfield.prototype._design.apply(this,arguments)},_handleChange:function(f,g,e){a.an.inputfield.prototype._handleChange.apply(this,arguments)},highlight:function(e){(this.options.mode=="edit"?this.input:this.element).toggleClass("an-state-hover",e)},destroy:function(){this.input&&this.input.unbind(".inputfield").remove();this.element.removeClass("an-inputfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.tree",{options:{draggable:true,droppable:true,labelProvider:{getText:function(e){return e.text},getClass:function(e){return e["class"]}}},_create:function(){var e=this,f=this.element,g=this.options;f.addClass("an-tree").empty();g.contentProvider=g.contentProvider||this._defaultContentProvider();this._loadChildren(f);f.delegate(".hitarea","click.tree",function(){var h=a(this).parent();e["_do"+(h.is(".expandable")?"Expand":"Collapse")](h)}).delegate("li>span","hover.tree",function(h){a(this).toggleClass("ui-state-hover");e._trigger("nodehover",h,a(this).closest("li").data("node"))}).delegate("li>span","click.tree contextmenu.tree",function(h){f.find("li>span.selected").removeClass("selected");a(this).addClass("selected");if(h.type=="click"){e._trigger("nodeclick",h,a(this).closest("li").data("node"))}else{if(h.type=="contextmenu"){e._trigger("contextmenu",h,a(this).closest("li").data("node"))}}}).delegate("li>span","dblclick.tree",function(h){e._trigger("nodedblclick",h,a(this).closest("li").data("node"))})},_defaultContentProvider:function(){return{getRoots:function(){return[]},getChildren:function(e){return[]},hasChildren:function(e){return false},getId:function(e){return e.id?e.id:null}}},refresh:function(g){var q=this;if(g){var k=this.element.find("#"+g);if(k.length){var f=this.options,h=f.labelProvider,i=f.contentProvider,e=k.attr("id"),j=k.parent().closest("li");function p(r){var t=null;for(var s in r){if(e==r[s].id){t=s;break}}if(t!=null){k.data("node",r[t]).addClass(h.getClass(r[t])).children("span").html(h.getText(r[t]));if(k.is(".expandable")){k.addClass("stale")}else{if(k.is(".collapsable")){q._loadChildren(k)}}}else{k.remove()}}if(j.length){i.getChildren(j.data("node"),p)}else{i.getRoots(p)}}}else{this._loadChildren(this.element)}},add:function(f,e){this._addNode(this.element.find("#"+f).children("ul"),e)},"delete":function(f){var e=this.element.find("#"+f);if(e.is(".last")){e.prev().addClass("last")}e.remove()},expand:function(f){var e=this.element.find("#"+f);if(e.length>0){this._doExpand(e)}},collapse:function(f){var e=this.element.find("#"+f);if(e.length>=0){this._doCollapse(e)}},_doExpand:function(e){if(e.is(".expandable.stale")){this._loadChildren(e)}else{if(e.is(".expandable")){e.children("ul").show();e.removeClass("expandable").addClass("collapsable")}}},_doCollapse:function(e){if(e.is(".collapsable")){e.children("ul").hide();e.removeClass("collapsable").addClass("expandable")}},_addNode:function(k,g){var r=this,f=this.options,h=f.labelProvider,j=f.contentProvider,e=j.getId(g),q=h.getText(g),p=a("<li/>").addClass(h.getClass(g)).attr("id",e);if(f.checkbox){a("<input type='checkbox'/>").prop("checked",a.inArray(e,f.checkedNodes)!=-1).appendTo(p)}a("<span/>").addClass(h.getClass(g)).html(q).appendTo(p);if(j.hasChildren(g)){p.addClass("expandable stale").prepend("<div class='hitarea'/>");var i=a.type(f.droppable)=="function"?f.droppable(g):f.droppable;if(i){p.children("span").droppable({greedy:true,hoverClass:"ui-state-hover",drop:function(t,u){r._trigger("drop",null,{source:u.draggable.data("node"),target:g})}})}}k.children("li.last").removeClass("last");p.data("node",g).addClass("last").appendTo(k);var s=a.type(f.draggable)=="function"?f.draggable(g):f.draggable;if(s){p.draggable({appendTo:"body",helper:"clone",scroll:true,distance:20,scrollSensitivity:100,zIndex:9999})}},_loadChildren:function(i){var f=this,p=this.options,g=i.children("ul"),j=p.contentProvider||this._defaultContentProvider();if(g.length==0){g=a("<ul/>").appendTo(i)}var h=[];g.find(".collapsable").each(function(){h.push(a(this).attr("id"))});g.empty();var e=i.children(".hitarea").addClass("loading");function k(q){a.each(q,function(t,s){f._addNode(g,s)});i.removeClass("expandable stale").addClass("collapsable");for(var r in h){f.expand(h[r])}e.removeClass("loading")}if(i[0]==this.element[0]){j.getRoots(k)}else{j.getChildren(i.data("node"),k)}},option:function(g,h){if(g=="checkedNodes"&&h===b){var f=[];a("input:checked",this.element).each(function(){f.push(a(this).closest("li").data("node"))});return f}else{if(g==="roots"&&h===b){var e=[];this.element.children("ul").children("li").each(function(){e.push(a(this).attr("id"))});return e}else{if(g==="selectedNodes"&&h===b){var f=[];this.element.find(".selected").each(function(){f.push(a(this).closest("li").attr("id"))});return f}}}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(f,h){a.Widget.prototype._setOption.apply(this,arguments);var e=this,g=this.element;if(f==="contentProvider"){this._loadChildren(this.element)}else{if(f==="checkedNodes"){a.each(h,function(j,i){a("#"+i+" input",e.element).prop("checked",true)})}else{if(f==="selectedNodes"){a.each(h,function(j,i){g.find("li>span.selected").removeClass("selected");g.find("li#"+i+">span").addClass("selected")})}}}return this},destroy:function(){this.element.undelegate(".hitarea",".tree").undelegate("li>span",".tree").removeClass("an-tree");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);jQuery.cookie=function(b,p,s){if(typeof p!="undefined"){s=s||{};if(p===null){p="";s.expires=-1}var g="";if(s.expires&&(typeof s.expires=="number"||s.expires.toUTCString)){var h;if(typeof s.expires=="number"){h=new Date();h.setTime(h.getTime()+(s.expires*24*60*60*1000))}else{h=s.expires}g="; expires="+h.toUTCString()}var r=s.path?"; path="+(s.path):"";var j=s.domain?"; domain="+(s.domain):"";var a=s.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(p),g,r,j,a].join("")}else{var f=null;if(document.cookie&&document.cookie!=""){var q=document.cookie.split(";");for(var k=0;k<q.length;k++){var e=jQuery.trim(q[k]);if(e.substring(0,b.length+1)==(b+"=")){f=decodeURIComponent(e.substring(b.length+1));break}}}return f}};(function(b){b.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};function a(f){if(typeof f.data!=="string"){return}var e=f.handler,g=f.data.toLowerCase().split(" ");f.handler=function(s){if(this!==s.target&&(/textarea|select/i.test(s.target.nodeName)||s.target.type==="text")){return}var k=s.type!=="keypress"&&b.hotkeys.specialKeys[s.which],t=String.fromCharCode(s.which).toLowerCase(),q,r="",j={};if(s.altKey&&k!=="alt"){r+="alt+"}if(s.ctrlKey&&k!=="ctrl"){r+="ctrl+"}if(s.metaKey&&!s.ctrlKey&&k!=="meta"){r+="meta+"}if(s.shiftKey&&k!=="shift"){r+="shift+"}if(k){j[r+k]=true}else{j[r+t]=true;j[r+b.hotkeys.shiftNums[t]]=true;if(r==="shift+"){j[b.hotkeys.shiftNums[t]]=true}}for(var p=0,h=g.length;p<h;p++){if(j[g[p]]){return e.apply(this,arguments)}}}}b.each(["keydown","keyup","keypress"],function(){b.event.special[this]={add:a}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(b){var a=0;b.widget("an.menu",{defaultElement:"<ul>",delay:100,options:{submenuPosition:{my:"left top",at:"right top"},triggerEvent:"contextmenu",menuPosition:{my:"left top",at:"left bottom"}},_create:function(){var e=this.options;this.element.addClass("an-menu");this.activeMenu=this.menu=this._createMenuContent(e.actions);this.menu.appendTo("body").hide();this.menuId=this.menu.attr("id")||"ui-menu-"+a++;if(this.menu.find(".ui-icon").length){this.menu.addClass("ui-menu-icons")}this.bindings=b();this.menu.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:"menu"}).css({"z-index":"999999"}).bind("click.menu",b.proxy(function(f){if(e.disabled){f.preventDefault()}},this));this._bind({"click .ui-menu-item:has(a)":function(f){var g=b(f.currentTarget);if(!this.active||(this.active[0]!==g[0])){this.focus(f,g)}this.select(f);f.preventDefault()},"mouseover .ui-menu-item:not(.seperator)":function(f){f.stopImmediatePropagation();var g=b(f.currentTarget);g.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(f,g)},mouseleave:"_mouseleave","mouseleave .ui-menu":"_mouseleave","mouseout .ui-menu-item":"blur",focus:function(f){this.focus(f,b(f.target).children(".ui-menu-item:first"))},blur:"collapseAll"});this.refresh();this.menu.attr("tabIndex",0);this._bind({keydown:function(j){switch(j.keyCode){case b.ui.keyCode.PAGE_UP:this.previousPage(j);j.preventDefault();j.stopImmediatePropagation();break;case b.ui.keyCode.PAGE_DOWN:this.nextPage(j);j.preventDefault();j.stopImmediatePropagation();break;case b.ui.keyCode.HOME:this._move("first","first",j);j.preventDefault();j.stopImmediatePropagation();break;case b.ui.keyCode.END:this._move("last","last",j);j.preventDefault();j.stopImmediatePropagation();break;case b.ui.keyCode.UP:this.previous(j);j.preventDefault();j.stopImmediatePropagation();break;case b.ui.keyCode.DOWN:this.next(j);j.preventDefault();j.stopImmediatePropagation();break;case b.ui.keyCode.LEFT:if(this.collapse(j)){j.stopImmediatePropagation()}j.preventDefault();break;case b.ui.keyCode.RIGHT:if(this.expand(j)){j.stopImmediatePropagation()}j.preventDefault();break;case b.ui.keyCode.ENTER:if(this.active.children("a[aria-haspopup='true']").length){if(this.expand(j)){j.stopImmediatePropagation()}}else{this.select(j);j.stopImmediatePropagation()}j.preventDefault();break;case b.ui.keyCode.ESCAPE:if(this.collapse(j)){j.stopImmediatePropagation()}j.preventDefault();break;default:j.stopPropagation();clearTimeout(this.filterTimer);var f,i=this.previousFilter||"",k=String.fromCharCode(j.keyCode),h=false;if(k==i){h=true}else{k=i+k}function g(p){return p.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}f=this.activeMenu.children(".ui-menu-item").filter(function(){return new RegExp("^"+g(k),"i").test(b(this).children("a").text())});f=h&&f.index(this.active.next())!=-1?this.active.nextAll(".ui-menu-item"):f;if(!f.length){k=String.fromCharCode(j.keyCode);f=this.activeMenu.children(".ui-menu-item").filter(function(){return new RegExp("^"+g(k),"i").test(b(this).children("a").text())})}if(f.length){this.focus(j,f);if(f.length>1){this.previousFilter=k;this.filterTimer=this._delay(function(){delete this.previousFilter},1000)}else{delete this.previousFilter}}else{delete this.previousFilter}}}});if(e.triggerEvent){this.element.unbind(e.triggerEvent+".menu");this.element.bind(e.triggerEvent+".menu",b.proxy(function(h){var f=b.extend({},{of:h,offset:"0 0"},b.type(this.options.menuPosition)=="function"?this.options.menuPosition(this.active):this.options.menuPosition);var g=b(document).data("contextmenu");if(g){g.collapseAll()}b(document).data("contextmenu",this);this.menu.show().position(f);if(this.options.triggerEvent=="contextmenu"){h.preventDefault()}},this))}this.proxy=b.proxy(function(f){var g=b(f.target);if(g.closest(".ui-menu").length||g.closest(".an-menu").get(0)==this.element.get(0)){return}this.collapseAll(f)},this);b(document).bind("click.menu",this.proxy);if(e.autoShow){this.menu.position(b.type(this.options.menuPosition)=="function"?this.options.menuPosition(this.active):this.options.menuPosition).show()}},_createMenuContent:function(g){var e=this,f=b("<ul/>");b.each(g,function(j,i){switch(i.type){case"submenu":var p=e._createMenuContent(i.children);b("<li/>").append(b("<a href='#'/>").text(i.text)).append(p).appendTo(f);break;case"menuItem":b("<a/>").attr("href","#"+j).text(i.text).click(function(k){i.handler(arguments);k.preventDefault()}).wrap("<li/>").parent().appendTo(f);break;case"seperator":b("<li class='seperator'/>").append(b("<a href='#'/>")).appendTo(f);break;case"checkbox":var h=b("<input/>").attr("type","checkbox").attr("name",i.name).prop("checked",i.checked);b("<a/>").attr("href","#"+j).text(i.text).click(function(s){var r=b(s.target),q=false;if(r.is("a")){var k=r.find("input");q=!k.prop("checked");k.prop("checked",q)}else{if(r.is("input")){q=r.prop("checked")}}i.handler(s,q);s.stopImmediatePropagation()}).prepend(h).wrap("<li/>").parent().appendTo(f);break}});return f},refresh:function(){var e=this.menu.find("ul:not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","menu").hide().attr("aria-hidden","true").attr("aria-expanded","false");var f=this.menuId;e.add(this.menu).children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").addClass("ui-corner-all").attr("tabIndex",-1).attr("role","menuitem").attr("id",function(g){return f+"-"+g});e.each(function(){var h=b(this),g=h.prev("a");g.attr("aria-haspopup","true").prepend('<span class="ui-menu-icon ui-icon ui-icon-carat-1-e"></span>');h.attr("aria-labelledby",g.attr("id"))})},focus:function(e,p){this.blur(e);if(this._hasScroll()){var g=parseFloat(b.curCSS(this.activeMenu[0],"borderTopWidth",true))||0,q=parseFloat(b.curCSS(this.activeMenu[0],"paddingTop",true))||0,h=p.offset().top-this.activeMenu.offset().top-g-q,k=this.activeMenu.scrollTop(),i=this.activeMenu.height(),f=p.height();if(h<0){this.activeMenu.scrollTop(k+h)}else{if(h+f>i){this.activeMenu.scrollTop(k+h-i+f)}}}this.active=p.first().children("a").addClass("ui-state-focus").end();this.menu.attr("aria-activedescendant",this.active.children("a").attr("id"));this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");this.timer=this._delay(function(){this._close()},this.delay);var j=b(">ul",p);if(j.length&&(/^mouse/.test(e.type))){this._startOpening(j)}this.activeMenu=p.parent();this._trigger("focus",e,{item:p})},blur:function(e){if(!this.active){return}clearTimeout(this.timer);this.active.children("a").removeClass("ui-state-focus");this.active=null;this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true"){return}this.timer=this._delay(function(){this._close();this._open(e)},this.delay)},_open:function(f){clearTimeout(this.timer);this.menu.find(".ui-menu").not(f.parents()).hide().attr("aria-hidden","true");var e=b.extend({},{of:this.active},b.type(this.options.submenuPosition)=="function"?this.options.submenuPosition(this.active):this.options.submenuPosition);f.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(e)},collapseAll:function(e){var f=false;if(e){var g=b(e.target);if(g.is(".ui-menu")){f=g}else{if(g.closest(".ui-menu").length){f=g.closest(".ui-menu")}}}this._close(f);this.blur(e);this.activeMenu=this.menu;this._trigger("collapseAll")},_close:function(e){if(!e){e=this.active?this.active.parent():this.menu}e.find("ul").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active");if(e==this.menu){e.hide().attr("aria-hidden","true").attr("aria-expanded","false")}},collapse:function(f){var e=this.active&&this.active.parents("li:not(.ui-menubar-item)").first();if(e&&e.length){this._close();this.focus(f,e);return true}},expand:function(f){var e=this.active&&this.active.children("ul").children("li").first();if(e&&e.length){this._open(e.parent());this._delay(function(){this.focus(f,e)},20);return true}},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(h,f,g){if(!this.active){this.focus(g,this.activeMenu.children(".ui-menu-item")[f]());return}var e;if(h==="first"||h==="last"){e=this.active[h==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1)}else{e=this.active[h+"All"](".ui-menu-item").eq(0)}if(e.length){this.focus(g,e)}else{this.focus(g,this.activeMenu.children(".ui-menu-item")[f]())}},nextPage:function(g){if(this._hasScroll()){if(!this.active){this.focus(g,this.activeMenu.children(".ui-menu-item").first());return}if(this.last()){return}var h=this.active.offset().top,f=this.menu.height(),e;this.active.nextAll(".ui-menu-item").each(function(){e=b(this);return b(this).offset().top-h-f<0});this.focus(g,e)}else{this.focus(g,this.activeMenu.children(".ui-menu-item")[!this.active?"first":"last"]())}},previousPage:function(g){if(this._hasScroll()){if(!this.active){this.focus(g,this.activeMenu.children(".ui-menu-item").first());return}if(this.first()){return}var h=this.active.offset().top,f=this.menu.height(),e;this.active.prevAll(".ui-menu-item").each(function(){e=b(this);return b(this).offset().top-h+f>0});this.focus(g,e)}else{this.focus(g,this.activeMenu.children(".ui-menu-item").first())}},_hasScroll:function(){return this.menu.height()<this.menu.prop("scrollHeight")},_mouseleave:function(e){this.collapseAll(e);this.blur()},select:function(e){var f={item:this.active};this.collapseAll(e);this._trigger("select",e,f)},_bind:function(g,f){if(!f){f=g;g=this.menu}else{g=b(g);this.bindings=this.bindings.add(g)}var e=this;b.each(f,function(q,p){function j(){if(e.options.disabled===true||b(this).hasClass("ui-state-disabled")){return}return(typeof p==="string"?e[p]:p).apply(e,arguments)}var k=q.match(/^(\w+)\s*(.*)$/),i=k[1]+"."+e.widgetName,h=k[2];if(h){e.menu.delegate(h,i,j)}else{g.bind(i,j)}})},_delay:function(h,g){function f(){return(typeof h==="string"?e[h]:h).apply(e,arguments)}var e=this;return setTimeout(f,g||0)},destroy:function(){b(document).unbind(".menu",this.proxy);this.menu.removeAttr("aria-activedescendant").find("ul").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").show();this.menu.find(".ui-menu-item").unbind(".menu").removeClass("ui-menu-item").removeAttr("role").children("a").removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").removeAttr("id").children(".ui-icon").remove();this.bindings.unbind("."+this.widgetName);this.menu.remove();this.element.unbind("."+this.widgetName).removeClass("an-menu");b.Widget.prototype.destroy.apply(this,arguments)}})}(jQuery));
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.border",{options:{center:{minWidth:200,minHeight:20}},_create:function(){this.element.addClass("an-border");this._calculateDimension();this._makeResizable();this._proxy=a.proxy(function(f){if(f.target===window){this._calculateDimension()}},this);a(window).bind("resize.border",this._proxy)},_setOption:function(f,g){var e=a.extend({},this.options[f]);switch(f){case"east":case"south":case"west":case"north":case"center":a.extend(true,this.options[f],g);if(g.width!=e.width||g.height!=e.height){this._calculateDimension(f)}if(g.hasOwnProperty("resizable")){this._makeResizable()}break;default:break}this._trigger("optionchanged",null,{key:f,value:this.options[f],oldValue:e})},_calculateDimension:function(k){var u=this,g=this.options,f=null;if(g.center.selector&&g.center.selector!=""){f=u.element.children(g.center.selector)}if(!f||f.length==0){f=a("<div/>").appendTo(u.element)}u.centerElement=f;var q={pbmWidth:0,pbmHeight:0,minWidth:0,minHeight:0,totalMinWidth:0,totalMinHeight:0},p=a.extend({height:0,totalHeight:0},q),s=a.extend({},p),i=a.extend({width:0,totalWidth:0},q),r=a.extend({},i),h={};h.pbmWidth=(f.outerWidth(true)-f.width());h.pbmHeight=(f.outerHeight(true)-f.height());h.minWidth=parseFloat(g.center.minWidth);h.minHeight=parseFloat(g.center.minHeight);h.totalMinWidth=h.minWidth+h.pbmWidth;h.totalMinHeight=h.minHeight+h.pbmHeight;a.each({north:p,south:s},function(x,w){var z=null;if(g[x]){if(g[x].selector&&g[x].selector!=""){z=u.element.children(g[x].selector)}if(!z||z.length==0){z=a("<div/>").appendTo(u.element)}w.height=parseFloat(g[x].height||w.minHeight||0);w.pbmWidth=z.outerWidth(true)-z.width();w.pbmHeight=z.outerHeight(true)-z.height();w.totalHeight=w.height+w.pbmHeight;w.minWidth=parseFloat(g[x].minWidth);w.minHeight=parseFloat(g[x].minHeight);w.totalMinWidth=w.minWidth+w.pbmWidth;w.totalMinHeight=w.minHeight+w.pbmHeight;u[x+"Element"]=z}});a.each({west:i,east:r},function(x,w){var z=null;if(g[x]){if(g[x].selector&&g[x].selector!=""){z=u.element.children(g[x].selector)}if(!z||z.length==0){z=a("<div/>").appendTo(u.element)}w.width=parseFloat(g[x].width||w.minWidth||0);w.pbmWidth=z.outerWidth(true)-z.width();w.pbmHeight=z.outerHeight(true)-z.height();w.totalWidth=w.width+w.pbmWidth;w.minWidth=parseFloat(g[x].minWidth);w.minHeight=parseFloat(g[x].minHeight);w.totalMinWidth=w.minWidth+w.pbmWidth;w.totalMinHeight=w.minHeight+w.pbmHeight;u[x+"Element"]=z}});var j=u.element.width(),e=u.element.height();if((p.totalHeight+s.totalHeight+h.totalMinHeight>e)&&(p.totalMinHeight+s.totalMinHeight+h.totalMinHeight<e)){var t=p.totalHeight+s.totalHeight+h.totalMinHeight-e;if(!k){s.height=s.height-Math.ceil(t/2);p.height=p.height-Math.floor(t/2);if(s.height<s.minHeight){p.height=p.height-(s.minHeight-s.height);s.height=s.minHeight}if(p.height<p.minHeight){s.height=s.height-(p.minHeight-p.height);p.height=p.minHeight}s.totalHeight=s.height+s.pbmHeight;p.totalHeight=p.height+p.pbmHeight}else{if(k=="north"){s.height=s.height-t;if(s.height<s.minHeight){p.height=p.height-(s.minHeight-s.height);s.height=s.minHeight;p.totalHeight=p.height+p.pbmHeight}s.totalHeight=s.height+s.pbmHeight}else{if(k=="south"){p.height=p.height-t;if(p.height<p.minHeight){s.height=s.height-(p.minHeight-p.height);p.height=p.minHeight;s.totalHeight=s.height+s.pbmHeight}p.totalHeight=p.height+p.pbmHeight}}}}else{if(p.totalMinHeight+s.totalMinHeight+h.totalMinHeight>=e){p.height=p.minHeight;s.height=s.minHeight;p.totalHeight=p.height+p.pbmHeight;s.totalHeight=s.height+s.pbmHeight;e=p.totalMinHeight+s.totalMinHeight+h.totalMinHeight}}if((i.totalWidth+r.totalWidth+h.totalMinWidth>j)&&(i.totalMinWidth+r.totalMinWidth+h.totalMinWidth<j)){var t=i.totalWidth+r.totalWidth+h.totalMinWidth-j;if(!k){r.width=r.width-Math.ceil(t/2);i.width=i.width-Math.floor(t/2);if(r.width<r.minWidth){i.width=i.width-(r.minWidth-r.width);r.width=r.minWidth}if(i.width<i.minWidth){r.width=r.width-(i.minWidth-i.width);i.width=i.minWidth}r.totalWidth=r.width+r.pbmWidth;i.totalWidth=i.width+i.pbmWidth}else{if(k=="west"){r.width=r.width-t;if(r.width<r.minWidth){i.width=i.width-(r.minWidth-r.width);r.width=r.minWidth;i.totalWidth=i.width+i.pbmWidth}r.totalWidth=r.width+r.pbmWidth}else{if(k=="east"){i.width=i.width-t;if(i.width<i.minWidth){r.width=r.width-(i.minWidth-i.width);i.width=i.minWidth;r.totalWidth=r.width+r.pbmWidth}i.totalWidth=i.width+i.pbmWidth}}}}else{if(i.totalMinWidth+r.totalMinWidth+h.totalMinWidth>=j){i.width=i.minWidth;r.width=r.minWidth;i.totalWidth=i.width+i.pbmWidth;r.totalWidth=r.width+r.pbmWidth;j=i.totalMinWidth+r.totalMinWidth+h.totalMinWidth}}h.top=parseFloat(u.element.css("padding-top"));h.left=parseFloat(u.element.css("padding-left"));h.right=parseFloat(u.element.css("padding-right"));h.bottom=parseFloat(u.element.css("padding-bottom"));if(u.northElement){p.top=parseFloat(u.element.css("padding-top"));p.left=parseFloat(u.element.css("padding-left"));p.width=j-p.pbmWidth;h.top+=p.totalHeight}if(u.southElement){s.left=parseFloat(u.element.css("padding-left"));s.width=j-s.pbmWidth;s.top=e-s.totalHeight;h.bottom+=s.totalHeight}if(u.westElement){i.top=h.top;i.left=parseFloat(u.element.css("padding-left"));i.height=e-h.top-h.bottom-i.pbmHeight;h.left+=i.totalWidth}if(u.eastElement){r.top=h.top;r.left=j-r.totalWidth;r.height=e-h.top-h.bottom-r.pbmHeight;h.right+=r.totalWidth}h.width=j-h.left-h.right-h.pbmWidth;h.height=e-h.top-h.bottom-h.pbmHeight;a.each({north:p,south:s,west:i,east:r,center:h},function(x,w){if(u[x+"Element"]){u[x+"Element"].css(a.extend({position:"absolute"},{top:w.top+"px",left:w.left+"px",overflow:x=="north"?"visible":"hidden",width:w.width+"px",height:w.height+"px"}))}});u.element.trigger("resize")},_makeResizable:function(){var e=this,f=this.options;if(this.northElement){this.northElement.resizable(f.north.resizable?{handles:"s",containment:e.element,resize:function(i,h){var g=Math.max(ui.size.height,f.north.minHeight||0);g=Math.min(g,f.north.maxHeight||Number.MAX_VALUE);e._setOption("north",{height:g})},start:function(g,h){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(g,h){a("#mask").remove()}}:"destroy")}if(this.southElement){this.southElement.resizable(f.south.resizable?{handles:"n",containment:e.element,resize:function(h,i){var g=Math.max(i.size.height,f.south.minHeight||0);g=Math.min(g,f.south.maxHeight||Number.MAX_VALUE);e._setOption("south",{height:g})},start:function(g,h){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(g,h){a("#mask").remove()}}:"destroy")}if(this.westElement){this.westElement.resizable(f.west.resizable?{handles:"e",containment:e.element,resize:function(h,i){var g=Math.max(i.size.width,f.west.minWidth||0);g=Math.min(g,f.west.maxWidth||Number.MAX_VALUE);e._setOption("west",{width:g})},start:function(g,h){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(g,h){a("#mask").remove()}}:"destroy")}if(this.eastElement){this.eastElement.resizable(f.east.resizable?{handles:"w",containment:e.element,resize:function(h,i){var g=Math.max(i.size.width,f.east.minWidth||0);g=Math.min(g,f.east.maxWidth||Number.MAX_VALUE);e._setOption("east",{width:g})},start:function(g,h){a("body").append('<div id="mask" style="position: absolute; z-index: 999999; left: 0pt; top: 0pt; right: 0pt; bottom: 0pt;"></div>')},stop:function(g,h){a("#mask").remove()}}:"destroy")}},refresh:function(){this._calculateDimension()},destroy:function(){this.element.removeClass("ui-border");a(window).unbind("resize.border",this._proxy);return a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.rte",{options:{doctype:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">',cssFiles:[],jsFiles:[],mode:"design",lang:"en",absoluteURLs:true,styleWithCSS:false,history:[],undoable:false,redoable:false,formIds:{standard:"5080143085ac60df09000001",link:"508251eb0b27990c0a000001",image:"5082d29f0b27990c0a000005",table:"5085f383eeeac1e909000001",cell:"5086b873eeeac1e909000002",tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"]}},_create:function(){var e=this,i=this.options,g=this.element;g.addClass("an-rte").empty();this.url=this._parseURL(window.location.href);this.lang=(""+i.lang);i.iframe=a("<iframe/>").addClass("container").attr({frameborder:0}).appendTo(g);i.win=i.iframe[0].contentWindow;var h=(i.doc=i.win.document);if(i.resizable){g.resizable()}this.source=a("<textarea class='content'/>").appendTo(g);this.source[i.mode=="sourcecode"?"show":"hide"]();i.actions=this._createActions();a(i.win).bind("focus.rte blur.rte",function(k){e._trigger(k.type,k,g)});a(h).bind("dragend.rte",function(k){setTimeout(function(){try{i.win.focus();sel.moveToBookmark(sel.getBookmark());e.updatePath()}catch(p){}},200)});i.iframe.load(function(){var k=a(this).contents().find("body")[0];if(a.browser.msie){k.contentEditable=true}else{try{k.contentEditable=true;h.execCommand("styleWithCSS",false,i.styleWithCSS)}catch(q){}}if(i.mobile){var p=this;this.width="100%";setTimeout(function(){var s=p.contentWindow.document.body.scrollHeight;var t=p.contentWindow.document.documentElement.scrollHeight;var r=Math.max(s,t);p.height=r},500)}e.$body=a(k);if(i.cssClass){e.$body.addClass(i.cssClass)}i.onload&&i.onload();i.restore&&i.restore(e.$body);e._restore()});var f='<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';a.each(i.cssFiles,function(){f+="<link rel='stylesheet' type='text/css' href='"+this+"'/>"});a.each(i.jsFiles,function(){f+="<script type='text/javascript' language='javascript' src='"+this+"'><\/script>"});f+='<style id="stylesheet" type="text/css">'+(i.stylesheet||"")+"</style>";h.open();h.write(i.doctype+f+"</head><body>"+a.trim(i.content||"")+"</body></html>");h.close();i.dom=new rteDom(this);i.selection=new rteSelection(this);this.showToolbar(i.showToolbar);this.source.bind("change.rte keyup.rte",function(k){k.preventDefault();k.stopImmediatePropagation();e.element.trigger("change")}).bind("keydown.rte",function(s){if(s.keyCode==a.ui.keyCode.TAB){s.preventDefault();if(a.browser.msie){var k=document.selection.createRange();k.text="\t"+k.text;this.focus()}else{var q=this.value,p=q.substr(0,this.selectionStart),t=q.substr(this.selectionEnd);this.value=p+"\t"+t;this.setSelectionRange(p.length+1,p.length+1)}}});var j=null;a(h).bind("keydown.rte",function(p){var k=i.selection;if(p.keyCode==13){var q=k.getNode();if(i.dom.selfOrParent(q,/^PRE$/)){k.insertNode(i.doc.createTextNode("\r\n"))}else{if(a.browser.safari&&p.shiftKey){k.insertNode(i.doc.createElement("br"))}}}if(p.keyCode==32&&a.browser.opera){k.insertNode(i.doc.createTextNode(" "))}if((p.keyCode>=48&&p.keyCode<=57)||p.keyCode==61||p.keyCode==109||(p.keyCode>=65&&p.keyCode<=90)||(p.keyCode>=188&&p.keyCode<=190)||p.keyCode==191||(p.keyCode>=219&&p.keyCode<=222)||p.keyCode==8||p.keyCode==46||p.keyCode==32||p.keyCode==13){e.element.trigger("change")}if((p.keyCode>=8&&p.keyCode<=13)||(p.keyCode>=32&&p.keyCode<=40)||p.keyCode==46||(p.keyCode>=96&&p.keyCode<=111)||(p.keyCode==65)&&(p.metaKey||p.ctrlKey)){e.updatePath()}e.element.trigger(p)}).bind("contextmenu.rte",function(r){r.preventDefault();r.stopImmediatePropagation();var s=i.iframe.offset(),p=s.left+r.clientX,k=s.top+r.clientY,q=a.extend(a.Event(),{type:"contextmenu2",pageX:p,pageY:k});a(h).find(r.target).trigger(q)}).bind("paste.rte",function(k){if(i.denyPaste){k.stopPropagation();k.preventDefault()}}).bind("mousedown.rte",function(k){j="down"}).bind("mousemove.rte",function(k){if(j=="down"){j="moving"}e.element.trigger(k)}).bind("mouseup.rte dblclick.rte",function(k){if(j=="moving"||k.type=="dblclick"){j=null;e.element.trigger("selectionChanged")}e.updatePath();e.element.trigger(k)}).bind("click.rte newwidget.rte contentchange.rte",function(k){e.element.trigger(k)}).bind("treenodeclick.rte",function(p,k){e.element.trigger(p,k)});if(a.browser.msie){a(h).bind("keyup.rte",function(p){var k=i.selection;if(p.keyCode==86&&(p.metaKey||p.ctrlKey)){k.saveIERange();i.content=e.$body.html();k.restoreIERange();e.$body.mouseup();e.updatePath()}})}if(a.browser.safari){a(h).bind("click.rte",function(k){content.find(".rte-webkit-hl").removeClass("rte-webkit-hl");if(k.target.nodeName=="IMG"){a(k.target).addClass("rte-webkit-hl")}}).bind("keyup.rte",function(k){content.find(".rte-webkit-hl").removeClass("rte-webkit-hl")})}i.win.focus()},option:function(e,f){if(/^can.*/.test(e)){this.options[e]=this["_"+e]?this["_"+e]():false}if(e==="actionSets"&&f===b){return this._createActionSets()}else{if(e==="content"&&f===b){return this._getContent()}}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(f,g){var h=this.options,e=this.option(f);if(!equals(g,e)){a.Widget.prototype._setOption.apply(this,arguments);if(f=="mode"){if(g=="design"){h.iframe.show();this.$body.html(this.source.hide().val());h.restore&&h.restore(this.$body);this._restore();h.win.focus()}else{h.clean&&h.clean(this.$body);this._clean();this.source.val(this.$body.html()).show();h.iframe.hide();if(a.browser.msie){}else{this.source[0].setSelectionRange(0,0)}}}else{if(f=="content"){if(h.mode=="design"){this.$body.html(g)}else{if(h.mode=="sourcecode"){this.source.val(g)}}}else{if(f=="stylesheet"){a(h.doc).find("#stylesheet").text(g)}else{if(f=="height"){this.element.css("height",g)}else{if(f=="width"){this.element.css("width",g)}else{if(f=="showToolbar"){this.showToolbar(g)}else{if(f=="path"){this.toolbar&&this.toolbar.toolbar("refresh")}}}}}}}this._trigger("optionchanged",null,{key:f,value:g,oldValue:e})}return this},history:function(){var e=this,g=e.options,f=g.history;if(g.mode=="design"){clearTimeout(g.historyT);g.historyT=setTimeout(function(){f.push(e._getContent());e.htStep=f.length-1;e.option("undoable",true)},400)}},undo:function(){var e=this,f=e.options.history;if(f.length<=1){return}e.htStep=e.htStep-1;if(e.htStep<0){e.htStep=0}e.$body.html(f[e.htStep]);e._restore();e.option("redoable",true);e.htStep==0&&e.option("undoable",false)},redo:function(){var e=this,f=e.options.history;if(f.length<=1){return}e.htStep++;if(e.htStep>(f.length-1)){e.htStep=f.length-1}e.$body.html(f[e.htStep]);e._restore();e.option("undoable",true);(e.htStep==f.length-1)&&e.option("redoable",false)},showToolbar:function(e){if(e){if(!this.toolbar){var f=this,g=this.options;this.toolbar=a("<div/>").toolbar({actionSets:this._createActionSets()}).prependTo(this.element);function h(){if(f.toolbar.is(":visible")){var i=f.element.height()-f.toolbar.outerHeight(true);g.iframe.css({height:i});f.source.css({height:i})}}h();this._proxy=a.proxy(function(i){h()},this);a(window).bind("resize.rte",this._proxy)}}else{if(this.toolbar){a(window).unbind("resize.rte",this._proxy);this.toolbar.remove();delete this.toolbar}}},_getContent:function(){var f=this.options,e=f.content;if(f.mode=="design"&&this.$body){f.clean&&f.clean(this.$body);this._clean();e=this.$body.html();f.restore&&f.restore(this.$body);this._restore()}else{if(f.mode=="sourcecode"){e=this.source.val()}}return e},_clean:function(){a("table",this.$body).each(function(){if(a(this).data("resizable")){a(this).data("resizable").destroy()}});a("img",this.$body).unbind("dblclick");this.$body.find(".widget[type=tabsx]").each(function(){var e=a(this).data("tabsxwidget");if(e){e.destroy()}})},_restore:function(){var e=this,h=this.options,f=h.formIds,g=h.selection;a("table",this.$body).resizable({stop:function(j,i){e.element.trigger("contentchange");j.preventDefault();j.stopImmediatePropagation()}});a("img",this.$body).each(function(){var i=this;a(this).dblclick(function(){var j=attributes(i);j.width=a(i).css("width").replace(/px/g,"");j.height=a(i).css("height").replace(/px/g,"");e._showDialog("Image",j,[f.standard,f.image],function(k){a.each(k,function(q,p){if(q=="width"||q=="height"){p=a.trim(p)?$img.css(q,p):$img.removeAttr(q)}else{p=a.trim(p)?$img.attr(q,p):$img.removeAttr(q)}});if(!i.parentNode){g.insertNode(i)}e.element.trigger("contentchange")})})});this.$body.find(".widget[type=tabsx]").each(function(){var i=a(this);if(i.is(".an-tabsxwidget")){i.data("tabsxwidget").option("mode",h.mode)}else{i.tabsxwidget({parent:function(){return e},mode:h.mode,dbId:h.dbId,optionchanged:function(k,j){if(j.key=="metadata"||j.key=="attributes"){e.element.trigger("contentchange")}}})}})},_createActionSets:function(){var f=this.options,e=f.mode;if(e=="design"){return[this._controlActionSet(),this._formatActionSet(),this._tableActionSet(),this._widgetActionSet(),this._modeActionSet()]}else{if(e=="sourcecode"){return[this._modeActionSet()]}}},_controlActionSet:function(){return this._createActionSet(["properties","cleanFormat"])},_formatActionSet:function(){return this._createActionSet(["bold","italic","underline","strikethrough","subscript","superscript","alignLeft","alignCenter","alignRight","alignFull","font","fontSize","format","leftToRight","rightToLeft","fontColor","backgroundColor","outdent","indent","orderedList","unorderedList","link","deleteLink","horizontalRule","blockQuote","blockElement","stopFloat","image"])},_tableActionSet:function(){return this._createActionSet(["table","tableProps","deleteTable","rowBefore","rowAfter","deleteRow","columnBefore","columnAfter","deleteColumn","cellProps","mergeCells","splitCells"])},_widgetActionSet:function(){return this._createActionSet(["tabsx"])},_modeActionSet:function(){return this._createActionSet(["sourcecode"])},_createActionSet:function(e){var g=this.options.actions,f={};a.each(e,function(){f[this]=g[this]});return f},_doCCP:function(h){this.addHistory();try{this.options.doc.execCommand(h,false,null)}catch(g){if(a.browser.mozilla){var f=" Ctl + C";if(h=="cut"){f=" Ctl + X"}else{if(h=="paste"){f=" Ctl + V"}}a("<div class='rte-dialog'/>").dialog({title:"Warning",height:260,width:380,modal:true,open:function(e,i){a(this).append("This operation is disabled in your browser on security reason. Use shortcut instead.: "+f)},buttons:{OK:function(){a(this).dialog("close")}},close:function(j,i){a(this).remove()}})}else{window.console.log("commands failed: "+h)}}this.updatePath()},_canCCP:function(i){var h=this.options,f=false;try{f=h.mode=="design"&&h.doc.queryCommandEnabled(i)}catch(g){}return f},_canCut:function(){return this._canCCP("cut")},_canCopy:function(){return this._canCCP("copy")},_canPaste:function(){return this._canCCP("paste")},cut:function(){this._doCCP("cut")},copy:function(){this._doCCP("copy")},paste:function(){this._doCCP("paste")},updatePath:function(q){var f=this.options,g=f.selection,j=f.dom;q&&g.cleanCache();var h=g.getNode(),e=j.parents(h,"*"),r=f.rtl,u=r?" &laquo; ":" &raquo; ",t="",k;function s(v){var i=v.nodeName.toLowerCase();v=a(v);if(i=="img"||i=="div"){if(v.is(".widget")){var p=v.attr("id");if(p){p=p.replace(/-/g,".")}i=p+" ("+v.attr("type")+")"}}return i}if(h&&h.nodeType==1&&h.nodeName!="BODY"){e.unshift(h)}if(!r){e=e.reverse()}for(k=0;k<e.length;k++){t+=(k>0?u:"")+s(e[k])}return this.option("path",t)},removeFormat:function(){this.options.doc.execCommand("removeformat",false,null);return this},bold:function(){this.options.doc.execCommand("bold",false,null);this.element.trigger("contentchange");return this},italic:function(){this.options.doc.execCommand("italic",false,null);this.element.trigger("contentchange");return this},underline:function(){this.options.doc.execCommand("underline",false,null);this.element.trigger("contentchange");return this},strikethrough:function(){this.options.doc.execCommand("strikethrough",false,null);this.element.trigger("contentchange");return this},subscript:function(){this.options.doc.execCommand("subscript",false,null);this.element.trigger("contentchange");return this},superscript:function(){this.options.doc.execCommand("superscript",false,null);this.element.trigger("contentchange");return this},align:function(f){var h=this.options,g=h.selection.selected({collapsed:true,blocks:true,tag:"div"}),e=g.length;while(e--){h.dom.filter(g[e],"textNodes")&&a(g[e]).css("text-align",f)}this.element.trigger("contentchange");return this},leftToRight:function(){var g=this.options,f=g.dom,e=g.selection,h=e.getNode();if(a(h).attr("dir")=="ltr"||a(h).parents('[dir="ltr"]').length||a(h).find('[dir="ltr"]').length){a(h).removeAttr("dir");a(h).parents('[dir="ltr"]').removeAttr("dir");a(h).find('[dir="ltr"]').removeAttr("dir")}else{if(f.is(h,"textNodes")&&f.is(h,"block")){a(h).attr("dir","ltr")}else{a.each(f.parents(h,"textNodes"),function(j,k){if(f.is(k,"block")){a(k).attr("dir","ltr");return false}})}}this.element.trigger("contentchange");return this},rightToLeft:function(){var f=this.options,e=f.dom,g=f.selection.getNode();if(a(g).attr("dir")=="rtl"||a(g).parents('[dir="rtl"]').length||a(g).find('[dir="rtl"]').length){a(g).removeAttr("dir");a(g).parents('[dir="rtl"]').removeAttr("dir");a(g).find('[dir="rtl"]').removeAttr("dir")}else{if(e.is(g,"textNodes")&&e.is(g,"block")){a(g).attr("dir","rtl")}else{a.each(e.parents(g,"textNodes"),function(h,j){if(e.is(j,"block")){a(j).attr("dir","rtl");return false}})}}this.element.trigger("contentchange");return this},outdent:function(){var i=this.options,f=i.selection,h=i.dom;function g(p){function j(t){var q={type:"",val:0},r;if((r=h.attr(t,"style"))){q.type=r.indexOf("padding-left")!=-1?"padding-left":(r.indexOf("margin-left")!=-1?"margin-left":"");q.val=q.type?parseInt(a(t).css(q.type))||0:0}return q}var p=f.getNode(),k=j(p);if(k.val){k.node=p}else{a.each(h.parents(p,"*"),function(){k=j(this);if(k.val){k.node=this;return k}})}return k}var e=g();if(e.node){a(e.node).css(e.type,(e.val>40?e.val-40:0)+"px");this.updatePath()}this.element.trigger("contentchange");return this},indent:function(){var p=this.options,h=p.selection,k=p.dom,j=p.doc,f=h.selected({collapsed:true,blocks:true,wrap:"inline",tag:"p"});function e(s){var i=/(IMG|HR|TABLE|EMBED|OBJECT)/.test(s.nodeName)?"margin-left":"padding-left";var r=k.attr(s,"style").indexOf(i)!=-1?parseInt(a(s).css(i))||0:0;a(s).css(i,r+40+"px")}for(var g=0;g<f.length;g++){if(/^(TABLE|THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(f[g].nodeName)){a(f[g]).find("td,th").each(function(){e(this)})}else{if(/^LI$/.test(f[g].nodeName)){var q=a(f[g]);a(j.createElement(f[g].parentNode.nodeName)).append(a(j.createElement("li")).html(q.html()||"")).appendTo(q.html("&nbsp;"))}else{e(f[g])}}}this.updatePath();this.element.trigger("contentchange");return this},orderedList:function(){this.options.doc.execCommand("insertorderedlist",false,null);this.updatePath();this.element.trigger("contentchange");return this},unorderedList:function(){this.options.doc.execCommand("insertunorderedlist",false,null);this.updatePath();this.element.trigger("contentchange");return this},_showDialog:function(j,k,e,p,i){var q=this,g=this.options,h=g.selection,f=h.getBookmark();h.saveIERange();a("<div class='rte-dialog'/>").dialog({title:j,height:400,width:500,modal:true,create:function(r,s){var t=a(this);Model.getPages(g.dbId,e,function(v,u){if(u){t.editor({document:k,forms:u,dbId:g.dbId,mode:"edit",ignoreEscape:true})}})},buttons:{OK:function(){var r=a(this);h.moveToBookmark(f);p(r.editor("option","document"));q.updatePath();r.dialog("close")},Cancel:function(){a(this).dialog("close")}},open:function(r,s){if(typeof i=="function"){i()}},close:function(s,r){h.removeBookmark(f);a.browser.msie&&h.restoreIERange();a(this).remove()}})},link:function(){var s=this,f=this.options,g=f.selection,k=f.dom,r=f.doc,h=g.getNode(),q=k.selfOrParentLink(h),e=f.formIds;function j(i){return i.nodeName=="A"&&i.href}if(!q){sn=a.browser.msie?g.selected():g.selected({wrap:false});if(sn.length){for(var p=0;p<sn.length;p++){if(j(sn[p])){q=sn[p];break}}if(!q){q=k.parent(sn[0],j)||k.parent(sn[g.length-1],j)}}}q=q||r.createElement("a");this._showDialog("Link",attributes(q),[e.standard,e.link],function(u){var t=s._absoluteURL(u.href),v,i=h.nodeName=="IMG"?h:null;if(i&&i.parentNode){q=a(r.createElement("a")).attr("href",t);k.wrap(i,q[0])}else{if(!q.parentNode){v="#--el-editor---"+Math.random();r.execCommand("createLink",false,v);q=a('a[href="'+v+'"]',r).each(function(){var w=a(this);if(!a.trim(w.html())&&!a.trim(w.text())){w.replaceWith(w.text())}})}}u.href=t;q=a(q);a.each(u,function(x,w){w=a.trim(w)?q.attr(x,w):q.removeAttr(x)});i&&g.select(i)});this.element.trigger("contentchange");return this},blockQuote:function(){var h=this.options,f=h.selection,g=h.dom,i,e;if(f.collapsed()&&(i=g.selfOrParent(f.getNode(),/^BLOCKQUOTE$/))){a(i).replaceWith(a(i).html())}else{e=f.selected({wrap:"all",tag:"blockquote"});e.length&&f.select(e[0],e[e.length-1])}this.updatePath();this.element.trigger("contentchange");return this},blockElement:function(){var h=this.options,f=h.selection,g=h.dom,i,e;if(f.collapsed()){i=g.selfOrParent(f.getNode(),/^DIV$/);if(i){a(i).replaceWith(a(i).html())}}else{e=f.selected({wrap:"all",tag:"div"});e.length&&f.select(e[0],e[e.length-1])}this.updatePath();this.element.trigger("contentchange");return this},stopFloat:function(){var i=this.options,e=i.selection,h=i.dom,f=i.doc;function g(){if(e.collapsed()){var k=h.selfOrParent(e.getEnd(),/^DIV$/);if(k&&(h.attr(k,"clear")||a(k).css("clear")!="none")){return k}}}var j=g();if(j){j=a(j);if(!j.children().length&&!a.trim(j.text()).length){j.remove()}else{j.removeAttr("clear").css("clear","")}}else{e.insertNode(a(f.createElement("div")).css("clear","both")[0],true)}this.updatePath();this.element.trigger("contentchange");return this},deleteTable:function(){a(this.options.dom.parent(this.options.selection.getNode(),/^TABLE$/)).remove();this.updatePath();this.element.trigger("contentchange");return this},insertTableRow:function(k){var u=this.options,A=u.dom,w=u.selection,v=w.getNode(),C=u.doc,B=A.selfOrParent(v,/^(TD|TH)$/),t=A.selfOrParent(B,/^TR$/),s=A.tableMatrix(A.selfOrParent(B,/^TABLE$/));if(B&&t&&s){var q="before"==k,p=a(t).prevAll("tr").length,x=0,g=[];function h(i,r){while(r>0){r--;if(s[r]&&s[r][i]&&s[r][i].nodeName){return s[r][i]}}}for(var z=0;z<s[p].length;z++){if(s[p][z]&&s[p][z].nodeName){var e=a(s[p][z]);var f=parseInt(e.attr("colspan")||1);if(parseInt(e.attr("rowspan")||1)>1){if(q){x+=f}else{g.push(e)}}else{x+=f}}else{if(s[p][z]=="-"){e=h(z,p);e&&g.push(a(e))}}}var j=a(C.createElement("tr"));for(var z=0;z<x;z++){j.append("<td>&nbsp;</td>")}if(q){j.insertBefore(t)}else{j.insertAfter(t)}a.each(g,function(){a(this).attr("rowspan",parseInt(a(this).attr("rowspan")||1)+1)});this.updatePath()}this.element.trigger("contentchange");return this},deleteRow:function(){var t=this.options,w=t.selection,A=t.dom,v=w.getNode(),B=A.selfOrParent(v,/^(TD|TH)$/),s=A.selfOrParent(B,/^TR$/),k=A.selfOrParent(B,/^TABLE$/),q=A.tableMatrix(k);if(B&&s&&q.length){if(q.length==1){a(k).remove();this.updatePath()}var f=[],p=a(s).prevAll("tr").length;function g(i,r){while(r>0){r--;if(q[r]&&q[r][i]&&q[r][i].nodeName){return q[r][i]}}}function j(r,i){y=p+1;var E=null;if(q[y]){for(var D=0;D<i;D++){if(q[y][D]&&q[y][D].nodeName){E=q[y][D]}}r=r.remove();if(E){r.insertAfter(E)}else{r.prependTo(a(s).next("tr").eq(0))}}}function x(D){for(var r=0;r<D.length;r++){if(D[r]==B){return r<D.length-1?D[r+1]:D[r-1]}}}for(var z=0;z<q[p].length;z++){var e=null;var u=false;if(q[p][z]&&q[p][z].nodeName){e=q[p][z];u=true}else{if(q[p][z]=="-"&&(e=g(z,p))){u=false}}if(e){e=a(e);var C=parseInt(e.attr("rowspan")||1);if(C>1){e.attr("rowspan",C-1);u&&j(e,z,p)}}}var h=x(A.tableColumn(B));if(h){w.selectContents(h).collapse(true)}a(s).remove()}this.updatePath();this.element.trigger("contentchange");return this},insertTableColumn:function(j){var i=this.options,g=i.doc,h=i.dom,f=i.selection,e=h.tableColumn(f.getNode(),false,true);if(e.length){a.each(e,function(){var p=a(this);var k=parseInt(p.attr("colspan")||1);if(k>1){p.attr("colspan",k+1)}else{var q=a(g.createElement(this.nodeName)).html("&nbsp;");if(j=="before"){q.insertBefore(this)}else{q.insertAfter(this)}}})}this.updatePath();this.element.trigger("contentchange");return this},deleteColumn:function(){var e=this.options,f=e.selection,i=e.dom,g=f.getNode(),p=i.selfOrParent(g,/^(TD|TH)$/),h=a(p).prev("td,th")[0],k=a(p).next("td,th")[0],j=i.parent(g,/^TABLE$/),q=i.tableColumn(g,false,true);if(q.length){a.each(q,function(){var s=a(this),r=parseInt(s.attr("colspan")||1);if(r>1){s.attr("colspan",r-1)}else{s.remove()}});i.fixTable(j);if(h||k){f.selectContents(h?h:k).collapse(true)}}this.updatePath();this.element.trigger("contentchange");return this},mergeCells:function(){var v=this.options,x=v.selection,z=v.dom,g=null,w=z.selfOrParent(x.getStart(),/^(TD|TH)$/),u=z.selfOrParent(x.getEnd(),/^(TD|TH)$/);if(w&&u&&w!=u&&a(w).parents("table")[0]==a(u).parents("table")[0]){g=[w,u]}if(g){var A=z.indexOf(a(g[0]).parent("tr")[0]),h=z.indexOf(a(g[1]).parent("tr")[0]),r=Math.min(A,h),t=Math.max(A,h)-r+1,k=z.tableColumn(g[0],true,true),j=z.tableColumn(g[1],true),q=a.inArray(g[0],k.column),p=a.inArray(g[1],j.column),f=k.info.offset[q]<j.info.offset[p]?k:j,e=k.info.offset[q]>=j.info.offset[p]?k:j,i=0,B=null,s="";a(a(g[0]).parents("table").eq(0).find("tr").get().slice(r,r+t)).each(function(E){var D=s.length,C=false;a(this).children("td,th").each(function(){var K=a(this),I=a.inArray(this,f.column),H=a.inArray(this,e.column);if(I!=-1||H!=-1){C=I!=-1&&H==-1;var G=parseInt(K.attr("colspan")||1);if(E==0){i+=G}if(I!=-1&&E>0){var L=f.info.delta[I],F;if(L>0){if(K.css("text-align")=="left"){F=K.clone(true);K.html("&nbsp;")}else{F=K.clone().html("&nbsp;")}F.removeAttr("colspan").removeAttr("id").insertBefore(this);if(L>1){F.attr("colspan",L)}}}if(H!=-1){var L=e.info.delta[H],F;if(G-L>1){var J=G-L-1;if(K.css("text-align")=="right"){F=K.clone(true);K.html("&nbsp;")}else{F=K.clone().html("&nbsp;")}F.removeAttr("colspan").removeAttr("id").insertAfter(this);if(J>1){F.attr("colspan",J)}}}if(!B){B=K}else{s+=K.html();K.remove()}}else{if(C){if(E==0){i+=parseInt(K.attr("colspan")||1)}s+=K.html();K.remove()}}});s+=D!=s.length?"<br/>":""});B.removeAttr("colspan").removeAttr("rowspan").html(B.html()+s);if(i>1){B.attr("colspan",i)}if(t>1){B.attr("rowspan",t)}z.fixTable(a(g[0]).parents("table").get(0))}this.updatePath();this.element.trigger("contentchange");return this},splitCells:function(){var h=this.options,j=h.selection,u=h.dom,z=h.doc,k=u.selfOrParent(j.getNode(),/^(TD|TH)$/);if(k){var p=parseInt(u.attr(k,"colspan")),q=parseInt(u.attr(k,"rowspan"));if(p>1||q>1){var w=p-1,x=q-1,t=u.parent(k,/^TABLE$/),s=u.tableMatrix(t);if(w){for(var v=0;v<w;v++){a(z.createElement(k.nodeName)).html("&nbsp;").insertAfter(k)}}if(x){var B=u.indexesOfCell(k,s),g=B[0],f=B[1];for(var e=g+1;e<g+x+1;e++){var A=null;if(!s[e][f].nodeName){if(s[e][f-1].nodeName){A=s[e][f-1]}else{for(var v=f-1;v>=0;v--){if(s[e][v].nodeName){A=s[e][v];break}}}if(A){for(var v=0;v<=w;v++){a(z.createElement(A.nodeName)).html("&nbsp;").insertAfter(A)}}}}}a(k).removeAttr("colspan").removeAttr("rowspan");u.fixTable(t)}}this.updatePath();this.element.trigger("contentchange");return this},fontColor:function(h){var g=this.options,f=g.selection;if(!f.collapsed()){var e=f.selected({collapse:false,wrap:"text"});a.each(e,function(){if(/^(THEAD|TBODY|TFOOT|TR)$/.test(this.nodeName)){a(this).find("td,th").each(function(){a(this).css("color",h).find("*").css("color","")})}else{a(this).css("color",h).find("*").css("color","")}});this.updatePath();this.element.trigger("contentchange")}return this},backgroundColor:function(h){var g=this.options,f=g.selection;if(!f.collapsed()){var e=f.selected({collapse:false,wrap:"text"});a.each(e,function(){if(/^(THEAD|TBODY|TFOOT|TR)$/.test(this.nodeName)){a(this).find("td,th").each(function(){a(this).css("background-color",h).find("*").css("background-color","")})}else{a(this).css("background-color",h).find("*").css("background-color","")}});this.updatePath();this.element.trigger("contentchange")}return this},font:function(f){var h=this.options,g=h.selection,e=g.selected({filter:"textContainsNodes"});a.each(e,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?a(this).find("td,th"):a(this);a(this).css("font-family",f).find("[style]").css("font-family","")});this.updatePath();this.element.trigger("contentchange");return this},fontSize:function(f){var g=this.options,e=g.selection.selected({filter:"textContainsNodes"});a.each(e,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?a(this).find("td,th"):a(this);$this.css("font-size",f).find("[style]").css("font-size","")});this.updatePath();this.element.trigger("contentchange");return this},format:function(B){var j=this.options,k=j.selection,r=j.dom,A=j.doc;function u(i,e){function f(s){a(s).find("h1,h2,h3,h4,h5,h6,p,address,pre").each(function(){a(this).replaceWith(a(this).html())});return s}if(/^(LI|DT|DD|TD|TH|CAPTION)$/.test(i.nodeName)){!r.isEmpty(i)&&r.wrapContents(f(i),e)}else{if(/^(UL|OL|DL|TABLE)$/.test(i.nodeName)){r.wrap(i,e)}else{!r.isEmpty(i)&&a(f(i)).replaceWith(a(A.createElement(e)).html(a(i).html()))}}}var D=B.toUpperCase(),t,p,z,x=k.collapsed(),h=k.getBookmark(),g=k.selected({collapsed:true,blocks:true,filter:"textContainsNodes",wrap:"inline",tag:"span"}),q=g.length,C=a(g[0]).prev(),w=a(g[g.length-1]).next();while(q--){p=g[q];z=a(p);if(D=="DIV"||D=="SPAN"){if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(p.nodeName)){z.replaceWith(a(A.createElement("div")).html(z.html()||""))}}else{if(/^(THEAD|TBODY|TFOOT|TR)$/.test(p.nodeName)){z.find("td,th").each(function(){u(this,D)})}else{if(p.nodeName!=D){u(p,D)}}}}k.moveToBookmark(h);this.updatePath();this.element.trigger("contentchange");return this},deleteLink:function(){var p=this.options,h=p.selection,k=p.dom,j=p.doc,q=h.getNode(),e=k.selfOrParentLink(q);function g(i){return i.nodeName=="A"&&i.href}if(e){h.select(e);j.execCommand("unlink",false,null)}else{h=a.browser.msie?h.selected():h.selected({wrap:false});if(h.length){for(var f=0;f<h.length;f++){if(g(h[f])){e=h[f];break}}if(!e){e=k.parent(h[0],g)||k.parent(h[h.length-1],g)}}}this.updatePath();this.element.trigger("contentchange");return this},horizontalRule:function(){var g=this.options,e=g.selection,h=e.getEnd(),f=g.doc;h=(h&&(h.nodeName=="HR"))?h:f.createElement("hr");this._showDialog("Horizontal Rule",attributes(h),[g.formIds.standard],function(i){var j=a(h);a.each(i,function(q,p){p=a.trim(p)?j.attr(q,p):j.removeAttr(q)});if(!j.parent().length){e.insertNode(h)}});this.element.trigger("contentchange");return this},properties:function(){var e=this,g=this.options,f=g.selection,h=f.getNode();if(h.nodeType==3){h=h.parentNode}if(h.nodeType!=1||h.nodeName=="BODY"){return}this._showDialog("Standard Properties",attributes(h),[g.formIds.standard],function(i){var j=a(h);a.each(i,function(q,p){p=a.trim(p)?j.attr(q,p):j.removeAttr(q)});e.element.trigger("contentchange")});return this},image:function(){var g=this,p=this.options,j=p.selection,f=j.getEnd(),k=p.doc,i=p.formIds;if(a(f).is(".widget,:not(img)")){f=k.createElement("img")}if(f.width&&a(f).attr("style")){f.width=f.offsetWidth;a(f).attr("style",a(f).attr("style").replace(/width:\s*\d+px/,"width:"+f.offsetWidth+"px"))}if(f.height&&a(f).attr("style")){f.height=f.offsetHeight;a(f).attr("style",a(f).attr("style").replace(/height:\s*\d+px/,"height:"+f.offsetHeight+"px"))}var e=attributes(f),h=a.extend(true,{},e);this._showDialog("Image",attributes(f),[i.standard,i.image],function(q){var r=a(f);if(q.width&&q.style){q.style=q.style.replace(/width:\s*\d+px/,"width:"+q.width+"px")}if(q.height&&q.style){q.style=q.style.replace(/height:\s*\d+px/,"height:"+q.height+"px")}a.each(q,function(t,s){s=a.trim(s)?r.attr(t,s):r.removeAttr(t)});if(!f.parentNode){j.insertNode(f)}g.element.trigger("contentchange");if(!equals(q,h)){g.element.trigger("contentchange")}r.dblclick(function(){var s=attributes(f);s.width=a(f).css("width").replace(/px/g,"");s.height=a(f).css("height").replace(/px/g,"");g._showDialog("Image",s,[i.standard,i.image],function(t){a.each(t,function(w,u){if(w=="width"||w=="height"){u=a.trim(u)?r.css(w,u):r.removeAttr(w)}else{u=a.trim(u)?r.attr(w,u):r.removeAttr(w)}});if(!f.parentNode){j.insertNode(f)}g.element.trigger("contentchange")})})});return this},rteWidget:function(p,f,e){var g=this.options,h=g.selection,i=h.getStart(),q=a(i);if(!q.is(".widget[type="+p+"]")){q=a("<div class='widget'/>").attr("type",p).css((e&&e.style)||{});q.toggleClass("field",a.inArray(p,["text","checkbox","radio","select","datetime","mobiledate","codearea","textarea","file","grid","jsrender","password","rte","search","toggle","listview","customhtml"])!=-1);q.toggleClass("box",a.inArray(p,["box","editor","page","view"])!=-1);i=q.get(0)}var k=a.extend(true,e,q.getMetadata()),j=attributes(i),r=p.substring(0,1).toUpperCase()+p.substring(1)+" Properties";if(j.id){j.id=j.id.replace(/-/g,".")}this._showDialog(r,a.extend({},k,j),f,function(s){var t={};if(q.is(".field")&&s[p+"field"]){t[p+"field"]=s[p+"field"];delete s[p+"field"]}else{if(q.is("[type=widget]")){t.widget=s.widget;delete s.widget}else{if(q.is("[type=box]")){t.box=s.box;delete s.box;if(k&&k.box&&!(k.box.link==t.box.link&&t.box.link=="raw")){q.children(".content").empty()}}else{if(q.is("[type=tabsx]")){t.tabsxwidget=s.tabsxwidget;delete s.tabsxwidget}else{if(q.is("[type=button]")){t.buttonwidget=s.buttonwidget;delete s.buttonwidget}else{if(q.is(".box")&&s[p+"box"]){t[p+"box"]=s[p+"box"];delete s[p+"box"]}else{if(q.is(".widget")&&s[p+"widget"]){t[p+"widget"]=s[p+"widget"];delete s[p+"widget"]}}}}}}}if(!equals(t,k)){q.setMetadata(t);q.trigger("metadatachanged",[t,k])}if(!equals(s,j)){if(s.id){s.id=s.id.replace(/\./g,"-")}a.each(s,function(w,u){u=a.trim(u)?q.attr(w,u):q.removeAttr(w)});if(q.parent().length==0){h.insertNode(i);q.trigger("newwidget",[i])}else{q.trigger("attributeschanged",[s,j])}}});return this},rteWidgetActive:function(e){var f=this.options.selection.getEnd();if(f&&f.nodeName=="DIV"){return a(f).is(".widget[type="+e+"]")}return false},_alignEnable:function(){var f=this.options;if(f.mode!="design"){return false}var e=f.selection.getNode();return e&&e.nodeName=="BODY"?e:f.dom.selfOrParent(e,"textNodes")||(e&&e.parentNode&&e.parentNode.nodeName=="BODY"?e.parentNode:null)?true:false},_alignActive:function(h){var f=this.options;if(f.mode!="design"){return false}var e=f.selection.getNode(),g=e.nodeName=="BODY"?e:f.dom.selfOrParent(e,"textNodes")||(e.parentNode&&e.parentNode.nodeName=="BODY"?e.parentNode:null);return a(g).css("text-align")==h},_commandEnabled:function(g){var i=this.options,f=false;try{f=(i.mode=="design")&&i.doc.queryCommandEnabled(g)}catch(h){}return f},_commandState:function(g){var i=this.options,f=false;try{f=(i.mode=="design")&&i.doc.queryCommandState(g)}catch(h){}return f},_directionActive:function(e){var f=a(this.options.selection.getNode());return f.attr("dir")==e||f.parents("[dir="+e+"]").length||f.find("[dir="+e+"]").length},_colorEnable:function(f,e){var g=this.options;if(g.mode!="design"){return false}var i=g.selection.getNode();if(i){var h=a(i.nodeType!=1?i.parentNode:i).css(e);f.data("select").val(this._color2Hex(""+h)||(e=="color"?"#000000":"#FFFFFF"));return true}return false},_fontEnable:function(f){var g=this.options;if(g.mode!="design"){return false}var h=g.selection.getNode();if(h){if(h.nodeType!=1){h=h.parentNode}var e=a(h).css("font-family");e=e?e.toString().toLowerCase().replace(/,\s+/g,",").replace(/'|"/g,""):"";f.element.data("select").val(f.src[e]?e:"");return true}return false},_fontSizeEnable:function(e){var f=this.options;if(f.mode!="design"){return false}var g=f.selection.getNode();e.element.data("select").val((m=f.dom.attr(g,"style").match(/font-size:\s*([^;]+)/i))?m[1]:"");return true},_formatEnable:function(e){var f=this.options;if(f.mode!="design"){return false}var g=f.dom.selfOrParent(f.selection.getNode(),/^(H[1-6]|P|ADDRESS|PRE)$/);e.element.data("select").val(g?g.nodeName.toLowerCase():"span");return true},_outdentEnable:function(){var j=this.options;if(j.mode!="design"){return false}var g=j.selection,i=j.dom;function e(r){var p={type:"",val:0},q;if((q=i.attr(r,"style"))){p.type=q.indexOf("padding-left")!=-1?"padding-left":(q.indexOf("margin-left")!=-1?"margin-left":"");p.val=p.type?parseInt(a(r).css(p.type))||0:0}return p}var k=g.getNode(),h=e(k),f=null;if(h.val){f=k}else{a.each(i.parents(k,"*"),function(){h=e(this);if(h.val){f=this}})}return f?true:false},_linkEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,h=e.getNode();if(h){var f=g.dom;return f.selfOrParentLink(h)||f.selectionHas(e,function(i){return i.nodeName=="A"&&i.href})||!e.collapsed()||h.nodeName=="IMG"}return false},_linkActive:function(){var g=this.options,e=g.selection;if(g.mode!="design"){return false}var h=e.getNode();if(h){var f=g.dom;return f.selfOrParentLink(h)||f.selectionHas(e,function(i){return i.nodeName=="A"&&i.href})}return false},_deleteLinkEnable:function(){var g=this.options,e=g.selection;if(g.mode!="design"){return false}var h=e.getNode();if(h){var f=g.dom;return f.selfOrParentLink(h)||f.selectionHas(e,function(i){return i.nodeName=="A"&&i.href})}return false},_blockQuoteEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;if(!e.collapsed()){return true}return f.selfOrParent(e.getNode(),/^BLOCKQUOTE$/)},_blockElementEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return !e.collapsed()||f.selfOrParent(e.getNode(),/^DIV$/)},_blockElementActive:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return e.collapsed()&&f.selfOrParent(e.getNode(),/^DIV$/)},_stopFloatActive:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;if(!e.collapsed()){return false}var h=f.selfOrParent(e.getEnd(),/^DIV$/);return h&&(f.attr(h,"clear")||a(h).css("clear")!="none")},_propertiesEnable:function(){var f=this.options,e=f.selection,g=e.getNode();if(f.mode!="design"){return false}if(g&&g.nodeType==3){g=g.parentNode}g=(g&&g.nodeType==1&&g.nodeName!="BODY")?g:null;return g?true:false},_imageActive:function(){var f=this.options;if(f.mode!="design"){return false}var g=f.selection.getEnd();if(g){var e=a(g);return g.nodeName=="IMG"&&!e.is(".widget")&&!e.is(".rte-media")}return false},_tablePropsEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.selfOrParent(e.getNode(),/^TABLE$/)},_deleteTableEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.parent(e.getNode(),/^TABLE$/)},_rowBeforeEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.selfOrParent(e.getNode(),/^TR$/)},_rowAfterEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.selfOrParent(e.getNode(),/^TR$/)},_deleteRowEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.selfOrParent(e.getNode(),/^TR$/)},_columnBeforeEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.selfOrParent(e.getNode(),/^(TD|TH)$/)},_columnAfterEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.selfOrParent(e.getNode(),/^(TD|TH)$/)},_deleteColumnEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.selfOrParent(e.getNode(),/^(TD|TH)$/)},_cellPropsEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom;return f.parent(e.getNode(),/^TABLE$/)},_mergeCellsEnable:function(){var i=this.options;if(i.mode!="design"){return false}var g=i.selection,h=i.dom,f=h.selfOrParent(g.getStart(),/^(TD|TH)$/),e=h.selfOrParent(g.getEnd(),/^(TD|TH)$/);return f&&e&&f!=e&&a(f).parents("table").get(0)==a(e).parents("table").get(0)},_splitCellsEnable:function(){var g=this.options;if(g.mode!="design"){return false}var e=g.selection,f=g.dom,h=f.selfOrParent(e.getNode(),/^(TD|TH)$/);return h&&(parseInt(f.attr(h,"colspan"))>1||parseInt(f.attr(h,"rowspan"))>1)},_parseURL:function(g){var h=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var f=g.match(h);var e={};a.each(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(j){e[this]=f[j]});if(!e.host.match(/[a-z0-9]/i)){e.host=""}return e},_absoluteURL:function(f){var g=this.url.protocol+"://"+(this.url.userInfo?parts.userInfo+"@":"")+this.url.host+(this.url.port?":"+this.url.port:"");var h=!this.url.file?this.url.path:this.url.path.substring(0,this.url.path.length-this.url.file.length);f=a.trim(f);if(!f){return""}if(f[0]=="#"){return f}var e=this._parseURL(f);if(!e.host&&!e.path&&!e.anchor){return""}if(!this.options.absoluteURLs){return f}if(e.protocol){return f}if(e.host&&(e.host.indexOf(".")!=-1||e.host=="localhost")){return this.url.protocol+"://"+f}if(f[0]=="/"){f=g+f}else{if(f.indexOf("./")==0){f=f.substring(2)}f=g+h+f}return f},_color2Hex:function(j){var f={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#fffffff",yellow:"#ffff00"};var i=/\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*/i;var g=/aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|rgb\s*\([^\)]+\)/i;var e;j=j||"";if(j.indexOf("#")===0){return j}function h(k){k=parseInt(k).toString(16);return k.length>1?k:"0"+k}if(f[j]){return f[j]}if((e=j.match(i))){return"#"+h(e[1])+h(e[2])+h(e[3])}return""},_trimEventCallback:function(e){e=e?e.toString():"";return a.trim(e.replace(/\r*\n/mg,"").replace(/^function\s*on[a-z]+\s*\(\s*event\s*\)\s*\{(.+)\}$/igm,"$1"))},_toPixels:function(f){var e=f.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(e){f=e[1];unit=e[2]}if(f[0]=="."){f="0"+f}f=parseFloat(f);if(isNaN(f)){return""}var g=parseInt(a(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(f*g);case"pt":return parseInt(f*g/12);case"%":return parseInt(f*g/100)}return f},_parseStyle:function(h){var f={},g,j,e,i;if(typeof(h)=="string"&&h.length){a.each(h.replace(/&quot;/gi,"'").split(";"),function(k,p){if((i=p.indexOf(":"))!==-1){j=a.trim(p.substr(0,i));e=a.trim(p.substr(i+1));if(j=="color"||j=="background-color"){e=e.toLowerCase()}if(j&&e){f[j]=e}}})}return f},_encode:function(g){var i={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};var f=/[<>&\"]/g;var h=i;return(""+g).replace(f,function(e){return h[e]})},_edittable:function(k){var g=this.options,h=g.selection,j=g.dom,p=g.doc,f=g.formIds,r=this;var q=k?p.createElement("table"):j.selfOrParent(h.getNode(),/^TABLE$/);q=q||p.createElement("table");if(q.width&&a(q).attr("style")){q.width=q.offsetWidth;a(q).attr("style",a(q).attr("style").replace(/width:\s*\d+px/,"width:"+q.offsetWidth+"px"))}if(q.height&&a(q).attr("style")){q.height=q.offsetHeight;a(q).attr("style",a(q).attr("style").replace(/height:\s*\d+px/,"height:"+q.offsetHeight+"px"))}var i=attributes(q);if(k){a.extend(i,{rows:2,columns:2,_isNew:true})}var e=a.extend(true,{},i);this._showDialog("Table",i,[f.standard,f.table],function(v){var u=a(q);if(!u.parents().length){var x=parseInt(v.rows)||0;var A=parseInt(v.columns)||0;if(x<=0||A<=0){return}var s=a(p.createElement("tbody")).appendTo(q);for(var w=0;w<x;w++){var z="<tr>";for(var t=0;t<A;t++){z+="<td>&nbsp;</td>"}s.append(z+"</tr>")}}else{u.removeAttr("width").removeAttr("border").removeAttr("cellspacing").removeAttr("cellpadding").removeAttr("frame").removeAttr("rules").removeAttr("style")}delete v.rows;delete v.columns;delete v._isNew;if(v.width&&v.style){v.style=v.style.replace(/width:\s*\d+px/,"width:"+v.width+"px")}if(v.height&&v.style){v.style=v.style.replace(/height:\s*\d+px/,"height:"+v.height+"px")}a.each(v,function(C,B){B=a.trim(B)?u.attr(C,B):u.removeAttr(C)});if(!q.parentNode){h.insertNode(q)}u.resizable({stop:function(C,B){r.element.trigger("contentchange");C.preventDefault();C.stopImmediatePropagation()}});if(!equals(v,e)){r.element.trigger("contentchange")}});return this},_cellProperties:function(){var g=this,p=this.options,j=p.selection,k=p.dom,h=p.formIds;var e=k.selfOrParent(j.getNode(),/^(TD|TH)$/);if(!e){return}var i=a(e),f=attributes(e);a.extend(f,{type:e.nodeName.toLowerCase(),width:i.css("width")||i.attr("width"),height:i.css("height")||i.attr("height")});this._showDialog("Cell",f,[h.standard,h.cell],function(q){var r=i;switch(q.apply){case"row":r=i.parent("tr").children("td,th");break;case"column":r=a(k.tableColumn(e));break;case"table":r=i.closest("table").find("td,th");break}delete q.apply;if(e.nodeName.toLowerCase()!=q.type){a.each(r.get(),function(){a(this).replaceWith(a("<"+q.type+" />").html(a(this).html()))})}delete q.type;g.element.trigger("contentchange");a.each(q,function(t,s){s=a.trim(s)?r.attr(t,s):r.removeAttr(t)})});return this},addClass:function(e,f){this.$body.find(e).addClass(f)},removeClass:function(e,f){this.$body.find(e).removeClass(f)},toggleClass:function(f,g,e){this.$body.find(f).toggleClass(g,e)},_createActions:function(){var e=this,g=this.options;var f={properties:{type:"button",label:"Properties",icons:{primary:"ui-icon-css"},handler:function(){e.properties()},enabled:function(){return e._propertiesEnable()}},cleanFormat:{type:"checkbox",label:"Clean Format",icons:{primary:"ui-icon-clean-format"},handler:function(){e.removeFormat()},enabled:function(){return e._commandEnabled("removeformat")},checked:function(){return e._commandState("removeformat")}},bold:{type:"checkbox",label:"Bold",icons:{primary:"ui-icon-bold"},handler:function(){e.bold()},enabled:function(){return e._commandEnabled("bold")},checked:function(){return e._commandState("bold")}},italic:{type:"checkbox",label:"Italic",icons:{primary:"ui-icon-italic"},handler:function(){e.italic()},enabled:function(){return e._commandEnabled("italic")},checked:function(){return e._commandState("italic")}},underline:{type:"checkbox",label:"Underline",icons:{primary:"ui-icon-underline"},handler:function(){e.underline()},enabled:function(){return e._commandEnabled("underline")},checked:function(){return e._commandState("underline")}},strikethrough:{type:"checkbox",label:"Strikethrough",icons:{primary:"ui-icon-strikethrough"},handler:function(){e.strikethrough()},enabled:function(){return e._commandEnabled("strikethrough")},checked:function(){return e._commandState("strikethrough")}},subscript:{type:"checkbox",label:"Subscript",icons:{primary:"ui-icon-subscript"},handler:function(){e.subscript()},enabled:function(){return e._commandEnabled("subscript")},checked:function(){return e._commandState("subscript")}},superscript:{type:"checkbox",label:"Superscript",icons:{primary:"ui-icon-superscript"},handler:function(){e.superscript()},enabled:function(){return e._commandEnabled("superscript")},checked:function(){return e._commandState("superscript")}},alignLeft:{name:"align",type:"radio",label:"Align left",icons:{primary:"ui-icon-align-left"},handler:function(){e.align("left")},enabled:function(){return e._alignEnable()},checked:function(){return e._alignActive("left")}},alignCenter:{name:"align",type:"radio",label:"Align center",icons:{primary:"ui-icon-align-center"},handler:function(){e.align("center")},enabled:function(){return e._alignEnable()},checked:function(){return e._alignActive("center")}},alignRight:{name:"align",type:"radio",label:"Align right",icons:{primary:"ui-icon-align-right"},handler:function(){e.align("right")},enabled:function(){return e._alignEnable()},checked:function(){return e._alignActive("right")}},alignFull:{name:"align",type:"radio",label:"Align full",icons:{primary:"ui-icon-align-full"},handler:function(){e.align("justify")},enabled:function(){return e._alignEnable()},checked:function(){return e._alignActive("justify")}},leftToRight:{name:"direction",type:"radio",label:"Left to right",icons:{primary:"ui-icon-left-to-right"},handler:function(){e.leftToRight()},checked:function(){return e._directionActive("ltr")}},rightToLeft:{name:"direction",type:"radio",label:"Right to left",icons:{primary:"ui-icon-right-to-left"},handler:function(){e.rightToLeft()},checked:function(){return e._directionActive("rtl")}},fontColor:{type:"colorPicker",label:"Font color",icons:{primary:"ui-icon-font-color"},handler:function(h){e.fontColor(h)},enabled:function(){return e._colorEnable(this.element,"color")}},backgroundColor:{type:"colorPicker",label:"Background color",color:"#FFFFFF",icons:{primary:"ui-icon-background-color"},handler:function(h){e.backgroundColor(h)},enabled:function(){return e._colorEnable(this.element,"background-color")}},font:{type:"select",label:"Font",tpl:'<span style="font-family:%val">%label</span>',src:{"":"Font","andale mono,sans-serif":"Andale Mono","arial,helvetica,sans-serif":"Arial","arial black,gadget,sans-serif":"Arial Black","book antiqua,palatino,sans-serif":"Book Antiqua","comic sans ms,cursive":"Comic Sans MS","courier new,courier,monospace":"Courier New","georgia,palatino,serif":"Georgia","helvetica,sans-serif":"Helvetica","impact,sans-serif":"Impact","lucida console,monaco,monospace":"Lucida console","lucida sans unicode,lucida grande,sans-serif":"Lucida grande","tahoma,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,lucida grande,verdana,sans-serif":"Trebuchet MS","verdana,geneva,sans-serif":"Verdana"},select:function(h){e.font(h)},enabled:function(){return e._fontEnable(this)}},fontSize:{type:"select",label:"Font size",labelTpl:"%label",tpl:'<span style="font-size:%val;line-height:1.2em">%label</span>',src:{"":"Font size","xx-small":"Small (8pt)","x-small":"Small (10px)",small:"Small (12pt)",medium:"Normal (14pt)",large:"Large (18pt)","x-large":"Large (24pt)","xx-large":"Large (36pt)"},select:function(h){e.fontSize(h)},enabled:function(){return e._fontSizeEnable(this)}},format:{type:"select",label:"Format",labelTpl:"%label",tpls:{"":"%label"},src:{span:"Format",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",p:"Paragraph",address:"Address",pre:"Preformatted",div:"Normal (DIV)"},select:function(h){e.format(h)},enabled:function(){return e._formatEnable(this)}},outdent:{type:"button",label:"Outdent",icons:{primary:"ui-icon-outdent"},handler:function(){e.outdent()},enabled:function(){return e._outdentEnable()}},indent:{type:"button",label:"Indent",icons:{primary:"ui-icon-indent"},handler:function(){e.indent()}},orderedList:{type:"button",label:"Ordered list",icons:{primary:"ui-icon-ordered-list"},handler:function(){e.orderedList()},enabled:function(){return e._commandEnabled("insertorderedlist")},checked:function(){return e._commandState("insertorderedlist")}},unorderedList:{type:"button",label:"Unordered List",icons:{primary:"ui-icon-unordered-list"},handler:function(){e.unorderedList()},enabled:function(){return e._commandEnabled("insertunorderedlist")},checked:function(){return e._commandState("insertunorderedlist")}},link:{type:"checkbox",label:"Link",icons:{primary:"ui-icon-link"},handler:function(){e.link()},enabled:function(){return e._linkEnable()},checked:function(){return e._linkActive()}},deleteLink:{type:"checkbox",label:"Delete Link",icons:{primary:"ui-icon-del-link"},handler:function(){e.deleteLink()},enabled:function(){return e._deleteLinkEnable()},checked:function(){return e._deleteLinkEnable()}},horizontalRule:{type:"checkbox",label:"Horizontal rule",icons:{primary:"ui-icon-horizontal-rule"},handler:function(){e.horizontalRule()},checked:function(){return g.mode=="design"&&g.selection.getEnd()&&g.selection.getEnd().nodeName=="HR"}},blockQuote:{type:"checkbox",label:"Block quote",icons:{primary:"ui-icon-block-quote"},handler:function(){e.blockQuote()},enabled:function(){return e._blockQuoteEnable()},checked:function(){return e._blockQuoteEnable()}},blockElement:{type:"checkbox",label:"Block element (DIV)",icons:{primary:"ui-icon-block-element"},handler:function(){e.blockElement()},enabled:function(){return e._blockElementEnable()},checked:function(){return e._blockElementActive()}},stopFloat:{type:"checkbox",label:"Stop element floating",icons:{primary:"ui-icon-stop-float"},handler:function(){e.stopFloat()},checked:function(){return e._stopFloatActive()}},image:{type:"checkbox",label:"Image",icons:{primary:"ui-icon-image"},handler:function(){e.image()},checked:function(){return e._imageActive()}},table:{type:"button",label:"Table",icons:{primary:"ui-icon-table"},handler:function(){e._edittable(true)}},tableProps:{type:"button",label:"Table properties",icons:{primary:"ui-icon-table-props"},handler:function(){e._edittable()},enabled:function(){return e._tablePropsEnable()}},deleteTable:{type:"button",label:"Delete table",icons:{primary:"ui-icon-del-table"},handler:function(){e.deleteTable()},enabled:function(){return e._deleteTableEnable()}},rowBefore:{type:"button",label:"Insert row before",icons:{primary:"ui-icon-row-before"},handler:function(){e.insertTableRow("before")},enabled:function(){return e._rowBeforeEnable()}},rowAfter:{type:"button",label:"Insert row after",icons:{primary:"ui-icon-row-after"},handler:function(){e.insertTableRow("after")},enabled:function(){return e._rowAfterEnable()}},deleteRow:{type:"button",label:"Delete row",icons:{primary:"ui-icon-del-row"},handler:function(){e.deleteRow()},enabled:function(){return e._deleteRowEnable()}},columnBefore:{type:"button",label:"Insert column before",icons:{primary:"ui-icon-col-before"},handler:function(){e.insertTableColumn("before")},enabled:function(){return e._columnBeforeEnable()}},columnAfter:{type:"button",label:"Insert column after",icons:{primary:"ui-icon-col-after"},handler:function(){e.insertTableColumn("after")},enabled:function(){return e._columnAfterEnable()}},deleteColumn:{type:"button",label:"Delete column",icons:{primary:"ui-icon-del-column"},handler:function(){e.deleteColumn()},enabled:function(){return e._deleteColumnEnable()}},cellProps:{type:"button",label:"Table cell properties",icons:{primary:"ui-icon-cell-props"},handler:function(){e._cellProperties()},enabled:function(){return e._cellPropsEnable()}},mergeCells:{type:"button",label:"Merge table cells",icons:{primary:"ui-icon-merge-cells"},handler:function(){e.mergeCells()},enabled:function(){return e._mergeCellsEnable()}},splitCells:{type:"button",label:"Split table cells",icons:{primary:"ui-icon-split-cells"},handler:function(){e.splitCells()},enabled:function(){return e._splitCellsEnable()}},tabsx:{type:"checkbox",label:"Tabsx",icons:{primary:"ui-icon-tabsx"},handler:function(){e.rteWidget("tabsx",g.formIds.tabsx,{style:{width:400,height:300}})},checked:function(){return e.rteWidgetActive("tabsx")}},sourcecode:{type:"checkbox",label:"Source Code",icons:{primary:"ui-icon-sourcecode"},handler:function(){e.option("mode",g.mode=="sourcecode"?"design":"sourcecode")},checked:function(){return g.mode=="sourcecode"},enabled:function(){return true}}};a.each(f,function(){this.text=false;if(!this.enabled){this.enabled=function(){return g.mode=="design"}}});return f},destroy:function(){var f=this.options,e=f.doc;f.history=[];this.toolbar&&this.toolbar.remove();this.source.unbind(".rte");a(e).unbind(".rte");this.$body.unbind(".rte");a(f.win).unbind(".rte");a(window).unbind("resize.rte",this._proxy);this.element.removeClass("an-rte");return a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.tabsx",a.ui.tabs,{options:{duration:2000,slideshow:false,fxs:null},_create:function(){var e=this,f=this.options;if((f.mode=="edit"||f.mode=="browser")&&f.slideshow){f.fx=f.fxs?f.fxs:{opacity:"toggle",duration:200}}a.ui.tabs.prototype._create.apply(this,arguments);this.element.addClass("an-tabsx");this._navMenu=a("<div id='nav-menu'>>><span>0</span></div>");this._navMenu.css({position:"relative","float":"left",width:"18px",height:"22px","font-size":"60%",border:"1px solid #CCCCCC",margin:"0px",padding:"0px"});this._navMenu.find("span").css({position:"absolute",right:"0px",bottom:"0px","font-size":"11px"});this._navMenu.hover(function(g){e._navMenu.css({border:"1px solid #AAAAAA",cursor:"pointer",margin:"0px",padding:"0px"})},function(){e._navMenu.css({border:"1px solid #CCCCCC",margin:"0px",padding:"0px"})});if((f.mode=="edit"||f.mode=="browser")&&f.slideshow){this._slideshow(f.duration)}else{this.element.bind("tabsxadd.tabsx",a.proxy(this,"_showMenu"));this.element.bind("tabsxshow.tabsx",a.proxy(this,"_showMenu"));this.element.bind("tabsxremove.tabsx",a.proxy(this,"_showMenu"));this._proxy=a.proxy(this,"_showMenu");a(window).bind("resize.tabsx",this._proxy)}if(f.showTabsContextMenu){this.list.menu({triggerEvent:"contextmenu",menuPosition:{my:"left top",at:"left bottom"},delay:false,actions:{close:{type:"menuItem",text:"Close",handler:a.proxy(e,"closeCurrent")},closeOthers:{type:"menuItem",text:"Close Others",handler:a.proxy(e,"closeOthers")},closeAll:{type:"menuItem",text:"Close All",handler:a.proxy(e,"closeAll")}},select:function(h,g){a(this).menu("collapseAll")}})}},_slideshow:function(i){var e=this,j=this.options,k=null,h=0;this.lis.each(function(){h+=a(this).outerWidth(true)});this.list.css({width:h}).addClass("ui-tabs-slideshow-nav").removeClass("ui-widget-header");var f=function(p){g();e._rotation=setTimeout(function(){var q=j.selected;if(k!=null&&k==q){g();return false}e.select(++q<e.anchors.length?q:0);f()},i)};function g(){clearTimeout(e._rotation);e._rotation=null}if(i){this.anchors.bind("click",g);this.anchors.bind("mouseover",function(){var p=e.anchors.index(this);if(j.selected==p){g()}else{k=p}});this.anchors.bind("mouseout",function(){f();k=null});this.anchors.bind("mouseup",function(){a(this).parent().hasClass("ui-state-focus")&&a(this).parent().removeClass("ui-state-focus")});f()}else{g()}return this},closeCurrent:function(){this.remove(this.option("selected"))},closeOthers:function(){var e=this.option("selected");while(this.length()-1>e){this.remove(this.length()-1)}while(this.length()>1){this.remove(0)}},closeAll:function(){while(this.length()>0){this.remove(0)}},option:function(e,f){if(e==="selectedPanel"&&f===b){return this.panels.get(this.options.selected)}else{if(e==="panels"&&f===b){return this.panels}}return a.Widget.prototype.option.apply(this,arguments)},_showMenu:function(k,j){if(this.list.is(":hidden")){return}var f=this;if(k.type=="tabsxshow"){this.lis.each(function(r,e){var t=a(e),s=parseInt(t.attr("hit"))||0;t.attr("hit",t.is(".ui-tabs-selected")?0:s+1)})}var q=this.lis.toArray();q.sort(function(e,t){var s=parseInt(a(e).attr("hit")),r=parseInt(a(t).attr("hit"));return s-r});this._navMenu.appendTo(this.list);var i=this.list.width()-this._navMenu.outerWidth(true);this._navMenu.menu("destroy").detach();a.each(q,function(r,e){i-=a(e).outerWidth(true);a(e)[i>0?"show":"hide"]()});var h=this.lis.filter(":hidden"),g=h.size();if(g>0){this._navMenu.find("span").html(g);var p={};h.each(function(){var r=a(this),e=r.find("a:first"),s=e.attr("href").slice(1);p[s]={type:"menuItem",text:e.text(),handler:function(){f.element.tabsx("select","#"+s)}}});f._navMenu.appendTo(this.list);f._navMenu.menu({triggerEvent:"click",menuPosition:{of:f._navMenu,my:"left top",at:"left bottom"},delay:false,actions:p,select:function(s,r){a(this).menu("collapseAll")}})}},remove:function(e){if(this._getIndex(e)==-1){return}return a.ui.tabs.prototype.remove.apply(this,arguments)},panel:function(e){return a(this.panels[this._getIndex(e)])},_trigger:function(e,f,g){var j,i,h=this.options[e];g=g||{};f=a.Event(f);f.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase();f.target=this.element[0];i=f.originalEvent;if(i){for(j in i){if(!(j in f)){f[j]=i[j]}}}!(a.isFunction(h)&&h.call(this.element[0],f,g)===false||f.isDefaultPrevented());return this.element.trigger(f,g)},destroy:function(){var e=this.options;if(!e.destroyTabs){this.lis.add(this.panels).each(function(){a.removeData(this,"destroy.tabs")})}a(window).unbind("resize.tabsx",this._proxy);this.list.unbind(".tabsx");this.element.removeClass("an-tabsx").unbind(".tabsx").removeData("tabsx");return a.ui.tabs.prototype.destroy.apply(this,arguments)}})}(jQuery));
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.explorer",a.an.tree,{_create:function(){a.an.tree.prototype._create.apply(this,arguments);var e=this;a(document).bind("documentCreated.explorer documentChanged.explorer documentDeleted.explorer",function(g,f){a.each(a.isArray(f)?f:[f],function(i,h){if(g.type=="documentCreated"&&h._path){var j=h._path.split(","),p=j[j.length-3];e.refresh(p)}else{e.refresh(h._id);e.refresh(Model.GROUP_ROOT)}})})},_defaultContentProvider:function(){var e=this.options;return{getRoots:function(g){var f={$or:[]};a.each(e.roots,function(){f.$or.push({_id:this})});a.ans.getDoc(e.dbId,null,{selector:f},function(i,j){var h=[];a.each(j.docs||[],function(q,p){h.push({id:p._id,text:p.title,data:p,"class":"folder root"})});g(h)})},getChildren:function(f,i){var h=f.data,g;if(h._id==Model.EXTENSION_ROOT){g={type:Model.EXTENSION_POINT}}else{if(h.type==Model.EXTENSION_POINT){g={extensionPoint:h._id}}else{g={_path:{$regex:"^"+h._path+"[^,]+,$"}};if(e.showUser&&(h.type==Model.GROUP)){g={$or:[g,{type:Model.USER,_groupPaths:h._path}]}}else{if(!e.showUser){g={$and:[g,{type:{$ne:Model.USER}}]}}}}}a.ans.getDoc(e.dbId,null,{selector:g},function(k,p){var j=[];a.each(p.docs,function(q,r){j.push({id:r._id,text:r.title,data:r,parent:f,"class":(r.type==Model.CATEGORY||r.type==Model.OU||r.type==Model.GROUP||r.type==Model.ROLE||r.type==Model.EXTENSION_POINT)?"folder":"file"})});i(j)})},hasChildren:function(g){var f=g.data.type;return f==Model.CATEGORY||f==Model.OU||f==Model.GROUP||f==Model.ROLE||f==Model.EXTENSION_POINT},getId:function(f){return f.id?f.id:null}}},destroy:function(){a(document).unbind(".explorer");a.an.tree.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.page",{options:{mode:"browser",actionSets:[],wrapper:"<div/>",modelType:"page",formIds:{button:["5080143085ac60df09000001","50de596da092007b11000001"],tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],codearea:["5080143085ac60df09000001","51d66f5fedad572a8b0001ad"]},mFormIds:{tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],text:["5080143085ac60df09000001","519095a03bcccb65f400008b"],search:["5080143085ac60df09000001","51932b05ac8f2725e1000048"],password:["5080143085ac60df09000001","5185ac02a092006ca6000048"],checkbox:["5080143085ac60df09000001","519dbd9c3bcccb444800008c","51a2ffeeac8f275c2700013b"],button:["5080143085ac60df09000001","51933105ac8f2712ab000069"],slider:["5080143085ac60df09000001","51a5a62dac8f2755d2000069"],datetime:["5080143085ac60df09000001","50af2da26cec663c0a00000b"],textarea:["5080143085ac60df09000001","50af2ca66cec663c0a000008"],tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],file:["5080143085ac60df09000001","50ceb75ba092004120000000"],grid:["5080143085ac60df09000001","5089e21f2b2255080a000005"],jsrender:["5080143085ac60df09000001","514d0a46caa05a669e0005c8","514d0e9dcaa05a26e30001af","514d0825caa05a669e0002ae","514d5ef3ac8f27413200014e"],radio:["5080143085ac60df09000001","51a2b48dac8f2770b7000001","51850c1ca092003b12000024"],select:["5080143085ac60df09000001","51af125321c7d61a65000024","508259700b27990c0a000003"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],rte:["5080143085ac60df09000001"],collapsible:["5080143085ac60df09000001","51a8639ebd94293c2f000081"],mobiledate:["5080143085ac60df09000001","51c967a3ba4682122900004a"],toggle:["5080143085ac60df09000001","51a565753bcccb5b0e0000ac"],navbar:["5080143085ac60df09000001","51c17808caa05a042500004a","51c02b6eac8f274167000120"],listview:["5080143085ac60df09000001","51ad5e1f21c7d6296100006c","51ad54a921c7d63144000144"],customhtml:["5080143085ac60df09000001","51c175e221c7d6118800023a"],swipe:["5080143085ac60df09000001","51ca58ebedad5734e8000023"],codearea:["5080143085ac60df09000001","51d66f5fedad572a8b0001ad"]}},_create:function(){this.element.addClass("an-page");var o=this.options,page=o[this.widgetName];$.extend(this,eval("try{("+(page.methods||"{}")+")}catch(e){}"));o.cssFiles=o.cssFiles||[];o.jsFiles=o.jsFiles||[];if(o.mobile){o.cssFiles=["stylesheets/jquery.mobile-1.3.1.min.css","stylesheets/jquery.an.mwidget.css"].concat(o.cssFiles);o.jsFiles=["javascripts/jquery-1.8.2.js","javascripts/jquery.scrollto.js"].concat(o.jsFiles);o.formIds=o.mFormIds}else{o.cssFiles=["stylesheets/rte/rte-design.css","stylesheets/jquery-ui-1.8.24.custom.css","stylesheets/jquery.ui.timepicker.css","stylesheets/jquery.an.menu.css","stylesheets/jquery.an.agilegrid.css","stylesheets/jquery.an.tree.css","stylesheets/jquery.an.border.css","stylesheets/jquery.an.tabsx.css","stylesheets/jquery.an.toolbar.css","stylesheets/jquery.an.page.css","stylesheets/jquery.an.editor.css","stylesheets/jquery.an.formview.css","stylesheets/jquery.an.widget.css","stylesheets/jquery.an.tabsxwidget.css","stylesheets/jquery.an.box.css","stylesheets/jquery.an.fileinput.css","stylesheets/jquery.an.filefield.css","stylesheets/jquery.an.gridfield.css","stylesheets/jquery.colorpicker.css","stylesheets/jquery.ui.select.css","stylesheets/rte/paddinginput.css","stylesheets/jquery.an.rte.css","stylesheets/base.css"].concat(o.cssFiles);o.jsFiles=["javascripts/jquery-1.8.2.js","javascripts/jquery.scrollto.js"].concat(o.jsFiles)}this._initPage()},_initPage:function(){this.refresh()},_createOutline:function(){var self=this,page=this.options[this.widgetName],root=this._getPage();return{getRoots:function(mountNodes){var nodes=new Array();nodes.push({id:"root",text:page.title||page.name||page._id,"class":"folder"});mountNodes(nodes)},getChildren:function(parentNode,mountNodes){var nodes=new Array();if(parentNode.id=="root"){root.find(".widget").each(function(){var $this=$(this),id=$this.attr("id");if($this.parent().closest(".widget").length==0){nodes.push({id:id,text:id,"class":self._isContainer($this)?"folder":"file",data:self._getWidgetObj($this)})}})}else{root.find("#"+parentNode.id).find(".widget").each(function(){var $this=$(this),id=$this.attr("id");if($this.parent().closest(".widget").attr("id")==parentNode.id){nodes.push({id:id,text:id,"class":self._isContainer($this)?"folder":"file",data:self._getWidgetObj($this)})}})}mountNodes(nodes)},hasChildren:function(node){return node["class"]=="folder"},getId:function(node){return node.id?node.id:null}}},_isContainer:function(el){return el.is("[type=tabsx], [type=box]")},_getWidgetObj:function(el){var widget=null,type=el.attr("type");if(el.is(".box")){widget=el.data(type)}else{if(el.is(".widget")){widget=el.data(type+"widget")}}return widget},option:function(key,value){var o=this.options;if(key==="actionSets"&&value===undefined){return this._createActionSets()}else{if(key==="outline"&&value===undefined){return this._createOutline()}else{if(key=="content"&&value==undefined){if(o.isDirty){this._syncPageContent()}return o[this.widgetName].content}}}var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var o=this.options,oldValue=o[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);this._handleChange(key,value,oldValue);this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},_handleChange:function(key,value,oldValue){var o=this.options;if(key==="mode"){if(o.isDirty){this._syncPageContent()}this.refresh()}else{if(key==="page"){var page=o[this.widgetName];this.element.children("style").text(page.stylesheet);this.$page&&!o.isDirty&&this.$page.empty().html(page.content);if(this.rte){!o.isDirty&&this.rte.rte("option","content",page.content);this.rte.rte("option","stylesheet",page.stylesheet)}this.refresh()}}},refresh:function(){var o=this.options;this["_"+o.mode]&&this["_"+o.mode]()},_browser:function(){this.rte&&this.rte.hide();if(!this.$page){this._createPage()}else{this.$page.show();this._refreshWidgets()}},_edit:function(){this.rte&&this.rte.hide();if(!this.$page){this._createPage()}else{this.$page.show();this._refreshWidgets()}},_design:function(){this.$page&&this.$page.hide();if(!this.rte){var self=this,o=this.options,page=o[this.widgetName];Model.getDb(o.dbId,function(error,db){self._createRTE(db&&db.globalCss?db.globalCss+page.stylesheet:page.stylesheet)})}else{this.rte.show();this._refreshWidgets()}},getWidget:function(id){var self=this,o=this.options,page=o[this.widgetName],widget=null;this._getPage().find("#"+id).each(function(){var $this=$(this),filter=(o.mode=="design"?".an-box:not(.raw),."+page.name:".an-page");$this.parent().closest(filter).each(function(){if($(this).is("."+page.name)||this==self.element[0]){widget=self._getWidgetObj($this);return false}});if(widget){return false}});return widget},showWidget:function(){var self=this;$.each(arguments,function(){var w=self.getWidget(this);w&&w.widget().show()})},hideWidget:function(){var self=this;$.each(arguments,function(){var w=self.getWidget(this);w&&w.widget().hide()})},_createPage:function(){var o=this.options,page=o[this.widgetName],el=this.element;$('<style type="text/css">'+(page.stylesheet||"")+"</style>").appendTo(el);this.$page=$(o.wrapper).addClass(page.name).html(page.content).appendTo(el);var data={};data[this.widgetName]=this;$.each(eval("("+(o[this.widgetName].actions||"[]")+")"),function(k,action){el.bind(action.events,data,action.handler)});if(o.mobile){this._refreshMobileToolbar()}this._refreshWidgets()},_refreshMobileToolbar:function(){try{var $page=this.element.parents(".ui-page-active"),o=$page.data("mobile-page").options,pageRole=$page.jqmData("role"),pageTheme=o.theme;$(":jqmData(role='header'), :jqmData(role='footer'), :jqmData(role='content')",$page).jqmEnhanceable().each(function(){var $this=$(this),role=$this.jqmData("role"),theme=$this.jqmData("theme"),contentTheme=theme||o.contentTheme||(pageRole==="dialog"&&pageTheme),$headeranchors,leftbtn,rightbtn,backBtn;$this.addClass("ui-"+role);if(role==="header"||role==="footer"){var thisTheme=theme||(role==="header"?o.headerTheme:o.footerTheme)||pageTheme;$this.addClass("ui-bar-"+thisTheme).attr("role",role==="header"?"banner":"contentinfo");if(role==="header"){$headeranchors=$this.children("a, button");leftbtn=$headeranchors.hasClass("ui-btn-left");rightbtn=$headeranchors.hasClass("ui-btn-right");leftbtn=leftbtn||$headeranchors.eq(0).not(".ui-btn-right").addClass("ui-btn-left").length;rightbtn=rightbtn||$headeranchors.eq(1).addClass("ui-btn-right").length}if(o.addBackBtn&&role==="header"&&$(".ui-page").length>1&&$page.jqmData("url")!==$.mobile.path.stripHash(location.hash)&&!leftbtn){backBtn=$("<a href='javascript:void(0);' class='ui-btn-left' data-"+$.mobile.ns+"rel='back' data-"+$.mobile.ns+"icon='arrow-l'>"+o.backBtnText+"</a>").attr("data-"+$.mobile.ns+"theme",o.backBtnTheme||thisTheme).prependTo($this)}$this.children("h1, h2, h3, h4, h5, h6").addClass("ui-title").attr({role:"heading","aria-level":"1"})}else{if(role==="content"){if(contentTheme){$this.addClass("ui-body-"+(contentTheme))}$this.attr("role","main")}}})}catch(e){}},_createRTE:function(stylesheet){var self=this,o=this.options,page=o[this.widgetName];this.rte=$("<div class = 'rte'/>").appendTo(this.element).rte({content:page.content,cssFiles:o.cssFiles,jsFiles:o.jsFiles,dbId:o.dbId,mobile:o.mobile,modelType:o.modelType,stylesheet:stylesheet,cssClass:page.name,restore:function(page){self._refreshWidgets(page)},clean:function(page){page.find(".widget").each(function(){var $this=$(this),wid;wid=self._getWidgetObj($this);wid&&wid.destroy()})},onload:function(){var sel=self.rte.rte("option","selection"),$doc=$(self.rte.rte("option","doc"));$doc.bind("paste.page",function(e){setTimeout(function(){self._refreshWidgets();self.rte.rte("updatePath");self._trigger("change",null,self)},20)}).bind("widgetdblclick.page widgetclick.page widgetchange.page click.page",function(e,widget){$doc.find(".widget.selected").removeClass("selected");if(e.type=="widgetclick"||e.type=="widgetdblclick"){if(widget.selectable(e.originalEvent)){var el=widget.widget();el.addClass("selected");!$.browser.chrome&&sel.select(el[0]);self._trigger("widgetselect",null,widget)}self.rte.rte("updatePath");if(e.type=="widgetdblclick"){var type=widget.option("type");if(self.rteWidgetActive(type)){self.rteWidget(type)}}}self.rte.trigger(e,widget)});self._refreshWidgets();var data={};data[self.widgetName]=self;self._trigger(self.widgetName+"create",null,data)}}).bind("change.page contentchange.page",function(e){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}).bind("newwidget.page",function(e,widget){e.stopImmediatePropagation();self.refresh();self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)})},_getPage:function(){return this.options.mode=="design"?$(this.rte.rte("option","doc")):this.$page},_refreshWidgets:function(page){var self=this;(page||this._getPage()).find(".widget").each(function(){self._refreshWidget($(this))});return this},_refreshWidget:function(el){var self=this,o=this.options,type=el.attr("type");if(el.is(".box")){var actions=[],id=el.attr("id");$.each(o.boxToolbarActions||[],function(){if(this.boxName==id){actions.push(this)}});if(el.is(".an-box")){el.data("box").option("mode",o.mode)}else{el.box({parent:function(){return self},mode:o.mode,dbId:o.dbId,mobile:o.mobile,toolbarActions:actions,optionchanged:function(e,data){if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}})}}else{if(el.is("[type="+type+"]")){if(el.is(".an-"+type+"widget")){el.data(type+"widget").option("mode",o.mode)}else{el[type+"widget"]({parent:function(){return self},mode:o.mode,dbId:o.dbId,mobile:o.mobile,optionchanged:function(e,data){if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}})}}}},_createActionSets:function(){if(this.options.mode=="design"){return[this._controlActionSet(),this._formatActionSet(),this._tableActionSet()]}},_controlActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["properties","cleanFormat"],actions)},_formatActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["bold","italic","underline","strikethrough","subscript","superscript","alignLeft","alignCenter","alignRight","alignFull","font","fontSize","format","leftToRight","rightToLeft","fontColor","backgroundColor","outdent","indent","orderedList","unorderedList","link","deleteLink","horizontalRule","blockQuote","blockElement","stopFloat","image"],actions)},_tableActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["table","tableProps","deleteTable","rowBefore","rowAfter","deleteRow","columnBefore","columnAfter","deleteColumn","cellProps","mergeCells","splitCells"],actions)},_createActionSet:function(actionNames,actions){var actionSet={};$.each(actionNames,function(){actionSet[this]=actions[this]});return actionSet},_syncPageContent:function(){var page=this.options[this.widgetName];page.content=this.rte.rte("option","content");this.$page&&this.$page.empty().html(page.content)},rteWidget:function(type,opts){this.rte&&this.rte.rte("rteWidget",type,this.options.formIds[type],opts);return this},rteWidgetActive:function(type){return this.rte&&this.rte.rte("rteWidgetActive",type)},labelActive:function(){return this.rte&&this.rte.rte("labelActive")},sourceCode:function(){if(this.rte){var mode=this.rte.rte("option","mode");this.rte.rte("option","mode",mode=="sourcecode"?"design":"sourcecode")}},sourceCodeActive:function(){return this.rte&&this.rte.rte("option","mode")=="sourcecode"},handler:function(){self.option("mode",o.mode=="sourcecode"?"design":"sourcecode")},checked:function(){return o.mode=="sourcecode"},highlightWidget:function(id,highlight){var w=this.getWidget(id);w&&w.highlight(highlight);return this},scrollTo:function(id,opts){var o=this.options;if(o.mode=="design"){var win=this.rte.rte("option","win");win.$("#"+id.replace(/\./g,"-")).ScrollTo(opts)}else{this.$page.find("#"+id).scrollTo(opts)}},save:function(){var self=this,o=this.options,page=o[this.widgetName];if(o.isDirty){this._syncPageContent();ModelupdateDocument(o.dbId,page._id,page,null,function(err,result){self.option("isDirty",false)})}return this},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&pageid="+o[this.widgetName]._id;print(url);return this},destroy:function(){$(this.options.document).unbind(".page");this.element.unbind(".page").removeClass("an-page").children("style").remove();return $.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.mpage",a.an.page,{_create:function(){this.element.addClass("an-mpage");if(this.widgetName=="mpage"){this.widgetName="page"}a.an.page.prototype._create.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.form",$.an.page,{options:{document:{},printable:true,formIds:{text:["5080143085ac60df09000001","5092733215ca72150a000001"],password:["5080143085ac60df09000001","5185ac02a092006ca6000048"],checkbox:["5080143085ac60df09000001","50af2d266cec663c0a000009"],datetime:["5080143085ac60df09000001","50af2da26cec663c0a00000b"],mobiledate:["5080143085ac60df09000001","51c967a3ba4682122900004a"],textarea:["5080143085ac60df09000001","50af2ca66cec663c0a000008"],tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],file:["5080143085ac60df09000001","50ceb75ba092004120000000"],grid:["5080143085ac60df09000001","5089e21f2b2255080a000005"],jsrender:["5080143085ac60df09000001","514d0a46caa05a669e0005c8","514d0e9dcaa05a26e30001af","514d0825caa05a669e0002ae","514d5ef3ac8f27413200014e"],radio:["5080143085ac60df09000001","50af2d626cec663c0a00000a","51850c1ca092003b12000024"],select:["5080143085ac60df09000001","51850b35a09200784a000122","508259700b27990c0a000003"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],rte:["5080143085ac60df09000001"]},wrapper:"<form/>"},_create:function(){$.an.page.prototype._create.apply(this,arguments)},_initPage:function(){var self=this,o=this.options,el=this.element;el.addClass("an-form");o.cssFiles=o.cssFiles||[];o.cssFiles.push("stylesheets/jquery.an.form.css");o.document=$.type(o.document)=="function"?o.document():o.document;$(o.document).bind("docchanged.form",function(e,doc,oldDoc){self.refresh();el.trigger("documentchanged",e,[doc,oldDoc])}).bind("propchanged.form",function(e,id,value,oldValue,trans){self.field(id,value)});$.an.page.prototype._initPage.apply(this,arguments)},option:function(key,value){var o=this.options;if(key==="mode"&&o.readonly){return}else{if(key==="isValid"&&value===undefined&&o.mode=="edit"){return this.validator.form()}}return $.an.page.prototype.option.apply(this,arguments)},_getWidgetObj:function(el){if(el.is(".field")){return el.data(el.attr("type")+"field")}return $.an.page.prototype._getWidgetObj.apply(this,arguments)},_handleChange:function(key,value,oldValue){var o=this.options;if(key==="document"){this.refresh()}else{if(key==="url"){this.$page.find(".field.file").filefield("option","url",o.url);this.$page.find(".field.grid").gridfield("option","url",o.url)}}return $.an.page.prototype._handleChange.apply(this,arguments)},_createPage:function(){$.an.page.prototype._createPage.apply(this,arguments);this.validator=this.$page.validate($.extend({meta:"validate",ignore:"",errorPlacement:function(error,el){error.insertAfter(el.closest("div.field"))}},eval("("+(this.options[this.widgetName].validator||"{}")+")")))},_refreshWidget:function(el){var self=this,o=this.options,type=el.attr("type");if(el.is(".field")){var id=el.attr("id");if(id){id=id.replace(/-/g,".")}var doc=o.document,value=doc&&doc.prop&&doc.prop(id),field=el.data(type+"field");if(field){field.option("mode",o.mode).option("value",value);field.refresh()}else{var opts={dbId:o.dbId,parent:function(){return self},value:value,url:o.url,mode:o.mode,mobile:o.mobile,optionchanged:function(e,data){if(data.key=="value"&&doc.prop){var id=$(e.target).attr("id");id=id&&id.replace(/-/g,".");var curValue=doc.prop(id);if(curValue!=data.value){doc.prop(id,data.value,data["transient"])}}else{if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}},resize:function(e,data){self.option("isDirty",true)}};if(type=="button"){el[type+"widget"]({parent:function(){return self},label:el.attr("label")})}else{el[type+"field"]&&el[type+"field"](opts)}}}else{$.an.page.prototype._refreshWidget.apply(this,arguments)}},field:function(id,value){var field=this._getPage().find("#"+id.replace(/\./g,"-")+".field");if(field.size()==0){return}if(value===undefined){var v=null;field.each(function(){var $this=$(this),type=$this.attr("type");v=$this[type+"field"]("option","value");if(type=="radio"&&v!=null){return false}});return v}else{field[field.attr("type")+"field"]("option","value",value)}},label:function(){this.rte&&this.rte.rte("label");return this},reset:function(){var o=this.options,staticAttr=["type","_path"],doc=o.document._doc,_this=this;this.element.find("form")[0].reset();for(var q in doc){if(q=="_id"){doc[q]=new ObjectId().toString()}else{if(q!="type"&&q!="_path"){delete doc[q]}}}var field=this._getPage().find(".field");if(field.size()==0){return}field.each(function(){if($(this).attr("type")=="select"){_this.field(this.id,$(this).find("select").val())}else{if($.isFunction($(this)[$(this).attr("type")+"field"])){_this.field(this.id,"")}}_this.getWidget(this.id)&&_this.getWidget(this.id).element.trigger("change")})},validate:function(){return this.validator?this.validator.form():true},print:function(){var o=this.options,docId=o.document.prop("_id"),loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&docid="+docId+"&formid="+o[this.widgetName]._id;print(url);return this},destroy:function(){this.element.removeClass("an-form");return $.an.page.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.agilegrid",{options:{selectionMode:"row",showTopHeader:true,showLeftHeader:true,isColumnResizable:false,isRowResizable:false,topHeaderHeight:28,leftHeaderWidth:50,defaultColWidth:80,defaultRowHeight:28,cellSelections:[],colSelections:{},rowSelections:{},focus:{row:0,col:0},pagerHeight:28,currentPage:0,totalPage:0,colModel:{},rowModel:{},rowOffset:0,limit:30,rowCount:0,totalRowCount:0,totalColCount:3,topHeaderRender:function(f,e){return e&&e.label?e.label:f},leftHeaderRender:function(e){return e},cellRender:function(f,e){return f+","+e}},_create:function(){this.element.addClass("an-agilegrid").empty();var e=this,f=this.options;if(f.showLeftHeader&&f.showTopHeader){this.topLeftCorner=a("<div class='top-left ui-widget-header'/>").css({left:0,top:0,width:f.leftHeaderWidth,height:f.topHeaderHeight}).appendTo(this.element)}if(f.showTopHeader){this.topHeaderTable=a("<table cellspacing='0' cellpadding='0'><thead><tr/></thead></table>");this.topHeaderArea=a("<div class='top-header ui-widget-header'/>").css({left:f.showLeftHeader?f.leftHeaderWidth+1:0,top:0,right:0,height:f.topHeaderHeight+1}).append(this.topHeaderTable).appendTo(this.element).disableSelection()}if(f.showLeftHeader){this.leftHeaderTable=a("<table cellspacing='0' cellpadding='0'><thead></thead></table>");this.leftHeaderArea=a("<div class='left-header ui-widget-header'/>").css({left:0,top:f.showTopHeader?f.topHeaderHeight+1:0,bottom:f.showPager?f.pagerHeight:0,width:f.leftHeaderWidth+1}).append(this.leftHeaderTable).appendTo(this.element).disableSelection()}this.contentArea=a("<div class='content-area'/>").css({left:f.showLeftHeader?f.leftHeaderWidth+1:0,top:f.showTopHeader?f.topHeaderHeight+1:0,bottom:f.showPager?f.pagerHeight:0,right:0}).appendTo(this.element).disableSelection();this.contentTable=a("<table class='content' cellspacing='0' cellpadding='0'><tbody/></table>").appendTo(this.contentArea);if(f.showPager){this.pager=a("<div class='pager ui-widget-header'/>").css({left:0,right:0,bottom:0,height:f.pagerHeight}).appendTo(this.element);a.each(["first","prev","goto","next","last"],function(h,g){if(g=="goto"){e.pager.append("<div class='goto-page'>Page<input class='current-page' type='text' value='"+f.currentPage+"'>of<div class='total-page'>"+f.totalPage+"</div></div>");e.pager.delegate("input","change.agilegrid",function(){var j=a(this),i=a(this).val();if(i<=0){i=1;j.val(i)}else{if(i>f.totalPage){i=f.totalPage;j.val(i)}}e._trigger("gotopage",null,{page:i})})}else{a("<button class='pager-button'/>").attr("id",g).appendTo(e.pager).button({label:g,icons:{primary:"ui-icon-"+g+"-page"},text:false,disabled:true}).click(function(i){i.preventDefault();i.stopImmediatePropagation();e._trigger(g+"page",null,{currentPage:f.currentPage})})}});this.pager.append("<div class='info'>")}this.contentArea.scroll(function(){var g=e.contentTable.position();if(f.showTopHeader){e.topHeaderTable.css("left",g.left)}if(f.showLeftHeader){e.leftHeaderTable.css("top",g.top)}});this.element.delegate(".top-header th>div","hover.agilegrid",function(g){if(f.isColumnResizable){a(this).resizable({handles:"e",resize:function(h,i){e._columnWidth(parseInt(i.element.parent().attr("index")),i.size.width)}})}}).delegate(".left-header th>div","hover.agilegrid",function(g){if(f.isRowResizable){a(this).resizable({handles:"s",resize:function(h,i){e._rowHeight(f.rowOffset,parseInt(i.element.parent().attr("index")),i.size.height)}})}}).delegate(".top-header th","mousedown.agilegrid",function(k){if(f.selectionMode=="row"){return}var h=parseInt(a(this).attr("index"));if(k.ctrlKey){if(f.colSelections[h]){delete f.colSelections[h]}else{f.colSelections[h]=true}e.contentTable.find("td[colindex="+h+"]").toggleClass("selected",f.colSelections[h]==true?true:false);f.focus=a.extend(f.focus,{col:h})}else{if(k.shiftKey){var p=Math.min(f.focus.col,h),g=Math.max(f.focus.col,h);e.clearSelection();for(var j=p;j<=g;j++){f.colSelections[j]=true;e.contentTable.find("td[colindex="+j+"]").addClass("selected")}}else{e.clearSelection();f.focus=a.extend(f.focus,{col:h});f.colSelections[h]=true;e.contentTable.find("td[colindex="+h+"]").addClass("selected");f.focus=a.extend(f.focus,{col:h})}}e.mouseDownTopHeader=true}).delegate(".top-header th","mousemove.agilegrid",function(k){if(e.mouseDownTopHeader){var h=parseInt(a(this).attr("index")),p=Math.min(f.focus.col,h),g=Math.max(f.focus.col,h);if(!k.ctrlKey){e.clearSelection()}for(var j=p;j<=g;j++){f.colSelections[j]=true;e.contentTable.find("td[colindex="+h+"]").addClass("selected")}}}).delegate(".left-header th","mousedown.agilegrid",function(k){if(f.selectionMode=="column"){return}var q=parseInt(a(this).attr("index")),p=f.rowOffset+q;if(k.ctrlKey){if(f.rowSelections[p]){delete f.rowSelections[p]}else{f.rowSelections[p]=true}e.contentTable.find("tr[rowindex="+q+"]").toggleClass("selected",f.rowSelections[p]==true?true:false);f.focus=a.extend(f.focus,{row:p})}else{if(k.shiftKey){var h=Math.min(f.focus.row,p),j=Math.max(f.focus.row,p);e.clearSelection();for(var g=h;g<=j;g++){f.rowSelections[g]=true;e.contentTable.find("tr[rowindex="+(g-f.rowOffset)+"]").addClass("selected")}}else{e.clearSelection();f.focus=a.extend(f.focus,{row:p});f.rowSelections[p]=true;e.contentTable.find("tr[rowindex="+q+"]").addClass("selected");f.focus=a.extend(f.focus,{row:p})}}e.mouseDownLeftHeader=true}).delegate(".left-header th","mousemove.agilegrid",function(k){if(e.mouseDownLeftHeader){var q=parseInt(a(this).attr("index")),p=f.rowOffset+q,h=Math.min(f.focus.row,p),j=Math.max(f.focus.row,p);if(!k.ctrlKey){e.clearSelection()}for(var g=h;g<=j;g++){f.rowSelections[g]=true;e.contentTable.find("tr[rowindex="+(g-f.rowOffset)+"]").addClass("selected")}}}).delegate(".content td","mousedown.agilegrid",function(j){var i=a(this),p=parseInt(i.attr("rowindex")),h=parseInt(i.attr("colindex")),k=f.rowOffset+p,g=h;e.select(k,g,j.ctrlKey?"ctrl":(j.shiftKey?"shift":null));e.mouseDownContent=true}).delegate(".content td","mousemove.agilegrid",function(p){if(e.mouseDownContent){var r=a(this),s=parseInt(r.attr("rowindex")),t=parseInt(r.attr("colindex")),v=f.rowOffset+s,g=t;if(!p.ctrlKey){e.clearSelection()}if(f.selectionMode=="row"){var h=Math.min(f.focus.row,v),q=Math.max(f.focus.row,v);for(var k=h;k<=q;k++){f.rowSelections[k]=true;e.contentTable.find("tr[rowindex="+(k-f.rowOffset)+"]").addClass("selected")}}else{if(f.selectionMode=="column"){var j=Math.min(f.focus.col,g),u=Math.max(f.focus.col,g);for(var k=j;k<=u;k++){f.colSelections[k]=true;e.contentTable.find("td[colindex="+k+"]").addClass("selected")}}else{var h=Math.min(f.focus.row,v),q=Math.max(f.focus.row,v),j=Math.min(f.focus.col,g),u=Math.max(f.focus.col,g);for(var v=h;v<=q;v++){if(!f.cellSelections[v]){f.cellSelections[v]=[]}for(var g=j;g<=u;g++){f.cellSelections[v][g]=true;e.contentTable.find("td[rowindex="+(v-f.rowOffset)+"][colindex="+g+"]").addClass("selected")}}}}}}).delegate(".content td","dblclick.agilegrid click.agilegrid",function(i){var h=a(this),j=parseInt(h.attr("rowindex")),g=parseInt(h.attr("colindex"));e._trigger(i.type=="dblclick"?"celldblclick":"cellclick",i,{row:f.rowOffset+j,column:g})});f.topHeaderActions=f.topHeaderActions||function(h,g){var j={};j.hide={type:"menuItem",text:"Hide",handler:function(){e.hideColumn(g)}};if(f.columnEditable){j.add={type:"menuItem",text:"Add",handler:function(){e.editColumn(g,"add")}};j.edit={type:"menuItem",text:"Edit",handler:function(){e.editColumn(g)}};j.del={type:"menuItem",text:"Delete",handler:function(){e.removeColumn(g)}}}if(!a.isEmptyObject(h)){var i={};a.each(h,function(q,p){i[p.name]={name:p.name,type:"checkbox",text:p.label,checked:!p.hide,handler:function(s,r){var k=e.option("visibleColCount");if(k<=1&&!r){a(s.target).prop("checked",true)}else{e[r?"showColumn":"hideColumn"](q)}}}});j.show={type:"submenu",text:"Show",children:i}}return j};f.leftHeaderActions=f.leftHeaderActions||function(h){var g={};return g};f.contentActions=f.contentActions||function(i,g){var h={};return h};this.element.bind("mouseup.agilegrid",function(){delete e.mouseDownContent;delete e.mouseDownLeftHeader;delete e.mouseDownTopHeader}).bind("contextmenu2.agilegrid contextmenu.agilegrid",function(p){if((f.contextmenu2&&p.type=="contextmenu2")||(!f.contextmenu2&&p.type=="contextmenu")){var s=a(p.target),k=s.closest(".top-header table"),g=s.parent("th"),j={},r=f.colModel;if(k.length>0&&g.length>0){a.extend(j,f.topHeaderActions(r,parseInt(s.closest("th").attr("index"))))}var q=s.closest(".content"),i=s.closest("td");if(q.length>0&&i.length>0){var u=f.rowOffset+parseInt(i.attr("rowindex")),h=parseInt(i.attr("rowindex"));a.extend(j,f.contentActions(u,h))}if(!a.isEmptyObject(j)){s.menu({autoShow:true,menuPosition:{of:p,my:"left top",at:"left bottom"},actions:j,select:function(v,t){a(this).menu("destroy")},collapseAll:function(t){a(this).menu("destroy")}})}p.preventDefault()}}).attr("tabIndex",-1).css("outline",0).bind("keydown.agilegrid",function(g){e._keydown(g)})},_init:function(){this.refresh()},_refreshLeftHeader:function(){var k=this.options,j=k.rowModel,f=k.rowOffset,h=this.leftHeaderTable.find("thead");h.empty();for(var e=0;e<k.rowCount;e++){var g=a("<tr/>");a("<th/>").attr("index",f+e).css("display",j[f+e]&&j[f+e].hide?"none":"block").append(a("<div/>").css({width:k.leftHeaderWidth,height:(j[f+e]&&j[f+e].height)||k.defaultRowHeight,"line-height":(j[f+e]&&j[f+e].height)||k.defaultRowHeight+"px"}).html((j[f+e]&&j[f+e].render)||k.leftHeaderRender(f+e,j[f+e]))).appendTo(g);g.appendTo(h)}},_refreshTopHeader:function(){var h=this.options,e=h.colModel,g=this.topHeaderTable.find("tr");g.empty();for(var f=0;f<h.totalColCount;f++){a("<th/>").attr("index",f).css("display",e[f]&&e[f].hide?"none":"table-cell").append(a("<div/>").css({width:(e[f]&&e[f].width)||h.defaultColWidth,height:h.topHeaderHeight,"line-height":h.topHeaderHeight+"px"}).html((e[f]&&e[f].render)||h.topHeaderRender(f,e[f]))).appendTo(g)}},_refreshContent:function(){var e=this.options,r=e.colModel,j=e.rowModel,h=e.rowOffset,g=this.contentTable.children("tbody"),q=a("<tr/>");g.detach().empty();for(var p=0;p<e.totalColCount;p++){td=a("<td/>").attr("colindex",p).css("display",r[p]&&r[p].hide?"none":"table-cell").append(a("<div/>").css("width",r[p]&&r[p].width?r[p].width:e.defaultColWidth)).appendTo(q)}for(var f=0;f<e.rowCount;f++){var s=j[h+f]&&j[h+f].height?j[h+f].height:e.defaultRowHeight,k=q.clone();k.css("display",j[h+f]&&j[h+f].hide?"none":"table-row").attr("rowindex",f).toggleClass("selected",e.rowSelections[h+f]||(e.selectionMode=="row"&&e.focus.row==h+f)).children("td").attr("rowindex",f).each(function(){var i=a(this),t=parseInt(i.attr("colindex"));i.toggleClass("selected",(e.cellSelections[h+f]&&e.cellSelections[h+f][t])||e.colSelections[t]||(e.focus.row==h+f&&e.focus.col==t)||(e.focus.col==t&&e.selectionMode=="column"));i.children("div").css({height:s,"line-height":s+"px"}).html(e.cellRender(h+f,t))});k.appendTo(g)}this.contentTable.append(g)},option:function(e,f){if(e==="visibleColCount"&&f===b){return this.topHeaderTable.find("th:visible").length}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(f,g){var h=this.options,e=h[f];if(!equals(g,e)){a.Widget.prototype._setOption.apply(this,arguments);if(h.showPager&&(f=="currentPage"||f=="totalPage")){this._refreshPager()}this._trigger("optionchanged",null,{key:f,value:g,oldValue:e})}return this},_refreshPager:function(){var e=this.options;if(e.totalPage<=1){this.pager.find(".pager-button").button("disable")}else{this.pager.find(".pager-button").button("enable");if(e.currentPage<=1){this.pager.find("#first").button("disable");this.pager.find("#prev").button("disable")}else{if(e.currentPage>=e.totalPage){this.pager.find("#last").button("disable");this.pager.find("#next").button("disable")}}}this.pager.find("input.current-page").val(e.currentPage);this.pager.find(".total-page").html(e.totalPage);this.pager.find(".info").html("Displaying "+(e.rowOffset+1)+" to "+(e.rowOffset+e.rowCount)+" of "+e.totalRowCount+" items.")},select:function(u,g,s){var f=this.options;if(s=="ctrl"){if(f.selectionMode=="row"){if(f.rowSelections[u]){delete f.rowSelections[u]}else{f.rowSelections[u]=true}this.contentTable.find("tr[rowindex="+(u-f.rowOffset)+"]").toggleClass("selected",f.rowSelections[u]==true?true:false)}else{if(f.selectionMode=="column"){if(f.colSelections[g]){delete f.colSelections[g]}else{f.colSelections[g]=true}this.contentTable.find("td[colindex="+g+"]").toggleClass("selected",f.colSelections[g]==true?true:false)}else{if(!f.cellSelections[u]){f.cellSelections[u]=[];f.cellSelections[u][g]=true}else{if(f.cellSelections[u][g]){delete f.cellSelections[u][g]}else{f.cellSelections[u][g]=true}}this.contentTable.find("td[rowindex="+(u-f.rowOffset)+"][colindex="+g+"]").toggleClass("selected",f.cellSelections[u][g]=true?true:false)}}f.focus=a.extend(f.focus,{row:u,col:g})}else{if(s=="shift"){if(f.selectionMode=="row"){var h=Math.min(f.focus.row,u),p=Math.max(f.focus.row,u);this.clearSelection();for(var k=h;k<=p;k++){f.rowSelections[k]=true;this.contentTable.find("tr[rowindex="+(k-f.rowOffset)+"]").addClass("selected")}}else{if(f.selectionMode=="column"){var j=Math.min(f.focus.col,g),t=Math.max(f.focus.col,g);this.clearSelection();for(var k=j;k<=t;k++){f.colSelections[k]=true;this.contentTable.find("td[colindex="+k+"]").addClass("selected")}}else{var h=Math.min(f.focus.row,u),p=Math.max(f.focus.row,u),j=Math.min(f.focus.col,g),t=Math.max(f.focus.col,g);this.clearSelection();for(var e=h;e<=p;e++){f.cellSelections[e]=f.cellSelections[e]||[];for(var q=j;q<=t;q++){f.cellSelections[e][q]=true;this.contentTable.find("td[rowindex="+(e-f.rowOffset)+"][colindex="+q+"]").addClass("selected")}}}}}else{this.clearSelection();if(f.selectionMode=="row"){f.rowSelections[u]=true;this.contentTable.find("tr[rowindex="+(u-f.rowOffset)+"]").addClass("selected")}else{if(f.selectionMode=="column"){f.colSelections[g]=true;this.contentTable.find("td[colindex="+g+"]").addClass("selected")}else{f.cellSelections[u]=[];f.cellSelections[u][g]=true;this.contentTable.find("td[rowindex="+(u-f.rowOffset)+"][colindex="+g+"]").addClass("selected")}}f.focus=a.extend(f.focus,{row:u,col:g})}}},clearSelection:function(){var e=this.options;e.cellSelections=[];e.rowSelections={};e.colSelections={};if(e.showTopHeader){this.topHeaderTable.find(".selected").removeClass("selected")}if(e.showLeftHeader){this.leftHeaderTable.find(".selected").removeClass("selected")}this.contentTable.find(".selected").removeClass("selected")},_keydown:function(e){var f=a.ui.keyCode,g=this.options;if(e.shiftKey&&!this.shiftKeyDown){this.shiftKeyDown={row:g.focus.row,col:g.focus.col}}else{if(!e.shiftKey){delete this.shiftKeyDown}}switch(e.keyCode){case f.LEFT:if(g.focus.col>0){this.select(g.focus.row,e.shiftKey?--this.shiftKeyDown.col:g.focus.col-1,e.shiftKey?"shift":null)}break;case f.RIGHT:if(g.focus.col<g.totalColCount-1){this.select(g.focus.row,e.shiftKey?++this.shiftKeyDown.col:g.focus.col+1,e.shiftKey?"shift":null)}break;case f.UP:if(g.focus.row>0){this.select(e.shiftKey?--this.shiftKeyDown.row:g.focus.row-1,g.focus.col,e.shiftKey?"shift":null)}break;case f.DOWN:if(g.focus.row<g.rowCount-1){this.select(e.shiftKey?++this.shiftKeyDown.row:g.focus.row+1,g.focus.col,e.shiftKey?"shift":null)}break;case f.SPACE:case f.ENTER:break}return true},_columnWidth:function(f,g){var i=this.options,e=i.colModel,h=a.extend({},e);e[f]=e[f]||{name:f,label:f};oldWidth=e[f].width||i.defaultColWidth;e[f].width=g;if(i.showTopHeader){this.topHeaderTable.find("th[index="+f+"]>div").css("width",g)}this.contentTable.find("td[colindex="+f+"]>div").css("width",g);this._trigger("optionchanged",null,{key:"colModel",value:e,oldValue:h})},_rowHeight:function(g,f,e){var k=this.options,i=k.rowModel,j=g+f,h=a.extend({},i);i[j]=i[j]||{};oldHeight=i[j].height||k.defaultRowHeight;i[j].height=e;if(k.showLeftHeader){this.leftHeaderTable.find("th[index="+f+"]>div").css({height:e,"line-height":e+"px"})}this.contentTable.find("td[rowindex="+f+"]>div").css("height",e);this._trigger("optionchanged",null,{key:"rowModel",value:i,oldValue:h})},insertColumn:function(g,e){var i=this.options,h=a.extend(true,{},i.colModel),f={};a.each(h,function(p,j){if(p<g){f[p]=j}else{f[parseInt(p)+1]=j}});f[g]=e;i.colModel=f;i.totalColCount=i.totalColCount+1;this._adjustWidth();this._trigger("optionchanged",null,{key:"colModel",value:f,oldValue:h})},removeColumn:function(f){var h=this.options,e=h.colModel,g=a.extend(true,{},e);a.each(e,function(j,i){if(j>=f&&j<h.totalColCount-1){e[j]=g[parseInt(j)+1]}else{if(j==h.totalColCount-1){delete e[j]}}});h.totalColCount=h.totalColCount-1;this._adjustWidth();this._trigger("optionchanged",null,{key:"colModel",value:e,oldValue:g})},showColumn:function(f){var h=this.options,e=h.colModel,g=a.extend(true,{},e);if(e[f]&&e[f].hide){e[f].hide=false}else{return}this.topHeaderTable.find("th[index="+f+"]").show();this.contentTable.find("td[colindex="+f+"]").show();this._trigger("optionchanged",null,{key:"colModel",value:e,oldValue:g})},editColumn:function(h,k){var g=this,j=this.options,e=j.colModel,i=a.extend(true,{},e),f=(k=="add"?{name:"",label:""}:e[h]);a("<div/>").dialog({title:k=="add"?"Add Column":"Edit Column",height:260,width:380,modal:true,create:function(p,q){var r=a(this);a.ans.getDoc(j.dbId,"50acda5e9555dbe125000004",null,function(t,s){r.editor({document:f,forms:[s],dbId:j.dbId,mode:"edit",ignoreEscape:true})})},buttons:{OK:function(){var q=a(this),p=q.editor("option","document");if(k=="add"){g.insertColumn(h,p)}else{e[h]=e[h]||{};a.extend(e[h],p);g._refreshTopHeader();g._trigger("optionchanged",null,{key:"colModel",value:e,oldValue:i})}g.option("isDirty",true);q.dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(q,p){a(this).remove()}})},hideColumn:function(f){var h=this.options,e=h.colModel,g=a.extend(true,{},e);e[f]=e[f]||{name:f,label:f};e[f].hide=true;this.topHeaderTable.find("th[index="+f+"]").hide();this.contentTable.find("td[colindex="+f+"]").hide();this._trigger("optionchanged",null,{key:"colModel",value:e,oldValue:g})},showRow:function(h){var g=this.options,f=g.rowModel,e=a.extend(true,{},f);if(f[h]&&f[h].hide){delete f[h].hide}else{return}this.leftHeaderTable.find("th[index="+h+"]").hide();this.contentTable.find("td[rowindex="+h+"]").hide();this._trigger("optionchanged",null,{key:"rowModel",value:f,oldValue:e})},hideRow:function(h){var g=this.options,f=g.rowModel,e=a.extend(true,{},f);f[h]=f[h]?f[h]:{};f[h].hide=true;this._adjustHeight();this._trigger("optionchanged",null,{key:"rowModel",value:f,oldValue:e})},_adjustWidth:function(){this._refreshTopHeader();this._refreshContent();return this},_adjustHeight:function(){this._refreshLeftHeader();this._refreshContent();return this},refresh:function(){var e=this.options;if(e.showTopHeader){this._refreshTopHeader()}if(e.showLeftHeader){this._refreshLeftHeader()}this._refreshContent();if(e.showPager){this._refreshPager()}return this},destroy:function(){this.element.removeClass("an-agilegrid").unbind(".agilegrid").undelegate(".top-header th>div",".agilegrid").undelegate(".left-header th>div",".agilegri").undelegate(".content td>div",".agilegrid");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.toolbar",{options:{},_create:function(){this.element.addClass("an-toolbar");var e=this.options;if(e.startAction||e.globalActionSet||e.actionSets){this.element.empty();this._createActionSets();this.refresh()}},_createActionSets:function(){var f=this,g=this.options,e=[];if(g.startAction){e.push(g.startAction)}if(g.globalActionSet){e.push(g.globalActionSet)}e=e.concat(g.actionSets||[]);this.actionSets=e;a.each(e,function(k,h){a.each(h,function(q,p){var s=null;switch(p.type){case"button":if(q=="startAction"){p.element=a("<button class='action start-menu'/>").button({label:p.label,icons:{primary:"ui-icon-home",secondary:"ui-icon-triangle-1-s"}}).prependTo(f.element);p.element.menu({triggerEvent:"click",menuPosition:{of:p.element,my:"left top",at:"left bottom"},actions:p.actions,select:function(){a(this).menu("collapseAll")}})}else{p.element=a("<button class='action'/>").button({label:p.label,text:p.text,icons:p.icons}).appendTo(f.element).click(function(t){if(p.handler){p.handler(t)}t.preventDefault();t.stopImmediatePropagation()})}break;case"checkbox":var j=a("<input class='action' type='checkbox' id = '"+new ObjectId().toString()+"'/>").appendTo(f.element);a("<label for='"+j.attr("id")+"' class='action'></label>").insertAfter(j);p.element=j.button({label:p.label,text:p.text,icons:p.icons}).click(function(t){if(p.handler){p.handler(t)}t.preventDefault();t.stopImmediatePropagation()});break;case"radio":var j=a("<input class='action' type='radio' name = '"+p.name+"' id = '"+new ObjectId().toString()+"'/>").appendTo(f.element);a("<label for='"+j.attr("id")+"' class='action'></label>").insertAfter(j);p.element=j.button({label:p.label,text:p.text,icons:p.icons}).click(function(t){if(p.handler){p.handler(t)}t.preventDefault();t.stopImmediatePropagation()});break;case"select":s=a("<acronym class='action'/>").attr("title",p.label).elSelect({labelTpl:p.labelTpl,tpl:p.tpl,select:p.select,src:p.src}).appendTo(f.element);s.data("select",s);p.element=s;break;case"colorPicker":s=a("<button class='action'/>").button({label:p.label,text:p.text,icons:p.icons}).appendTo(f.element).ColorPicker({color:p.color,handler:p.handler});s.data("select",s);p.element=s;break;default:break}if(p.iconFile){var r;if(p.type=="checkbox"){var i=p.element.attr("id");r=p.element.siblings("label[for="+i+"]").find("."+p.icons.primary)}else{r=p.element.find("."+p.icons.primary)}r.css("background-image","url("+p.iconFile+")")}})})},refresh:function(){a.each(this.actionSets,function(f,e){a.each(e,function(h,g){switch(g.type){case"button":case"checkbox":case"radio":if(g.enabled()){g.element.button("enable");if(g.type=="checkbox"||g.type=="radio"){g.element.prop("checked",g.checked());g.element.button("refresh")}}else{g.element.button("disable")}break;case"colorPicker":case"select":g.element.toggleClass("disabled",!g.enabled());break}})})},value:function(e,f){this.element.find("#"+e).data("select").val(f);return this},option:function(e,f){if(e=="isEmpty"&&f===b){return this.element.children().length==0}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(f,g){var h=this.options,e=h[f];if(!equals(g,e)){a.Widget.prototype._setOption.apply(this,arguments);if(f=="actionSets"){this.element.empty();this._createActionSets();this.refresh()}this._trigger("optionchanged",null,{key:f,value:g,oldValue:e,"transient":h["transient"]})}return this},destroy:function(){this.element.removeClass("an-toolbar");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.view",{options:{mode:"browser",actionSets:[]},_create:function(){var o=this.options,el=this.element;el.addClass("an-view").addClass(o.view.name).empty();$('<style type="text/css">'+(o.view.stylesheet||"")+"</style>").appendTo(el);o.limit=o.limit||parseInt(o.view.limit)||10;o.skip=o.skip||parseInt(o.view.skip)||0;o.total=o.total||parseInt(o.view.total)||0;o.filter=o.filter||o.view.filter;o.showPager=o.showPager||o.view.showPager;try{$.extend(this,eval("("+(o.view.methods||"{}")+")"))}catch(e){console.log(e)}var data={};data[this.widgetName]=this;$.each(eval("("+(o.view.actions||"[]")+")"),function(k,action){el.bind(action.events,data,action.handler)});o.showPager&&this._createPager();this.docs=[];this._loadDocs()},option:function(key,value){var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var oldValue=this.options[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);this._handleChange&&this._handleChange(key,value,oldValue);this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},_handleChange:function(key,value,oldValue){if(key==="mode"||key==="view"){this.refresh()}},_createPager:function(){var o=this.options,self=this;this.pager=$("<div style='display:none;' class='pager'/>").css({left:0,right:0,bottom:0,height:o.pagerHeight}).appendTo(this.element);this.pager.addClass(o.className);$.each(["first","prev","goto","next","last"],function(k,v){if(v=="goto"){self.pager.append("<div class='goto-page'>Page<input class='current-page' type='text' value='"+o.currentPage+"'>of<div class='total-page'>"+o.totalPage+"</div></div>");self.pager.delegate("input","change.pager",function(){var $this=$(this),p=$(this).val();if(p<=0){p=1;$this.val(p)}else{if(p>o.totalPage){p=o.totalPage;$this.val(p)}}self.gotopage(p)})}else{$("<button class='pager-button'/>").attr("id",v).appendTo(self.pager).button({label:$.i18n.pager?$.i18n.pager[v]:v,icons:{primary:"ui-icon-"+v+"-page"},text:false,disabled:true}).click(function(e){e.preventDefault();e.stopImmediatePropagation();self[v+"page"]()})}});this.pager.append("<div class='info'>")},firstpage:function(e,data){this.options.skip=0;this._loadDocs()},prevpage:function(){var o=this.options;o.skip=o.skip-o.limit;this._loadDocs()},gotopage:function(page){var o=this.options;o.skip=(page-1)*o.limit;this._loadDocs()},nextpage:function(){var o=this.options;o.skip=o.skip+o.limit;this._loadDocs()},lastpage:function(){var o=this.options;o.skip=Math.floor(o.total/o.limit)*o.limit;this._loadDocs()},refresh:function(){var o=this.options;this["_"+o.mode]&&this["_"+o.mode]();this._refreshPager()},_refreshPager:function(){var o=this.options;if(this.pager){if(o.totalPage<=1){this.pager.hide();return this}this.pager.show();this.pager.find(".pager-button").button("enable");if(o.currentPage<=1){this.pager.find("#first").button("disable");this.pager.find("#prev").button("disable")}else{if(o.currentPage>=o.totalPage){this.pager.find("#last").button("disable");this.pager.find("#next").button("disable")}}this.pager.find("input.current-page").val(o.currentPage);this.pager.find(".total-page").html(o.totalPage);var currentNums=o.currentPage==o.totalPage?(o.limit*(o.currentPage-1)+o.total%o.limit):o.limit*o.currentPage,info="";if($.i18n.pager){info=$.i18n.pager.display.replace(/{total}/,o.total).replace(/{currentPagerFirst}/,(o.limit*(o.currentPage-1)+1)).replace(/{currentPagerLast}/,currentNums)}else{info="Displaying "+(o.limit*(o.currentPage-1)+1)+" to "+currentNums+" of "+o.total+" items."}this.pager.find(".info").html(info)}},reload:function(){this._loadDocs()},_loadDocs:function(){var self=this,o=this.options,sel=o.view.selector,filter=o.filter,opts={skip:o.skip,limit:o.limit},selectorStr,taskUrl=o.view.taskUrl;if($.type(o.view.sort)=="string"){opts.sort=eval("("+o.view.sort+")")}if($.type(taskUrl)=="string"&&taskUrl.replace(/(^\s*)|(\s*$)/g,"")!=""){var param={};param.taskFilter=typeof filter=="string"?eval("("+filter+")"):filter;param.skip=o.skip;param.limit=o.limit;param.sort=opts.sort||o.view.sort;param.options={exec:true,redirect:true};$.ans.getDoc(o.dbId,taskUrl,param,function(err,data){self.docs=data.docs;try{self._docsLoaded&&self._docsLoaded()}catch(e){}self._trigger("documentloaded",null,data)});return}if($.type(sel)=="string"&&sel.replace(/\s/g,"")){sel=eval("("+sel+")");if($.type(filter)=="string"){selectorStr=filter.replace(/\s/g,"")?{selector:sel,filter:eval("("+filter+")"),options:opts}:{selector:sel,options:opts}}else{selectorStr=filter?{selector:sel,filter:filter,options:opts}:{selector:sel,options:opts}}$.ans.getDoc(o.dbId,null,selectorStr,function(err,data){self.docs=data.docs;o.total=data.total;if(self.pager){o.currentPage=Math.floor(o.skip/o.limit+1);o.totalPage=Math.ceil(o.total/o.limit)}try{self._docsLoaded&&self._docsLoaded()}catch(e){}self._trigger("documentloaded",null,data)})}},_getRow:function(row){return this.docs[row-this.options.skip]},_delRow:function(row){var self=this,o=this.options;Model.deleteDocument(o.dbId,this.docs[row-o.skip]._id,null,function(err,result){self._loadDocs()})},save:function(){var self=this,o=this.options,view=o.view;Model.updateDocument(o.dbId,view._id,view,null,function(err,result){self.option("isDirty",false)})},destroy:function(){this.element.children("style").remove();this.element.unbind(".view").empty();$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.gridview",$.an.view,{options:{printable:false},_create:function(){$.an.view.prototype._create.apply(this,arguments);this.element.addClass("an-gridview");var self=this,o=this.options;if(o.view.cellRender){o.cellRender=eval("("+o.view.cellRender+")")}this.element.agilegrid($.extend({rowOffset:o.skip,showPager:o.showPager,dbId:o.dbId,leftHeaderRender:function(row){return row+1},cellRender:function(row,col){var value="",r=self._getRow(row),cm=this.colModel,c=cm[col];if(o.cellRender){value=o.cellRender(row,col,doc,cm)}else{if(r&&c){value=eval("try{r['"+c.name+"']}catch(e){}")}}return value?value+"":""},firstpage:function(e,data){o.skip=0;self._loadDocs()},prevpage:function(e,data){o.skip=o.skip-o.limit;self._loadDocs()},gotopage:function(e,data){o.skip=(data.page-1)*o.limit;self._loadDocs()},nextpage:function(e,data){o.skip=o.skip+o.limit;self._loadDocs()},lastpage:function(e,data){o.skip=Math.floor(o.total/o.limit)*o.limit;self._loadDocs()},celldblclick:function(e,data){self._trigger("docdblclick",e,self.docs[data.row-o.skip])},cellclick:function(e,data){self._trigger("docclick",e,self.docs[data.row-o.skip])},contentActions:function(row,col){return o.contentActions(self.docs[row-o.skip])},optionchanged:function(e,data){if(data.key=="colModel"&&o.mode=="design"){self.option("isDirty",true)}}},o.view.options));this.refresh()},_docsLoaded:function(){var o=this.options,rc=this.docs.length;this.element.agilegrid({currentPage:Math.floor(o.skip/o.limit+1),totalPage:Math.ceil(o.total/o.limit),rowOffset:o.skip,rowCount:rc,totalRowCount:o.total})},_design:function(){this.element.agilegrid({columnEditable:true,isColumnResizable:true,isRowResizable:true})},_browser:function(){this.element.agilegrid($.extend({columnEditable:false,isColumnResizable:false,isRowResizable:false},this.options.view.options))},_createPager:function(){},save:function(){$.extend(this.options.view.options,this._viewOptions());return $.an.view.prototype.save.apply(this,arguments)},option:function(key,value){if(key==="viewOptions"&&value===undefined){return this._viewOptions()}return $.an.view.prototype.option.apply(this,arguments)},_viewOptions:function(){var self=this,value={};$.each(["showTopHeader","showLeftHeader","isColumnResizable","isRowResizable","topHeaderHeight","leftHeaderWidth","defaultColWidth","defaultRowHeight","colModel","rowModel","totalColCount"],function(k,v){value[v]=self.element.agilegrid("option",v)});return value},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&viewid="+o.view._id;print(url)},destroy:function(){this.element.agilegrid("destroy").unbind(".gridview").removeClass("an-gridview");$.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.formview",a.an.view,{options:{printable:false,pagerPosition:"bottom",itemWidth:320,itemHeight:280},_create:function(){a.an.view.prototype._create.apply(this,arguments);var f=this.options,e=this.element;f.showPager=f.view.showPager;f.itemWidth=f.view.itemWidth;f.itemHeight=f.view.itemHeight;e.addClass("an-formview");this.documents=a("<div class='content'/>").prependTo(e)},_showDocuments:function(){var e=this,g=this.options;this.documents.empty();var f=document.createDocumentFragment();a.each(this.docs,function(i,j){var h=a("<div class='grid-item'/>").css({width:g.itemWidth,height:g.itemHeight});f.appendChild(h[0]);h.editor({dbId:g.dbId,document:j,forms:[g.form],readOnly:true})});e.documents[0].appendChild(f)},_docsLoaded:function(e){if(a.isArray(e)){this.docs=e}this.refresh()},_design:function(){this._showDocuments()},_browser:function(){this._showDocuments()},save:function(){var e=this,f={};a.extend(this.options.view.options,f);return a.an.view.prototype.save.apply(this,arguments)},print:function(){var g=this.options,f=window.location,e=f.protocol+"//"+f.host+"/pdfs?dbid="+g.dbId+"&viewid="+g.view._id;print(e)},destroy:function(){this.element.unbind(".formview").removeClass("an-formview show-pager");a.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.customview",$.an.view,{options:{printable:false,pagerPosition:"bottom"},_create:function(){$.an.view.prototype._create.apply(this,arguments);var o=this.options,el=this.element;el.addClass("an-customview");o.templateTemp=o.view.templateTemp;o.templateSelector=o.view.templateSelector;o.templateConverts=o.view.templateConverts;o.templateContent=o.view.templateContent;this.documents=$(o.templateContent).prependTo(el);if(o.templateTemp){o.templateTemp=$.templates(o.templateTemp)}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_showDocuments:function(){var self=this,o=this.options;if(o.templateTemp){var html=o.templateTemp.render(self.docs);$(o.templateSelector,this.documents).html(html)}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_docsLoaded:function(){this.refresh()},_design:function(){this._showDocuments()},_browser:function(){this._showDocuments()},save:function(){var value={};$.extend(this.options.view.options,value);return $.an.view.prototype.save.apply(this,arguments)},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&viewid="+o.view._id;print(url)},destroy:function(){this.element.unbind(".formview").removeClass("an-formview show-pager");$.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.editor",{options:{printable:true,mode:"browser",document:{},forms:[],actionSets:[],parseDot:true,isDocDirty:false},_create:function(){this.element.addClass("an-editor");var self=this,o=this.options,el=this.element,doc=o.document,docType=doc.type,forms={};this.doc=new DocWrapper(doc,o.parseDot);var id=doc._id;if(id){o.url="/dbs/"+o.dbId+"/"+id+"/attachments"}if(o.forms.length<=1){el.addClass("tabs-nav-hide")}if(o.design&&(docType==Model.FORM||docType==Model.PAGE||docType==Model.VIEW)){forms[doc._id+"-design"]=doc}$.each(o.forms||[],function(k,v){forms[v._id]=v});el.append("<ul />").tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a></li>",show:function(event,ui){var $p=$(ui.panel),id=$p.attr("id"),d=forms[id],type=d.type;if($p.is(".an-form,.an-page,.an-view,.an-mpage")){var data=$p.data();for(var i in data){if($.inArray(i,["form","page","mpage","gridview","formview","customview","view","mobilelistview"])!=-1){if(!o.design||!(/-design$/.test(id))){data[i].option("mode",o.mode)}data[i].option("mobile",o.mobile);self._trigger("tabshow",event,data[i]);break}}}else{var opt={dbId:o.dbId,mode:(o.design&&/-design$/.test(id))?"design":o.mode,ignoreEscape:o.ignoreEscape,change:function(){o.change&&o.change()},mobile:o.mobile,readOnly:o.readOnly,widgetselect:o.widgetselect,optionchanged:function(e,data){if(data.key=="isDirty"){if(data.value){self.option("isFormDirty",true)}else{var isFormDirty=false;el.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview","customview","view","mobilelistview"])!=-1){isFormDirty=data[i].option("isDirty");if(isFormDirty){break}}}});self.option("isFormDirty",isFormDirty)}}else{if(data.key=="mode"){self.option(data.key,data.value)}}}};if(type==Model.FORM){$p.form($.extend(true,{form:d,document:(o.design&&/-design$/.test(id))?{}:function(){return self.doc},url:o.url,editor:self,create:function(){self._trigger("tabcreated",event,$(this).data("form"))}},opt))}else{if(type==Model.PAGE){$p.page($.extend(true,{page:d,create:function(){self._trigger("tabcreated",event,$(this).data("page"))}},opt))}else{if(type==Model.VIEW){var vt=d.viewType||"gridview",vt=vt.toLowerCase();vt=(vt=="customizedview"?"view":vt);var optsx={view:d,create:function(){self._trigger("tabcreated",event,$(this).data(vt))}};if(vt=="formview"||vt=="customview"||vt=="mobilelistview"){optsx.form=o.form}$p[vt]($.extend(true,optsx,opt))}}}}}});$.each(forms||[],function(k,v){el.tabsx("add","#"+k,v.title)});if(o.tabsPosition=="bottom"){el.addClass("tabs-bottom").children(".ui-tabs-nav, .ui-tabs-nav > *").removeClass("ui-corner-all ui-corner-top").addClass("ui-corner-bottom")}el.attr("tabIndex",-1).css("outline",0).keydown(function(e){var form=self._currentForm();if(e.keyCode===$.ui.keyCode.ESCAPE&&!o.ignoreEscape&&!e.isDefaultPrevented()&&form.validate()){e.preventDefault();self.option("mode","browser");form.option("mode","browser")}}).bind("dblclick.form",function(e){var form=self._currentForm();if(o.mode=="browser"&&!o.readOnly){self.option("mode","edit");form.option("mode","edit")}});$(this.doc).bind("propchanged.editor",function(e,id,value,oldValue,trans){if(!trans){self.option("isDocDirty",true)}if(o.design&&(docType==Model.FORM||docType==Model.PAGE||docType==Model.VIEW)){var docId=doc._id+"-design",dd=$.extend(true,{},doc);el.children("#"+docId+".ui-tabs-panel").each(function(){var $this=$(this);if($this.is(".an-form,.an-page,.an-view,.an-mpage")){var data=$this.data();for(var i in data){if($.inArray(i,["form","page","mpage"])!=-1){$this[i]("option",i,dd)}else{if($.inArray(i,["gridview","formview","customview","view","mobilelistview"])!=-1){$this[i]("option","view",dd)}}}}})}self._trigger("docpropchanged",e,{id:id,value:value,oldValue:oldValue,"transient":trans})});$(document).bind("documentChanged.editor",function(e,data){var ds=$.isArray(data)?data:[data],id;for(var i in ds){id=ds[i]._id;if(id==o.document._id){$.extend(true,o.document,ds[i]);el.children(".ui-tabs-panel").each(function(){var $this=$(this);$this.is(".an-form")&&$this.form("refresh")})}if(forms[id]||forms[id+"-design"]){if(forms[id+"-design"]){id=id+"-design"}forms[id]=$.extend(true,{},ds[i]);for(var j in o.forms){if(o.forms[j]._id==ds[i]._id){o.forms[j]=forms[id];break}}el.children("#"+id+".ui-tabs-panel").each(function(){var $this=$(this);if($this.is(".an-form,.an-page,.an-view,.an-mpage")){var data=$this.data();for(var i in data){if($.inArray(i,["form","page","mpage"])!=-1){$this[i]("option",i,forms[id])}else{if($.inArray(i,["gridview","formview","customview","view","mobilelistview"])!=-1){$this[i]("option","view",forms[id])}}}}})}}}).bind("documentDeleted.editor",function(e,data){var ds=$.isArray(data)?data:[data],id;for(var i in ds){id=ds[i]._id;if(forms[id]||forms[id+"-design"]){if(forms[id+"-design"]){id=id+"-design"}for(var j in o.forms){if(o.forms[j]._id==ds[i]._id){o.forms.splice(j,1);delete forms[id];el.tabsx("remove",id);break}}}}})},_validate:function(){var self=this,valid=true;this.element.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page"])!=-1&&data[i].option("mode")!="design"&&!data[i].option("isValid")){self.element.tabsx("select",data[i].option("form")._id);valid=false;return false}}});return valid},save:function(opts){opts=opts||{};var self=this,o=this.options,dbId=o.dbId,valid=true;this.element.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page"])!=-1){if(data[i].option("isDirty")){if(data[i].option(i)._id==o.document._id){o.document.content=data[i].option("content");data[i].option("isDirty",false);o.isDocDirty=true}else{data[i].save()}}if(opts.validate&&valid&&form.option("mode")!="design"){valid=form.option("isValid");if(!valid){self.element.tabsx("select",form.option("form")._id)}}}else{if($.inArray(i,["gridview","formview","customview","view","mobilelistview"])!=-1){if(data[i].option("isDirty")){if(data[i].option("view")._id==o.document._id){o.document.options=$.extend(true,o.document.options,data[i].option("viewOptions"));data[i].option("isDirty",false);o.isDocDirty=true}else{data[i].save()}}}}}});this.option("isFormDirty",false);if(valid&&o.isDocDirty){var doc=this._getDocument(),opNew={options:{}},tags=false;if($.type(opts.beforesave)=="function"){opts.beforesave(doc)}if(o.formIds){doc.formIds=o.formIds}if(o.task||opts.task){opNew.options["task"]=o.task||opts.task;tags=true}if(o.isNew){var def=o["default"]&&o["default"]._id;if(def){opNew.options["default"]=def;tags=true}Model.postDocument(dbId,doc,tags?opNew:null,function(err,result){if(!err){delete o.isNew;$.extend(o.document,result);self.option("option","url","/dbs/"+dbId+"/"+doc._id+"/attachments");self.option("isDocDirty",false)}if($.type(opts.saved)=="function"){opts.saved(err,doc,true)}else{o.saved&&o.saved(err,doc,true)}})}else{Model.updateDocument(dbId,doc._id,doc,tags?opNew:null,function(err,result){if(!err){$.extend(o.document,result);self.option("isDocDirty",false)}if($.type(opts.saved)=="function"){opts.saved(err,doc,true)}else{o.saved&&o.saved(err,doc,true)}})}}},_getDocument:function(){var o=this.options,doc=$.extend(true,{},o.document);$.each(o.forms,function(){$(this.content).find(".field[transient=true]").each(function(){var $this=$(this),id=$this.attr("id");if(id){id=id.replace(/-/g,".");if($this.attr("transient")){try{delete eval("doc."+id)}catch(e){}}}})});return doc},print:function(){this._currentForm().print()},option:function(key,value){var self=this,o=this.options;if(key==="actionSets"&&value===undefined){var cf=this._currentForm();return cf&&cf.option("actionSets")}else{if(key==="outline"&&value===undefined){var form=this._currentForm();if(form){return form.option("outline")}}else{if(key==="document"&&value===undefined){return this._getDocument()}else{if(key==="namedValues"&&value===undefined){var nv={};$.each(o.forms,function(k,form){$(form.form).find(".field:not(.button)").each(function(){var id=$(this).attr("id");if(id){id=id.replace(/-/g,".");nv[id]=self.doc.prop(id)}})});return nv}else{if(key=="currentForm"&&value==undefined){return this._currentForm()}else{if(key=="isValid"&&value==undefined){return this._validate()}}}}}}var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var oldValue=this.options[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);if(key==="document"){this.doc.setDoc(value);this._setOption("isDocDirty",false)}else{if(key==="url"){this.element.tabsx("option","panels").each(function(){$(this).form("option",key,value)})}else{if(key==="mode"){this._currentForm().option(key,value)}}}this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},getForm:function(id){var o=this.options;if(o.design&&(id==o.document._id)){id=id+"-design"}var data=this.element.tabsx("panel",id).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview","customview","view","mobilelistview"])!=-1){return data[i]}}return null},_currentForm:function(){var data=$(this.element.tabsx("option","selectedPanel")).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview","customview","view","mobilelistview"])!=-1){return data[i]}}return null},refresh:function(){this._currentForm().refresh();return this},highlightWidget:function(id,highlight){return this._currentForm().highlightWidget(id,highlight)},destroy:function(){$(document).unbind(".editor");this.element.tabsx("destroy").removeClass("an-editor tabs-bottom").unbind(".editor").undelegate(".an-form",".editor").empty();$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.sideview",{_create:function(){var o=this.options,el=this.element;if(o.name){el.addClass(o.name)}$('<style type="text/css">'+(o.stylesheet||"")+"</style>").appendTo(el);$.extend(this,eval("try{("+(o.methods||"{}")+")}catch(e){}"));var data={};data[this.widgetName]=this;o.actions=eval("("+(o.actions||"[]")+")");$.each(o.actions,function(k,action){el.bind(action.events,data,action.handler)});this.createContent&&this.createContent()},destroy:function(){var o=this.options,el=this.element;$.each(o.actions,function(k,action){el.unbind(action.events)});this.clean&&this.clean();$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.workbench",{options:{westWidth:320,eastWidth:260,westViews:"",eastViews:"",sideViews:[{id:"50b19b6449987bc16db5a1b8",anchor:"west"}],extensionPoints:{startNew:"51959a88a092003a0f000011",toolbarGlobal:"519598d2a092003a0f000005",toolbarHeader:"5195994da092003a0f000008",toolbarCenter:"5195989ea092003a0f000001",toolbarTail:"51959981a092003a0f00000b",showSideView:"51959a53a092003a0f00000e",documentClick:"519ad731a092001a75000001",documentDoubleClick:"51998379a092001104000078",documentContextMenuNew:"51949426a092000480000001",documentContextMenuMiddle:"519ad76ba092001a75000004",documentContextMenuTop:"519ad8f8a092001a7500000f",documentContextMenuBottom:"519ad916a092001a75000012"},openedDocuments:[]},_create:function(){this.element.addClass("an-workbench");var self=this,o=this.options;document.title=o.title||"Agile Notes";this.element.border({north:{selector:".north",height:28},west:{selector:".west",width:0,resizable:false},east:{selector:".east",width:0,resizable:false},south:{selector:".south",height:18},center:{selector:".center"},optionchanged:function(e,data){if(data.key=="west"||data.key=="east"){if(data.value.width){o[data.key+"Width"]=data.value.width}self._saveOptions()}}});$(["center","west","east"]).each(function(k,v){var node=$("#"+v+"-tabs",self.element);node.tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a> <span class='ui-icon ui-icon-close'>Remove Tab</span></li>",showTabsContextMenu:true,add:function(e,ui){if(v=="center"){node.tabsx("select","#"+ui.panel.id)}},show:function(e,ui){var panel=$(ui.panel),editor;$.each(["editor","gridview","formview","customview","view","page","mobilelistview"],function(k,v){editor=panel.data(v);if(editor){var title=editor.option("title");document.title=o.title+" - "+title;self.reloadToolbar();self._notifyOutline();return false}})},remove:function(e,ui){if(v=="center"){if(node.tabsx("length")==0){document.title=o.title;self.reloadToolbar();self._notifyOutline()}self._afterCloseEditor({workbench:self,id:$(ui.panel).attr("id")})}else{if(v=="west"||v=="east"){var id=$(ui.panel).attr("id"),index=-1;$.each(o.sideViews,function(k,sv){if(id==sv.id&&v==sv.anchor){index=k;return false}});o.sideViews.splice(index,1);self._saveOptions();if(node.tabsx("length")==0){self.element.border("option",v,{width:0,resizable:false})}}}}});node.delegate("span.ui-icon-close","click",function(){var index=$("li",node).index($(this).parent());var saveBtn=self.toolbar.find('button[title="Save"]');if(!saveBtn.attr("disabled")&&$("li",node).eq(index).hasClass("ui-tabs-selected")){showDialog("Confirm","Do you want to save the changes?",{buttons:[{text:"OK",handler:function(dialog){saveBtn.trigger("click");node.tabsx("remove",index);dialog.close()}},{text:"Cancel",handler:function(dialog){node.tabsx("remove",index);dialog.close()}}]});return}node.tabsx("remove",index)});self[v+"Tabs"]=node});this.statusBar=$(".south",self.element);this.element.ajaxComplete(function(event,request,settings){switch(request.status){case 401:self._login();break;default:break}});$.ans.getDoc(o.dbId,null,{selector:{type:Model.VALIDATE_METHOD}},function(err,data){if(err){console.log("Load validate methods error: "+err)}else{$.each(data.docs,function(){$.validator.addMethod(this.name,eval("(0,"+this.handler+")"),this.message)})}});this._loadExtensions(function(){self._initMainToolbar();$.each(o.openedDocuments||[],function(){if(typeof(this.method)!="undefined"){self[this.method](this.id,this.options)}});$.each(o.sideViews,function(){self.showSideView(this.id,this.anchor,this.options)})});this.element.bind("rteoptionchanged.workbench",function(e,data){if(data.key=="path"){self.statusBar.html(data.value);self.toolbar.toolbar("refresh")}else{if(data.key=="undoable"||data.key=="redoable"){self.toolbar.toolbar("refresh")}}}).bind("selectionChanged.workbench",function(e){self.toolbar.toolbar("refresh")});this._proxy=$.proxy(function(e){if(e.target===window){if(this.toolbar.toolbar("option","isEmpty")){$(this.element).border("option",{north:{height:"0"}})}else{var height=this.toolbar.outerHeight(true);$(this.element).border("option","north",{height:height?height:0})}}},this);$(window).bind("resize.workbench",this._proxy);$(document).bind("documentChanged.workbench documentCreated.workbench",function(e,data){var hit=false;$.each($.isArray(data)?data:[data],function(k,v){self.centerTabs.find("a[href^=#"+v._id+"]").html(v.title);if(v.extensionPoint){hit=true}});if(hit){self._loadExtensions(function(){self._initMainToolbar()})}}).bind("documentDeleted.workbench",function(e,data){$.each($.isArray(data)?data:[data],function(k,v){self.centerTabs.find("a[href^=#"+v._id+"]").each(function(){var href=$(this).attr("href");if(href){self.centerTabs.tabsx("remove",href.substring(1))}})});self._loadExtensions(function(){self._initMainToolbar()})});window.workbench=this},_afterOpenEditor:function(data){var o=this.options,hit=false;o.openedDocuments=o.openedDocuments||[];$.each(o.openedDocuments,function(){if(this.id==data.id&&this.method==data.method){hit=true}});if(!hit&&!(data.options&&data.options.isNew)){o.openedDocuments.push(data);this._saveOptions()}},_afterCloseEditor:function(data){var o=this.options,m=data.id.match(/([^-]+)-([^-]+)/),index=-1,type=m[2].substring(0,1).toUpperCase()+m[2].substring(1);$.each(o.openedDocuments,function(k,v){if(v.method==("open"+type)&&v.id==m[1]){index=k;return false}});o.openedDocuments.splice(index,1);this._saveOptions()},_afterShowSideView:function(data){var o=this.options,hit=false;$.each(o.sideViews,function(){if(this.id==data.id&&this.anchor==data.anchor){hit=true}});if(!hit){o.sideViews.push(data);this._saveOptions()}},_loadExtensions:function(afterLoad){var self=this,o=this.options,eps=[];$.each(o.extensionPoints,function(k,v){eps.push(v)});Model.loadExtensions(o.dbId,eps,function(err,exts){self.extensions=exts;afterLoad()})},_initMainToolbar:function(){var self=this,o=this.options,eps=o.extensionPoints;var startActions=[],children=[];var sna=this.extensions[eps.startNew]||[];$.each(sna,function(k,v){children.push({id:k,type:"menuItem",text:v.title||v.name||k,handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")")})});if(sna.length>0){children.push({type:"seperator"})}children.push({id:"others",type:"menuItem",text:"Others ...",handler:function(){$("<div class='workbench'/>").dialog({title:"New Document",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this);$this.explorer({dbId:o.dbId,roots:[Model.META_ROOT],docdblclick:function(e,doc){self.newDocument(doc._id);$this.dialog("close")}});setTimeout(function(){$this.explorer("expand",Model.META_ROOT)},200)},buttons:{OK:function(){var $this=$(this),docIds=$this.explorer("option","selectedNodes");$.each(docIds,function(){self.newDocument(this)});$this.dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},enabled:function(){return true}});startActions.push({type:"submenu",text:"New",children:children});children=[];var ssv=this.extensions[eps.showSideView]||[];$.each(ssv,function(k,v){children.push({id:k,type:"menuItem",text:v.title||v.name||k,handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")")})});if(ssv.length>0){children.push({type:"seperator"})}children.push({id:"others",type:"menuItem",text:"Others ...",handler:function(){$("<div class='workbench'/>").dialog({title:"Show Side View",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this);$this.explorer({dbId:o.dbId,roots:[Model.SIDE_VIEW_ROOT],docdblclick:function(e,doc){self.showSideView(doc._id);$this.dialog("close")}});setTimeout(function(){$this.explorer("expand",Model.SIDE_VIEW_ROOT)},200)},buttons:{OK:function(){var $this=$(this);$.each($this.explorer("option","selectedNodes"),function(){self.showSideView(this)});$this.dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},enabled:function(){return true}});startActions.push({type:"submenu",text:$.i18n.showSideView,children:children});startActions.push({type:"seperator"});startActions.push({id:"login",type:"menuItem",text:"Login ...",handler:function(){self._login()},enabled:function(){return true}});startActions.push({id:"logout",type:"menuItem",text:"Logout",handler:function(){self._logout()},enabled:function(){return true}});var globalActions={},tga=this.extensions[eps.toolbarGlobal]||[];$.each(tga,function(k,v){globalActions[v._id]={_id:v._id,type:"button",label:v.title||v.name,text:false,icons:{primary:"ui-icon-"+v.name},handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")")};if(v.icon&&(v.icon.length>0)&&v.icon[0].metadata){globalActions[v._id].iconFile="/dbs/"+o.dbId+"/"+v._id+"/attachments/"+v.icon[0].metadata.filepath}});if(this.toolbar){this.toolbar.remove()}this.toolbar=$("<div id='main' class='ui-corner-all'/>").appendTo($(".north",self.element)).toolbar({startAction:{startAction:{type:"button",label:"Agile Notes",icons:{primary:"ui-icon-home",secondary:"ui-icon-triangle-1-s"},actions:startActions,enabled:function(){return true}}},globalActionSet:globalActions});this.reloadToolbar()},reloadToolbar:function(){var self=this,eps=this.options.extensionPoints;clearTimeout(this.time);this.time=setTimeout(function(){console.log("reloadToolbar............................!");var editor=self.currentEditor(),actionSets=[];if(editor){function createActionSet(actions,context){var actionSet={};$.each(actions,function(k,v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){actionSet[v._id]={_id:v._id,type:v.actionType||"button",label:v.title||v.name,text:false,icons:{primary:"ui-icon-"+v.name},iconFile:v.icon,handler:eval("(0,"+(v.handler||"function(){}")+")"),enabled:eval("(0,"+(v.enabled||"function(){return false;}")+")"),checked:eval("(0,"+(v.checked||"function(){return false;}")+")")};if(v.icon&&(v.icon.length>0)&&v.icon[0].metadata){actionSet[v._id].iconFile="/dbs/"+context.dbId+"/"+v._id+"/attachments/"+v.icon[0].metadata.filepath}}});return actionSet}var tas=editor.widget().data("toolbarActions"),dbId=editor.widget().data("dbid")||self.options.dbId,context={editor:editor,dbId:dbId},ass=editor.option("actionSets"),actionSet={},filter;actionSet=createActionSet((tas&&tas[eps.toolbarHeader])||self.extensions[eps.toolbarHeader],context);if(!$.isEmptyObject(actionSet)){actionSets.push(actionSet)}if($.isArray(ass)){actionSets=actionSets.concat(ass)}actionSet=createActionSet((tas&&tas[eps.toolbarCenter])||self.extensions[eps.toolbarCenter],context);if(!$.isEmptyObject(actionSet)){actionSets.push(actionSet)}actionSet=createActionSet((tas&&tas[eps.toolbarTail])||self.extensions[eps.toolbarTail],context);if(!$.isEmptyObject(actionSet)){actionSets.push(actionSet)}}self.toolbar.toolbar("option","actionSets",actionSets);if(self.toolbar.toolbar("option","isEmpty")){self.element.border("option","north",{height:"0"})}else{var height=self.toolbar.outerHeight(true);self.element.border("option","north",{height:height?height:"0"})}},800)},currentEditor:function(){var panel=$(this.centerTabs.tabsx("option","selectedPanel")),data=panel.data(),editor=null;$.each(data||{},function(k,v){if($.inArray(k,["editor","gridview","formview","customview","view","page","mobilelistview"])!=-1){editor=v;return false}});return editor},_saveOptions:function(){var o=this.options,opts={};if(o.openedDocuments.length){opts.openedDocuments=o.openedDocuments}if(o.westWidth){opts.westWidth=o.westWidth}if(o.eastWidth){opts.eastWidth=o.eastWidth}if(o.sideViews.length){opts.sideViews=o.sideViews}$.cookie(o.dbId,$.toJSON(opts))},_login:function(){var o=this.options;var login=function($this){$.ans.login($this.editor("option","document"),function(err,result,real){if(real.success){window.location.reload()}else{showDialog("Login Failed","Login failed: "+real.msg)}$this.dialog("close")})};$("<div class='workbench'/>").dialog({title:"Login",height:260,width:380,modal:true,create:function(event,ui){var $this=$(this);$.ans.getDoc(o.dbId,"50accac59555dbe125000002",null,function(err,form){if(err){console.log("Load Form Error","Load form error: "+err)}else{$this.editor({document:{},forms:[form],dbId:o.dbId,mode:"edit",ignoreEscape:true})}});$this.bind("keyup",function(e){if(e.keyCode==$.ui.keyCode.ENTER){login($(this))}})},buttons:{OK:function(){login($(this))},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},_logout:function(){$.ans.logout(function(err,result){window.location.reload()})},showSideView:function(viewId,anchor,opts){var self=this,o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,viewId,null,function(err,sideView){if(sideView){self._doShowSideView(sideView,anchor||"west",opts)}else{console.log("Load view "+viewId+"error: "+err)}})},_docClick:function(context,actions){var filter,action={};$.each(actions||[],function(k,v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){$.extend(true,action,v);action.context=context;action.handler=eval("(0,"+(v.handler||"function(){}")+")");action.handler();return false}})},_docDblClick:function(context,actions){var filter,action={},hit=false;$.each(actions||[],function(k,v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){$.extend(true,action,v);action.context=context;action.handler=eval("(0,"+(v.handler||"function(){}")+")");action.handler();hit=true;return false}});if(!hit){this.openDocument(context.document._id,{dbId:context.dbId})}},_docContextMenuActions:function(inActions,context,outActions){if(!inActions){return outActions}var eps=this.options.extensionPoints;function addAction(v){filter=eval("(0,"+(v.filter||"function(){return true}")+")");if(filter(context)){outActions.push({type:"menuItem",text:v.title,context:context,handler:eval("(0,"+(v.handler||"function(){}")+")")})}}$.each(inActions[eps.documentContextMenuTop]||[],function(k,v){addAction(v)});if(outActions.length>0){outActions.push({type:"seperator"})}$.each(inActions[eps.documentContextMenuMiddle]||[],function(k,v){addAction(v)});if(outActions.length>=1&&outActions[outActions.length-1].type!="seperator"){outActions.push({type:"seperator"})}$.each(inActions[eps.documentContextMenuBottom]||[],function(k,v){addAction(v)});if(outActions.length>=1&&outActions[outActions.length-1].type=="seperator"){outActions.pop()}return outActions},_doShowSideView:function(sideView,anchor,opts){var self=this,o=this.options,title=sideView.title||sideView.name||sideView._id,dbId=(opts&&opts.dbId)||o.dbId,tabs=this[anchor+"Tabs"],id=sideView._id,el=this.element,panel=tabs.children("#"+id);if(panel.size()>0){return}var a=el.border("option",anchor);if(!a.width){el.border("option",anchor,{width:o[anchor+"Width"],resizable:o[anchor+"Width"]>0})}tabs.tabsx("add","#"+id,title);$("#"+id,tabs).sideview($.extend({dbId:dbId,create:function(e,data){self._afterShowSideView({id:sideView._id,anchor:anchor,options:opts})}},sideView,opts))},authorization:function(docId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,docId,null,function(err,doc){if(err){console.log("Load document "+docId+" error: "+err)}else{var sel;if(doc.type==Model.META){sel={$or:[{_id:"a417d20f9fa10c25dad56974"},{_id:"e2922e5edc79a1b28c0199e9"}]}}else{sel={_id:"a417d20f9fa10c25dad56974"}}$.ans.getDoc(Model.ADMINDBID,null,{selector:sel},function(err,data){if(err){console.log("Load forms error: "+err)}else{$("<div/>").authorization({title:"Authorization - "+(doc.title||doc.name||doc._id),dbId:Model.ADMINDBID,document:doc,forms:data.docs,buttons:[{text:"Save",click:function(){var $this=$(this),doc=$this.authorization("option","document");Model.updateDocument(dbId,doc._id,doc,null,function(err,result){if(err){console.log("Save authorization error: "+err)}$this.authorization("close")})}},{text:"Cancel",click:function(){$(this).authorization("close")}}],close:function(e,ui){$(this).remove()}})}})}})},execute:function(doc,opts){var self=this,o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,doc._id,{options:{exec:true}},function(err,doc){if(opts.notify){self.statusBar.html("Execute "+doc.name+" "+(doc.result||doc.error))}})},_notifyOutline:function(){$(window).trigger($.Event("outline",{workbench:this}))},_notifyWidgetSelect:function(widget){$(window).trigger($.Event("widgetselect",{workbench:this}),widget)},status:function(status){this.statusBar.html(status)},newDocument:function(typeId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId,id=new ObjectId().toString(),title=opts.title||id,pid=id,optsx=$.extend(true,{id:id,tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()},saved:function(err,doc,bl){var data={id:doc._id,method:"openDocument",options:{mode:"edit"}};if(doc.type==Model.FORM){$.extend(true,data,{method:"openForm",options:{mode:"design"}})}else{if(doc.type==Model.PAGE){$.extend(true,data,{method:"openPage",options:{mode:"design"}})}else{if(doc.type==Model.VIEW){$.extend(true,data,{method:"openView",options:{mode:"design"}})}}}if(bl){self.options.openedDocuments.push(data);self._saveOptions()}}},opts);if(typeId==Model.FORM){pid=pid+"-form";optsx.isFormEditor=true}else{if(typeId==Model.PAGE){pid=pid+"-page";optsx.isPageEditor=true}else{if(typeId==Model.VIEW){pid=pid+"-view"}else{pid=pid+"-document"}}}var el=this.centerTabs.tabsx("add","#"+pid,title).children("#"+pid);optsx.opened=function(editor){document.title=o.title+" - "+title;self.reloadToolbar();opts.opened&&opts.opened(editor)};Model.newDocument(el,dbId,typeId,optsx)},copyDocument:function(docId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId;$.ans.getDoc(dbId,docId,null,function(err,doc){if(err){console.log("Load document "+docId+" error: "+err)}else{self.newDocument(doc.type,$.extend(true,{"default":doc,title:doc.title||doc.name},opts))}})},openDocument:function(docId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=docId+"-document";if(tabs.tabsx("panel",pid).size()>0){tabs.tabsx("select",pid);return}function doOpenDoc(el,dbId,docId,opts){var optsx=$.extend(true,{id:docId,tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);optsx.opened=function(editor){var doc=editor.option("document"),title=doc.title||doc.name||docId;tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;self._afterOpenEditor({method:"openDocument",id:docId,options:opts});opts.opened&&opts.opened(editor)};Model.openDocument(el,dbId,docId,optsx)}var el=tabs.tabsx("add","#"+pid,"...").children("#"+pid);if(dbId!=o.dbId){var eps=o.extensionPoints;Model.loadExtensions(dbId,[eps.toolbarHeader,eps.toolbarCenter,eps.toolbarTail],function(err,toolbarActions){if(err){showDialog("Load Toolbar Actions","Load toolbar actions: "+err)}else{el.data("toolbarActions",toolbarActions).data("dbId",dbId)}doOpenDoc(el,dbId,docId,opts)})}else{doOpenDoc(el,dbId,docId,opts)}},openForm:function(formId,opts){opts=opts||{};$.extend(true,opts,{isFormEditor:true});var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=formId+"-form";if(!opts.preview&&tabs.tabsx("panel",pid).size()>0){tabs.tabsx("select",pid);return}function doOpenForm(el,dbId,formId,opts){var optsx=$.extend(true,{tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},widgetselect:function(e,widget){self._notifyWidgetSelect(widget)},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);optsx.opened=function(editor){var doc=editor.option("document"),title=doc.title||doc.name||formId;tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;self._afterOpenEditor({method:"openForm",id:formId,options:opts});opts.opened&&opts.opened(editor)};Model.openPage(el,dbId,formId,optsx)}var el=null;if(!opts.preview){el=this.centerTabs.tabsx("add","#"+pid,"...").children("#"+pid)}if(dbId!=o.dbId){var eps=o.extensionPoints;Model.loadExtensions(dbId,[eps.toolbarHeader,eps.toolbarCenter,eps.toolbarTail],function(err,toolbarActions){if(err){showDialog("Load Toolbar Actions","Load toolbar actions: "+err)}else{el.data("toolbarActions",toolbarActions).data("dbId",dbId)}doOpenForm(el,dbId,formId,opts)})}else{doOpenForm(el,dbId,formId,opts)}return this},openPage:function(pageId,opts){opts=opts||{};$.extend(true,opts,{isPageEditor:true});var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=pageId+"-page";if(!opts.preview&&tabs.tabsx("panel",pid).size()>0){tabs.tabsx("select",pid);return}function doOpenPage(el,dbId,pageId,opts){var optsx=$.extend(true,{tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},widgetselect:function(e,widget){self._notifyWidgetSelect(widget)},change:function(e,form){self._notifyOutline()},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);optsx.opened=function(editor){var doc=editor.option("document"),title=doc.title||doc.name||doc._id;tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;self._afterOpenEditor({method:"openPage",id:pageId,options:opts});opts.opened&&opts.opened(editor)};Model.openPage(el,dbId,pageId,optsx)}var el=null;if(!opts.preview){el=this.centerTabs.tabsx("add","#"+pid,"...").children("#"+pid)}if(dbId!=o.dbId){var eps=o.extensionPoints;Model.loadExtensions(dbId,[eps.toolbarHeader,eps.toolbarCenter,eps.toolbarTail],function(err,toolbarActions){if(err){showDialog("Load Toolbar Actions","Load toolbar actions: "+err)}else{el.data("toolbarActions",toolbarActions).data("dbId",dbId)}doOpenPage(el,dbId,pageId,opts)})}else{doOpenPage(el,dbId,pageId,opts)}return this},openView:function(viewId,opts){opts=opts||{};var self=this,o=this.options,dbId=opts.dbId||o.dbId,tabs=this.centerTabs,pid=viewId+"-view",el=tabs.tabsx("panel",pid),eps=o.extensionPoints;if(el.size()>0){tabs.tabsx("select",pid);$.each(["editor","gridview","formview","customview","view","mobilelistview"],function(k,v){editor=el.data(v);if(editor&&((v=="editor"&&opts.mode!="design")||(v!="editor"&&opts.mode=="design"))){editor.destroy()}else{return}})}else{el=tabs.tabsx("add","#"+pid,"...").children("#"+pid)}function doOpenView(el,dbId,viewId,actions,opts){var optsx=$.extend(true,{tabsPosition:"bottom",optionchanged:function(e,data){if(data.key=="isDocDirty"||data.key=="isFormDirty"){self.toolbar.toolbar("refresh")}else{if(data.key=="mode"){self.reloadToolbar()}}},tabshow:function(e,target){self.reloadToolbar();self._notifyOutline()},tabcreated:function(e,target){self.reloadToolbar();self._notifyOutline()}},opts);var tas={};$.each(["Header","Center","Tail"],function(){var name="toolbar"+this;if(actions[eps[name]]){tas[eps[name]]=actions[eps[name]]}});tas=$.isEmptyObject(tas)?undefined:tas;el.data("toolbarActions",tas).data("dbId",dbId);optsx.opened=function(editor){var view=editor;if(editor.widgetName=="editor"){view=editor.getForm(viewId)}var v=view.option("view"),title=v.title||v.name||viewId,viewType=v.viewType||"gridview";tabs.find(".ui-tabs-nav>li>a[href=#"+pid+"]").html(title);document.title=o.title+" - "+title;viewType=viewType.toLowerCase();view.option("docclick",function(e,doc){self._docClick({dbId:dbId,view:el.data(viewType),document:doc},actions[eps.documentClick]||self.extensions[eps.documentClick])});view.option("docdblclick",function(e,doc){self._docDblClick({dbId:dbId,view:el.data(viewType),document:doc},actions[eps.documentDoubleClick]||self.extensions[eps.documentDoubleClick])});view.option("contentActions",function(doc){return self._docContextMenuActions(actions,{dbId:dbId,view:el.data(viewType),document:doc},[])});self.reloadToolbar();self._afterOpenEditor({method:"openView",id:viewId,options:opts});opts.opened&&opts.opened(view)};Model.openView(el,dbId,viewId,optsx)}if(dbId!=o.dbId){var epids=[];$.each(["toolbarHeader","toolbarCenter","toolbarTail","documentClick","documentDoubleClick","documentContextMenuMiddle","documentContextMenuTop","documentContextMenuBottom"],function(){epids.push(eps[this])});Model.loadExtensions(dbId,epids,function(err,exts){if(err){console.log("Load actions error: "+err)}else{doOpenView(el,dbId,viewId,exts,opts)}})}else{doOpenView(el,dbId,viewId,this.extensions,opts)}return this},openDatabase:function(dbId,opts){window.open("workbench.html?dbid="+dbId);return this},removeDocument:function(doc,opts){opts=opts||{};var dbId=(opts&&opts.dbId)||this.options.dbId,targetName=doc.title||doc.name||doc._id,title="Remove "+targetName,message="Are you sure to remove "+targetName;message+=(doc.type==Model.CATEGORY)?" and all its child nodes?":"?";showDialog(title,message,{buttons:[{text:"OK",handler:function(dialog){if(doc.type==Model.CATEGORY){Model.deleteDocument(dbId,null,{selector:{_path:{$regex:"^"+doc._path}}},function(err,result){if(err){console.log("Remove document error: "+err)}else{if($.type(opts.removed)=="function"){opts.removed()}}})}else{Model.deleteDocument(dbId,doc._id,null,function(err,result){if(err){console.log("Remove document error: "+err)}else{if($.type(opts.removed)=="function"){opts.removed()}}})}dialog.close()}},{text:"Cancel",handler:function(dialog){dialog.close()}}]});return this},joinInGroup:function(userId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,userId,null,function(err,user){if(err){console.log("Load user document "+userId+" error: "+err)}else{$("<div class='workbench'/>").dialog({title:"Join In Group",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this),ids=[];$.each(user._groupPaths||[],function(k,v){var a=v.split(",");ids.push(a[a.length-2])});$this.explorer({dbId:dbId,roots:[Model.GROUP_ROOT],checkbox:true,checkedNodes:ids});setTimeout(function(){$this.explorer("expand",Model.GROUP_ROOT)},200)},buttons:{OK:function(){var $this=$(this),nodes=$this.explorer("option","checkedNodes");user._groupPaths=[];$.each(nodes||[],function(k,node){user._groupPaths.push(node.data._path)});Model.updateDocument(dbId,userId,user,null,function(err,result){if(err){console.log("Join in group error: "+err)}$this.dialog("close")})},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})}});return this},quitGroup:function(userId,groupId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,userId,null,function(err,user){if(err){console.log("Load user document "+userId+" error: "+err)}else{var paths=[];$.each(user._groupPaths||[],function(k,path){var matcher=new RegExp(groupId+",$");if(!matcher.test(path)){paths.push(path)}});user._groupPaths=paths;Model.updateDocument(dbId,userId,user,null,function(err,result){if(err){console.log("Quit group error: "+err)}})}});return this},assignRole:function(docId,opts){var o=this.options,dbId=(opts&&opts.dbId)||o.dbId;$.ans.getDoc(dbId,docId,null,function(err,doc){if(err){console.log("Load document "+docId+" error: "+err)}else{$("<div class='workbench'/>").dialog({title:"Assign Roles",height:460,width:320,modal:true,create:function(event,ui){var $this=$(this),ids=[];$.each(doc._rolePaths||[],function(k,v){var a=v.split(",");ids.push(a[a.length-2])});$this.explorer({dbId:dbId,roots:[Model.ROLE_ROOT],checkbox:true,checkedNodes:ids});setTimeout(function(){$this.explorer("expand",Model.ROLE_ROOT)},200)},buttons:{OK:function(){var $this=$(this),nodes=$this.explorer("option","checkedNodes"),paths=doc._rolePaths=[];$.each(nodes||[],function(k,node){paths.push(node.data._path)});Model.updateDocument(dbId,docId,doc,null,function(err,result){if(err){console.log("Assign role error:"+err)}$this.dialog("close")})},Cancel:function(){$(this).dialog("close")}},close:function(){$(this).remove()}})}});return this},destroy:function(){this.element.border("destroy");$(window).unbind("resize.workbench",this._proxy);$(document).unbind(".workbench");this.element.removeClass("an-workbench");return $.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.authorization",a.ui.dialog,{options:{title:"Authorization",westWidth:220,width:620,height:480,forms:[]},_create:function(){a.ui.dialog.prototype._create.apply(this,arguments);var e=this.element.addClass("an-authorization");this.west=a("<div class='west'/>").appendTo(e);this.organization=a("<div class='organization ui-corner-all'/>").appendTo(this.west);this.center=a("<div class='center'/>").appendTo(e);this.operation=a("<div class='operation ui-corner-all'><h4 class='title'/></div>").appendTo(this.center);this.content=a("<div class='content'/>").appendTo(this.operation)},_init:function(){a.ui.dialog.prototype._init.apply(this,arguments);var e=this,f=this.options;this.element.border({west:{selector:".west",width:f.westWidth,resizable:true},center:{selector:".center"}});this.organization.explorer({dbId:f.dbId,roots:[Model.OU_ROOT,Model.GROUP_ROOT,Model.ROLE_ROOT],nodeclick:function(i,g){var h=g.data;e.center.find(".title").html(h.title||h.name||h._id);e.content.editor({document:e._getACLAuthz(h),forms:f.forms,dbId:f.dbId,mode:"edit",ignoreEscape:true,docpropchanged:function(k,j){e._updateDocument(h,j)}})}});f.resize=function(){e.element.border("refresh")}},_getACLAuthz:function(i){var f=this.options,p=f.document,u=(i.type==Model.USER?i._id:i._path),t=null,e={title:p.title||p.name||p._id,typeName:"Document"},h=this._getPathsName(i),s=p._acl,k=p._authz,g,q,j,r;if(s){t=s.get&&s.get[h];g=t&&(a.inArray(u,t)!=-1)?true:false;t=s.put&&s.put[h];j=t&&(a.inArray(u,t)!=-1)?true:false;t=s["delete"]&&s["delete"][h];r=t&&(a.inArray(u,t)!=-1)?true:false;e._acl={get:g,put:j,"delete":r}}if(p.type==Model.META){e.typeName=p.title||p.name||p._id||"Document";if(k){t=k.post&&k.post[h];q=t&&(a.inArray(u,t)!=-1)?true:false;t=k.get&&k.get[h];g=t&&(a.inArray(u,t)!=-1)?true:false;t=k.put&&k.put[h];j=t&&(a.inArray(u,t)!=-1)?true:false;t=k["delete"]&&k["delete"][h];r=t&&(a.inArray(u,t)!=-1)?true:false;e._authz={get:g,post:q,put:j,"delete":r}}}return e},_updateDocument:function(h,i){var p=this.options.document,f=i.id.split("."),k=p[f[0]]=p[f[0]]||{},e=k[f[1]]=k[f[1]]||{},g=this._getPathsName(h),r=e[g]=e[g]||[],q=(h.type==Model.USER?h._id:h._path),j=a.inArray(q,r);if(i.value&&(j==-1)){r.push(q)}else{if(!i.value&&j!=-1){r.splice(j,1);if(r.length<=0){delete e[g];if(a.isEmptyObject(e)){delete k[f[1]];if(a.isEmptyObject(k)){}}}}}},_getPathsName:function(e){var f=null;if(e.type==Model.USER){f="users"}else{if(e.type==Model.OU){f="ouPaths"}else{if(e.type==Model.GROUP){f="groupPaths"}else{if(e.type==Model.ROLE){f="rolePaths"}}}}return f},destroy:function(){this.element.border("destroy").removeClass("an-authorization");a.ui.dialog.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(b){function f(h){var g=["transform","WebkitTransform","msTransform","MozTransform","OTransform"];var i;while(i=g.shift()){if(typeof h.style[i]!="undefined"){return i}}return"transform"}var e=null;var a=b.fn.css;b.fn.css=function(g,h){if(e===null){if(typeof b.cssProps!="undefined"){e=b.cssProps}else{if(typeof b.props!="undefined"){e=b.props}else{e={}}}}if(typeof e.transform=="undefined"&&(g=="transform"||(typeof g=="object"&&typeof g.transform!="undefined"))){e.transform=f(this.get(0))}if(e.transform!="transform"){if(g=="transform"){g=e.transform;if(typeof h=="undefined"&&jQuery.style){return jQuery.style(this.get(0),g)}}else{if(typeof g=="object"&&typeof g.transform!="undefined"){g[e.transform]=g.transform;delete g.transform}}}return a.apply(this,arguments)}})(jQuery);jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,f,a,h,g){return jQuery.easing[jQuery.easing.def](e,f,a,h,g)},easeInQuad:function(e,f,a,h,g){return h*(f/=g)*f+a},easeOutQuad:function(e,f,a,h,g){return -h*(f/=g)*(f-2)+a},easeInOutQuad:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f+a}return -h/2*((--f)*(f-2)-1)+a},easeInCubic:function(e,f,a,h,g){return h*(f/=g)*f*f+a},easeOutCubic:function(e,f,a,h,g){return h*((f=f/g-1)*f*f+1)+a},easeInOutCubic:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f+a}return h/2*((f-=2)*f*f+2)+a},easeInQuart:function(e,f,a,h,g){return h*(f/=g)*f*f*f+a},easeOutQuart:function(e,f,a,h,g){return -h*((f=f/g-1)*f*f*f-1)+a},easeInOutQuart:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f+a}return -h/2*((f-=2)*f*f*f-2)+a},easeInQuint:function(e,f,a,h,g){return h*(f/=g)*f*f*f*f+a},easeOutQuint:function(e,f,a,h,g){return h*((f=f/g-1)*f*f*f*f+1)+a},easeInOutQuint:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f*f+a}return h/2*((f-=2)*f*f*f*f+2)+a},easeInSine:function(e,f,a,h,g){return -h*Math.cos(f/g*(Math.PI/2))+h+a},easeOutSine:function(e,f,a,h,g){return h*Math.sin(f/g*(Math.PI/2))+a},easeInOutSine:function(e,f,a,h,g){return -h/2*(Math.cos(Math.PI*f/g)-1)+a},easeInExpo:function(e,f,a,h,g){return(f==0)?a:h*Math.pow(2,10*(f/g-1))+a},easeOutExpo:function(e,f,a,h,g){return(f==g)?a+h:h*(-Math.pow(2,-10*f/g)+1)+a},easeInOutExpo:function(e,f,a,h,g){if(f==0){return a}if(f==g){return a+h}if((f/=g/2)<1){return h/2*Math.pow(2,10*(f-1))+a}return h/2*(-Math.pow(2,-10*--f)+2)+a},easeInCirc:function(e,f,a,h,g){return -h*(Math.sqrt(1-(f/=g)*f)-1)+a},easeOutCirc:function(e,f,a,h,g){return h*Math.sqrt(1-(f=f/g-1)*f)+a},easeInOutCirc:function(e,f,a,h,g){if((f/=g/2)<1){return -h/2*(Math.sqrt(1-f*f)-1)+a}return h/2*(Math.sqrt(1-(f-=2)*f)+1)+a},easeInElastic:function(f,h,e,q,k){var i=1.70158;var j=0;var g=q;if(h==0){return e}if((h/=k)==1){return e+q}if(!j){j=k*0.3}if(g<Math.abs(q)){g=q;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(q/g)}return -(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+e},easeOutElastic:function(f,h,e,q,k){var i=1.70158;var j=0;var g=q;if(h==0){return e}if((h/=k)==1){return e+q}if(!j){j=k*0.3}if(g<Math.abs(q)){g=q;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(q/g)}return g*Math.pow(2,-10*h)*Math.sin((h*k-i)*(2*Math.PI)/j)+q+e},easeInOutElastic:function(f,h,e,q,k){var i=1.70158;var j=0;var g=q;if(h==0){return e}if((h/=k/2)==2){return e+q}if(!j){j=k*(0.3*1.5)}if(g<Math.abs(q)){g=q;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(q/g)}if(h<1){return -0.5*(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+e}return g*Math.pow(2,-10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j)*0.5+q+e},easeInBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}return i*(f/=h)*f*((g+1)*f-g)+a},easeOutBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}return i*((f=f/h-1)*f*((g+1)*f+g)+1)+a},easeInOutBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}if((f/=h/2)<1){return i/2*(f*f*(((g*=(1.525))+1)*f-g))+a}return i/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+a},easeInBounce:function(e,f,a,h,g){return h-jQuery.easing.easeOutBounce(e,g-f,0,h,g)+a},easeOutBounce:function(e,f,a,h,g){if((f/=g)<(1/2.75)){return h*(7.5625*f*f)+a}else{if(f<(2/2.75)){return h*(7.5625*(f-=(1.5/2.75))*f+0.75)+a}else{if(f<(2.5/2.75)){return h*(7.5625*(f-=(2.25/2.75))*f+0.9375)+a}else{return h*(7.5625*(f-=(2.625/2.75))*f+0.984375)+a}}}},easeInOutBounce:function(e,f,a,h,g){if(f<g/2){return jQuery.easing.easeInBounce(e,f*2,0,h,g)*0.5+a}return jQuery.easing.easeOutBounce(e,f*2-g,0,h,g)*0.5+h*0.5+a}});(function(f){var e="deg";f.fn.rotate=function(i){var h=f(this).css("transform")||"none";if(typeof i=="undefined"){if(h){var g=h.match(/rotate\(([^)]+)\)/);if(g&&g[1]){return g[1]}}return 0}var g=i.toString().match(/^(-?\d+(\.\d+)?)(.+)?$/);if(g){if(g[3]){e=g[3]}f(this).css("transform",h.replace(/none|rotate\([^)]*\)/,"")+"rotate("+g[1]+e+")")}return this};f.fn.scale=function(k,j,h){var i=f(this).css("transform");if(typeof k=="undefined"){if(i){var g=i.match(/scale\(([^)]+)\)/);if(g&&g[1]){return g[1]}}return 1}f(this).css("transform",i.replace(/none|scale\([^)]*\)/,"")+"scale("+k+")");return this};var b=f.fx.prototype.cur;f.fx.prototype.cur=function(){if(this.prop=="rotate"){return parseFloat(f(this.elem).rotate())}else{if(this.prop=="scale"){return parseFloat(f(this.elem).scale())}}return b.apply(this,arguments)};f.fx.step.rotate=function(g){f(g.elem).rotate(g.now+e)};f.fx.step.scale=function(g){f(g.elem).scale(g.now)};var a=f.fn.animate;f.fn.animate=function(h){if(typeof h.rotate!="undefined"){var g=h.rotate.toString().match(/^(([+-]=)?(-?\d+(\.\d+)?))(.+)?$/);if(g&&g[5]){e=g[5]}h.rotate=g[1]}return a.apply(this,arguments)}})(jQuery);(function(a){a.fn.quicksand=function(g,b){var f={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"auto",useScaling:true,enhancement:function(h){},selector:"> *",dx:0,dy:0};a.extend(f,b);if(a.browser.msie||(typeof(a.fn.scale)=="undefined")){f.useScaling=false}var e;if(typeof(arguments[1])=="function"){var e=arguments[1]}else{if(typeof(arguments[2]=="function")){var e=arguments[2]}}return this.each(function(A){var F;var D=[];var k=a(g).clone();var E=a(this);var j=a(this).css("height");var t;var p=false;var q=a(E).offset();var r=[];var C=a(this).find(f.selector);if(a.browser.msie&&a.browser.version.substr(0,1)<7){E.html("").append(k);return}var s=0;var w=function(){if(!s){s=1;$toDelete=E.find("> *");E.prepend(x.find("> *"));$toDelete.remove();if(p){E.css("height",t)}f.enhancement(E);if(typeof e=="function"){e.call(this)}}};var B=E.offsetParent();var z=B.offset();if(B.css("position")=="relative"){if(B.get(0).nodeName.toLowerCase()=="body"){}else{z.top+=(parseFloat(B.css("border-top-width"))||0);z.left+=(parseFloat(B.css("border-left-width"))||0)}}else{z.top-=(parseFloat(B.css("border-top-width"))||0);z.left-=(parseFloat(B.css("border-left-width"))||0);z.top-=(parseFloat(B.css("margin-top"))||0);z.left-=(parseFloat(B.css("margin-left"))||0)}if(isNaN(z.left)){z.left=0}if(isNaN(z.top)){z.top=0}z.left-=f.dx;z.top-=f.dy;E.css("height",a(this).height());C.each(function(G){r[G]=a(this).offset()});a(this).stop();var v=0;var u=0;C.each(function(G){a(this).stop();var H=a(this).get(0);if(H.style.position=="absolute"){v=-f.dx;u=-f.dy}else{v=f.dx;u=f.dy}H.style.position="absolute";H.style.margin="0";H.style.top=(r[G].top-parseFloat(H.style.marginTop)-z.top+u)+"px";H.style.left=(r[G].left-parseFloat(H.style.marginLeft)-z.left+v)+"px"});var x=a(E).clone();var h=x.get(0);h.innerHTML="";h.setAttribute("id","");h.style.height="auto";h.style.width=E.width()+"px";x.append(k);x.insertBefore(E);x.css("opacity",0);h.style.zIndex=-1;h.style.margin="0";h.style.position="absolute";h.style.top=q.top-z.top+"px";h.style.left=q.left-z.left+"px";if(f.adjustHeight==="dynamic"){E.animate({height:x.height()},f.duration,f.easing)}else{if(f.adjustHeight==="auto"){t=x.height();if(parseFloat(j)<parseFloat(t)){E.css("height",t)}else{p=true}}}C.each(function(G){var H=[];if(typeof(f.attribute)=="function"){F=f.attribute(a(this));k.each(function(){if(f.attribute(this)==F){H=a(this);return false}})}else{H=k.filter("["+f.attribute+"="+a(this).attr(f.attribute)+"]")}if(H.length){if(!f.useScaling){D.push({element:a(this),animation:{top:H.offset().top-z.top,left:H.offset().left-z.left,opacity:1}})}else{D.push({element:a(this),animation:{top:H.offset().top-z.top,left:H.offset().left-z.left,opacity:1,scale:"1.0"}})}}else{if(!f.useScaling){D.push({element:a(this),animation:{opacity:"0.0"}})}else{D.push({element:a(this),animation:{opacity:"0.0",scale:"0.0"}})}}});k.each(function(I){var H=[];var K=[];if(typeof(f.attribute)=="function"){F=f.attribute(a(this));C.each(function(){if(f.attribute(this)==F){H=a(this);return false}});k.each(function(){if(f.attribute(this)==F){K=a(this);return false}})}else{H=C.filter("["+f.attribute+"="+a(this).attr(f.attribute)+"]");K=k.filter("["+f.attribute+"="+a(this).attr(f.attribute)+"]")}var J;if(H.length===0){if(!f.useScaling){J={opacity:"1.0"}}else{J={opacity:"1.0",scale:"1.0"}}d=K.clone();var G=d.get(0);G.style.position="absolute";G.style.margin="0";G.style.top=K.offset().top-z.top+"px";G.style.left=K.offset().left-z.left+"px";d.css("opacity",0);if(f.useScaling){d.css("transform","scale(0.0)")}d.appendTo(E);D.push({element:a(d),animation:J})}});x.remove();f.enhancement(E);for(A=0;A<D.length;A++){D[A].element.animate(D[A].animation,f.duration,f.easing,w)}})}})(jQuery);(function(a){a.fn.ColorPicker=function(h){var b=this;var f=a.extend({},a.fn.ColorPicker.defaults,h);this.hidden=a('<input type="hidden" />').attr("name",f.name).appendTo(this);this.palette=null;this.preview=null;this.input=null;this.indicator=a("<div />").addClass("color-indicator").appendTo(this);function e(i){b.val(i);f.handler&&f.handler(b.val());b.palette.slideUp()}function g(){b.palette=a("<div />").addClass(f.paletteClass+" rounded-3");for(var j=0;j<f.colors.length;j++){a("<div />").addClass("color").css("background-color",f.colors[j]).attr({title:f.colors[j],unselectable:"on"}).appendTo(b.palette).mouseenter(function(){var i=a(this).attr("title");b.input.val(i);b.preview.css("background-color",i)}).click(function(i){i.stopPropagation();e(a(this).attr("title"))})}b.input=a('<input type="text" />').addClass("rounded-3").attr("size",8).click(function(i){i.stopPropagation();a(this).focus()}).keydown(function(p){if(p.ctrlKey||p.metaKey){return true}var i=p.keyCode;if(i==27){return b.mouseleave()}if(i!=8&&i!=13&&i!=46&&i!=37&&i!=39&&(i<48||i>57)&&(i<65||i>70)){return false}var q=a(this).val();if(q.length==7||q.length==0){if(i==13){p.stopPropagation();p.preventDefault();e(q);b.palette.slideUp()}if(p.keyCode!=8&&p.keyCode!=46&&i!=37&&i!=39){return false}}}).keyup(function(i){var k=a(this).val();k.length==7&&/^#[0-9abcdef]{6}$/i.test(k)&&b.val(k)});b.preview=a("<div />").addClass("preview rounded-3").click(function(i){i.stopPropagation();e(b.input.val())});b.palette.append(a("<div />").addClass("clearfix")).append(a("<div />").addClass("panel").append(b.input).append(b.preview));if(f.palettePosition=="outer"){b.palette.hide().appendTo(b.parents("body").eq(0)).mouseleave(function(){if(!b.palette.is(":animated")){a(this).slideUp();b.val(b.val())}});b.mouseleave(function(i){if(i.relatedTarget!=b.palette.get(0)){if(!b.palette.is(":animated")){b.palette.slideUp();b.val(b.val())}}})}else{b.append(b.palette.hide()).mouseleave(function(i){b.palette.slideUp();b.val(b.val())})}b.val(b.val())}this.click(function(k){if(!b.hasClass("disabled")){!b.palette&&g();if(f.palettePosition=="outer"&&b.palette.css("display")=="none"){var p=a(this).offset(),j=b.palette.width();var i=b.parents("body").width()-p.left>=j?p.left:p.left+a(this).outerWidth()-j;b.palette.css({left:i+"px",top:p.top+a(this).height()+1+"px"})}b.palette.slideToggle()}});this.val=function(i){if(!i&&i!==""){return this.hidden.val()}else{this.hidden.val(i);if(f.update){f.update.apply(this,[this.hidden.val()])}else{this.css("background-color",i)}if(b.palette){b.preview.css("background-color",i);b.input.val(i)}}return this};this.val(f.color||"");return this};a.fn.ColorPicker.defaults={"class":"colorpicker",paletteClass:"palette",palettePosition:"outer",name:"color",color:"",update:function(b){this.indicator.css("background-color",b)},handler:function(b){},colors:["#ffffff","#cccccc","#999999","#666666","#333333","#000000","#ffcccc","#cc9999","#996666","#663333","#330000","#ff9999","#cc6666","#cc3333","#993333","#660000","#ff6666","#ff3333","#ff0000","#cc0000","#990000","#ff9966","#ff6633","#ff3300","#cc3300","#993300","#ffcc99","#cc9966","#cc6633","#996633","#663300","#ff9933","#ff6600","#ff9900","#cc6600","#cc9933","#ffcc66","#ffcc33","#ffcc00","#cc9900","#996600","#ffffcc","#cccc99","#999966","#666633","#333300","#ffff99","#cccc66","#cccc33","#999933","#666600","#ffff66","#ffff33","#ffff00","#cccc00","#999900","#ccff66","#ccff33","#ccff00","#99cc00","#669900","#ccff99","#99cc66","#99cc33","#669933","#336600","#99ff33","#99ff00","#66ff00","#66cc00","#66cc33","#99ff66","#66ff33","#33ff00","#33cc00","#339900","#ccffcc","#99cc99","#669966","#336633","#003300","#99ff99","#66cc66","#33cc33","#339933","#006600","#66ff66","#33ff33","#00ff00","#00cc00","#009900","#66ff99","#33ff66","#00ff33","#00cc33","#009933","#99ffcc","#66cc99","#33cc66","#339966","#006633","#33ff99","#00ff66","#00ff99","#00cc66","#33cc99","#66ffcc","#33ffcc","#00ffcc","#00cc99","#009966","#ccffff","#99cccc","#669999","#336666","#003333","#99ffff","#66cccc","#33cccc","#339999","#006666","#66cccc","#33ffff","#00ffff","#00cccc","#009999","#66ccff","#33ccff","#00ccff","#0099cc","#006699","#99ccff","#6699cc","#3399cc","#336699","#003366","#3399ff","#0099ff","#0066ff","#066ccc","#3366cc","#6699ff","#3366ff","#0033ff","#0033cc","#003399","#ccccff","#9999cc","#666699","#333366","#000033","#9999ff","#6666cc","#3333cc","#333399","#000066","#6666ff","#3333ff","#0000ff","#0000cc","#009999","#9966ff","#6633ff","#3300ff","#3300cc","#330099","#cc99ff","#9966cc","#6633cc","#663399","#330066","#9933ff","#6600ff","#9900ff","#6600cc","#9933cc","#cc66ff","#cc33ff","#cc00ff","#9900cc","#660099","#ffccff","#cc99cc","#996699","#663366","#330033","#ff99ff","#cc66cc","#cc33cc","#993399","#660066","#ff66ff","#ff33ff","#ff00ff","#cc00cc","#990099","#ff66cc","#ff33cc","#ff00cc","#cc0099","#990066","#ff99cc","#cc6699","#cc3399","#993366","#660033","#ff3399","#ff0099","#ff0066","#cc0066","#cc3366","#ff6699","#ff3366","#ff0033","#cc0033","#990033"]}})(jQuery);(function(a){a.fn.elBorderSelect=function(h){var j=this;var p=this.eq(0);var b=a.extend({},a.fn.elBorderSelect.defaults,h);var f=a('<input type="text" />').attr({name:b.name+"[width]",size:3}).css("text-align","right").change(function(){j.change()});var i=a("<div />").css("position","relative").ColorPicker({"class":"el-colorpicker ui-icon ui-icon-pencil",name:b.name+"[color]",palettePosition:"outer",change:function(){j.change()}});var e=a("<div />").elSelect({tpl:'<div style="border-bottom:4px %val #000;width:100%;margin:7px 0"> </div>',tpls:{"":"%label"},maxHeight:b.styleHeight||null,select:function(){j.change()},src:{"":"none",solid:"solid",dashed:"dashed",dotted:"dotted","double":"double",groove:"groove",ridge:"ridge",inset:"inset",outset:"outset"}});p.empty().addClass(b["class"]).attr("name",b.name||"").append(a("<table />").attr("cellspacing",0).append(a("<tr />").append(a("<td />").append(f).append(" px")).append(a("<td />").append(e)).append(a("<td />").append(i))));function g(s){function r(t){hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return !t?"00":hexDigits[(t-t%16)/16]+hexDigits[t%16]}var q=(s||"").match(/\(([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})\)/);return q?"#"+r(q[1])+r(q[2])+r(q[3]):""}function k(r){if(!r){return r}var q=r.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(q){r=q[1];unit=q[2]}if(r[0]=="."){r="0"+r}r=parseFloat(r);if(isNaN(r)){return""}var s=parseInt(a(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(r*s);case"pt":return parseInt(r*s/12);case"%":return parseInt(r*s/100)}return r}this.change=function(){b.change&&b.change(this.val())};this.val=function(u){var t,x,z,r,q;if(!u&&u!==""){t=parseInt(f.val());t=!isNaN(t)?t+"px":"";x=e.val();z=i.val();return{width:t,style:x,color:z,css:a.trim(t+" "+x+" "+z)}}else{r="";if(u.nodeName||u.css){if(!u.css){u=a(u)}r=u.css("border");if((r=u.css("border"))){t=x=z=r}else{t=u.css("border-width");x=u.css("border-style");z=u.css("border-color")}}else{t=u.width||"";x=u.style||"";z=u.color||""}f.val(k(t));q=x?x.match(/(solid|dashed|dotted|double|groove|ridge|inset|outset)/i):"";e.val(q?q[1]:"");i.val(z.indexOf("#")===0?z:g(z));return this}};this.val(b.value);return this};a.fn.elBorderSelect.defaults={name:"el-borderselect","class":"el-borderselect",value:{},change:null}})(jQuery);(function(a){a.fn.elPaddingInput=function(g){var e=this;var f=a.extend({},a.fn.elPaddingInput.defaults,{name:this.attr("name")},g);this.regexps={main:new RegExp(f.type=="padding"?'paddings*:s*([^;"]+)':'margins*:s*([^;"]+)',"im"),left:new RegExp(f.type=="padding"?'padding-lefts*:s*([^;"]+)':'margin-lefts*:s*([^;"]+)',"im"),top:new RegExp(f.type=="padding"?'padding-tops*:s*([^;"]+)':'margin-tops*:s*([^;"]+)',"im"),right:new RegExp(f.type=="padding"?'padding-rights*:s*([^;"]+)':'margin-rights*:s*([^;"]+)',"im"),bottom:new RegExp(f.type=="padding"?'padding-bottoms*:s*([^;"]+)':'margin-bottoms*:s*([^;"]+)',"im")};a.each(["left","top","right","bottom"],function(){e[this]=a('<input type="text" />').attr("size",3).css("text-align","right").css("border-"+this,"2px solid red").bind("change",function(){a(this).val(b(a(this).val()));h()}).attr("name",f.name+"["+this+"]")});a.each(["uleft","utop","uright","ubottom"],function(){e[this]=a("<select />").append('<option value="px">px</option>').append('<option value="em">em</option>').append('<option value="pt">pt</option>').bind("change",function(){h()}).attr("name",f.name+"["+this+"]");if(f.percents){e[this].append('<option value="%">%</option>')}});this.empty().addClass(f["class"]).append(this.left).append(this.uleft).append(" x ").append(this.top).append(this.utop).append(" x ").append(this.right).append(this.uright).append(" x ").append(this.bottom).append(this.ubottom);this.val=function(x){if(!x&&x!==""){var q=b(this.left.val());var z=b(this.top.val());var i=b(this.right.val());var w=b(this.bottom.val());var u={left:q=="auto"||q==0?q:(q!==""?q+this.uleft.val():""),top:z=="auto"||z==0?z:(z!==""?z+this.utop.val():""),right:i=="auto"||i==0?i:(i!==""?i+this.uright.val():""),bottom:w=="auto"||w==0?w:(w!==""?w+this.ubottom.val():""),css:""};if(u.left!==""&&u.right!==""&&u.top!==""&&u.bottom!==""){if(u.left==u.right&&u.top==u.bottom){u.css=u.top+" "+u.left}else{u.css=u.top+" "+u.right+" "+u.bottom+" "+u.left}}return u}else{if(x.nodeName||x.css){if(!x.css){x=a(x)}var k={left:"",top:"",right:"",bottom:""};var j=(x.attr("style")||"").toLowerCase();if(j){j=a.trim(j);var p=j.match(this.regexps.main);if(p){var s=a.trim(p[1]).replace(/\s+/g," ").split(" ",4);k.top=s[0];k.right=s[1]&&s[1]!==""?s[1]:k.top;k.bottom=s[2]&&s[2]!==""?s[2]:k.top;k.left=s[3]&&s[3]!==""?s[3]:k.right}else{a.each(["left","top","right","bottom"],function(){var r=this.toString();p=j.match(e.regexps[r]);if(p){k[r]=p[1]}})}}var x=k}a.each(["left","top","right","bottom"],function(){var t=this.toString();e[t].val("");e["u"+t].val();if(typeof(x[t])!="undefined"&&x[t]!==null){x[t]=x[t].toString();var v=b(x[t]);e[t].val(v);var r=x[t].match(/(px|em|pt|%)/i);e["u"+t].val(r?r[1]:"px")}});return this}};function b(i){i=a.trim(i.toString());if(i[0]=="."){i="0"+i}n=parseFloat(i);return !isNaN(n)?n:(i=="auto"?i:"")}function h(){f.change&&f.change(e)}this.val(f.value);return this};a.fn.elPaddingInput.defaults={name:"el-paddinginput","class":"el-paddinginput",type:"padding",value:{},percents:true,change:null}})(jQuery);(function(a){a.fn.elSelect=function(e){var q=this;var t=this.eq(0);var b=a.extend({},a.fn.elSelect.defaults,e);var g=a('<input type="hidden" />').attr("name",b.name);var p=a("<label />").attr({unselectable:"on"}).addClass("rounded-left-3");var h=null;var k=null;if(t.get(0).nodeName=="SELECT"){b.src={};t.children("option").each(function(){b.src[a(this).val()]=a(this).text()});b.value=t.val();b.name=t.attr("name");t.replaceWith((t=a("<div />")))}if(!b.value||!b.src[b.val]){b.value=null;var f=0;for(var r in b.src){if(f++==0){b.value=r}}}this.val=function(i){if(!i&&i!==""){return g.val()}else{if(b.src[i]){g.val(i);j(i);if(h){h.children().each(function(){if(a(this).attr("name")==i){a(this).addClass("active")}else{a(this).removeClass("active")}})}}return this}};function j(i){var u=b.labelTpl||b.tpls[i]||b.tpl;p.html(u.replace(/%val/g,i).replace(/%label/,b.src[i])).children().attr({unselectable:"on"})}t.empty().addClass(b["class"]+" rounded-3").attr({unselectable:"on"}).append(g).append(p).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).click(function(i){!h&&s();h.slideToggle();if(a.browser.msie&&!k){h.children().each(function(){k=Math.max(k,a(this).width())});if(k>h.width()){h.width(k+40)}}});this.val(b.value);function s(){h=a("<div style='z-index:99999;'/>").addClass(b.listClass+" rounded-3").hide().appendTo(t.mouseleave(function(v){h.slideUp()}));for(var u in b.src){var x=b.tpls[u]||b.tpl;a('<div class="item"/>').attr("name",u).append(a(x.replace(/%val/g,u).replace(/%label/g,b.src[u])).attr({unselectable:"on"})).appendTo(h).click(function(A){A.stopPropagation();A.preventDefault();var w=a(this).attr("name");q.val(w);b.select(w);h.slideUp()})}var i=t.outerWidth();if(h.width()<i){h.width(i)}var z=h.height();if(b.maxHeight>0&&z>b.maxHeight){h.height(b.maxHeight)}q.val(g.val())}return this};a.fn.elSelect.defaults={name:"rte-select","class":"rte-select",listClass:"list",labelTpl:null,tpl:"<%val>%label</%val>",tpls:{},value:null,src:{},select:function(b){window.console&&window.console.log&&window.console.log("selected: "+b)},maxHeight:410}})(jQuery);function rteDom(a){this.rte=a;this.regExp={textNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TD|TH|TT|VAR)$/,textContainsNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DL|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|OL|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|TT|UL|VAR)$/,block:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|UL)$/,selectionBlock:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TD|TH|TR|UL)$/,header:/^H[1-6]$/,formElement:/^(FORM|INPUT|HIDDEN|TEXTAREA|SELECT|BUTTON)$/}}rteDom.prototype.createBookmark=function(){var a=this.rte.options.doc.createElement("span");a.id="rte-bm-"+Math.random().toString().substr(2);$(a).addClass("rtebm rte-protected");return a};rteDom.prototype.attr=function(e,a){var b="";if(e&&e.nodeType==1){b=$(e).attr(a);if(b&&a!="src"&&a!="href"&&a!="title"&&a!="alt"){b=b.toString().toLowerCase()}}return b||""};rteDom.prototype.findCommonAncestor=function(f,e){if(!f||!e){return}if(f==e){return f}else{if(f.nodeName=="BODY"||e.nodeName=="BODY"){return this.rte.options.doc.body}}var h=$(f).parents(),g=$(e).parents(),a=g.length-1,j=g[a];for(var b=h.length-1;b>=0;b--,a--){if(h[b]==g[a]){j=h[b]}else{break}}return j};rteDom.prototype.isEmpty=function(a){if(a.nodeType==1){return this.regExp.textNodes.test(a.nodeName)?$.trim($(a).text()).length==0:false}else{if(a.nodeType==3){return/^(TABLE|THEAD|TFOOT|TBODY|TR|UL|OL|DL)$/.test(a.parentNode.nodeName)||a.nodeValue==""||($.trim(a.nodeValue).length==0&&!(a.nextSibling&&a.previousSibling&&a.nextSibling.nodeType==1&&a.previousSibling.nodeType==1&&!this.regExp.block.test(a.nextSibling.nodeName)&&!this.regExp.block.test(a.previousSibling.nodeName)))}}return true};rteDom.prototype.next=function(a){while(a.nextSibling&&(a=a.nextSibling)){if(a.nodeType==1||(a.nodeType==3&&!this.isEmpty(a))){return a}}return null};rteDom.prototype.prev=function(a){while(a.previousSibling&&(a=a.previousSibling)){if(a.nodeType==1||(a.nodeType==3&&!this.isEmpty(a))){return a}}return null};rteDom.prototype.isPrev=function(b,a){while((b=this.prev(b))){if(b==a){return true}}return false};rteDom.prototype.nextAll=function(b){var a=[];while((b=this.next(b))){a.push(b)}return a};rteDom.prototype.prevAll=function(b){var a=[];while((b=this.prev(b))){a.push(b)}return a};rteDom.prototype.toLineEnd=function(b){var a=[];while((b=this.next(b))&&b.nodeName!="BR"&&b.nodeName!="HR"&&this.isInline(b)){a.push(b)}return a};rteDom.prototype.toLineStart=function(b){var a=[];while((b=this.prev(b))&&b.nodeName!="BR"&&b.nodeName!="HR"&&this.isInline(b)){a.unshift(b)}return a};rteDom.prototype.isFirstNotEmpty=function(a){while((a=this.prev(a))){if(a.nodeType==1||(a.nodeType==3&&$.trim(a.nodeValue)!="")){return false}}return true};rteDom.prototype.isLastNotEmpty=function(a){while((a=this.next(a))){if(!this.isEmpty(a)){return false}}return true};rteDom.prototype.isOnlyNotEmpty=function(a){return this.isFirstNotEmpty(a)&&this.isLastNotEmpty(a)};rteDom.prototype.findLastNotEmpty=function(a){if(a.nodeType==1&&(l=a.lastChild)){if(!this.isEmpty(l)){return l}while(l.previousSibling&&(l=l.previousSibling)){if(!this.isEmpty(l)){return l}}}return false};rteDom.prototype.isInline=function(e){if(e.nodeType==3){return true}else{if(e.nodeType==1){e=$(e);var b=e.css("display");var a=e.css("float");return b=="inline"||b=="inline-block"||a=="left"||a=="right"}}return true};rteDom.prototype.is=function(b,a){if(b&&b.nodeName){if(typeof(a)=="string"){a=this.regExp[a]||/.?/}if(a instanceof RegExp&&b.nodeName){return a.test(b.nodeName)}else{if(typeof(a)=="function"){return a(b)}}}return false};rteDom.prototype.filter=function(f,e){var a=[],b;if(!f.push){return this.is(f,e)?f:null}for(b=0;b<f.length;b++){if(this.is(f[b],e)){a.push(f[b])}}return a};rteDom.prototype.parents=function(e,b){var a=[];while(e&&(e=e.parentNode)&&e.nodeName!="BODY"&&e.nodeName!="HTML"){if(this.is(e,b)){a.push(e)}}return a};rteDom.prototype.parent=function(b,a){return this.parents(b,a)[0]||null};rteDom.prototype.selfOrParent=function(e,b,a){return this.is(e,b)?e:this.parent(e,a||b)};rteDom.prototype.selfOrParentLink=function(a){a=this.selfOrParent(a,/^A$/);return a?a:null};rteDom.prototype.selfOrParentAnchor=function(a){a=this.selfOrParent(a,/^A$/);return a&&!a.href&&a.name?a:null};rteDom.prototype.childLinks=function(b){var a=[];$("a[href]",b).each(function(){a.push(this)});return a};rteDom.prototype.selectionHas=function(e,b){var g=e.cloneContents(),a;if(g&&g.childNodes&&g.childNodes.length){for(a=0;a<g.childNodes.length;a++){if(typeof(b)=="function"){if(b(g.childNodes[a])){return true}}else{if(g instanceof RegExp){if(b.test(g.childNodes[a].nodeName)){return true}}}}}return false};rteDom.prototype.wrap=function(b,a){b=$.isArray(b)?b:[b];a=a.nodeName?a:this.rte.options.doc.createElement(a);if(b[0]&&b[0].nodeType&&b[0].parentNode){a=b[0].parentNode.insertBefore(a,b[0]);$(b).each(function(){if(this!=a){a.appendChild(this)}})}return a};rteDom.prototype.unwrap=function(a){if(a&&a.parentNode){while(a.firstChild){a.parentNode.insertBefore(a.firstChild,a)}a.parentNode.removeChild(a)}};rteDom.prototype.wrapContents=function(e,a){a=a.nodeName?a:this.rte.options.doc.createElement(a);for(var b=0;b<e.childNodes.length;b++){a.appendChild(e.childNodes[b])}e.appendChild(a);return a};rteDom.prototype.cleanNode=function(a){if(a.nodeType!=1){return}if(/^(P|LI)$/.test(a.nodeName)&&(l=this.findLastNotEmpty(a))&&l.nodeName=="BR"){$(l).remove()}$n=$(a);$n.children().each(function(){this.cleanNode(this)});if(a.nodeName!="BODY"&&!/^(TABLE|TR|TD)$/.test(a)&&this.isEmpty(a)){return $n.remove()}if($n.attr("style")===""){$n.removeAttr("style")}if($.browser.safari&&$n.hasClass("Apple-span")){$n.removeClass("Apple-span")}if(a.nodeName=="SPAN"&&!$n.attr("style")&&!$n.attr("class")&&!$n.attr("id")){$n.replaceWith($n.html())}};rteDom.prototype.cleanChildNodes=function(b){var a=this.cleanNode;$(b).children().each(function(){a(this)})};rteDom.prototype.tableMatrix=function(f){var e=[];if(f&&f.nodeName=="TABLE"){var b=0;function a(h){for(var g=0;g<=b;g++){if(!e[h][g]){return g}}}$(f).find("tr").each(function(g){if(!$.isArray(e[g])){e[g]=[]}$(this).children("td,th").each(function(){var k=parseInt($(this).attr("colspan")||1);var r=parseInt($(this).attr("rowspan")||1);var q=a(g);for(var t=0;t<r;t++){for(var j=0;j<k;j++){var p=g+t;if(!$.isArray(e[p])){e[p]=[]}var s=j==0&&t==0?this:(t==0?j:"-");e[p][q+j]=s}}b=Math.max(b,e[g].length)})})}return e};rteDom.prototype.indexesOfCell=function(f,e){for(var a=0;a<e.length;a++){for(var b=0;b<e[a].length;b++){if(e[a][b]==f){return[a,b]}}}};rteDom.prototype.fixTable=function(b){if(b&&b.nodeName=="TABLE"){var g=$(b);var k=this.tableMatrix(b);var j=0;$.each(k,function(){j=Math.max(j,this.length)});if(j==0){return g.remove()}for(var a=0;a<k.length;a++){var f=k[a].length;if(f==0){g.find("tr").eq(a).remove()}else{if(f<j){var e=j-f;var p=g.find("tr").eq(a);for(var h=0;h<e;h++){p.append("<td>&nbsp;</td>")}}}}}};rteDom.prototype.tableColumn=function(e,b,h){e=this.selfOrParent(e,/^TD|TH$/);var f=this.selfOrParent(e,/^TABLE$/);ret=[];info={offset:[],delta:[]};if(e&&f){h&&this.fixTable(f);var p=this.tableMatrix(f);var q=false;var k;for(var a=0;a<p.length;a++){for(var j=0;j<p[a].length;j++){if(p[a][j]==e){k=j;q=true;break}}if(q){break}}if(k>=0){for(var a=0;a<p.length;a++){var g=p[a][k]||null;if(g){if(g.nodeName){ret.push(g);if(b){info.delta.push(0);info.offset.push(k)}}else{var i=parseInt(g);if(!isNaN(i)&&p[a][k-i]&&p[a][k-i].nodeName){ret.push(p[a][k-i]);if(b){info.delta.push(i);info.offset.push(k)}}}}}}}return !b?ret:{column:ret,info:info}};function rteSelection(b){this.rte=b;this.w3cRange=null;var a=this,e=b.options.doc;$(e).keyup(function(f){if(f.ctrlKey||f.metaKey||(f.keyCode>=8&&f.keyCode<=13)||(f.keyCode>=32&&f.keyCode<=40)||f.keyCode==46||(f.keyCode>=96&&f.keyCode<=111)){a.cleanCache()}}).mousedown(function(f){a.start=(f.target.nodeName=="HTML"?e.body:f.target);a.end=a.node=null}).mouseup(function(f){a.end=(f.target.nodeName=="HTML"?e.body:f.target);a.node=null}).click()}rteSelection.prototype.getSelection=function(){var a=this.rte.options.win;return a.getSelection?a.getSelection():a.document.selection};rteSelection.prototype.realSelected=function(f,b,a){var e=this.rte.options.dom;while(f.nodeName!="BODY"&&f.parentNode&&f.parentNode.nodeName!="BODY"&&(b?f!==b&&f.parentNode!=b:1)&&((a=="left"&&e.isFirstNotEmpty(f))||(a=="right"&&e.isLastNotEmpty(f))||(e.isFirstNotEmpty(f)&&e.isLastNotEmpty(f)))){f=f.parentNode}return f};rteSelection.prototype.collapsed=function(){return this.getRangeAt().isCollapsed()};rteSelection.prototype.collapse=function(a){var b=this.getRangeAt();b.collapse(a?true:false);if(!$.browser.msie){this.getSelection().removeAllRanges();this.getSelection().addRange(b)}return this};rteSelection.prototype.getRangeAt=function(e){if($.browser.msie){if(!this.w3cRange){this.w3cRange=new w3cRange(this.rte.options.win)}e&&this.w3cRange.update();return this.w3cRange}var a=this.getSelection(),b=a&&a.rangeCount>0?a.getRangeAt(0):this.rte.options.win.document.createRange();b.getStart=function(){return this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(this.startOffset,this.startContainer.childNodes.length-1)]:this.startContainer};b.getEnd=function(){return this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(this.startOffset==this.endOffset?this.endOffset:this.endOffset-1,this.endContainer.childNodes.length-1)]:this.endContainer};b.isCollapsed=function(){return this.collapsed};return b};rteSelection.prototype.saveIERange=function(){if($.browser.msie){bm=this.getRangeAt().getBookmark()}};rteSelection.prototype.restoreIERange=function(){$.browser.msie&&bm&&this.getRangeAt().moveToBookmark(bm)};rteSelection.prototype.cloneContents=function(){var g=this.rte.options.doc,j=g.createElement("div"),b,h,a;if($.browser.msie){try{b=this.getSelection().createRange()}catch(f){b=g.body.createTextRange()}$(j).html(b.htmlText)}else{h=this.getRangeAt().cloneContents();for(a=0;a<h.childNodes.length;a++){j.appendChild(h.childNodes[a].cloneNode(true))}}return j};rteSelection.prototype.select=function(f,i){i=i||f;if($.browser.msie){var g=this.rte.options.doc.body.createTextRange(),b=g.duplicate(),a=g.duplicate();b.moveToElementText(f);a.moveToElementText(i);g.setEndPoint("StartToStart",b);g.setEndPoint("EndToEnd",a);g.select()}else{var h=this.getSelection(),g=this.getRangeAt();g.setStartBefore(f);g.setEndAfter(i);h.removeAllRanges();h.addRange(g)}return this.cleanCache()};rteSelection.prototype.selectContents=function(g){var b=this.getRangeAt();if(g&&g.nodeType==1){if($.browser.msie){b.range();b.r.moveToElementText(g.parentNode);b.r.select()}else{try{b.selectNodeContents(g)}catch(f){return}var a=this.getSelection();a.removeAllRanges();a.addRange(b)}}return this};rteSelection.prototype.deleteContents=function(){if(!$.browser.msie){this.getRangeAt().deleteContents()}return this};rteSelection.prototype.insertNode=function(f,e){if(e&&!this.collapsed()){this.collapse()}if($.browser.msie){var b=this.getRangeAt();b.insertNode(f.nodeType==3?f.nodeValue:$("span").append($(f)).html())}else{var b=this.getRangeAt();b.insertNode(f);b.setStartAfter(f);b.setEndAfter(f);var a=this.getSelection();a.removeAllRanges();a.addRange(b)}return this.cleanCache()};rteSelection.prototype.insertHtml=function(a,b){if(b&&!this.collapsed()){this.collapse()}if($.browser.msie){this.getRangeAt().range().pasteHTML(a)}else{var e=$(this.rte.options.doc.create("span")).html(a||"").get(0);this.insertNode(e);$(e).replaceWith($(e).html())}return this.cleanCache()};rteSelection.prototype.insertText=function(b,a){var e=this.rte.options.doc.createTextNode(b);return this.insertHtml(e.nodeValue)};rteSelection.prototype.getBookmark=function(){this.rte.options.win.focus();var a,h,f,q,j,i=this.rte.options.dom,t=i.createBookmark(),k=i.createBookmark(),p=this.rte.options.doc;if($.browser.msie){try{a=this.getSelection().createRange()}catch(k){a=p.body.createTextRange()}if(a.item){var g=a.item(0);a=p.body.createTextRange();a.moveToElementText(g)}h=a.duplicate();f=a.duplicate();q=p.createElement("span");j=p.createElement("span");q.appendChild(t);j.appendChild(k);h.collapse(true);h.pasteHTML(q.innerHTML);f.collapse(false);f.pasteHTML(j.innerHTML)}else{var b=this.getSelection(),a=b&&b.rangeCount>0?b.getRangeAt(0):p.createRange();h=a.cloneRange();f=a.cloneRange();f.collapse(false);f.insertNode(k);h.collapse(true);h.insertNode(t);this.select(t,k)}return[t.id,k.id]};rteSelection.prototype.moveToBookmark=function(a){this.rte.options.win.focus();if(a&&a.length==2){var j=this.rte.options.doc,f=j.getElementById(a[0]),i=j.getElementById(a[1]),h,g;if(f&&i){this.select(f,i);if(this.rte.options.dom.next(f)==i){this.collapse(true)}if(!$.browser.msie){h=this.getSelection();g=h.rangeCount>0?h.getRangeAt(0):j.createRange();h.removeAllRanges();h.addRange(g)}f.parentNode.removeChild(f);i.parentNode.removeChild(i)}}return this};rteSelection.prototype.removeBookmark=function(a){this.rte.options.win.focus();if(a.length==2){var h=this.rte.options.doc,f=h.getElementById(a[0]),g=h.getElementById(a[1]);if(f&&g){f.parentNode.removeChild(f);g.parentNode.removeChild(g)}}};rteSelection.prototype.cleanCache=function(){this.start=this.end=this.node=null;return this};rteSelection.prototype.getStart=function(){if(!this.start){this.start=this.getRangeAt().getStart()}return this.start};rteSelection.prototype.getEnd=function(){if(!this.end){this.end=this.getRangeAt().getEnd()}return this.end};rteSelection.prototype.getNode=function(){if(!this.node){this.node=this.rte.options.dom.findCommonAncestor(this.getStart(),this.getEnd())}return this.node};rteSelection.prototype.selected=function(e){var a={collapsed:false,blocks:false,filter:false,wrap:"text",tag:"span"},j=this.rte.options.dom;a=$.extend({},a,e);if(a.blocks){var h=this.getNode(),g=null;if(g=j.selfOrParent(h,"selectionBlock")){return[g]}}var f=this.selectedRaw(a.collapsed,a.blocks),r=[],k=[],s=null;function b(){function t(){for(var v=0;v<k.length;v++){if(k[v].nodeType==1&&(j.selfOrParent(k[v],/^P$/)||$(k[v]).find("p").length>0)){return false}}return true}if(k.length>0){var i=a.tag=="p"&&!t()?"div":a.tag;var u=j.wrap(k,i);r[s]=u;s=null;k=[]}}function q(u){if(u.nodeType==1){if(/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(u.nodeName)){$(u).find("td,th").each(function(){var v=a.tag=="p"&&$(this).find("p").length>0?"div":a.tag;var w=j.wrapContents(this,v);return r.push(w)})}else{if(/^(CAPTION|TD|TH|LI|DT|DD)$/.test(u.nodeName)){var i=a.tag=="p"&&$(u).find("p").length>0?"div":a.tag;var u=j.wrapContents(u,i);return r.push(u)}}}var t=k.length>0?k[k.length-1]:null;if(t&&t!=j.prev(u)){b()}k.push(u);if(s===null){s=r.length;r.push("dummy")}}if(f.nodes.length>0){for(var p=0;p<f.nodes.length;p++){var h=f.nodes[p];if(h.nodeType==3&&(p==0||p==f.nodes.length-1)&&$.trim(h.nodeValue).length>0){if(p==0&&f.so>0){h=h.splitText(f.so)}if(p==f.nodes.length-1&&f.eo>0){h.splitText(p==0&&f.so>0?f.eo-f.so:f.eo)}}switch(a.wrap){case"text":if((h.nodeType==1&&h.nodeName=="BR")||(h.nodeType==3&&$.trim(h.nodeValue).length>0)){q(h)}else{if(h.nodeType==1){r.push(h)}}break;case"inline":if(j.isInline(h)){q(h)}else{if(h.nodeType==1){r.push(h)}}break;case"all":if(h.nodeType==1||!j.isEmpty(h)){q(h)}break;default:if(h.nodeType==1||!j.isEmpty(h)){r.push(h)}}}b()}if(r.length){this.rte.options.win.focus();this.select(r[0],r[r.length-1])}return a.filter?j.filter(r,a.filter):r};rteSelection.prototype.selectedRaw=function(p,a){var x={so:null,eo:null,nodes:[]};var b=this.getRangeAt(true);var i=b.commonAncestorContainer;var A,w;var v=false;var t=false;var k=this.rte.options.dom;function u(C,r,B){if(C.nodeType==3){B=B>=0?B:C.nodeValue.length;return(r==0&&B==C.nodeValue.length)||$.trim(C.nodeValue).length==$.trim(C.nodeValue.substring(r,B)).length}return true}function j(C,r,B){if(C.nodeType==1){return k.isEmpty(C)}else{if(C.nodeType==3){return $.trim(C.nodeValue.substring(r||0,B>=0?B:C.nodeValue.length)).length==0}}return true}if(b.startContainer.nodeType==1){if(b.startOffset<b.startContainer.childNodes.length){A=b.startContainer.childNodes[b.startOffset];x.so=A.nodeType==1?null:0}else{A=b.startContainer.childNodes[b.startOffset-1];x.so=A.nodeType==1?null:A.nodeValue.length}}else{A=b.startContainer;x.so=b.startOffset}if(b.collapsed){if(p){if(a){A=this.realSelected(A);if(!k.isEmpty(A)||(A=k.next(A))){x.nodes=[A]}if(k.isInline(A)){x.nodes=k.toLineStart(A).concat(x.nodes,k.toLineEnd(A))}if(x.nodes.length>0){x.so=x.nodes[0].nodeType==1?null:0;x.eo=x.nodes[x.nodes.length-1].nodeType==1?null:x.nodes[x.nodes.length-1].nodeValue.length}}else{if(!k.isEmpty(A)){x.nodes=[A]}}}return x}if(b.endContainer.nodeType==1){w=b.endContainer.childNodes[b.endOffset-1];x.eo=w.nodeType==1?null:w.nodeValue.length}else{w=b.endContainer;x.eo=b.endOffset}if(A.nodeType==1||a||u(A,x.so,A.nodeValue.length)){A=this.realSelected(A,i,"left");v=true;x.so=A.nodeType==1?null:0}if(w.nodeType==1||a||u(w,0,x.eo)){w=this.realSelected(w,i,"right");t=true;x.eo=w.nodeType==1?null:w.nodeValue.length}if(a){if(A.nodeType!=1&&A.parentNode!=i&&A.parentNode.nodeName!="BODY"){A=A.parentNode;x.so=null}if(w.nodeType!=1&&w.parentNode!=i&&w.parentNode.nodeName!="BODY"){w=w.parentNode;x.eo=null}}if(A.parentNode==w.parentNode&&A.parentNode.nodeName!="BODY"&&(v&&k.isFirstNotEmpty(A))&&(t&&k.isLastNotEmpty(w))){A=w=A.parentNode;x.so=A.nodeType==1?null:0;x.eo=w.nodeType==1?null:w.nodeValue.length}if(A==w){if(!k.isEmpty(A)){x.nodes.push(A)}return x}var f=A;while(f.nodeName!="BODY"&&f.parentNode!==i&&f.parentNode.nodeName!="BODY"){f=f.parentNode}var z=w;while(z.nodeName!="BODY"&&z.parentNode!==i&&z.parentNode.nodeName!="BODY"){z=z.parentNode}if(!j(A,x.so,A.nodeType==3?A.nodeValue.length:null)){x.nodes.push(A)}var h=A;while(h!==f){var g=h;while((g=k.next(g))){x.nodes.push(g)}h=h.parentNode}h=f;while((h=k.next(h))&&h!=z){x.nodes.push(h)}var q=[];h=w;while(h!==z){var g=h;while((g=k.prev(g))){q.push(g)}h=h.parentNode}if(q.length){x.nodes=x.nodes.concat(q.reverse())}if(!j(w,0,w.nodeType==3?x.eo:null)){x.nodes.push(w)}if(a){if(k.isInline(A)){x.nodes=k.toLineStart(A).concat(x.nodes);x.so=x.nodes[0].nodeType==1?null:0}if(k.isInline(w)){x.nodes=x.nodes.concat(k.toLineEnd(w));x.eo=x.nodes[x.nodes.length-1].nodeType==1?null:x.nodes[x.nodes.length-1].nodeValue.length}}return x};function w3cRange(a){this.win=a;this.r=null;this.collapsed=true;this.startContainer=null;this.endContainer=null;this.startOffset=0;this.endOffset=0;this.commonAncestorContainer=null}w3cRange.prototype.range=function(){doc=this.win.document;try{this.r=doc.selection.createRange()}catch(a){this.r=doc.body.createTextRange()}return this.r};w3cRange.prototype.insertNode=function(a){this.range();this.r.collapse(false);var b=this.r.duplicate();b.pasteHTML(a)};w3cRange.prototype.getBookmark=function(){this.range();if(this.r.item){var a=this.r.item(0);this.r=this.win.document.body.createTextRange();this.r.moveToElementText(a)}return this.r.getBookmark()};w3cRange.prototype.moveToBookmark=function(a){this.win.focus();this.range().moveToBookmark(a);this.r.select()};w3cRange.prototype.update=function(){var b=this,f=this.win.document;function g(w){var j="\uFEFF";var k=offset=0;var s=b.r.duplicate();s.collapse(w);var t=s.parentElement();if(!t||t.nodeName=="HTML"){return{parent:f.body,ndx:k,offset:offset}}s.pasteHTML(j);childs=t.childNodes;for(var q=0;q<childs.length;q++){var v=childs[q];if(q>0&&(v.nodeType!==3||childs[q-1].nodeType!==3)){k++}if(v.nodeType!==3){offset=0}else{var u=v.nodeValue.indexOf(j);if(u!==-1){offset+=u;break}offset+=v.nodeValue.length}}s.moveStart("character",-1);s.text="";return{parent:t,ndx:Math.min(k,t.childNodes.length-1),offset:offset}}this.range();this.startContainer=this.endContainer=null;if(this.r.item){this.collapsed=false;var e=this.r.item(0);this.setStart(e.parentNode,$(e).index());this.setEnd(e.parentNode,this.startOffset+1)}else{this.collapsed=this.r.boundingWidth==0;var h=g(true),a=g(false);h.parent.normalize();a.parent.normalize();h.ndx=Math.min(h.ndx,h.parent.childNodes.length-1);a.ndx=Math.min(a.ndx,a.parent.childNodes.length-1);if(h.parent.childNodes[h.ndx].nodeType&&h.parent.childNodes[h.ndx].nodeType==1){this.setStart(h.parent,h.ndx)}else{this.setStart(h.parent.childNodes[h.ndx],h.offset)}if(a.parent.childNodes[a.ndx].nodeType&&a.parent.childNodes[a.ndx].nodeType==1){this.setEnd(a.parent,a.ndx)}else{this.setEnd(a.parent.childNodes[a.ndx],a.offset)}this.select()}return this};w3cRange.prototype.isCollapsed=function(){this.range();this.collapsed=this.r.item?false:this.r.boundingWidth==0;return this.collapsed};w3cRange.prototype.collapse=function(a){this.range();if(this.r.item){var b=this.r.item(0);this.r=this.win.document.body.createTextRange();this.r.moveToElementText(b)}this.r.collapse(a);this.r.select();this.collapsed=true};w3cRange.prototype.getStart=function(){this.range();if(this.r.item){return this.r.item(0)}var b=this.r.duplicate();b.collapse(true);var a=b.parentElement();return a&&a.nodeName=="BODY"?a.firstChild:a};w3cRange.prototype.getEnd=function(){this.range();if(this.r.item){return this.r.item(0)}var a=this.r.duplicate();a.collapse(false);var b=a.parentElement();return b&&b.nodeName=="BODY"?b.lastChild:b};w3cRange.prototype.setStart=function(a,b){this.startContainer=a;this.startOffset=b;if(this.endContainer){this.commonAncestorContainer=this.findCommonAncestor(this.startContainer,this.endContainer)}};w3cRange.prototype.setEnd=function(a,b){this.endContainer=a;this.endOffset=b;if(this.startContainer){this.commonAncestorContainer=this.findCommonAncestor(this.startContainer,this.endContainer)}};w3cRange.prototype.setStartBefore=function(a){if(a.parentNode){this.setStart(a.parentNode,$(a).index())}};w3cRange.prototype.setStartAfter=function(a){if(a.parentNode){this.setStart(a.parentNode,$(a).index()+1)}};w3cRange.prototype.setEndBefore=function(a){if(a.parentNode){this.setEnd(a.parentNode,$(a).index())}};w3cRange.prototype.setEndAfter=function(a){if(a.parentNode){this.setEnd(a.parentNode,$(a).index()+1)}};w3cRange.prototype.select=function(){var j=this.win.document.body;function i(x,v){if(x.nodeType!=3){return -1}var w="\uFEFF",u=x.nodeValue,e=j.createTextRange();x.nodeValue=u.substring(0,v)+w+u.substring(v);e.moveToElementText(x.parentNode);e.findText(w);var s=Math.abs(e.moveStart("character",-1048575));x.nodeValue=u;return s}this.r=j.createTextRange();var h=this.startOffset,b=this.endOffset;var t=this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(h,this.startContainer.childNodes.length-1)]:this.startContainer;var k=this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(h==b?b:b-1,this.endContainer.childNodes.length-1)]:this.endContainer;if(this.collapsed){if(t.nodeType==3){var g=i(t,h);this.r.move("character",g)}else{this.r.moveToElementText(t);this.r.collapse(true)}}else{var a=j.createTextRange();var f=i(t,h);var q=i(k,b);if(t.nodeType==3){this.r.move("character",f)}else{this.r.moveToElementText(t)}if(k.nodeType==3){a.move("character",q)}else{a.moveToElementText(k)}this.r.setEndPoint("EndToEnd",a)}try{this.r.select()}catch(k){}if(a){a=null}};w3cRange.prototype.findCommonAncestor=function(f,e){if(!f||!e){return}if(f==e){return f}else{if(f.nodeName=="BODY"||e.nodeName=="BODY"){return doc.body}}var h=$(f).parents(),g=$(e).parents(),a=g.length-1,j=g[a];for(var b=h.length-1;b>=0;b--,a--){if(h[b]==g[a]){j=h[b]}else{break}}return j};if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/* JsRender v1.0pre: http://github.com/BorisMoore/jsrender */
(function(a,E,v){if(E&&E.views||a.jsviews){return}var ao="v1.0pre",T,ak,A,F,t="{",s="{",i="}",h="}",ag="^",G=/^(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,ah=/(\()(?=\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*((\))(?=\s*\.|\s*\^)|\)|\])([([]?))|(\s+)/g,ab=/\s*\n/g,g=/\\(['"])/g,am=/([\\'"])/g,u=/\x08(~)?([^\x08]+)\x08/g,p=/^if\s/,x=/<(\w+)[>\s]/,V=/<(\w+)[^>\/]*>[^>]*$/,W=/[<"'&]/g,R=/[><"'&]/g,ap=0,an=0,S={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;"},ae="data-jsv-tmpl",z=[].slice,X={},aa={template:{compile:b},tag:{compile:w},helper:{},converter:{}},U={jsviews:ao,render:X,View:al,settings:{delimiters:C,debugMode:true,tryCatch:true},sub:{Error:L,tmplFn:J,parse:D,extend:B,error:N,syntaxError:Z},_cnvt:O,_tag:e,_err:function(aq){return ac.debugMode?("Error: "+(aq.message||aq))+". ":""}};function L(ar,aq){if(aq&&aq.onError){if(aq.onError(ar)===false){return}}this.name="JsRender Error";this.message=ar||"JsRender error"}function B(at,ar){var aq;at=at||{};for(aq in ar){at[aq]=ar[aq]}return at}(L.prototype=new Error()).constructor=L;function C(aq,at,ar){if(!ad.rTag||arguments.length){t=aq?aq.charAt(0):t;s=aq?aq.charAt(1):s;i=at?at.charAt(0):i;h=at?at.charAt(1):h;ag=ar||ag;aq="\\"+t+"(\\"+ag+")?\\"+s;at="\\"+i+"\\"+h;A="(?:(?:(\\w+(?=[\\/\\s\\"+i+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+i+"]|\\"+i+"(?!\\"+h+"))*?)";ad.rTag=A+")";A=new RegExp(aq+A+"(\\/)?|(?:\\/(\\w+)))"+at,"g");F=new RegExp("<.*>|([^\\\\]|^)[{}]|"+aq+".*"+at)}return[t,s,i,h,ag]}function Q(av,ax){if(!ax){ax=av;av=v}var au,aw,at,ay,ar=this,aq=!ax||ax==="root";if(av){ay=ar.type===ax?ar:v;if(!ay){au=ar.views;if(ar._.useKey){for(aw in au){if(ay=au[aw].get(av,ax)){break}}}else{for(aw=0,at=au.length;!ay&&aw<at;aw++){ay=au[aw].get(av,ax)}}}}else{if(aq){while(ar.parent.parent){ay=ar=ar.parent}}else{while(ar&&!ay){ay=ar.type===ax?ar:v;ar=ar.parent}}}return ay}function P(){var aq=this.get("item");return aq?aq.index:v}P.depends=function(){return[this.get("item"),"index"]};function af(au){var ar,aq=this,at=(aq.ctx||{})[au];at=at===v?aq.getRsc("helpers",au):at;if(at){if(typeof at==="function"){ar=function(){return at.apply(aq,arguments)};B(ar,at)}}return ar||at}function O(aw,au,av){var at,ar,ay,ax=+av===av&&av,aq=au.linkCtx;if(ax){av=(ax=au.tmpl.bnds[ax-1])(au.data,au,U)}ay=av.args[0];if(aw||ax){ar=aq&&aq.tag||{_:{inline:!aq},tagName:aw+":",flow:true,_is:"tag"};ar._.bnd=ax;if(aq){aq.tag=ar;ar.linkCtx=aq;av.ctx=aj(av.ctx,aq.view.ctx)}ar.tagCtx=av;av.view=au;ar.ctx=av.ctx||{};delete av.ctx;au._.tag=ar;aw=aw!=="true"&&aw;if(aw&&((at=au.getRsc("converters",aw))||N("Unknown converter: {{"+aw+":"))){ar.depends=at.depends;ay=at.apply(ar,av.args)}ay=ax&&au._.onRender?au._.onRender(ay,au,ax):ay;au._.tag=v}return ay}function H(at,av){var au,aq=this,ar=U[at];au=ar&&ar[av];while((au===v)&&aq){ar=aq.tmpl[at];au=ar&&ar[av];aq=aq.parent}return au}function e(at,av,ay,az){var aN,aO,aB,aD,aL,aH,aI,aF,aK,aA,aq,aG,aJ,ax,aM="",aw=+az===az&&az,au=av.linkCtx||0,aE=av.ctx,ar=ay||av.tmpl,aC=av._;if(at._is==="tag"){aO=at;at=aO.tagName}if(aw){az=(aJ=ar.bnds[aw-1])(av.data,av,U)}aF=az.length;aO=aO||au.tag;for(aI=0;aI<aF;aI++){aA=az[aI];aG=aA.tmpl;aG=aA.content=aG&&ar.tmpls[aG-1];ay=aA.props.tmpl;if(!aI&&(!ay||!aO)){ax=av.getRsc("tags",at)||N("Unknown tag: {{"+at+"}}")}ay=ay||!aI&&ax.template||aG;ay=""+ay===ay?av.getRsc("templates",ay)||M(ay):ay;B(aA,{tmpl:ay,render:r,index:aI,view:av,ctx:aj(aA.ctx,aE)});if(!aO){if(ax.init){aO=new ax.init(aA,au,aE);aO.attr=aO.attr||ax.attr||v}else{aO={render:ax.render}}aO._={inline:!au};if(au){au.attr=aO.attr=au.attr||aO.attr;au.tag=aO;aO.linkCtx=au}if(aO._.bnd=aJ||au){aO._.arrVws={}}aO.tagName=at;aO.parent=aH=aE&&aE.tag,aO._is="tag"}aC.tag=aO;aA.tag=aO;aO.tagCtxs=az;aO.rendering={};if(!aO.flow){aq=aA.ctx=aA.ctx||{};aB=aq.parentTags=aE&&aj(aq.parentTags,aE.parentTags)||{};if(aH){aB[aH.tagName]=aH}aq.tag=aO}}for(aI=0;aI<aF;aI++){aA=aO.tagCtx=az[aI];aO.ctx=aA.ctx;if(aN=aO.render){aK=aN.apply(aO,aA.args)}aM+=aK!==v?aK:aA.tmpl?aA.render():""}delete aO.rendering;aO.tagCtx=aO.tagCtxs[0];aO.ctx=aO.tagCtx.ctx;if(aO._.inline&&(aD=aO.attr)&&aD!=="html"){aM=aD==="text"?ai.html(aM):""}return aM=aw&&av._.onRender?av._.onRender(aM,av,aw):aM}function al(aq,aw,aC,ar,ax,ay,aB,aE){var az,av,aD,au=aw==="array",at={key:0,useKey:au?0:1,id:""+an++,onRender:aE,bnds:{}},aA={data:ar,tmpl:ax,content:aB,views:au?[]:{},parent:aC,ctx:aq,type:aw,get:Q,getIndex:P,getRsc:H,hlp:af,_:at,_is:"view"};if(aC){az=aC.views;av=aC._;if(av.useKey){az[at.key="_"+av.useKey++]=aA;aD=av.tag;at.bnd=au&&(!aD||!!aD._.bnd&&aD)}else{az.splice(at.key=aA.index=ay!==v?ay:az.length,0,aA)}aA.ctx=aq||aC.ctx}return aA}function q(av){var aq,aw,ar,at,au;for(aq in aa){at=aa[aq];if((au=at.compile)&&(aw=av[aq+"s"])){for(ar in aw){aw[ar]=au(ar,aw[ar],av,aq,at)}}}}function w(ar,at,au){var av,aq;if(typeof at==="function"){at={depends:at.depends,render:at}}else{if(aq=at.template){at.template=""+aq===aq?(M[aq]||M(aq)):aq}if(at.init!==false){av=at.init=at.init||function(aw){};av.prototype=at;(av.prototype=at).constructor=av}}if(au){at._parentTmpl=au}return at}function b(aq,ax,ay,aw,ar,az){function au(aA){if((""+aA===aA)||aA.nodeType>0){try{at=aA.nodeType>0?aA:!F.test(aA)&&E&&E(a.document).find(aA)[0]}catch(aB){}if(at){aA=at.getAttribute(ae);aq=aq||aA;aA=M[aA];if(!aA){aq=aq||"_"+ap++;at.setAttribute(ae,aq);aA=M[aq]=b(aq,at.innerHTML,ay,aw,ar,az)}}return aA}}var av,at;ax=ax||"";av=au(ax);az=az||(ax.markup?ax:{});az.tmplName=aq;if(ay){az._parentTmpl=ay}if(!av&&ax.markup&&(av=au(ax.markup))){if(av.fn&&(av.debug!==ax.debug||av.allowCode!==ax.allowCode)){av=av.markup}}if(av!==v){if(aq&&!ay){X[aq]=function(){return ax.render.apply(ax,arguments)}}if(av.fn||ax.fn){if(av.fn){if(aq&&aq!==av.tmplName){ax=aj(az,av)}else{ax=av}}}else{ax=j(av,az);J(av,ax)}q(az);return ax}}function j(au,av){var aq,ar=ac.wrapMap||{},at=B({markup:au,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:r},av);if(!av.htmlTag){aq=x.exec(au);at.htmlTag=aq?aq[1].toLowerCase():""}aq=ar[at.htmlTag];if(aq&&aq!==ar.div){at.markup=T.trim(at.markup);at._elCnt=true}return at}function f(at,ar){function au(av,ax,aB){var aw,aA,az,ay;if(av&&""+av!==av&&!av.nodeType&&!av.markup){for(az in av){au(az,av[az],ax)}return U}ay=aB?aB[aq]=aB[aq]||{}:au;if(ax===v){ax=av;av=v}aA=ar.compile;if(aw=ad.onBeforeStoreItem){aA=aw(ay,av,ax,aA)||aA}if(!av){ax=aA(v,ax)}else{if(""+av===av){if(ax===null){delete ay[av]}else{ay[av]=aA?(ax=aA(av,ax,aB,at,ar)):ax}}}if(ax){ax._is=at}if(aw=ad.onStoreItem){aw(ay,av,ax,aA)}return ax}var aq=at+"s";U[aq]=au;aa[at]=ar}function r(aL,at,au,aM,aw,av){var aG,aF,ay,aI,aK,aD,aC,az,ar,aJ,aH,aq,ax,aE=this,aB=!aE.attr||aE.attr==="html",aA="";if(aM===true){aC=true;aM=0}if(aE.tag){az=aE;aE=aE.tag;aJ=aE._;aq=aE.tagName;ax=az.tmpl;at=aj(at,aE.ctx);ar=az.content;if(az.props.link===false){at=at||{};at.link=false}au=au||az.view;aL=aL===v?au:aL}else{ax=aE.jquery&&(aE[0]||N('Unknown template: "'+aE.selector+'"'))||aE}if(ax){if(!au&&aL&&aL._is==="view"){au=aL}if(au){ar=ar||au.content;av=av||au._.onRender;if(aL===au){aL=au.data;aw=true}at=aj(at,au.ctx)}if(!au||au.data===v){(at=at||{}).root=aL}if(!ax.fn){ax=M[ax]||M(ax)}if(ax){av=(at&&at.link)!==false&&aB&&av;aH=av;if(av===true){aH=v;av=au._.onRender}if(T.isArray(aL)&&!aw){aI=aC?au:(aM!==v&&au)||al(at,"array",au,aL,ax,aM,ar,av);for(aG=0,aF=aL.length;aG<aF;aG++){ay=aL[aG];aK=al(at,"item",aI,ay,ax,(aM||0)+aG,ar,av);aD=ax.fn(ay,aK,U);aA+=aI._.onRender?aI._.onRender(aD,aK):aD}}else{aI=aC?au:al(at,aq||"data",au,aL,ax,aM,ar,av);if(aJ&&!aE.flow){aI.tag=aE}aA+=ax.fn(aL,aI,U)}return aH?aH(aA,aI):aA}}return""}function N(aq){if(ac.debugMode){throw new U.sub.Error(aq)}}function Z(aq){N("Syntax error\n"+aq)}function J(aE,aA,aD,aw){function at(aF){aF-=av;if(aF){ay.push(aE.substr(av,aF).replace(ab,"\\n"))}}function aC(aF){aF&&Z('Unmatched or missing tag: "{{/'+aF+'}}" in template:\n'+aE)}function aq(aJ,aX,aK,aU,aS,aN,aH,aR,aT,aP,aW,aL){if(aN){aS=":";aU="html"}aP=aP||aD;var aF,aO,aV=aX&&[],aG="",aI="",aQ="",aM=!aP&&!aS&&!aH;aK=aK||aS;at(aL);av=aL+aJ.length;if(aR){if(au){ay.push(["*","\n"+aT.replace(g,"$1")+"\n"])}}else{if(aK){if(aK==="else"){if(p.test(aT)){Z('for "{{else if expr}}" use "{{else expr}}"')}aV=ax[6];ax[7]=aE.substring(ax[7],aL);ax=az.pop();ay=ax[3];aM=true}if(aT){aT=aT.replace(ab," ");aG=D(aT,aV).replace(u,function(aY,aZ,a0){if(aZ){aQ+=a0+","}else{aI+=a0+","}return""})}aI=aI.slice(0,-1);aG=aG.slice(0,-1);aF=aI&&(aI.indexOf("noerror:true")+1)&&aI||"";aB=[aK,aU||!!aw||"",aG,aM&&[],'params:"'+aT+'",props:{'+aI+"}"+(aQ?",ctx:{"+aQ.slice(0,-1)+"}":""),aF,aV||0];ay.push(aB);if(aM){az.push(ax);ax=aB;ax[7]=av}}else{if(aW){aO=ax[0];aC(aW!==aO&&aO!=="else"&&aW);ax[7]=aE.substring(ax[7],aL);ax=az.pop()}}}aC(!ax&&aW);ay=ax[3]}var aB,au=aA&&aA.allowCode,ar=[],av=0,az=[],ay=ar,ax=[,,,ar];aE=aE.replace(am,"\\$1");aC(az[0]&&az[0][3].pop()[0]);aE.replace(A,aq);at(aE.length);if(av=ar[ar.length-1]){aC(""+av!==av&&(+av[7]===av[7])&&av[0])}return I(ar,aA||aE,aD)}function I(aq,aD,ax){var aX,aJ,aE,aH,at,aR,aW,aK,au,aY,aQ,aG,ay,aB,aC,aO,av,aI,aN,az,aP,ar,a1,aL,a0,aF,aM,aU,aA=0,aw="",aS="",aV={},aT=aq.length;if(""+aD===aD){aO=ax?'data-link="'+aD.replace(ab," ").slice(1,-1)+'"':aD;aD=0}else{aO=aD.tmplName||"unnamed";if(aN=aD.allowCode){aV.allowCode=true}if(aD.debug){aV.debug=true}aQ=aD.bnds;aC=aD.tmpls}for(aX=0;aX<aT;aX++){aJ=aq[aX];if(""+aJ===aJ){aw+='\nret+="'+aJ+'";'}else{aE=aJ[0];if(aE==="*"){aw+=""+aJ[1]}else{aH=aJ[1];at=aJ[2];az=aJ[3];aR=aJ[4];aS=aJ[5];aP=aJ[7];if(!(a0=aE==="else")){aA=0;if(aQ&&(aG=aJ[6])){aA=aQ.push(aG)}}if(aF=aE===":"){if(aH){aE=aH==="html"?">":aH+aE}if(aS){aM="prm"+aX;aS="try{var "+aM+"=["+at+"][0];}catch(e){"+aM+'="";}\n';at=aM}}else{if(az){av=j(aP,aV);av.tmplName=aO+"/"+aE;I(az,av);aC.push(av)}if(!a0){aI=aE;aL=aw;aw="";ay=aX}a1=aq[aX+1];a1=a1&&a1[0]==="else"}aR+=",args:["+at+"]}";if(aF&&aG||aH&&aE!==">"){aU=new Function("data,view,j,u"," // "+aO+" "+aA+" "+aE+"\n"+aS+"return {"+aR+";");aU.paths=aG;aU._ctxs=aE;if(ax){return aU}aY=true}aw+=(aF?"\n"+(aG?"":aS)+(ax?"return ":"ret+=")+(aY?(aY=true,'c("'+aH+'",view,'+(aG?((aQ[aA-1]=aU),aA):"{"+aR)+");"):aE===">"?(aK=true,"h("+at+");"):(au=true,"(v="+at+")!="+(ax?"=":"")+'u?v:"";')):(aW=true,"{tmpl:"+(az?aC.length:"0")+","+aR+","));if(aI&&!a1){aw="["+aw.slice(0,-1)+"]";if(ax||aG){aw=new Function("data,view,j,u"," // "+aO+" "+aA+" "+aI+"\nreturn "+aw+";");if(aG){(aQ[aA-1]=aw).paths=aG}aw._ctxs=aE;if(ax){return aw}}aw=aL+'\nret+=t("'+aI+'",view,this,'+(aA||aw)+");";aG=0;aI=0}}}}aw="// "+aO+"\nvar j=j||"+(E?"jQuery.":"js")+"views"+(au?",v":"")+(aW?",t=j._tag":"")+(aY?",c=j._cnvt":"")+(aK?",h=j.converters.html":"")+(ax?";\n":',ret="";\n')+(ac.tryCatch?"try{\n":"")+(aV.debug?"debugger;":"")+aw+(ax?"\n":"\nreturn ret;\n")+(ac.tryCatch?"\n}catch(e){return j._err(e);}":"");try{aw=new Function("data,view,j,u",aw)}catch(aZ){Z("Compiled template code:\n\n"+aw,aZ)}if(aD){aD.fn=aw}return aw}function D(av,ar){function aA(aC,aU,aE,aM,aJ,aF,aV,aB,aK,aT,aS,aO,aR,aH,aP,aD,aQ,aG,aI){aJ=aJ||"";aE=aE||aU||aS;aM=aM||aB;if(ar&&aP){ar.push({_jsvOb:aI.slice(az[at-1]+1,aG+1)})}aK=aK||aD||"";function aN(aZ,aY,a1,aW,a3,a2,a0){if(aY){ar&&!ax&&ar.push(aM);if(aY!=="."){var aX=(a1?'view.hlp("'+a1+'")':aW?"view":"data")+(a0?(a3?"."+a3:a1?"":(aW?"":"."+aY))+(a2||""):(a0=a1?"":aW?a3||"":aY,""));aX=aX+(a0?"."+a0:"");return aX.slice(0,9)==="view.data"?aX.slice(5):aX}}return aZ}if(aF){Z(av)}else{var aL=(ay?(ay=!aO,(ay?aC:'"')):au?(au=!aR,(au?aC:'"')):((aE?(at++,az[at]=aG,aE):"")+(aQ?(at?"":aw?(aw=ax=false,"\b"):","):aV?(at&&Z(av),aw=aM,ax=aM.charAt(0)==="~","\b"+aM+":"):aM?(aM.split("^").join(".").replace(G,aN)+(aK?(aq[++at]=true,aK):aJ)):aJ?aJ:aH?((aq[at--]=false,aH)+(aK?(aq[++at]=true,aK):"")):aT?(aq[at]||Z(av),","):aU?"":(ay=aO,au=aR,'"'))));return aL}}var aw,ax,aq={},az={0:-1},at=0,au=false,ay=false;return(av+" ").replace(ah,aA)}function aj(ar,aq){return ar&&ar!==aq?(aq?B(B({},aq),ar):ar):aq&&B({},aq)}for(ak in aa){f(ak,aa[ak])}var M=U.templates,ai=U.converters,K=U.helpers,Y=U.tags,ad=U.sub,ac=U.settings;if(E){T=E;T.fn.render=r}else{T=a.jsviews={};T.isArray=Array&&Array.isArray||function(aq){return Object.prototype.toString.call(aq)==="[object Array]"}}T.render=X;T.views=U;T.templates=M=U.templates;Y({"else":function(){},"if":{render:function(at){var aq=this,ar=(aq.rendering.done||!at&&(arguments.length||!aq.tagCtx.index))?"":(aq.rendering.done=true,aq.selected=aq.tagCtx.index,aq.tagCtx.render());return ar},onUpdate:function(av,au,at){var ar,aq,aw;for(ar=0;(aq=this.tagCtxs[ar])&&aq.args.length;ar++){aq=aq.args[0];aw=!aq!==!at[ar].args[0];if(!!aq||aw){return aw}}return false},flow:true},"for":{render:function(ay){var ax,ar,av=this,au=av.tagCtx,aw=!arguments.length,aq="",at=aw||0;if(!av.rendering.done){if(aw){aq=v}else{if(ay!==v){aq+=au.render(ay);at+=T.isArray(ay)?ay.length:1}}if(av.rendering.done=at){av.selected=au.index}}return aq},onUpdate:function(at,ar,aq){},onArrayChange:function(au,ar){var at,aq=this,av=ar.change;if(this.tagCtxs[1]&&(av==="insert"&&au.target.length===ar.items.length||av==="remove"&&!au.target.length||av==="refresh"&&!ar.oldItems.length!==!au.target.length)){this.refresh()}else{for(at in aq._.arrVws){at=aq._.arrVws[at];if(at.data===au.target){at._.onArrayChange.apply(at,arguments)}}}au.done=true},flow:true},include:{flow:true},"*":{render:function(aq){return aq},flow:true}});function k(aq){return S[aq]}ai({html:function(aq){return aq!=v?String(aq).replace(R,k):""},attr:function(aq){return aq!=v?String(aq).replace(W,k):aq===null?null:""},url:function(aq){return aq!=v?encodeURI(String(aq)):aq===null?null:""}});C()})(this,this.jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.sliderfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-sliderfield")},_createControl:function(){var f=this.options,e=this;if(!f.min){f.min=1}if(!f.max){f.max=100}this.input=a("<input type='text'/>").attr({name:f.id}).attr({min:f.min,max:f.max}).bind("change.inputfield keyup.inputfield",function(i){var h=e.input.val(),g=f.value;if(h!=g){f.value=h;e._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}}).addClass("content ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c ui-input-text")},_edit:function(){this.input.appendTo(this.content).slider(this.options)},_makeResizable:function(){},_design:function(){if(!this.linkStr){this.linkStr=a('<input type="text" disabled="disabled" class="content ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c ui-input-text ui-slider-input"><div role="application" class="ui-slider-track ui-btn-down-c ui-btn-corner-all">			<a href="#"			class="ui-slider-handle ui-btn ui-shadow ui-btn-corner-all ui-btn-up-c"			data-corners="true" data-shadow="true" data-iconshadow="true"			data-wrapperels="span" data-theme="c" role="slider" aria-valuemin="0"			aria-valuemax="100" aria-valuenow="0" aria-valuetext="0" title="0"			aria-labelledby="slider1-label" style="left: 50%;">			<span class="ui-btn-inner">				<span class="ui-btn-text"></span>			</span>		</a>	</div>');this.linkStr.appendTo(this.content.removeClass("content"))}},destroy:function(){return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.togglefield",a.an.sliderfield,{_create:function(){a.an.sliderfield.prototype._create.apply(this,arguments);this.element.addClass("an-togglefield");this.element.unbind("change.widget")},_createControl:function(){var g=this.options,e=this;var f=this.element;g.ontext=g.ontext||"On";g.offtext=g.offtext||"Off";this.input=a('<select >		    <option value="no">'+g.ontext+'</option>		    <option value="yes">'+g.offtext+"</option>		  </select>").attr({name:g.id});g.stop=function(k,j){var i=e.input.val(),h=g.value;if(i!=h){g.value=i;e._trigger("optionchanged",null,{key:"value",value:i,oldValue:h,isTransient:g.isTransient})}if(a(k.target).closest(".widget")[0]==e.element[0]){setTimeout(function(){f.trigger(a.Event(k,{type:"widgetchange"}),e)},20)}};e._trigger("optionchanged",null,{key:"value",value:"no",oldValue:"",isTransient:g.isTransient})},_edit:function(){var f=this.options,e=this;this.input.appendTo(this.content).slider(this.options)},_browser:function(){var g=this.options,e=this;var f=g.value=="no"?g.ontext:g.offtext;this.input.detach();this.content.empty().append(a('<span style="height:32px;line-height:32px;margin:.5em 0;width: 5.8em;display:inline-block;">'+f+"</span>"))},_makeResizable:function(){},_design:function(){if(!this.select){var h=this.options;if(h.mobile){var f=this.element.find(".content").eq(0);f.addClass("codiqa-control ui-field-contain ui-body ui-br");this.select=a("<select />").attr({id:h.id,name:h.id,value:this.value}).addClass("ui-slider-switch").appendTo(f);var g=a("<div />").addClass("ui-slider ui-slider-switch ui-btn-down-c ui-btn-corner-all").appendTo(f);g.html('<span class="ui-slider-label ui-slider-label-a ui-btn-active ui-btn-corner-all" role="img" style="width: 0%;">On</span><span class="ui-slider-label ui-slider-label-b ui-btn-down-c ui-btn-corner-all" role="img" style="width: 100%;">Off</span>');var e=a("<div />").addClass("ui-slider-inneroffset").appendTo(g);a("<a />").addClass("ui-slider-handle ui-slider-handle-snapping ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all").html('<span class="ui-btn-inner"><span class="ui-btn-text"></span></span>').appendTo(e);this.content.removeClass("content")}}},destroy:function(){return a.an.sliderfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.collapsiblewidget",a.an.widget,{_create:function(){a.an.widget.prototype._create.apply(this,arguments);var f=this.options,g={};f.mobile=true;if(f.mobile){f.content_theme=f.content_theme||"";this.element.addClass("an-collapsiblewidget");var e=this.element.children(".content");e.attr("data-content-theme",f.content_theme);this.header=a("<h3>"+f.headerText+"</h3>");this.contentDiv=a("<div></div>");e.prepend(this.header);if(f.link!="raw"){e.append(this.contentDiv)}if(f.collapsedIcon){g.collapsedIcon=f.collapsedIcon}if(f.collapsed){g.collapsed=false}if(f.expandedIcon){g.expandedIcon=f.expandedIcon}if(f.iconpos){g.iconpos=f.iconpos}if(f.theme){g.theme=f.theme}this.opts=g}},_browser:function(){this._edit()},_edit:function(){var g=this.options,f=g.link;var e=this.element.children(".content");this.option("contextmenu2",false);this.content[0].contentEditable=false;e.collapsible&&e.collapsible(this.opts);if(f&&f!="raw"){this.contentDiv.box({hideTitleBar:true,link:g.link,odbId:g.dbId,targetId:g.targetId,mode:"browser"});this.contentDiv.css("border","0 none")}else{this.contentDiv.append(g.contentText)}},_design:function(){var g=this.options,f=g.link;this.option("contextmenu2",true);this.header.addClass("ui-collapsible-heading").html('<a href="#" class="ui-collapsible-heading-toggle ui-btn ui-fullsize ui-btn-icon-right ui-btn-up-c" data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="span" data-icon="arrow-u" data-iconpos="right" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">'+g.headerText+'<span class="ui-collapsible-heading-status"> click to collapse contents</span></span><span class="ui-icon ui-icon-shadow ui-icon-arrow-d">&nbsp;</span></span></a>');var e=false;if(f&&f!="raw"){this.contentDiv.box({hideTitleBar:true,link:g.link,odbId:g.dbId,targetId:g.targetId,mode:"design"})}else{e=true;this.contentDiv.append(g.contentText)}this.content[0].contentEditable=e},destroy:function(){var f=this.options,e=f.link;if(e&&e!="raw"){this.content.remove()}else{this.content.removeAttr("contenteditable");this.content.removeAttr("data-content-theme");this.header.remove()}this.element.removeClass("an-collapsiblewidget");this.element.unbind("collapsiblewidget");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.navbarwidget",a.an.widget,{_create:function(){var g=this.options;a.an.widget.prototype._create.apply(this,arguments);if(g.mobile){try{this.content.navbar({iconpos:g.iconpos})}catch(f){}}},_makeResizable:function(){},_browser:function(){var e=this.content.find(".an-navbarwidget");a(e).each(function(g,f){a(f).remove()});this.content.find(".c li").css("clear","none")},_edit:function(){var e=this.content.find(".an-navbarwidget");a(e).each(function(g,f){a(f).remove()});this.content.find(".c li").css("clear","none")},_design:function(){var i=this.options;if(i.mobile){var h=a("<div data-role='navbar'/>").attr("id",i.id);var f=a("<ul class='c' />"),g;var e=i.selectItems.length;a(i.selectItems).each(function(q,p){var r=a("<a/>"),s="ui-btn ";var j=a("<span style='display:none;' class='an-navbarwidget' />");j.addClass(i.iconpos||"");if(p.data_transition){r.attr("data-transition",p.data_transition)}if(p.data_icon){j.addClass("ui-icon ui-icon-"+p.data_icon);j.css("display","block");r.attr("data-icon",p.data_icon)}if(i.iconpos){j.addClass("ui-btn-icon-"+i.iconpos)}if(p.data_theme){s+=" ui-btn-up-"+p.data_theme;r.attr("data-theme",p.data_theme)}if(p.data_inline){s+=" ui-btn-inline";r.attr("data-inline",true)}if(p.isMini){s+=" ui-mini";r.attr("data-mini",true)}if(p.href){r.attr("link",p.href)}if(e<=5){g=100/e}else{g="33.33"}if(i.iconpos&&i.iconpos!="bottom"){r.append(j).addClass(s)}r.append(p.label||"Button");if(i.iconpos&&i.iconpos=="bottom"){r.append(j).addClass(s)}f.append(a("<li style='width:"+g+"%;'/>").addClass("ui-block-a").append(r))});h.append(f);this.content.html(h.html())}},destroy:function(){return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.listviewfield",a.an.field,{options:{mode:"browser",value:[]},_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-listviewfield")},_createControl:function(){var f=this,h=this.options,g=this.element;if(h.mobile){var e=this.element.find(".content").eq(0);this.ul_element=a('<ul name="'+h.id+'" data-role="listview" />').appendTo(e);if(h.isInset){this.ul_element.attr("data-inset","true")}if(h.label_theme){this.ul_element.attr("data-divider-theme",h.label_theme)}if(h.data_theme){this.ul_element.attr("data-theme",h.data_theme)}if(h.splitIcon){this.ul_element.attr("data-split-icon",h.splitIcon);this.ul_element.attr("data-split-theme","d")}}},_createLabel:function(){},_makeResizable:function(){},_notify:function(e,f){var g=this.options;if(f!=e){g.value=f;this._trigger("optionchanged",null,{key:"value",value:f,oldValue:e,isTransient:g.isTransient})}},appendValue:function(f){var g=this.options,e=[].concat(g.value);g.value.push(f);this.refresh();this._notify(e,g.value)},insertValue:function(f,g){var h=this.options,e=[].concat(h.value);h.value.splice(f,1,g);this.refresh();this._notify(e,h.value)},delValue:function(f){var g=this.options,e=[].concat(g.value);g.value.splice(f,1);this.refresh();this._notify(e,g.value)},getValue:function(e){var f=this.options;return f.value[e]},replaceValue:function(f,g){var h=this.options,e=[].concat(h.value);h.value[f]=g;this.refresh();this._notify(e,h.value)},_browser:function(){var f=this.options,e="";this.ul_element.empty();f.value=[];a.each(f.selectItems||[],function(h,g){f.value.push(f.selectItems[h].value);e+="<li><a>"+this.label+"</a></li>"});if(f.label){this.ul_element.append('<li data-role="list-divider"><a>'+f.label+"</a></li>")}this.ul_element.append(e);this.ul_element.listview();this.ul_element.data("mobileListview").refresh()},_edit:function(){var f=this.options,e="";this.ul_element.empty();f.value=[];a.each(f.selectItems||[],function(h,g){f.value.push(f.selectItems[h].value);if(f.splitIcon){e+="<li><a>"+this.label+'</a><a href="javascript:;">'+f.splitText+"</a></li>"}else{e+="<li><a>"+this.label+"</a></li>"}});if(f.value.length>0){this._trigger("optionchanged",null,{key:"value",value:f.value,oldValue:[],isTransient:f.isTransient})}if(f.label){this.ul_element.append('<li data-role="list-divider"><a>'+f.label+"</a></li>")}this.ul_element.append(e);if(this.ul_element.listview){this.ul_element.listview();this.ul_element.data("mobileListview").refresh()}},_design:function(){var g=this,i=this.options,f=this.content;if(f.is(".ui-resizable")){c.resizable("destroy")}f.html("");var e=a("<ul />").addClass("codiqa-control ui-listview").appendTo(f);if(!i.label_theme){i.label_theme="c"}if(i.label){e.html('<li data-role="list-divider"><a>'+i.label+"</a></li>")}var h=a("<li />").addClass("ui-li ui-li-divider ui-bar-"+i.label_theme+" ui-first-child").html(i.label).appendTo(e);a.each(i.selectItems||[],function(p,j){button_li=a("<li class='ui-btn ui-btn-icon-right ui-li-has-arrow ui-li' />").appendTo(e);a('<div class="ui-btn-inner ui-li" />').html('<div class="ui-btn-text"><a class="ui-link-inherit" >'+this.label+'</a></div><span class="ui-icon ui-icon-arrow-r ui-icon-shadow"> </span>').appendTo(button_li);if(p==i.selectItems.length-1){button_li.addClass("ui-last-child")}if(i.isInset){e.addClass("ui-listview-inset ui-corner-all ui-shadow")}button_li.addClass("ui-btn-up-"+i.data_theme)})},destroy:function(){this.element.removeClass("an-listviewfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.customhtmlfield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-customhtmlfield")},_createControl:function(){var g=this,j=this.options,h=this.element;if(j.mobile){try{var f=this.element.find(".content").eq(0);var k="";k+=j.customhtml;f.html(k);this.element.context.lastElementChild.lastElementChild.className="customhtml";if(a(".customhtml").listview){a(".customhtml").listview()}}catch(i){}}},_createLabel:function(){this.element.find("label").remove()},_makeResizable:function(){},_browser:function(){},_edit:function(){},_design:function(){var e=this},destroy:function(){this.element.removeClass("an-customhtmlfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.mobilelistview",$.an.view,{options:{printable:false,pagerPosition:"bottom"},_create:function(){$.an.view.prototype._create.apply(this,arguments);var o=this.options,el=this.element;el.addClass("an-mobilelistbview");o.templateTemp=o.view.templateTemp;o.templateSelector=o.view.templateSelector;o.templateConverts=o.view.templateConverts;o.templateContent=o.view.templateContent;this.documents=$(o.templateContent).prependTo(el);if(o.templateTemp){o.templateTemp=$.templates(o.templateTemp)}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_showDocuments:function(){var self=this,o=this.options,html="";if(o.templateTemp){html=o.templateTemp.render(self.docs);$(o.templateSelector,this.documents).html(html)}if($(o.templateSelector).listview){$(o.templateSelector).listview()}else{if(o.templateTemp){$(o.templateSelector,this.documents).attr("data-role","listview").mlist()}}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_docsLoaded:function(){this.refresh()},_design:function(){this._showDocuments()},_browser:function(){this._showDocuments();if($(this.options.templateSelector).listview){$(this.options.templateSelector).listview("refresh")}},save:function(){var value={};$.extend(this.options.view.options,value);return $.an.view.prototype.save.apply(this,arguments)},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&viewid="+o.view._id;print(url)},destroy:function(){this.element.unbind(".formview").removeClass("an-formview show-pager");$.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(V){function K(aT,aQ){function aM(e){return V.isArray(aO.readonly)?(e=V(".dwwl",aB).index(e),aO.readonly[e]):aO.readonly}function aS(t){var r='<div class="dw-bf">',t=ar[t],t=t.values?t:F(t),e=1,W=t.values,p=t.keys||W;V.each(W,function(X,Y){0==e%20&&(r+='</div><div class="dw-bf">');r+='<div class="dw-li dw-v" data-val="'+p[X]+'" style="height:'+al+"px;line-height:"+al+'px;"><div class="dw-i">'+Y+"</div></div>";e++});return r+="</div>"}function aP(e){h=V(".dw-li",e).index(V(".dw-v",e).eq(0));f=V(".dw-li",e).index(V(".dw-v",e).eq(-1));ah=V(".dw-ul",aB).index(e)}function aj(e){var p=aO.headerText;return p?"function"===typeof p?p.call(ag,e):p.replace(/\{value\}/i,e):""}function an(){aN.temp=ax&&null!==aN.val&&aN.val!=ak.val()||null===aN.values?aO.parseValue(ak.val()||"",aN):aN.values.slice(0);az()}function am(p){var e=window.getComputedStyle?getComputedStyle(p[0]):p[0].style,r;U?(V.each(["t","webkitT","MozT","OT","msT"],function(t,W){if(void 0!==e[W+"ransform"]){return r=e[W+"ransform"],!1}}),r=r.split(")")[0].split(", "),p=r[13]||r[5]):p=e.top.replace("px","");return Math.round(i-p/al)}function aR(e,p){clearTimeout(ao[p]);delete ao[p];e.closest(".dwwl").removeClass("dwa")}function aK(p,W,Y,r,X){var e=(i-Y)*al,t=p[0].style;e==aq[W]&&ao[W]||(r&&e!=aq[W]&&aL("onAnimStart",[aB,W,r]),aq[W]=e,t[j+"Transition"]="all "+(r?r.toFixed(3):0)+"s ease-out",U?t[j+"Transform"]="translate3d(0,"+e+"px,0)":t.top=e+"px",ao[W]&&aR(p,W),r&&void 0!==X&&(p.closest(".dwwl").addClass("dwa"),ao[W]=setTimeout(function(){aR(p,W)},1000*r)),ay[W]=Y)}function aF(r,e,W,p,t){!1!==aL("validate",[aB,e,r])&&(V(".dw-ul",aB).each(function(aY){var X=V(this),aW=V('.dw-li[data-val="'+aN.temp[aY]+'"]',X),aX=V(".dw-li",X),Y=aX.index(aW),a0=aX.length,aZ=aY==e||void 0===e;if(!aW.hasClass("dw-v")){for(var aa=aW,Z=0,aV=0;0<=Y-Z&&!aa.hasClass("dw-v");){Z++,aa=aX.eq(Y-Z)}for(;Y+aV<a0&&!aW.hasClass("dw-v");){aV++,aW=aX.eq(Y+aV)}(aV<Z&&aV&&2!==p||!Z||0>Y-Z||1==p)&&aW.hasClass("dw-v")?Y+=aV:(aW=aa,Y-=Z)}if(!aW.hasClass("dw-sel")||aZ){aN.temp[aY]=aW.attr("data-val"),V(".dw-sel",X).removeClass("dw-sel"),aW.addClass("dw-sel"),aK(X,aY,Y,aZ?r:0.1,aZ?t:!1)}}),ac=aO.formatResult(aN.temp),"inline"==aO.display?az(W,0,!0):V(".dwv",aB).html(aj(ac)),W&&aL("onChange",[ac]))}function aL(p,r){var e;r.push(aN);V.each([b.defaults,aC,aQ],function(t,W){W[p]&&(e=W[p].apply(ag,r))});return e}function aI(Y,Z,aa,t,W){var Z=Math.max(h,Math.min(Z,f)),e=V(".dw-li",Y).eq(Z),p=void 0===W?Z:W,r=ah,X=t?Z==p?0.1:Math.abs((Z-p)*aO.timeUnit):0;aN.temp[r]=e.attr("data-val");aK(Y,r,Z,X,W);setTimeout(function(){aF(X,r,!0,aa,W)},10)}function I(e){var p=ay[ah]+1;aI(e,p>f?h:p,1,!0)}function E(e){var p=ay[ah]-1;aI(e,p<h?f:p,2,!0)}function az(p,r,t,e){s&&!t&&aF(r);ac=aO.formatResult(aN.temp);e||(aN.values=aN.temp.slice(0),aN.val=ac);p&&ax&&ak.val(ac).trigger("change")}var i,al,ac,aB,B,af,v,aU,ad,w,av,b,ab,aA,ap,aE,q,aJ,u,a,h,f,ai,ah,au,D,aN=this,aH=V.mobiscroll,ag=aT,ak=V(ag),aO=k({},L),aC={},ao={},ay={},aq={},ar=[],ax=ak.is("input"),s=!1,at=function(e){g(e)&&!Q&&!aM(this)&&!aA&&(e.preventDefault(),Q=!0,ap="clickpick"!=aO.mode,ai=V(".dw-ul",this),aP(ai),a=(aE=void 0!==ao[ah])?am(ai):ay[ah],q=C(e,"Y"),aJ=new Date,u=q,aK(ai,ah,a,0.001),ap&&ai.closest(".dwwl").addClass("dwa"),V(document).bind(P,aw).bind(x,ae))},aw=function(e){ap&&(e.preventDefault(),e.stopPropagation(),u=C(e,"Y"),aK(ai,ah,Math.max(h-1,Math.min(a+(q-u)/al,f+1))));aE=!0},ae=function(){var t=new Date-aJ,W=Math.max(h-1,Math.min(a+(q-u)/al,f+1)),e,p=ai.offset().top;300>t?(t=(u-q)/t,e=t*t/aO.speedUnit,0>u-q&&(e=-e)):e=u-q;t=Math.round(a-e/al);if(!e&&!aE){var p=Math.floor((u-p)/al),r=V(".dw-li",ai).eq(p);e=ap;!1!==aL("onValueTap",[r])?t=p:e=!0;e&&(r.addClass("dw-hl"),setTimeout(function(){r.removeClass("dw-hl")},200))}ap&&aI(ai,t,0,!0,Math.round(W));Q=!1;ai=null;V(document).unbind(P,aw).unbind(x,ae)},z=function(r){V(document).bind(x,aD);V(this).hasClass("dwb-d")||V(this).addClass("dwb-a");if(V(this).hasClass("dwwb")){var t=V(this).closest(".dwwl");if(g(r)&&!aM(t)&&!t.hasClass("dwa")){r.stopPropagation();r.preventDefault();aA=!0;var e=t.find(".dw-ul"),p=V(this).hasClass("dwwbp")?I:E;aP(e);clearInterval(au);au=setInterval(function(){p(e)},aO.delay);p(e)}}},aD=function(){aA&&(clearInterval(au),aA=!1);V(document).unbind(x,aD);V(".dwb-a",aB).removeClass("dwb-a")},aG=function(e){if(!aM(this)){e.preventDefault();var e=e.originalEvent,e=e.wheelDelta?e.wheelDelta/120:e.detail?-e.detail/3:0,p=V(".dw-ul",this);aP(p);aI(p,Math.round(ay[ah]-e),0>e?1:2)}};aN.position=function(aV){if(!("inline"==aO.display||B===V(window).width()&&v===V(window).height()&&aV||!1===aL("onPosition",[aB]))){var aW,aX,W,Z,e,p,t,aa,aY,aZ=0,Y=0,aV=V(window).scrollTop();Z=V(".dwwr",aB);var X=V(".dw",aB),r={};e=void 0===aO.anchor?ak:aO.anchor;B=V(window).width();v=V(window).height();af=(af=window.innerHeight)||v;/modal|bubble/.test(aO.display)&&(V(".dwc",aB).each(function(){aW=V(this).outerWidth(!0);aZ+=aW;Y=aW>Y?aW:Y}),aW=aZ>B?Y:aZ,Z.width(aW).css("white-space",aZ>B?"":"nowrap"));aU=X.outerWidth();ad=X.outerHeight(!0);"modal"==aO.display?(aX=(B-aU)/2,W=aV+(af-ad)/2):"bubble"==aO.display?(aY=!0,aa=V(".dw-arrw-i",aB),aX=e.offset(),p=aX.top,t=aX.left,Z=e.outerWidth(),e=e.outerHeight(),aX=t-(X.outerWidth(!0)-Z)/2,aX=aX>B-aU?B-(aU+20):aX,aX=0<=aX?aX:20,W=p-ad,W<aV||p>aV+af?(X.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),W=p+e):X.removeClass("dw-bubble-bottom").addClass("dw-bubble-top"),aa=aa.outerWidth(),Z=t+Z/2-(aX+(aU-aa)/2),V(".dw-arr",aB).css({left:Math.max(0,Math.min(Z,aa))})):(r.width="100%","top"==aO.display?W=aV:"bottom"==aO.display&&(W=aV+af-ad));r.top=0>W?0:W;r.left=aX;X.css(r);V(".dw-persp",aB).height(0).height(W+ad>V(document).height()?W+ad:V(document).height());aY&&(W+ad>aV+af||p>aV+af)&&V(window).scrollTop(W+ad-af)}};aN.enable=function(){aO.disabled=!1;ax&&ak.prop("disabled",!1)};aN.disable=function(){aO.disabled=!0;ax&&ak.prop("disabled",!0)};aN.setValue=function(r,e,t,p){aN.temp=V.isArray(r)?r.slice(0):aO.parseValue.call(ag,r+"",aN);az(e,t,!1,p)};aN.getValue=function(){return aN.values};aN.getValues=function(){var e=[],p;for(p in aN._selectedValues){e.push(aN._selectedValues[p])}return e};aN.changeWheel=function(e,t){if(aB){var p=0,r=e.length;V.each(aO.wheels,function(W,X){V.each(X,function(Y,Z){if(-1<V.inArray(p,e)&&(ar[p]=Z,V(".dw-ul",aB).eq(p).html(aS(p)),r--,!r)){return aN.position(),aF(t,void 0,!0),!1}p++});if(!r){return !1}})}};aN.isVisible=function(){return s};aN.tap=function(p,r){var e,t;aO.tap&&p.bind("touchstart",function(W){W.preventDefault();e=C(W,"X");t=C(W,"Y")}).bind("touchend",function(W){20>Math.abs(C(W,"X")-e)&&20>Math.abs(C(W,"Y")-t)&&r.call(this,W);J=!0;setTimeout(function(){J=!1},300)});p.bind("click",function(W){J||r.call(this,W)})};aN.show=function(e){if(aO.disabled||s){return !1}"top"==aO.display&&(w="slidedown");"bottom"==aO.display&&(w="slideup");an();aL("onBeforeShow",[]);var t=0,p="";w&&!e&&(p="dw-"+w+" dw-in");var r='<div class="'+aO.theme+" dw-"+aO.display+(A?" dw"+A:"")+'">'+("inline"==aO.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dw-persp"><div class="dwo"></div><div class="dw dwbg '+p+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div><div class="dwwr">'+(aO.headerText?'<div class="dwv"></div>':""))+'<div class="dwcc">';V.each(aO.wheels,function(W,X){r+='<div class="dwc'+("scroller"!=aO.mode?" dwpm":" dwsc")+(aO.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>';V.each(X,function(Z,Y){ar[t]=Y;r+='<td><div class="dwwl dwrc dwwl'+t+'">'+("scroller"!=aO.mode?'<div class="dwb-e dwwb dwwbp" style="height:'+al+"px;line-height:"+al+'px;"><span>+</span></div><div class="dwb-e dwwb dwwbm" style="height:'+al+"px;line-height:"+al+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+(Y.label||Z)+'</div><div class="dwww"><div class="dww" style="height:'+aO.rows*al+"px;min-width:"+aO.width+'px;"><div class="dw-ul">';r+=aS(t);r+='</div><div class="dwwol"></div></div><div class="dwwo"></div></div><div class="dwwol"></div></div></td>';t++});r+="</tr></table></div></div>"});r+="</div>"+("inline"!=aO.display?'<div class="dwbc'+(aO.button3?" dwbc-p":"")+'"><span class="dwbw dwb-s"><span class="dwb dwb-e">'+aO.setText+"</span></span>"+(aO.button3?'<span class="dwbw dwb-n"><span class="dwb dwb-e">'+aO.button3Text+"</span></span>":"")+'<span class="dwbw dwb-c"><span class="dwb dwb-e">'+aO.cancelText+"</span></span></div></div>":"")+"</div></div></div>";aB=V(r);aF();aL("onMarkupReady",[aB]);"inline"!=aO.display?(aB.appendTo("body"),w&&!e&&(aB.addClass("dw-trans"),setTimeout(function(){aB.removeClass("dw-trans").find(".dw").removeClass(p)},350))):ak.is("div")?ak.html(aB):aB.insertAfter(ak);aL("onMarkupInserted",[aB]);s=!0;b.init(aB,aN);"inline"!=aO.display&&(aN.tap(V(".dwb-s span",aB),function(){if(aN.hide(false,"set")!==false){az(true,0,true);aL("onSelect",[aN.val])}}),aN.tap(V(".dwb-c span",aB),function(){aN.cancel()}),aO.button3&&aN.tap(V(".dwb-n span",aB),aO.button3),aO.scrollLock&&aB.bind("touchmove",function(W){ad<=af&&aU<=B&&W.preventDefault()}),V("input,select,button").each(function(){this.disabled||V(this).addClass("dwtd").prop("disabled",true).data("autocomplete",V(this).attr("autocomplete")).attr("autocomplete","off")}),aN.position(),V(window).bind("orientationchange.dw resize.dw",function(){clearTimeout(av);av=setTimeout(function(){aN.position(true)},100)}));aB.delegate(".dwwl","DOMMouseScroll mousewheel",aG).delegate(".dwb-e",H,z).delegate(".dwwl",H,at);aL("onShow",[aB,ac])};aN.hide=function(p,e){if(!s||!1===aL("onClose",[ac,e])){return !1}V(".dwtd").each(function(){V(this).prop("disabled",!1).removeClass("dwtd");V(this).data("autocomplete")?V(this).attr("autocomplete",V(this).data("autocomplete")):V(this).removeAttr("autocomplete")});ak.blur();aB&&("inline"!=aO.display&&w&&!p?(aB.addClass("dw-trans").find(".dw").addClass("dw-"+w+" dw-out"),setTimeout(function(){aB.remove();aB=null},350)):(aB.remove(),aB=null),s=!1,aq={},V(window).unbind(".dw"))};aN.cancel=function(){!1!==aN.hide(!1,"cancel")&&aL("onCancel",[aN.val])};aN.init=function(e){b=k({defaults:{},init:R},aH.themes[e.theme||aO.theme]);ab=aH.i18n[e.lang||aO.lang];k(aQ,e);k(aO,b.defaults,ab,aQ);aN.settings=aO;ak.unbind(".dw");if(e=aH.presets[aO.preset]){aC=e.call(ag,aN),k(aO,aC,aQ)}i=Math.floor(aO.rows/2);al=aO.height;w=aO.animate;s&&aN.hide();"inline"==aO.display?aN.show():(an(),ax&&aO.showOnFocus&&(void 0===D&&(D=ag.readOnly),ag.readOnly=!0,ak.bind("focus.dw",function(){aN.show()})))};aN.trigger=function(e,p){return aL(e,p)};aN.option=function(p,r){var e={};"object"===typeof p?e=p:e[p]=r;aN.init(e)};aN.destroy=function(){aN.hide();ak.unbind(".dw");delete M[ag.id];ax&&(ag.readOnly=D)};aN.getInst=function(){return aN};aN.values=null;aN.val=null;aN.temp=null;aN._selectedValues={};aN.init(aQ)}function S(f){for(var e in f){if(void 0!==O[f[e]]){return !0}}return !1}function g(b){if("touchstart"===b.type){N=!0}else{if(N){return N=!1}}return !0}function C(f,e){var i=f.originalEvent,h=f.changedTouches;return h||i&&i.changedTouches?i?i.changedTouches[0]["page"+e]:h[0]["page"+e]:f["page"+e]}function F(a){var e={values:[],keys:[]};V.each(a,function(b,f){e.keys.push(b);e.values.push(f)});return e}function T(f,e,i){var h=f;if("object"===typeof e){return f.each(function(){this.id||(G+=1,this.id="mobiscroll"+G);M[this.id]=new K(this,e)})}"string"===typeof e&&f.each(function(){var b;if((b=M[this.id])&&b[e]){if(b=b[e].apply(this,Array.prototype.slice.call(i,1)),void 0!==b){return h=b,!1}}});return h}var Q,J,N,G=(new Date).getTime(),M={},R=function(){},O=document.createElement("modernizr").style,U=S(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),A=function(){var f=["Webkit","Moz","O","ms"],e;for(e in f){if(S([f[e]+"Transform"])){return"-"+f[e].toLowerCase()}}return""}(),j=A.replace(/^\-/,"").replace("moz","Moz"),k=V.extend,H="touchstart mousedown",P="touchmove mousemove",x="touchend mouseup",L={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",lang:"en-US",setText:"Set",cancelText:"Cancel",scrollLock:!0,tap:!0,speedUnit:0.0012,timeUnit:0.1,formatResult:function(b){return b.join(" ")},parseValue:function(a,q){var p=a.split(" "),i=[],e=0,h;V.each(q.settings.wheels,function(f,r){V.each(r,function(s,t){t=t.values?t:F(t);h=t.keys||t.values;-1!==V.inArray(p[e],h)?i.push(p[e]):i.push(h[0]);e++})});return i}};V(document).bind("mouseover mouseup mousedown click",function(b){if(J){return b.stopPropagation(),b.preventDefault(),!1}});V.fn.mobiscroll=function(a){k(this,V.mobiscroll.shorts);return T(this,a,arguments)};V.mobiscroll=V.mobiscroll||{setDefaults:function(b){k(L,b)},presetShort:function(b){this.shorts[b]=function(a){return T(this,k(a,{preset:b}),arguments)}},shorts:{},presets:{},themes:{},i18n:{}};V.scroller=V.scroller||V.mobiscroll;V.fn.scroller=V.fn.scroller||V.fn.mobiscroll})(jQuery);(function(b){b.mobiscroll.i18n.hu=b.extend(b.mobiscroll.i18n.hu,{setText:"OK",cancelText:"M\u00e9gse",dateFormat:"dd.mm.yy",dateOrder:"ddmmyy",dayNames:"Vas\u00e1rnap,H\u00e9tf\u0151,Kedd,Szerda,Cs\u00fct\u00f6rt\u00f6k,P\u00e9ntek,Szombat".split(","),dayNamesShort:"Va,H\u00e9,Ke,Sze,Cs\u00fc,P\u00e9,Szo".split(","),dayText:"Nap",hourText:"\u00d3ra",minuteText:"Perc",monthNames:"Janu\u00e1r,Febru\u00e1r,M\u00e1rcius,\u00c1prilis,M\u00e1jus,J\u00fanius,J\u00falius,Augusztus,Szeptember,Okt\u00f3ber,November,December".split(","),monthNamesShort:"Jan,Feb,M\u00e1r,\u00c1pr,M\u00e1j,J\u00fan,J\u00fal,Aug,Szep,Okt,Nov,Dec".split(","),monthText:"H\u00f3nap",secText:"M\u00e1sodperc",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"\u00c9v",nowText:"Most",dateText:"D\u00e1tum",timeText:"Id\u0151",calendarText:"Napt\u00e1r",wholeText:"Eg\u00e9sz",fractionText:"T\u00f6rt",unitText:"Egys\u00e9g",labels:"\u00c9v,H\u00f3nap,Nap,\u00d3ra,Perc,M\u00e1sodperc,".split(","),labelsShort:"\u00c9v,H\u00f3.,Nap,\u00d3ra,Perc,Mp.,".split(","),startText:"Ind\u00edt",stopText:"Meg\u00e1ll\u00edt",resetText:"Vissza\u00e1ll\u00edt",lapText:"Lap",hideText:"Elrejt"})})(jQuery);(function(b){b.mobiscroll.i18n.de=b.extend(b.mobiscroll.i18n.de,{setText:"OK",cancelText:"Abbrechen",dateFormat:"dd.mm.yy",dateOrder:"ddmmyy",dayNames:"Sonntag,Montag,Dienstag,Mittwoch,Donnerstag,Freitag,Samstag".split(","),dayNamesShort:"So,Mo,Di,Mi,Do,Fr,Sa".split(","),dayText:"Tag",hourText:"Stunde",minuteText:"Minuten",monthNames:"Januar,Februar,M\u00e4rz,April,Mai,Juni,Juli,August,September,Oktober,November,Dezember".split(","),monthNamesShort:"Jan,Feb,M\u00e4r,Apr,Mai,Jun,Jul,Aug,Sep,Okt,Nov,Dez".split(","),monthText:"Monat",secText:"Sekunden",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Jahr",nowText:"Jetzt",dateText:"Datum",timeText:"Zeit",calendarText:"Kalender",wholeText:"Ganze Zahl",fractionText:"Bruchzahl",unitText:"Ma\u00dfeinheit",labels:"Jahre,Monate,Tage,Stunden,Minuten,Sekunden,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Start",stopText:"Stop",resetText:"Reset",lapText:"Lap",hideText:"Hide"})})(jQuery);(function(b){b.mobiscroll.i18n.es=b.extend(b.mobiscroll.i18n.es,{setText:"Aceptar",cancelText:"Cancelar",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"Domingo,Lunes,Martes,Mi&#xE9;rcoles,Jueves,Viernes,S&#xE1;bado".split(","),dayNamesShort:"Do,Lu,Ma,Mi,Ju,Vi,S&#xE1;".split(","),dayText:"D&#237;a",hourText:"Horas",minuteText:"Minutos",monthNames:"Enero,Febrero,Marzo,Abril,Mayo,Junio,Julio,Agosto,Septiembre,Octubre,Noviembre,Diciembre".split(","),monthNamesShort:"Ene,Feb,Mar,Abr,May,Jun,Jul,Ago,Sep,Oct,Nov,Dic".split(","),monthText:"Mes",secText:"Segundos",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"A&ntilde;o",nowText:"Ahora",dateText:"Fecha",timeText:"Tiempo",calendarText:"Calendario",wholeText:"Entero",fractionText:"Fracci\u00f3n",unitText:"Unidad",labels:"A\u00f1os,Meses,D\u00edas,Horas,Minutos,Segundos,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Iniciar",stopText:"Det\u00e9ngase",resetText:"Reinicializar",lapText:"Lap",hideText:"Esconder"})})(jQuery);(function(b){b.mobiscroll.i18n.fr=b.extend(b.mobiscroll.i18n.fr,{setText:"Termin\u00e9",cancelText:"Annuler",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"&#68;imanche,Lundi,Mardi,Mercredi,Jeudi,Vendredi,Samedi".split(","),dayNamesShort:"&#68;im.,Lun.,Mar.,Mer.,Jeu.,Ven.,Sam.".split(","),dayText:"Jour",monthText:"Mois",monthNames:"Janvier,F\u00e9vrier,Mars,Avril,Mai,Juin,Juillet,Ao\u00fbt,Septembre,Octobre,Novembre,D\u00e9cembre".split(","),monthNamesShort:"Janv.,F\u00e9vr.,Mars,Avril,Mai,Juin,Juil.,Ao\u00fbt,Sept.,Oct.,Nov.,D\u00e9c.".split(","),hourText:"Heures",minuteText:"Minutes",secText:"Secondes",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Ann\u00e9e",nowText:"Maintenant",dateText:"Date",timeText:"Heure",calendarText:"Calendrier",wholeText:"Entier",fractionText:"Fraction",unitText:"Unit\u00e9",labels:"Ans,Mois,Jours,Heures,Minutes,Secondes,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Ind\u00edt",stopText:"Meg\u00e1ll\u00edt",resetText:"Vissza\u00e1ll\u00edt",lapText:"Lap",hideText:"Elrejt"})})(jQuery);(function(b){b.mobiscroll.i18n.it=b.extend(b.mobiscroll.i18n.it,{setText:"OK",cancelText:"Annulla",dateFormat:"dd-mm-yyyy",dateOrder:"ddmmyy",dayNames:"Domenica,Luned&Igrave;,Merted&Igrave;,Mercoled&Igrave;,Gioved&Igrave;,Venerd&Igrave;,Sabato".split(","),dayNamesShort:"Do,Lu,Ma,Me,Gi,Ve,Sa".split(","),dayText:"Giorno",hourText:"Ore",minuteText:"Minuti",monthNames:"Gennaio,Febbraio,Marzo,Aprile,Maggio,Giugno,Luglio,Agosto,Settembre,Ottobre,Novembre,Dicembre".split(","),monthNamesShort:"Gen,Feb,Mar,Apr,Mag,Giu,Lug,Ago,Set,Ott,Nov,Dic".split(","),monthText:"Mese",secText:"Secondi",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Anno",dateText:"Data",timeText:"Volta",calendarText:"Calendario",wholeText:"Intero",fractionText:"Frazione",unitText:"Unit\u00e0",labels:"Anni,Mesi,Giorni,Ore,Minuti,Secondi,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Inizio",stopText:"Arresto",resetText:"Ripristina",lapText:"Lap",hideText:"Nascondi"})})(jQuery);(function(b){b.mobiscroll.i18n.no=b.extend(b.mobiscroll.i18n.no,{setText:"OK",cancelText:"Avbryt",dateFormat:"dd.mm.yy",dateOrder:"ddmmyy",dayNames:"S\u00f8ndag,Mandag,Tirsdag,Onsdag,Torsdag,Fredag,L\u00f8rdag".split(","),dayNamesShort:"S\u00f8,Ma,Ti,On,To,Fr,L\u00f8".split(","),dayText:"Dag",hourText:"Time",minuteText:"Minutt",monthNames:"Januar,Februar,Mars,April,Mai,Juni,Juli,August,September,Oktober,November,Desember".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,Mai,Jun,Jul,Aug,Sep,Okt,Nov,Des".split(","),monthText:"M\u00e5ned",secText:"Sekund",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"\u00c5r",nowText:"N\u00e5",dateText:"Dato",timeText:"Tid",calendarText:"Kalender",wholeText:"Hele",fractionText:"Fraksjon",unitText:"Enhet",labels:"\u00c5r,M\u00e5neder,Dager,Timer,Minutter,Sekunder,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Start",stopText:"Stopp",resetText:"Tilbakestille",lapText:"Runde",hideText:"Skjul"})})(jQuery);(function(b){b.mobiscroll.i18n["pt-BR"]=b.extend(b.mobiscroll.i18n["pt-BR"],{setText:"Selecionar",cancelText:"Cancelar",dateFormat:"dd/mm/yy",dateOrder:"ddMMyy",dayNames:"Domingo,Segunda-feira,Ter\u00e7a-feira,Quarta-feira,Quinta-feira,Sexta-feira,S\u00e1bado".split(","),dayNamesShort:"Dom,Seg,Ter,Qua,Qui,Sex,S\u00e1b".split(","),dayText:"Dia",hourText:"Hora",minuteText:"Minutos",monthNames:"Janeiro,Fevereiro,Mar\u00e7o,Abril,Maio,Junho,Julho,Agosto,Setembro,Outubro,Novembro,Dezembro".split(","),monthNamesShort:"Jan,Fev,Mar,Abr,Mai,Jun,Jul,Ago,Set,Out,Nov,Dez".split(","),monthText:"M\u00eas",secText:"Segundo",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Ano",dateText:"Data",timeText:"Tempo",calendarText:"Calend\u00e1rio",wholeText:"Inteiro",fractionText:"Fra\u00e7\u00e3o",unitText:"Unidade",labels:"Anos,Meses,Dias,Horas,Minutos,Segundos,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Come\u00e7ar",stopText:"Pare",resetText:"Reinicializar",lapText:"Lap",hideText:"Esconder"})})(jQuery);(function(b){b.mobiscroll.i18n.zh=b.extend(b.mobiscroll.i18n.zh,{setText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"\u5468\u65e5,\u5468\u4e00,\u5468\u4e8c,\u5468\u4e09,\u5468\u56db,\u5468\u4e94,\u5468\u516d".split(","),dayNamesShort:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),dayText:"\u65e5",hourText:"\u65f6",minuteText:"\u5206",monthNames:"1\u6708,2\u6708,3\u6708,4\u6708,5\u6708,6\u6708,7\u6708,8\u6708,9\u6708,10\u6708,11\u6708,12\u6708".split(","),monthNamesShort:"\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d,\u4e03,\u516b,\u4e5d,\u5341,\u5341\u4e00,\u5341\u4e8c".split(","),monthText:"\u6708",secText:"\u79d2",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"\u5e74",nowText:"\u5f53\u524d",dateText:"\u65e5",timeText:"\u65f6\u95f4",calendarText:"\u65e5\u5386",wholeText:"Whole",fractionText:"Fraction",unitText:"Unit",labels:"Years,Months,Days,Hours,Minutes,Seconds,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Start",stopText:"Stop",resetText:"Reset",lapText:"Lap",hideText:"Hide"})})(jQuery);(function(b){b.mobiscroll.i18n.nl=b.extend(b.mobiscroll.i18n.nl,{setText:"Instellen",cancelText:"Annuleer",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"Zondag,Maandag,Dinsdag,Woensdag,Donderdag,Vrijdag,Zaterdag".split(","),dayNamesShort:"Zo,Ma,Di,Wo,Do,Vr,Za".split(","),dayText:"Dag",hourText:"Uur",minuteText:"Minuten",monthNames:"Januari,Februari,Maart,April,Mei,Juni,Juli,Augustus,September,Oktober,November,December".split(","),monthNamesShort:"Jan,Feb,Mrt,Apr,Mei,Jun,Jul,Aug,Sep,Okt,Nov,Dec".split(","),monthText:"Maand",secText:"Seconden",timeFormat:"hh:ii A",timeWheels:"hhiiA",yearText:"Jaar",nowText:"Nu",dateText:"Datum",timeText:"Tijd",calendarText:"Kalender",wholeText:"geheel",fractionText:"fractie",unitText:"eenheid",labels:"Jaren,Maanden,Dagen,Uren,Minuten,Seconden,".split(","),labelsShort:"j,m,d,u,min,sec,".split(","),startText:"Start",stopText:"Stop",resetText:"Reset",lapText:"Lap",hideText:"Verbergen"})})(jQuery);(function(b){var g=b.mobiscroll,h=new Date,i={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:h.getFullYear()-100,endYear:h.getFullYear()+1,monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),dayNamesShort:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",nowText:"Now",showNow:!1,stepHour:1,stepMinute:1,stepSecond:1,separator:" "},f=function(af){function ah(j,p,e){return void 0!==Z[p]?+j[Z[p]]:void 0!==e?e:Y[ad[p]]?Y[ad[p]]():ad[p](Y)}function ac(j,p,e,q){j.push({values:e,keys:p,label:q})}function O(e,j){return Math.floor(e/j)*j}function V(e){var j=ah(e,"h",0);return new Date(ah(e,"y"),ah(e,"m"),ah(e,"d",1),ah(e,"a")?j+12:j,ah(e,"i",0),ah(e,"s",0))}var M=b(this),T={},ae;if(M.is("input")){switch(M.attr("type")){case"date":ae="yy-mm-dd";break;case"datetime":ae="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":ae="yy-mm-ddTHH:ii:ss";break;case"month":ae="yy-mm";T.dateOrder="mmyy";break;case"time":ae="HH:ii:ss"}var W=M.attr("min"),M=M.attr("max");W&&(T.minDate=g.parseDate(ae,W));M&&(T.maxDate=g.parseDate(ae,M))}var ai,I,G,L,P,W=b.extend({},af.settings),ab=b.extend(af.settings,i,T,W),H=0,M=[],Q=[],Z={},ad={y:"getFullYear",m:"getMonth",d:"getDate",h:function(e){e=e.getHours();e=K&&12<=e?e-12:e;return O(e,C)},i:function(e){return O(e.getMinutes(),a)},s:function(e){return O(e.getSeconds(),k)},a:function(e){return U&&11<e.getHours()?1:0}},X=ab.preset,ag=ab.dateOrder,aa=ab.timeWheels,E=ag.match(/D/),U=aa.match(/a/i),K=aa.match(/h/),z="datetime"==X?ab.dateFormat+ab.separator+ab.timeFormat:"time"==X?ab.timeFormat:ab.dateFormat,Y=new Date,C=ab.stepHour,a=ab.stepMinute,k=ab.stepSecond,x=ab.minDate||new Date(ab.startYear,0,1),r=ab.maxDate||new Date(ab.endYear,11,31,23,59,59);ae=ae||z;if(X.match(/date/i)){b.each(["y","m","d"],function(e,j){ai=ag.search(RegExp(j,"i"));-1<ai&&Q.push({o:ai,v:j})});Q.sort(function(e,j){return e.o>j.o?1:-1});b.each(Q,function(e,j){Z[j.v]=e});W=[];for(T=0;3>T;T++){if(T==Z.y){H++;G=[];I=[];L=x.getFullYear();P=r.getFullYear();for(ai=L;ai<=P;ai++){I.push(ai),G.push(ag.match(/yy/i)?ai:(ai+"").substr(2,2))}ac(W,I,G,ab.yearText)}else{if(T==Z.m){H++;G=[];I=[];for(ai=0;12>ai;ai++){L=ag.replace(/[dy]/gi,"").replace(/mm/,9>ai?"0"+(ai+1):ai+1).replace(/m/,ai+1),I.push(ai),G.push(L.match(/MM/)?L.replace(/MM/,'<span class="dw-mon">'+ab.monthNames[ai]+"</span>"):L.replace(/M/,'<span class="dw-mon">'+ab.monthNamesShort[ai]+"</span>"))}ac(W,I,G,ab.monthText)}else{if(T==Z.d){H++;G=[];I=[];for(ai=1;32>ai;ai++){I.push(ai),G.push(ag.match(/dd/i)&&10>ai?"0"+ai:ai)}ac(W,I,G,ab.dayText)}}}}M.push(W)}if(X.match(/time/i)){Q=[];b.each(["h","i","s","a"],function(e,j){e=aa.search(RegExp(j,"i"));-1<e&&Q.push({o:e,v:j})});Q.sort(function(e,j){return e.o>j.o?1:-1});b.each(Q,function(e,j){Z[j.v]=H+e});W=[];for(T=H;T<H+4;T++){if(T==Z.h){H++;G=[];I=[];for(ai=0;ai<(K?12:24);ai+=C){I.push(ai),G.push(K&&0==ai?12:aa.match(/hh/i)&&10>ai?"0"+ai:ai)}ac(W,I,G,ab.hourText)}else{if(T==Z.i){H++;G=[];I=[];for(ai=0;60>ai;ai+=a){I.push(ai),G.push(aa.match(/ii/)&&10>ai?"0"+ai:ai)}ac(W,I,G,ab.minuteText)}else{if(T==Z.s){H++;G=[];I=[];for(ai=0;60>ai;ai+=k){I.push(ai),G.push(aa.match(/ss/)&&10>ai?"0"+ai:ai)}ac(W,I,G,ab.secText)}else{T==Z.a&&(H++,I=aa.match(/A/),ac(W,[0,1],I?["AM","PM"]:["am","pm"],ab.ampmText))}}}}M.push(W)}af.setDate=function(p,s,e,t){for(var q in Z){af.temp[Z[q]]=p[ad[q]]?p[ad[q]]():ad[q](p)}af.setValue(af.temp,s,e,t)};af.getDate=function(e){return V(e?af.temp:af.values)};return{button3Text:ab.showNow?ab.nowText:void 0,button3:ab.showNow?function(){af.setDate(new Date,!1,0.3,!0)}:void 0,wheels:M,headerText:function(){return g.formatDate(z,V(af.temp),ab)},formatResult:function(e){return g.formatDate(ae,V(e),ab)},parseValue:function(p){var s=new Date,e,t=[];try{s=g.parseDate(ae,p,ab)}catch(q){}for(e in Z){t[Z[e]]=s[ad[e]]?s[ad[e]]():ad[e](s)}return t},validate:function(p){var q=af.temp,e={y:x.getFullYear(),m:0,d:1,h:0,i:0,s:0,a:0},t={y:r.getFullYear(),m:11,d:31,h:O(K?11:23,C),i:O(59,a),s:O(59,k),a:1},u=!0,s=!0;b.each("y,m,d,a,h,i,s".split(","),function(an,R){if(Z[R]!==void 0){var B=e[R],A=t[R],D=31,S=ah(q,R),ak=b(".dw-ul",p).eq(Z[R]),ap,am;if(R=="d"){ap=ah(q,"y");am=ah(q,"m");A=D=32-(new Date(ap,am,32)).getDate();E&&b(".dw-li",ak).each(function(){var v=b(this),F=v.data("val"),w=(new Date(ap,am,F)).getDay(),F=ag.replace(/[my]/gi,"").replace(/dd/,F<10?"0"+F:F).replace(/d/,F);b(".dw-i",v).html(F.match(/DD/)?F.replace(/DD/,'<span class="dw-day">'+ab.dayNames[w]+"</span>"):F.replace(/D/,'<span class="dw-day">'+ab.dayNamesShort[w]+"</span>"))})}u&&x&&(B=x[ad[R]]?x[ad[R]]():ad[R](x));s&&r&&(A=r[ad[R]]?r[ad[R]]():ad[R](r));if(R!="y"){var al=b(".dw-li",ak).index(b('.dw-li[data-val="'+B+'"]',ak)),j=b(".dw-li",ak).index(b('.dw-li[data-val="'+A+'"]',ak));b(".dw-li",ak).removeClass("dw-v").slice(al,j+1).addClass("dw-v");R=="d"&&b(".dw-li",ak).removeClass("dw-h").slice(D).addClass("dw-h")}S<B&&(S=B);S>A&&(S=A);u&&(u=S==B);s&&(s=S==A);if(ab.invalid&&R=="d"){var aj=[];ab.invalid.dates&&b.each(ab.invalid.dates,function(v,w){w.getFullYear()==ap&&w.getMonth()==am&&aj.push(w.getDate()-1)});if(ab.invalid.daysOfWeek){var ao=(new Date(ap,am,1)).getDay(),J;b.each(ab.invalid.daysOfWeek,function(v,w){for(J=w-ao;J<D;J=J+7){J>=0&&aj.push(J)}})}ab.invalid.daysOfMonth&&b.each(ab.invalid.daysOfMonth,function(v,w){w=(w+"").split("/");w[1]?w[0]-1==am&&aj.push(w[1]-1):aj.push(w[0]-1)});b.each(aj,function(w,v){b(".dw-li",ak).eq(v).removeClass("dw-v")})}q[Z[R]]=S}})}}};b.each(["date","time","datetime"],function(e,j){g.presets[j]=f;g.presetShort(j)});g.formatDate=function(v,w,r){if(!w){return null}var r=b.extend({},i,r),A=function(p){for(var e=0;a+1<v.length&&v.charAt(a+1)==p;){e++,a++}return e},j=function(p,e,q){e=""+e;if(A(p)){for(;e.length<q;){e="0"+e}}return e},z=function(q,p,t,s){return A(q)?s[p]:t[p]},a,u="",k=!1;for(a=0;a<v.length;a++){if(k){"'"==v.charAt(a)&&!A("'")?k=!1:u+=v.charAt(a)}else{switch(v.charAt(a)){case"d":u+=j("d",w.getDate(),2);break;case"D":u+=z("D",w.getDay(),r.dayNamesShort,r.dayNames);break;case"o":u+=j("o",(w.getTime()-(new Date(w.getFullYear(),0,0)).getTime())/86400000,3);break;case"m":u+=j("m",w.getMonth()+1,2);break;case"M":u+=z("M",w.getMonth(),r.monthNamesShort,r.monthNames);break;case"y":u+=A("y")?w.getFullYear():(10>w.getYear()%100?"0":"")+w.getYear()%100;break;case"h":var x=w.getHours(),u=u+j("h",12<x?x-12:0==x?12:x,2);break;case"H":u+=j("H",w.getHours(),2);break;case"i":u+=j("i",w.getMinutes(),2);break;case"s":u+=j("s",w.getSeconds(),2);break;case"a":u+=11<w.getHours()?"pm":"am";break;case"A":u+=11<w.getHours()?"PM":"AM";break;case"'":A("'")?u+="'":k=!0;break;default:u+=v.charAt(a)}}}return u};g.parseDate=function(M,N,K){var z=new Date;if(!M||!N){return z}var N="object"==typeof N?N.toString():N+"",G=b.extend({},i,K),x=G.shortYearCutoff,K=z.getFullYear(),F=z.getMonth()+1,L=z.getDate(),H=-1,O=z.getHours(),z=z.getMinutes(),j=0,k=-1,C=!1,A=function(e){(e=I+1<M.length&&M.charAt(I+1)==e)&&I++;return e},J=function(e){A(e);e=N.substr(E).match(RegExp("^\\d{1,"+("@"==e?14:"!"==e?20:"y"==e?4:"o"==e?3:2)+"}"));if(!e){return 0}E+=e[0].length;return parseInt(e[0],10)},a=function(p,e,q){p=A(p)?q:e;for(e=0;e<p.length;e++){if(N.substr(E,p[e].length).toLowerCase()==p[e].toLowerCase()){return E+=p[e].length,e+1}}return 0},E=0,I;for(I=0;I<M.length;I++){if(C){"'"==M.charAt(I)&&!A("'")?C=!1:E++}else{switch(M.charAt(I)){case"d":L=J("d");break;case"D":a("D",G.dayNamesShort,G.dayNames);break;case"o":H=J("o");break;case"m":F=J("m");break;case"M":F=a("M",G.monthNamesShort,G.monthNames);break;case"y":K=J("y");break;case"H":O=J("H");break;case"h":O=J("h");break;case"i":z=J("i");break;case"s":j=J("s");break;case"a":k=a("a",["am","pm"],["am","pm"])-1;break;case"A":k=a("A",["am","pm"],["am","pm"])-1;break;case"'":A("'")?E++:C=!0;break;default:E++}}}100>K&&(K+=(new Date).getFullYear()-(new Date).getFullYear()%100+(K<=("string"!=typeof x?x:(new Date).getFullYear()%100+parseInt(x,10))?0:-100));if(-1<H){F=1;L=H;do{G=32-(new Date(K,F-1,32)).getDate();if(L<=G){break}F++;L-=G}while(1)}O=new Date(K,F-1,L,-1==k?O:k&&12>O?O+12:!k&&12==O?0:O,z,j);if(O.getFullYear()!=K||O.getMonth()+1!=F||O.getDate()!=L){throw"Invalid date"}return O}})(jQuery);(function(b){var f=b.mobiscroll,g={invalid:[],showInput:!0,inputClass:""},h=function(x){function F(t,p,s,i){for(var r=0;r<p;){var u=b(".dwwl"+r,t),q=Q(i,r,s);b.each(q,function(w,v){b('.dw-li[data-val="'+v+'"]',u).removeClass("dw-v")});r++}}function Q(p,i,u){for(var s=0,r,t=[];s<i;){var q=p[s];for(r in u){if(u[r].key==q){u=u[r].children;break}}s++}for(s=0;s<u.length;){u[s].invalid&&t.push(u[s].key),s++}return t}function N(p,i){for(var q=[];p;){q[--p]=!0}q[i]=!1;return q}function C(S,D,B){var z=0,w,s,v=[],u=G;if(D){for(w=0;w<D;w++){v[w]=[{}]}}for(;z<S.length;){w=v;for(var D=z,t=u,p={keys:[],values:[],label:L[z]},r=0;r<t.length;){p.values.push(t[r].value),p.keys.push(t[r].key),r++}w[D]=[p];w=0;for(D=void 0;w<u.length&&void 0===D;){if(u[w].key==S[z]&&(void 0!==B&&z<=B||void 0===B)){D=w}w++}if(void 0!==D&&u[D].children){z++,u=u[D].children}else{if((s=I(u))&&s.children){z++,u=s.children}else{break}}}return v}function I(p,i){if(!p){return !1}for(var r=0,q;r<p.length;){if(!(q=p[r++]).invalid){return i?r-1:q}}return !1}function A(i,p){b(".dwc",i).css("display","").slice(p).hide()}function H(p,i){var v=[],t=G,s=0,u=!1,r,q;if(void 0!==p[s]&&s<=i){u=0;r=p[s];for(q=void 0;u<t.length&&void 0===q;){t[u].key==p[s]&&!t[u].invalid&&(q=u),u++}}else{q=I(t,!0),r=t[q].key}u=void 0!==q?t[q].children:!1;for(v[s]=r;u;){t=t[q].children;s++;if(void 0!==p[s]&&s<=i){u=0;r=p[s];for(q=void 0;u<t.length&&void 0===q;){t[u].key==p[s]&&!t[u].invalid&&(q=u),u++}}else{q=I(t,!0),q=!1===q?void 0:q,r=t[q].key}u=void 0!==q&&I(t[q].children)?t[q].children:!1;v[s]=r}return{lvl:s+1,nVector:v}}function P(i){var p=[];E=E>M++?E:M;i.children("li").each(function(q){var s=b(this),r=s.clone();r.children("ul,ol").remove();var r=r.html().replace(/^\s\s*/,"").replace(/\s\s*$/,""),t=s.data("invalid")?!0:!1,q={key:s.data("val")||q,value:r,invalid:t,children:null},s=s.children("ul,ol");s.length&&(q.children=P(s));p.push(q)});M--;return p}var J=b.extend({},x.settings),R=b.extend(x.settings,g,J),J=b(this),k,e,a=this.id+"_dummy",E=0,M=0,j={},G=R.wheelArray||P(J),L=function(i){var q=[],p;for(p=0;p<i;p++){q[p]=R.labels&&R.labels[p]?R.labels[p]:p}return q}(E),O=[],K=function(p){for(var i=[],s,r=!0,q=0;r;){if(s=I(p),i[q++]=s.key,r=s.children){p=s.children}}return i}(G),K=C(K,E);b("#"+a).remove();R.showInput&&(k=b('<input type="text" id="'+a+'" value="" class="'+R.inputClass+'" readonly />').insertBefore(J),x.settings.anchor=k,R.showOnFocus&&k.focus(function(){x.show()}));R.wheelArray||J.hide().closest(".ui-field-contain").trigger("create");return{width:50,wheels:K,headerText:!1,onBeforeShow:function(){var i=x.temp;O=i.slice(0);x.settings.wheels=C(i,E,E);e=true},onSelect:function(i){k&&k.val(i)},onChange:function(i){k&&R.display=="inline"&&k.val(i)},onClose:function(){k&&k.blur()},onShow:function(i){b(".dwwl",i).bind("mousedown touchstart",function(){clearTimeout(j[b(".dwwl",i).index(this)])})},validate:function(q,p,v){var t=x.temp;if(p!==void 0&&O[p]!=t[p]||p===void 0&&!e){x.settings.wheels=C(t,null,p);var s=[],u=(p||0)+1,r=H(t,p);if(p!==void 0){x.temp=r.nVector.slice(0)}for(;u<r.lvl;){s.push(u++)}A(q,r.lvl);O=x.temp.slice(0);if(s.length){e=true;x.settings.readonly=N(E,p);clearTimeout(j[p]);j[p]=setTimeout(function(){x.changeWheel(s);x.settings.readonly=false},v*1000);return false}F(q,r.lvl,G,x.temp)}else{r=H(t,t.length);F(q,r.lvl,G,t);A(q,r.lvl)}e=false}}};b.each(["list","image","treelist"],function(i,j){f.presets[j]=h;f.presetShort(j)})})(jQuery);(function(b){var e={inputClass:"",invalid:[],rtl:!1,group:!1,groupLabel:"Groups"};b.mobiscroll.presetShort("select");b.mobiscroll.presets.select=function(S){function a(){var h,s=0,q=[],p=[],i=[[]];T.group?(T.rtl&&(s=1),b("optgroup",P).each(function(f){q.push(b(this).attr("label"));p.push(f)}),i[s]=[{values:q,keys:p,label:x}],h=F,s+=T.rtl?-1:1):h=P;q=[];p=[];b("option",h).each(function(){var f=b(this).attr("value");q.push(b(this).text());p.push(f);b(this).prop("disabled")&&j.push(f)});i[s]=[{values:q,keys:p,label:x}];return i}function A(i,h){var s=[];if(G){var q=[],p=0;for(p in S._selectedValues){q.push(H[p]),s.push(p)}N.val(q.join(", "))}else{N.val(i),s=h?S.values[r]:null}h&&(M=!0,P.val(s).trigger("change"))}var C=b.extend({},S.settings),T=b.extend(S.settings,e,C),P=b(this),G=P.prop("multiple"),C=this.id+"_dummy",L=G?P.val()?P.val()[0]:b("option",P).attr("value"):P.val(),F=P.find('option[value="'+L+'"]').parent(),K=F.index()+"",R=K,M;b('label[for="'+this.id+'"]').attr("for",C);var U=b('label[for="'+C+'"]'),x=void 0!==T.label?T.label:U.length?U.text():P.attr("name"),j=[],k=[],H={},O,r,J,N,Q=T.readonly;T.group&&!b("optgroup",P).length&&(T.group=!1);T.invalid.length||(T.invalid=j);T.group?T.rtl?(O=1,r=0):(O=0,r=1):(O=-1,r=0);b("#"+C).remove();N=b('<input type="text" id="'+C+'" class="'+T.inputClass+'" readonly />').insertBefore(P);b("option",P).each(function(){H[b(this).attr("value")]=b(this).text()});T.showOnFocus&&N.focus(function(){S.show()});C=P.val()||[];U=0;for(U;U<C.length;U++){S._selectedValues[C[U]]=C[U]}A(H[L]);P.unbind(".dwsel").bind("change.dwsel",function(){M||S.setValue(G?P.val()||[]:[P.val()],true);M=false}).hide().closest(".ui-field-contain").trigger("create");S._setValue||(S._setValue=S.setValue);S.setValue=function(f,t,q,p,s){var h=b.isArray(f)?f[0]:f;L=h!==void 0?h:b("option",P).attr("value");if(G){S._selectedValues={};h=0;for(h;h<f.length;h++){S._selectedValues[f[h]]=f[h]}}if(T.group){F=P.find('option[value="'+L+'"]').parent();R=F.index();f=T.rtl?[L,F.index()]:[F.index(),L];if(R!==K){T.wheels=a();S.changeWheel([r]);K=R+""}}else{f=[L]}S._setValue(f,t,q,p,s);if(t){t=G?true:L!==P.val();A(H[L],t)}};S.getValue=function(f){return(f?S.temp:S.values)[r]};return{width:50,wheels:void 0,headerText:!1,multiple:G,anchor:N,formatResult:function(f){return H[f[r]]},parseValue:function(){var f=P.val()||[],g=0;if(G){S._selectedValues={};for(g;g<f.length;g++){S._selectedValues[f[g]]=f[g]}}L=G?P.val()?P.val()[0]:b("option",P).attr("value"):P.val();F=P.find('option[value="'+L+'"]').parent();R=F.index();K=R+"";return T.group&&T.rtl?[L,R]:T.group?[R,L]:[L]},validate:function(f,q,h){if(q===void 0&&G){var g=S._selectedValues,p=0;b(".dwwl"+r+" .dw-li",f).removeClass("dw-msel");for(p in g){b(".dwwl"+r+' .dw-li[data-val="'+g[p]+'"]',f).addClass("dw-msel")}}if(q===O){R=S.temp[O];if(R!==K){F=P.find("optgroup").eq(R);R=F.index();L=(L=F.find("option").eq(0).val())||P.val();T.wheels=a();if(T.group){S.temp=T.rtl?[L,R]:[R,L];T.readonly=[T.rtl,!T.rtl];clearTimeout(J);J=setTimeout(function(){S.changeWheel([r]);T.readonly=Q;K=R+""},h*1000);return false}}else{T.readonly=Q}}else{L=S.temp[r]}var i=b(".dw-ul",f).eq(r);b.each(T.invalid,function(s,t){b('.dw-li[data-val="'+t+'"]',i).removeClass("dw-v")})},onBeforeShow:function(){T.wheels=a();if(T.group){S.temp=T.rtl?[L,F.index()]:[F.index(),L]}},onMarkupReady:function(f){b(".dwwl"+O,f).bind("mousedown touchstart",function(){clearTimeout(J)});if(G){f.addClass("dwms");b(".dwwl",f).eq(r).addClass("dwwms");k={};for(var g in S._selectedValues){k[g]=S._selectedValues[g]}}},onValueTap:function(g){if(G&&g.hasClass("dw-v")&&g.closest(".dw").find(".dw-ul").index(g.closest(".dw-ul"))==r){var f=g.attr("data-val");g.hasClass("dw-msel")?delete S._selectedValues[f]:S._selectedValues[f]=f;g.toggleClass("dw-msel");T.display=="inline"&&A(f,true);return false}},onSelect:function(f){A(f,true);if(T.group){S.values=null}},onCancel:function(){if(T.group){S.values=null}if(G){S._selectedValues={};for(var f in k){S._selectedValues[f]=k[f]}}},onChange:function(f){if(T.display=="inline"&&!G){N.val(f);M=true;P.val(S.temp[r]).trigger("change")}},onClose:function(){N.blur()}}}})(jQuery);(function(b){b.mobiscroll.themes.android={defaults:{dateOrder:"Mddyy",mode:"clickpick",height:50,showLabel:!1}}})(jQuery);(function(b){var e={defaults:{dateOrder:"Mddyy",mode:"mixed",rows:5,width:70,height:36,showLabel:!1,useShortLabels:!0}};b.mobiscroll.themes["android-ics"]=e;b.mobiscroll.themes["android-ics light"]=e})(jQuery);(function(b){b.mobiscroll.themes.ios={defaults:{dateOrder:"MMdyy",rows:5,height:30,width:55,headerText:!1,showLabel:!1,useShortLabels:!0}}})(jQuery);(function(b){b.mobiscroll.themes.jqm={defaults:{jqmBorder:"a",jqmBody:"c",jqmHeader:"b",jqmWheel:"d",jqmClickPick:"c",jqmSet:"b",jqmCancel:"c"},init:function(a,f){var g=f.settings;b(".dw",a).removeClass("dwbg").addClass("ui-overlay-shadow ui-corner-all ui-body-"+g.jqmBorder);b(".dwb-s span",a).attr("data-role","button").attr("data-theme",g.jqmSet);b(".dwb-n span",a).attr("data-role","button").attr("data-theme",g.jqmCancel);b(".dwb-c span",a).attr("data-role","button").attr("data-theme",g.jqmCancel);b(".dwwb",a).attr("data-role","button").attr("data-theme",g.jqmClickPick);b(".dwv",a).addClass("ui-header ui-bar-"+g.jqmHeader);b(".dwwr",a).addClass("ui-body-"+g.jqmBody);b(".dwpm .dwwl",a).addClass("ui-body-"+g.jqmWheel);b(".dwpm .dwl",a).addClass("ui-body-"+g.jqmBody);a.trigger("create");b(".dwo",a).click(function(){f.cancel()})}}})(jQuery);(function(b){var e;b.mobiscroll.themes.wp={defaults:{width:70,height:76,accent:"none",dateOrder:"mmMMddDDyy",showLabel:!1,onAnimStart:function(f,g,a){b(".dwwl"+g,f).addClass("wpam");clearTimeout(e[g]);e[g]=setTimeout(function(){b(".dwwl"+g,f).removeClass("wpam")},1000*a+100)}},init:function(g,h){var a,f;e={};b(".dw",g).addClass("wp-"+h.settings.accent);b(".dwwl",g).delegate(".dw-sel","touchstart mousedown DOMMouseScroll mousewheel",function(){a=!0;f=b(this).closest(".dwwl").hasClass("wpa");b(".dwwl",g).removeClass("wpa");b(this).closest(".dwwl").addClass("wpa")}).bind("touchmove mousemove",function(){a=!1}).bind("touchend mouseup",function(){a&&f&&b(this).closest(".dwwl").removeClass("wpa")})}};b.mobiscroll.themes["wp light"]=b.mobiscroll.themes.wp})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.mobiledatefield",a.an.inputfield,{options:{theme:"jqm",lang:"en",display:"bottom",mode:"scroller",dateFormat:"yy-mm-dd",dateOrder:"yy mmD dd",dateOrder:"yymmdd",minDate:"",maxDate:"",},_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-mobiledatetimefield")},_edit:function(){var i,k,e=this,j=this.options;var g=new Date(),f=window.database.local,h={theme:j.theme,lang:j.lang,display:j.display,mode:j.mode,dateFormat:j.dateFormat,dateOrder:j.dateOrder,};i=j.minDate=="now"?g:new Date(j.minDate);i.toString()!="Invalid Date"&&(h.minDate=i);k=j.maxDate=="now"?g:new Date(j.maxDate);k.toString()!="Invalid Date"&&(h.maxDate=k);a.an.inputfield.prototype._edit.apply(this,arguments);h.onSelect=function(p){e.input.trigger("keyup")};this.input.mobiscroll().date(h)},destroy:function(){this.input.mobiscroll&&this.input.mobiscroll("destroy");this.input.removeAttr("readony");this.element.removeClass("an-mobiledatetimefield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.swipewidget",a.an.widget,{options:{swipeContent:"<li>no content</li>",swipeIcon:'<b class="swipe-icon-active"></b>',swipeindex:0,swipeContent:"<li>no content</li>",swipeduration:false,swipeduration:2000,width:"100"},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var i=this.options;if(i.mobile){var f=this;this.element.addClass("an-swipewidget");var h=a('<div class="swipeBox"></div>'),e=a('<ul class="swipeList c"></ul>'),g=a('<div class="iconList"></div>');e.append(i.swipeContent);e.find("li").each(function(k){var p="<b></b>";if(k==i.swipeindex){p='<b class="swipe-icon-active"></b>'}g.append(a(p))});e.width(i.width*e.find("li").length+"%");e.find("li").width(i.width/e.find("li").length+"%");h.append(e).append(g).appendTo(this.element.find(".content"));f.pos={};var j=f.pos;j.t=null;j.index=i.swipeindex;j.itemLen=e.find("li").length;j.itemWidth=e.find("li").eq(0).outerWidth(true);this.element.bind("touchstart.swipewidget",function(k){var k=k.originalEvent.touches[0];j.x=k.pageX;j.y=k.pageY;j.dx=0;j.dy=0;j.Left=e.offset().left;j.target=k.target.tagName.toLowerCase()=="li"?k.target:a(k.target).closest("li");j.index=e.find("li").index(a(j.target));j.itemWidth=a(j.target).outerWidth(true);clearTimeout(j.t);j.t=null});this.element.bind("touchmove.swipewidget",function(k){k.preventDefault();var k=k.originalEvent.touches[0];j.dx=k.pageX-j.x;j.dy=k.pageY-j.y;e.css({left:parseInt(j.dx+j.Left)+"px"})});this.element.bind("touchend.swipewidget",function(q){var k=0,p=0;if(j.index==0&&j.dx>0){k=0;p=0}else{if(j.index==j.itemLen-1&&j.dx<0){k=-j.itemWidth*j.index;p=j.index}else{if(Math.abs(j.dx)>=j.itemWidth/2){if(j.dx>0){k=-j.itemWidth*(j.index-1);p=j.index-1}else{if(j.dx<0){k=-j.itemWidth*(j.index+1);p=j.index+1}}}else{k=-j.itemWidth*(j.index);p=j.index}}}f._setActive(e,k,p);if(i.autoSwipe&&i.mode!="design"){j.t=setTimeout(function(){f.autoRun(e,k,p)},i.swipeduration)}})}},_setActive:function(h,e,g){var f=this;h.css({left:-g*100+"%"});setTimeout(function(){f.element.find(".iconList b").eq(g).addClass("swipe-icon-active").siblings().removeClass("swipe-icon-active")},100)},autoRun:function(h,e,g){var f=this,i=this.options,j=this.pos;if(g<=0||g>(j.itemLen-1)){g=0}e=-j.itemWidth*g;f._setActive(h,e,g);g++;j.index++;j.t=setTimeout(function(){f.autoRun(h,e,g)},i.swipeduration)},_browser:function(){var e=this.options;if(e.autoSwipe){this.autoRun(this.element.find(".swipeList"),0,0)}},_edit:function(){var e=this.options;if(e.autoSwipe){this.autoRun(this.element.find(".swipeList"),0,0)}},_design:function(){var e=this.options},destroy:function(){this.element.removeClass("an-swipewidget");this.element.unbind("swipewidget");this.content.remove();return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.loading",{options:{trans:"0.6",fullscreen:false,msg:""},_create:function(){var f=this.options,e=this;this.wrap=a('<div class="loading" style="width:100%;height:100%;position:absolute;left:0;top:0;z-index:9997;vertical-align:middle;"><div style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:9998;background:#fff;"></div></div>');this.wrap.children().eq(0).css("opacity",f.trans);this.wrap.append(a('<span style="background:url(images/large-loading.gif) center center no-repeat;width:32px;height:32px;position:absolute;left:49%;top:49%;z-index:9999;padding-top:32px;">'+f.msg+"</span>"));if(!f.fullscreen){this.oldPos=this.element.css("postion");this.element.css("postion","relatvie").append(this.wrap)}else{this.wrap.css("position","fixed").appendTo(a("body"))}},open:function(){this.wrap&&this.wrap.show()},close:function(){this.wrap&&this.wrap.hide()},destroy:function(){if(this.oldPos){this.element.css("postion",this.oldPos)}this.wrap&&this.wrap.remove();delete this.pager;a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(b,e){var a=function(h,f){var g=h.getAttribute(f);return g==="true"?true:g==="false"?false:g===null?e:g};b.fn.buttonMarkup=function(q){var k=this,s="data-",C={};q=(q&&(b.type(q)==="object"))?q:{};for(var x=0;x<k.length;x++){var p=k.eq(x),A=p[0],w=b.extend({},b.fn.buttonMarkup.defaults,{icon:q.icon!==e?q.icon:a(A,s+"icon"),iconpos:q.iconpos!==e?q.iconpos:a(A,s+"iconpos"),theme:q.theme!==e?q.theme:a(A,s+"theme")||"c",inline:q.inline!==e?q.inline:a(A,s+"inline"),shadow:q.shadow!==e?q.shadow:a(A,s+"shadow"),corners:q.corners!==e?q.corners:a(A,s+"corners"),iconshadow:q.iconshadow!==e?q.iconshadow:a(A,s+"iconshadow"),mini:q.mini!==e?q.mini:a(A,s+"mini")},q),u="ui-btn-inner",f="ui-btn-text",v,h,B=false,r="up",j,g,t,z;for(C in w){if(w[C]===e||w[C]===null){p.removeAttr(s+C)}else{A.setAttribute(s+C,w[C])}}if(a(A,s+"rel")==="popup"&&p.attr("href")){A.setAttribute("aria-haspopup",true);A.setAttribute("aria-owns",p.attr("href"))}z=b.data(((A.tagName==="INPUT"||A.tagName==="BUTTON")?A.parentNode:A),"buttonElements");if(z){A=z.outer;p=b(A);j=z.inner;g=z.text;b(z.icon).remove();z.icon=null;B=z.hover;r=z.state}else{j=document.createElement(w.wrapperEls);g=document.createElement(w.wrapperEls)}t=w.icon?document.createElement("span"):null;if(!w.theme){w.theme="c"}v="ui-btn ";v+=(B?"ui-btn-hover-"+w.theme:"");v+=(r?" ui-btn-"+r+"-"+w.theme:"");v+=w.shadow?" ui-shadow":"";v+=w.corners?" ui-btn-corner-all":"";if(w.mini!==e){v+=w.mini===true?" ui-mini":" ui-fullsize"}if(w.inline!==e){v+=w.inline===true?" ui-btn-inline":" ui-btn-block"}if(w.icon){w.icon="ui-icon-"+w.icon;w.iconpos=w.iconpos||"left";h="ui-icon "+w.icon;if(w.iconshadow){h+=" ui-icon-shadow"}}if(w.iconpos){v+=" ui-btn-icon-"+w.iconpos;if(w.iconpos==="notext"&&!p.attr("title")){p.attr("title",p.getEncodedText())}}if(z){p.removeClass(z.bcls||"")}p.removeClass("ui-link").addClass(v);j.className=u;g.className=f;if(!z){j.appendChild(g)}if(t){t.className=h;if(!(z&&z.icon)){t.innerHTML="&#160;";j.appendChild(t)}}while(A.firstChild&&!z){g.appendChild(A.firstChild)}if(!z){A.appendChild(j)}z={hover:B,state:r,bcls:v,outer:A,inner:j,text:g,icon:t};b.data(A,"buttonElements",z);b.data(j,"buttonElements",z);b.data(g,"buttonElements",z);if(t){b.data(t,"buttonElements",z)}}return this};b.fn.buttonMarkup.defaults={corners:true,shadow:true,iconshadow:true,wrapperEls:"span"}})(jQuery);(function(e,g){var f={};var a={_addFirstLastClasses:function(k,j,h){k.removeClass("ui-first-child ui-last-child"),j.eq(0).addClass("ui-first-child").end().last().addClass("ui-last-child"),h||this.element.trigger("updatelayout")},_getVisibles:function(k,j){var h;return j?h=k.not(".ui-screen-hidden"):(h=k.filter(":visible"),0===h.length&&(h=k.not(".ui-screen-hidden"))),h}};var b=function(q,k){for(var j,u,h=q[0],r="",p=/ui-(bar|body|overlay)-([a-z])\b/;h&&(j=h.className||"",!(j&&(u=p.exec(j))&&(r=u[2])));){h=h.parentNode}return r||k||"a"};e.widget("an.mlist",e.an.widget,e.extend({options:{theme:null,countTheme:"c",headerTheme:"b",dividerTheme:"b",icon:"arrow-r",splitIcon:"arrow-r",splitTheme:"b",corners:true,shadow:true,inset:false,initSelector:":jqmData(role='listview')"},_create:function(){var i=this,h="";h+=i.options.inset?" ui-listview-inset":"";if(!!i.options.inset){h+=i.options.corners?" ui-corner-all":"";h+=i.options.shadow?" ui-shadow":""}i.element.addClass(function(j,k){return k+" ui-listview"+h});i.refresh(true)},_findFirstElementByTagName:function(k,i,h,j){var p={};p[h]=p[j]=true;while(k){if(p[k.nodeName]){return k}k=k[i]}return null},_getChildrenByTagName:function(k,i,j){var h=[],p={};p[i]=p[j]=true;k=k.firstChild;while(k){if(p[k.nodeName]){h.push(k)}k=k.nextSibling}return e(h)},_addThumbClasses:function(p){var k,j,h=p.length;for(k=0;k<h;k++){j=e(this._findFirstElementByTagName(p[k].firstChild,"nextSibling","img","IMG"));if(j.length){j.addClass("ui-li-thumb");e(this._findFirstElementByTagName(j[0].parentNode,"parentNode","li","LI")).addClass(j.is(".ui-li-icon")?"ui-li-has-icon":"ui-li-has-thumb")}}},refresh:function(C){this.parentPage=this.element.closest(".ui-page");var I=this.options,h=this.element,G=this,O=h.attr("data-divider-theme")||I.dividerTheme,D=h.attr("data-split-theme"),u=h.attr("data-split-icon"),p=h.attr("data-icon"),F=this._getChildrenByTagName(h[0],"li","LI"),E=!!e.nodeName(h[0],"ol"),L=!e.support.cssPseudoElement,s=h.attr("start"),B={},M,i,A,N,z,r,x,q,J,j,K,v,P,t;if(E&&L){h.find(".ui-li-dec").remove()}if(E){if(s||s===0){if(!L){q=parseInt(s,10)-1;h.css("counter-reset","listnumbering "+q)}else{x=parseInt(s,10)}}else{if(L){x=1}}}if(!I.theme){I.theme=b(this.element,"c")}for(var w=0,k=F.length;w<k;w++){M=F.eq(w);i="ui-li";if(C||!M.hasClass("ui-li")){A=M.attr("data-theme")||I.theme;N=this._getChildrenByTagName(M[0],"a","A");var H=(M.attr("data-role")==="list-divider");if(N.length&&!H){K=M.attr("data-icon");M.buttonMarkup({wrapperEls:"div",shadow:false,corners:false,iconpos:"right",icon:N.length>1||K===false?false:K||p||I.icon,theme:A});if((K!==false)&&(N.length===1)){M.addClass("ui-li-has-arrow")}N.first().removeClass("ui-link").addClass("ui-link-inherit");if(N.length>1){i+=" ui-li-has-alt";z=N.last();r=D||z.attr("data-theme")||I.splitTheme;t=z.attr("data-icon");z.appendTo(M).attr("title",e.trim(z.getEncodedText())).addClass("ui-li-link-alt").empty().buttonMarkup({shadow:false,corners:false,theme:A,icon:false,iconpos:"notext"}).find(".ui-btn-inner").append(e(document.createElement("span")).buttonMarkup({shadow:true,corners:true,theme:r,iconpos:"notext",icon:t||K||u||I.splitIcon}))}}else{if(H){i+=" ui-li-divider ui-bar-"+(M.attr("data-theme")||O);M.attr("role","heading");if(E){if(s||s===0){if(!L){J=parseInt(s,10)-1;M.css("counter-reset","listnumbering "+J)}else{x=parseInt(s,10)}}else{if(L){x=1}}}}else{i+=" ui-li-static ui-btn-up-"+A}}}if(E&&L&&i.indexOf("ui-li-divider")<0){j=i.indexOf("ui-li-static")>0?M:M.find(".ui-link-inherit");j.addClass("ui-li-jsnumbering").prepend("<span class='ui-li-dec'>"+(x++)+". </span>")}if(!B[i]){B[i]=[]}B[i].push(M[0])}for(i in B){e(B[i]).addClass(i).children(".ui-btn-inner").addClass(i)}h.find("h1, h2, h3, h4, h5, h6").addClass("ui-li-heading").end().find("p, dl").addClass("ui-li-desc").end().find(".ui-li-aside").each(function(){var Q=e(this);Q.prependTo(Q.parent())}).end().find(".ui-li-count").each(function(){e(this).closest("li").addClass("ui-li-has-count")}).addClass("ui-btn-up-"+(h.attr("data-count-theme")||this.options.countTheme)+" ui-btn-corner-all");this._addThumbClasses(F);this._addThumbClasses(h.find(".ui-link-inherit"));this._addFirstLastClasses(F,this._getVisibles(F,C),C);this._trigger("afterrefresh")}},a))})(jQuery);
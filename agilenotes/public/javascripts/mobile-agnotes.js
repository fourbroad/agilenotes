var Model={ADMINDBID:"000000000000000000000000",META:"000000000000000000000001",FORM:"000000000000000000000002",VIEW:"000000000000000000000003",PAGE:"000000000000000000000004",TASK:"000000000000000000000005",USER:"000000000000000000000006",OU:"000000000000000000000007",GROUP:"000000000000000000000008",ROLE:"000000000000000000000009",SIDE_VIEW:"00000000000000000000000a",VALIDATE_METHOD:"00000000000000000000000c",EXTENSION_POINT:"00000000000000000000000d",CATEGORY:"00000000000000000000000e",DATABASE:"00000000000000000000000f",META_ROOT:"0000000000000000000e0001",FORM_ROOT:"0000000000000000000e0002",VIEW_ROOT:"0000000000000000000e0003",PAGE_ROOT:"0000000000000000000e0004",TASK_ROOT:"0000000000000000000e0005",OU_ROOT:"0000000000000000000e0007",GROUP_ROOT:"0000000000000000000e0008",ROLE_ROOT:"0000000000000000000e0009",SIDE_VIEW_ROOT:"0000000000000000000e000a",EXTENSION_ROOT:"0000000000000000000e000b",DATABASE_ROOT:"0000000000000000000e000f",dbs:{},types:{},pages:{},views:{},sideViews:{},extension:{},rootId:function(a){if(a==this.META){return this.META_ROOT}else{if(a==this.FORM){return this.FORM_ROOT}else{if(a==this.VIEW){return this.VIEW_ROOT}else{if(a==this.PAGE){return this.PAGE_ROOT}else{if(a==this.TASK){return this.TASK_ROOT}else{if(a==this.OU||a==this.USER){return this.OU_ROOT}else{if(a==this.GROUP){return this.GROUP_ROOT}else{if(a==this.ROLE){return this.ROLE_ROOT}else{if(a==this.SIDE_VIEW){return this.SIDE_VIEW_ROOT}else{if(a==this.EXTENSION_POINT){return this.EXTENSION_ROOT}else{if(a==this.DATABASE){return this.DATABASE_ROOT}}}}}}}}}}}},getDb:function(b,d){if(this.dbs[b]){d(null,this.dbs[b])}else{var a=this;$.ans.getDB(b,null,function(f,e){if(e){a.dbs[b]=e}d(f,e)})}},getPages:function(g,a,j){var k=this,b={$or:[]},d=[],i;for(var h in a){i=this.pages[a[h]];if(i){d.push(i)}else{b.$or.push({_id:a[h]})}}function e(q,f){var p=[];if(f.length>0){for(var m in q){for(var l in f){if(f[l]._id==q[m]){var n=f[l].type;if(n==Model.PAGE||n==Model.FORM){p.push(f[l]);k.pages[f[l]._id]=f[l]}break}}}}return p}if(b.$or.length>0){$.ans.getDoc(g,null,{selector:b},function(f,l){j(f,e(a,d.concat(l.docs)))})}else{j(null,e(a,d))}},loadExtensions:function(b,f,g){var a=this,e={$or:[]},d={};$.each(f,function(){if(a.extension[b]&&a.extension[b][this]){d[this]=a.extension[b][this]}else{e.$or.push({extensionPoint:this})}});if(e.$or.length>0){$.ans.getDoc(b,null,{selector:e},function(h,i){if(i){$.each(i.docs,function(){a.extension[b]=a.extension[b]||{};a.extension[b][this.extensionPoint]=d[this.extensionPoint]=d[this.extensionPoint]||[];d[this.extensionPoint].push(this)})}g(h,d)})}else{g(null,d)}},newDocument:function(f,e,g,h){h=h||{};h.isNew=true;var d=this,b=Model.rootId(g),i=$.extend(true,{},h["default"],{_id:h.id||new ObjectId().toString(),type:g});if(i._path){i._path=i._path.replace(/[^,]+,$/,i._id+",")}else{if(b){i._path=b+","+i._id+","}}function a(j){if(j.type==d.FORM||j.type==d.PAGE){j.content=j.content||"";d._doOpenPage(f,e,j,$.extend(true,{mode:"design"},h))}else{if(j.type==d.VIEW){j.viewType=h.viewType;d._doOpenView(f,e,j,$.extend(true,{mode:"design"},h))}else{d._doOpenDocument(f,e,j,$.extend(true,{mode:"edit"},h))}}}if($.type(h.parent)=="string"){$.ans.getDoc(e,h.parent,null,function(j,k){if(j){console.log("Get parent document "+h.parent+" error:"+j)}else{if(k&&k._path){i._path=k._path+i._id+","}a(i)}})}else{if(h.parent&&h.parent._path){i._path=h.parent._path+i._id+","}a(i)}},_doOpenDocument:function(element,dbId,doc,opts){var optsx=$.extend(true,{title:opts.title||doc.title||doc.name||doc._id,dbId:dbId,document:doc,isDocumentEditor:true},opts),self=this;if(optsx.formIds){this.getPages(dbId,optsx.formIds,function(err,forms){if(err){console.log("Load forms "+optsx.formIds+" error: "+err)}else{optsx.forms=forms;element.editor(optsx);optsx.opened&&optsx.opened(element.data("editor"))}})}else{var type=this.types[doc.type];function openEditor(type){if(optsx.isNew){var obj=type.defaultValues||"{}";$.extend(true,optsx.document,eval("("+obj+")"))}self.getPages(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{optsx.mobile=doc.mobile;optsx.forms=forms;element.editor(optsx);opts.opened&&opts.opened(element.data("editor"))}})}if(type){openEditor(type)}else{$.ans.getDoc(dbId,doc.type,null,function(err,type){if(err||!type){console.log("Load document type "+doc.type+" error: "+err)}else{self.types[doc.type]=type;openEditor(type)}})}}},openDocument:function(e,b,d,f){f=f||{};var a=this;if(!d&&f.document){this._doOpenDocument(e,b,f.document,f)}else{$.ans.getDoc(b,d,null,function(g,h){if(g){console.log("Load document "+d+" error: "+g)}else{a._doOpenDocument(e,b,h,f)}})}},_doOpenPage:function(element,dbId,page,opts){var self=this,title=opts.title||page.title||page.name||page._id,type=this.types[page.type];function openEditor(type){if(opts.mode=="design"){self.getPages(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{if(opts.isNew){$.extend(true,page,eval("("+type.defaultValues+")"||"{}"))}element.editor($.extend(true,{title:title,dbId:dbId,document:page,forms:forms,design:true},$.extend(true,{},opts,{mode:"edit"})));opts.opened&&opts.opened(element.data("editor"))}})}else{if(page.type==Model.PAGE){if(opts.mobile){element.mpage($.extend(true,{title:title,dbId:dbId,page:page,mobile:true},opts));opts.opened&&opts.opened(element.data("mpage"))}else{element.page($.extend(true,{title:title,dbId:dbId,page:page},opts));opts.opened&&opts.opened(element.data("page"))}}else{if(page.type==Model.FORM){var doc={};if(opts.isNew){$.extend(true,doc,eval("("+type.defaultValues+")"||"{}"))}element.editor($.extend(true,{title:title,dbId:dbId,document:doc,forms:[page]},opts));opts.opened&&opts.opened(element.data("editor"))}}}}if(type){openEditor(type)}else{$.ans.getDoc(dbId,page.type,null,function(err,type){if(err){console.log("Load document type "+page.type+" error: "+err)}else{self.types[page.type]=type;openEditor(type)}})}},openPage:function(e,d,b,f){f=f||{};var a=this;if(this.pages[b]){f.mobile=this.pages[b].mobile;this._doOpenPage(e,d,this.pages[b],f)}else{$.ans.getDoc(d,b,null,function(g,h){if(g){console.log("Load page "+b+" error: "+g)}else{a.pages[b]=h;f.mobile=h.mobile;a._doOpenPage(e,d,h,f)}})}},_doOpenView:function(element,dbId,view,opts){var self=this;function openView(element,dbId,viewDoc,opts){var title=viewDoc.title||viewDoc.name||viewDoc._id,vt=viewDoc.viewType||"gridview";vt=vt.toLowerCase();if(opts.mode=="design"){function openEditor(type){if(opts.isNew){$.extend(true,viewDoc,eval("("+type.defaultValues+")"||"{}"))}self.getPages(dbId,(type.forms&&type.forms.split(","))||[],function(err,forms){if(err){console.log("Load forms "+type.forms+" error: "+err)}else{if(opts.mobile){var cb=viewDoc.viewType;if(cb=="mobilelistview"){element.mobilelistview({view:viewDoc,dbId:dbId,mode:"design"})}else{if(cb=="customview"){element.customview({view:viewDoc,dbId:dbId,mode:"design"})}else{element.view({view:viewDoc,dbId:dbId,mode:"design"})}}opts.opened&&opts.opened(element.data(cb))}else{element.editor($.extend(true,{title:title,dbId:dbId,document:viewDoc,forms:forms,design:true,isViewEditor:true},$.extend(true,{},opts,{mode:"edit"})));opts.opened&&opts.opened(element.data("editor"))}}})}var type=self.types[viewDoc.type];if(type){openEditor(type)}else{$.ans.getDoc(dbId,viewDoc.type,null,function(err,type){if(err){console.log("Load document type "+viewDoc.type+" error: "+err)}else{self.types[viewDoc.type]=type;openEditor(type)}})}}else{vt=(vt=="customizedview"?"view":vt);element[vt]($.extend(true,{title:title,dbId:dbId,view:viewDoc,isViewEditor:true},opts));opts.opened&&opts.opened(element.data(vt))}}if(view.viewType=="formView"){var form=this.pages[view.formId];if(form){opts.form=form;openView(element,dbId,view,opts)}else{$.ans.getDoc(dbId,view.formId,null,function(err,form){if(err){console.log("Load form "+view.formId+" error: "+err)}else{opts.form=self.pages[view.formId]=form;openView(element,dbId,view,opts)}})}}else{openView(element,dbId,view,opts)}},openView:function(f,e,a,g){g=g||{};var d=this,b=this.views[a];if(b){this._doOpenView(f,e,b,g)}else{$.ans.getDoc(e,a,null,function(i,h){if(i){console.log("Load view "+a+" error: "+i)}else{d.views[a]=h;d._doOpenView(f,e,h,g)}})}},_doOpenSideView:function(d,b,a,e){if(a){d.sideview($.extend(true,{dbId:b},a,e));e.opened&&e.opened(d.data("sideview"))}},openSideView:function(e,d,f,g){g=g||{};var b=this,a=this.sideViews[f];if(a){this._doOpenSideView(e,d,a,g)}else{$.ans.getDoc(d,f,null,function(i,h){if(i){console.log("Load side view "+f+" error: "+i)}else{b.sideViews[f]=h;b._doOpenSideView(e,d,h,g)}})}},postDocument:function(a,d,b,e){$.ans.postDoc(a,d,b,e)},updateDocument:function(b,d,a,e,f){this._cleanCache(d);$.ans.putDoc(b,d,a,e,f)},deleteDocument:function(a,d,b,e){this._cleanCache(d);$.ans.delDoc(a,d,b,e)},_cleanCache:function(a){delete this.types[a];delete this.pages[a];delete this.views[a];delete this.sideViews[a]}};function DocWrapper(doc,parseDot){this._doc=doc;this._parseDot=parseDot;this.setDoc=function(doc){var oldDoc=this._doc;this._doc=doc;$(this).trigger("docchanged",[doc,oldDoc])};this.getDoc=function(){return this._doc};this.prop=function(id,value,isTransient){if(!id){return null}if(value===undefined){try{return eval("this._doc."+id)}catch(e){}}else{var oldValue=this.prop(id);if(value==oldValue){return this}if(this._parseDot){var parts=id.split(".");function assign(doc,parts,val){var part=parts.shift(),r=part.match(/([a-zA-Z0-9_]+)\[([0-9]+)\]/);if(r){doc[r[1]]=doc[r[1]]||[];if(parts.length>0){doc[r[1]][r[2]]=doc[r[1]][r[2]]||{};assign(doc[r[1]][r[2]],parts,val)}else{doc[r[1]][r[2]]=val}}else{if(parts.length>0){doc[part]=doc[part]||{};assign(doc[part],parts,val)}else{doc[part]=val}}}assign(this._doc,parts,value)}else{this._doc[id]=value}$(this).trigger("propchanged",[id,value,oldValue,isTransient])}}}
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
Date.prototype.format=function(a){var d={"m+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"M+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in d){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(d[b]):(("00"+d[b]).substr((""+d[b]).length)))}}return a};Date.prototype.add=function(e){var h=this.getFullYear(),a=this.getMonth()+1,g=this.getDate(),f=0;if(typeof e!="object"){return this}for(var b in e){if(b=="year"){h+=e[b]}else{if(b=="month"){a+=e[b];if(a>12){h+=parseInt(a/12);a=a%12}if(a<1){h+=parseInt(a/12)-1;a=12+a%12}}else{if(b=="day"){f+=e[b]}}}}return new Date(new Date(h+"/"+a+"/"+g).getTime()+f*24*60*60*1000)};function emptyEqual(b,a){if(b===null&&a===null){return 1}else{if(b===null||a===null){return -1}}if(b===undefined&&a===undefined){return 1}else{if(b===undefined||a===undefined){return -1}}if(b===""&&a===""){return 1}else{if(b===""||a===""){return -1}}return 0}function isBothObject(b,a){if(typeof b==="object"&&typeof a==="object"){return 0}else{if(typeof b==="object"||typeof a==="object"){return -1}}return 1}function equals(e,b){var d=0;var a=true;d=emptyEqual(e,b);if(d==1){return true}else{if(d==-1){return false}}d=isBothObject(e,b);if(d==-1){return false}if(d==1){if(e===b){return true}else{return false}}else{for(var f in e){var g=arguments.callee(e[f],b[f]);if(!g){a=false;break}}for(var f in b){var g=arguments.callee(b[f],e[f]);if(!g){a=false;break}}}return a}function getUrlParam(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),d=window.location.search.substr(1).match(b);return d!=null?unescape(d[2]):null}function attributes(e){var b={},a=e.attributes;for(var d=0;d<a.length;d++){if(a[d].name!="metadata"){b[a[d].name]=a[d].value}}return b}function print(a){var b=$("body").children("iframe#printer");if(b.length==0){b=$("<iframe id='printer'>").hide().appendTo("body")}b.attr("src",a)}function showDialog(g,f,e){var b=window.database.local;e=e||{};var d=[];$.each(e.buttons||[],function(){var h=this;d.push({text:h.text,click:function(){h.handler&&h.handler($(this).data("dialog"))}})});var a="OK";if(b&&b!="en"){a=$.i18n.dialog.ok}if(d.length==0){d.push({text:a,click:function(){$(this).dialog("close")}})}$("<div/>").dialog({title:g,height:220,width:360,modal:true,create:function(h,i){$(this).html(f)},buttons:d,close:function(i,h){$(this).remove()}})}function openDialog(a,e,b,d){$("<div/>").dialog($.extend(true,{height:220,width:360,modal:true,create:function(f,g){Model[d]($(this),a,e,b)},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}],close:function(g,f){$(this).remove()}},b))}function newDocument(a,b,d){openDialog(a,b,d,"newDocument")}function openDocument(a,b,d){openDialog(a,b,d,"openDocument")}var openPage,openView,openPage,openSideView;openForm=openPage=function(b,a,d){openDialog(b,a,d,"openPage")};openView=function(b,a,d){openDialog(b,a,d,"openView")};openSideView=function(b,a,d){openDialog(b,a,d,"openSideView")};var hexcase=0;function hex_md5(b){return rstr2hex(rstr_md5(str2rstr_utf8(b)))}function hex_hmac_md5(e,d){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(d)))}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(b){return binl2rstr(binl_md5(rstr2binl(b),b.length*8))}function rstr_hmac_md5(n,k){var l=rstr2binl(n);if(l.length>16){l=binl_md5(l,n.length*8)}var i=Array(16),m=Array(16);for(var h=0;h<16;h++){i[h]=l[h]^909522486;m[h]=l[h]^1549556828}var j=binl_md5(i.concat(rstr2binl(k)),512+k.length*8);return binl2rstr(binl_md5(m.concat(j),512+128))}function rstr2hex(l){try{hexcase}catch(i){hexcase=0}var j=hexcase?"0123456789ABCDEF":"0123456789abcdef";var e="";var h;for(var k=0;k<l.length;k++){h=l.charCodeAt(k);e+=j.charAt((h>>>4)&15)+j.charAt(h&15)}return e}function str2rstr_utf8(j){var f="";var i=-1;var g,h;while(++i<j.length){g=j.charCodeAt(i);h=i+1<j.length?j.charCodeAt(i+1):0;if(55296<=g&&g<=56319&&56320<=h&&h<=57343){g=65536+((g&1023)<<10)+(h&1023);i++}if(g<=127){f+=String.fromCharCode(g)}else{if(g<=2047){f+=String.fromCharCode(192|((g>>>6)&31),128|(g&63))}else{if(g<=65535){f+=String.fromCharCode(224|((g>>>12)&15),128|((g>>>6)&63),128|(g&63))}else{if(g<=2097151){f+=String.fromCharCode(240|((g>>>18)&7),128|((g>>>12)&63),128|((g>>>6)&63),128|(g&63))}}}}}return f}function rstr2binl(d){var e=Array(d.length>>2);for(var f=0;f<e.length;f++){e[f]=0}for(var f=0;f<d.length*8;f+=8){e[f>>5]|=(d.charCodeAt(f/8)&255)<<(f%32)}return e}function binl2rstr(d){var e="";for(var f=0;f<d.length*32;f+=8){e+=String.fromCharCode((d[f>>5]>>>(f%32))&255)}return e}function binl_md5(a,r){a[r>>5]|=128<<((r)%32);a[(((r+64)>>>9)<<4)+14]=r;var b=1732584193;var d=-271733879;var i=-1732584194;var q=271733878;for(var u=0;u<a.length;u+=16){var s=b;var t=d;var v=i;var w=q;b=md5_ff(b,d,i,q,a[u+0],7,-680876936);q=md5_ff(q,b,d,i,a[u+1],12,-389564586);i=md5_ff(i,q,b,d,a[u+2],17,606105819);d=md5_ff(d,i,q,b,a[u+3],22,-1044525330);b=md5_ff(b,d,i,q,a[u+4],7,-176418897);q=md5_ff(q,b,d,i,a[u+5],12,1200080426);i=md5_ff(i,q,b,d,a[u+6],17,-1473231341);d=md5_ff(d,i,q,b,a[u+7],22,-45705983);b=md5_ff(b,d,i,q,a[u+8],7,1770035416);q=md5_ff(q,b,d,i,a[u+9],12,-1958414417);i=md5_ff(i,q,b,d,a[u+10],17,-42063);d=md5_ff(d,i,q,b,a[u+11],22,-1990404162);b=md5_ff(b,d,i,q,a[u+12],7,1804603682);q=md5_ff(q,b,d,i,a[u+13],12,-40341101);i=md5_ff(i,q,b,d,a[u+14],17,-1502002290);d=md5_ff(d,i,q,b,a[u+15],22,1236535329);b=md5_gg(b,d,i,q,a[u+1],5,-165796510);q=md5_gg(q,b,d,i,a[u+6],9,-1069501632);i=md5_gg(i,q,b,d,a[u+11],14,643717713);d=md5_gg(d,i,q,b,a[u+0],20,-373897302);b=md5_gg(b,d,i,q,a[u+5],5,-701558691);q=md5_gg(q,b,d,i,a[u+10],9,38016083);i=md5_gg(i,q,b,d,a[u+15],14,-660478335);d=md5_gg(d,i,q,b,a[u+4],20,-405537848);b=md5_gg(b,d,i,q,a[u+9],5,568446438);q=md5_gg(q,b,d,i,a[u+14],9,-1019803690);i=md5_gg(i,q,b,d,a[u+3],14,-187363961);d=md5_gg(d,i,q,b,a[u+8],20,1163531501);b=md5_gg(b,d,i,q,a[u+13],5,-1444681467);q=md5_gg(q,b,d,i,a[u+2],9,-51403784);i=md5_gg(i,q,b,d,a[u+7],14,1735328473);d=md5_gg(d,i,q,b,a[u+12],20,-1926607734);b=md5_hh(b,d,i,q,a[u+5],4,-378558);q=md5_hh(q,b,d,i,a[u+8],11,-2022574463);i=md5_hh(i,q,b,d,a[u+11],16,1839030562);d=md5_hh(d,i,q,b,a[u+14],23,-35309556);b=md5_hh(b,d,i,q,a[u+1],4,-1530992060);q=md5_hh(q,b,d,i,a[u+4],11,1272893353);i=md5_hh(i,q,b,d,a[u+7],16,-155497632);d=md5_hh(d,i,q,b,a[u+10],23,-1094730640);b=md5_hh(b,d,i,q,a[u+13],4,681279174);q=md5_hh(q,b,d,i,a[u+0],11,-358537222);i=md5_hh(i,q,b,d,a[u+3],16,-722521979);d=md5_hh(d,i,q,b,a[u+6],23,76029189);b=md5_hh(b,d,i,q,a[u+9],4,-640364487);q=md5_hh(q,b,d,i,a[u+12],11,-421815835);i=md5_hh(i,q,b,d,a[u+15],16,530742520);d=md5_hh(d,i,q,b,a[u+2],23,-995338651);b=md5_ii(b,d,i,q,a[u+0],6,-198630844);q=md5_ii(q,b,d,i,a[u+7],10,1126891415);i=md5_ii(i,q,b,d,a[u+14],15,-1416354905);d=md5_ii(d,i,q,b,a[u+5],21,-57434055);b=md5_ii(b,d,i,q,a[u+12],6,1700485571);q=md5_ii(q,b,d,i,a[u+3],10,-1894986606);i=md5_ii(i,q,b,d,a[u+10],15,-1051523);d=md5_ii(d,i,q,b,a[u+1],21,-2054922799);b=md5_ii(b,d,i,q,a[u+8],6,1873313359);q=md5_ii(q,b,d,i,a[u+15],10,-30611744);i=md5_ii(i,q,b,d,a[u+6],15,-1560198380);d=md5_ii(d,i,q,b,a[u+13],21,1309151649);b=md5_ii(b,d,i,q,a[u+4],6,-145523070);q=md5_ii(q,b,d,i,a[u+11],10,-1120210379);i=md5_ii(i,q,b,d,a[u+2],15,718787259);d=md5_ii(d,i,q,b,a[u+9],21,-343485551);b=safe_add(b,s);d=safe_add(d,t);i=safe_add(i,v);q=safe_add(q,w)}return Array(b,d,i,q)}function md5_cmn(a,j,k,l,b,i){return safe_add(bit_rol(safe_add(safe_add(j,a),safe_add(l,i)),b),k)}function md5_ff(m,n,a,b,p,d,l){return md5_cmn((n&a)|((~n)&b),m,n,p,d,l)}function md5_gg(m,n,a,b,p,d,l){return md5_cmn((n&b)|(a&(~b)),m,n,p,d,l)}function md5_hh(m,n,a,b,p,d,l){return md5_cmn(n^a^b,m,n,p,d,l)}function md5_ii(m,n,a,b,p,d,l){return md5_cmn(a^(n|(~b)),m,n,p,d,l)}function safe_add(f,g){var h=(f&65535)+(g&65535);var e=(f>>16)+(g>>16)+(h>>16);return(e<<16)|(h&65535)}function bit_rol(e,d){return(e<<d)|(e>>>(32-d))}function md5(a){return hex_md5(a)}var ObjectId=(function(){var a=0;var b=Math.floor(Math.random()*(32767));var h=Math.floor(Math.random()*(16777216));if(localStorage&&typeof(localStorage)!="undefined"){var g=parseInt(localStorage.mongoMachineId);if(g>=0&&g<=16777215){h=Math.floor(localStorage.mongoMachineId)}localStorage.mongoMachineId=h;document.cookie="mongoMachineId="+h+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var d=document.cookie.split("; ");for(var f in d){var e=d[f].split("=");if(e[0]=="mongoMachineId"&&e[1]>=0&&e[1]<=16777215){h=e[1];break}}document.cookie="mongoMachineId="+h+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return function(){if(!(this instanceof ObjectId)){return new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}if(typeof(arguments[0])=="object"){this.timestamp=arguments[0].timestamp;this.machine=arguments[0].machine;this.pid=arguments[0].pid;this.increment=arguments[0].increment}else{if(typeof(arguments[0])=="string"&&arguments[0].length==24){this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))}else{if(arguments.length==4&&arguments[0]!=null){this.timestamp=arguments[0];this.machine=arguments[1];this.pid=arguments[2];this.increment=arguments[3]}else{this.timestamp=Math.floor(new Date().valueOf()/1000);this.machine=h;this.pid=b;if(a>16777215){a=0}this.increment=a++}}}}})();ObjectId.prototype.getDate=function(){return new Date(this.timestamp*1000)};ObjectId.prototype.toString=function(){var e=this.timestamp.toString(16);var d=this.machine.toString(16);var b=this.pid.toString(16);var a=this.increment.toString(16);return"00000000".substr(0,6-e.length)+e+"000000".substr(0,6-d.length)+d+"0000".substr(0,4-b.length)+b+"000000".substr(0,6-a.length)+a};
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(g){g.ans=g.ans||{};function j(u,q,p){var n=u.getResponseHeader("content-type")||"",m=q==="xml"||!q&&n.indexOf("xml")>=0,r=m?u.responseXML:u.responseText;if(m&&r.documentElement.nodeName==="parsererror"){jQuery.error("parsererror")}if(p&&p.dataFilter){r=p.dataFilter(r,q)}if(typeof r==="string"){if(q==="json"||!q&&n.indexOf("json")>=0){try{r=jQuery.parseJSON(r)}catch(t){r={error:t.message,reason:r}}}else{if(q==="script"||!q&&n.indexOf("javascript")>=0){jQuery.globalEval(r)}}}return r}function e(m,p){if(typeof hex_sha1=="undefined"){alert("creating a user doc requires sha1.js to be loaded in the page");return}var n="org.notesdb.user:";m._id=m._id||n+m.name;if(p){m.salt=g.notes.newUUID();m.password_sha=hex_sha1(p+m.salt)}m.type="user";if(!m.roles){m.roles=[]}return m}function h(p){var n=[];if(typeof(p)==="object"&&p!==null){for(var m in p){var q=p[m];if(typeof(q==="object")){q=k(q)}n.push(encodeURIComponent(m)+"="+encodeURIComponent(q))}}return n.length?"?"+n.join("&"):""}function k(m){return m!==null?JSON.stringify(m):null}function i(n,p,m){console.log(n);g.ajax(g.extend(true,{type:"GET",url:n,cache:!(g.browser.msie),dataType:"json",complete:function(s){var t=j(s,"json"),r,q;if(s.status==200){q=t}else{r={status:s.status,error:t?t.error:"Unknown",reason:t?t.reason:"Unknown"}}p(r,q)}},m))}function b(m,n,p){g.ajax({type:"POST",url:m,dataType:"json",contentType:"application/json",data:JSON.stringify(n),complete:function(s){var t=j(s,"json"),r,q;if(s.status==201||s.status==200){q=t}else{r={status:s.status,error:t.error,reason:t.reason}}p(r,q,t)}})}function d(m,n,p){g.ajax({type:"PUT",url:m,dataType:"json",contentType:"application/json",data:JSON.stringify(n),complete:function(s){var t=j(s,"json"),r,q;if(s.status==200){q=t}else{r={status:s.status,error:t.error,reason:t.reason}}p(r,q)}})}function f(m,n){g.ajax({type:"DELETE",url:m,dataType:"json",complete:function(r){var s=j(r,"json"),q,p;if(r.status==200){p=s}else{q={status:r.status,error:s.error,reason:s.reason}}n(q,p)}})}var l=new XMLHttpRequest();function a(m,p,n){l.open("GET",m,true);l.overrideMimeType("text/plain; charset=x-user-defined");l.onreadystatechange=function(u){if(this.readyState==4&&this.status==200){var q=this.responseText;var s=new ArrayBuffer(q.length);var r=new Uint8Array(s);for(var t=0;t<q.length;t++){r[t]=q.charCodeAt(t)&255}p(s)}};l.send(null)}g.extend(g.ans,{login:function(m,n){b(ag_url+"/login",m,n)},logout:function(m){i(ag_url+"/logout",m)},dbAttachmentUri:function(m,n){return"/dbs/"+Model.ADMINDBID+"/"+m+"/attachments/"+n},getDB:function(n,p,r){p=p||{};var m=this;g.extend(true,p,{selector:{type:Model.DATABASE}});var q=n+".json";new FileEntry(q,g_fullpath+"/cache/"+q).file(function(t){var s=new FileReader();s.onloadend=function(u){r(false,JSON.parse(this.result))};s.readAsText(t)},function(s){var u=ag_url+"/dbs/"+Model.ADMINDBID+"/"+(n||h(p));var t=localStorage.getItem("cookie_id");if(t){if(u.indexOf("?")!=-1){u+="&cookie_id="+t}else{u+="?cookie_id="+t}}i(u,function(v,w){var v=v;m.parseAttachments(w,function(x){if(w&&w.mobile){var y=new FileWriter(g_fullpath+"/cache/"+q);y.onwriteend=function(z){r(v,x)};y.write(JSON.stringify(x))}else{r(v,x)}})})})},postDB:function(m,n){b("/dbs/"+Model.ADMINDBID,m,function(q,p){n(q,p);if(!q){g(document).trigger("databaseCreated",p)}})},putDB:function(m,p,n,q){n=n||{};g.extend(true,n,{selector:{type:Model.DATABASE}});d("/dbs/"+Model.ADMINDBID+"/"+(m||h(n)),p,function(s,r){q(s,r);if(!s){g(document).trigger("databaseChanged",p)}})},delDB:function(m,n,p){n=n||{};g.extend(true,n,{selector:{type:Model.DATABASE}});f("/dbs/"+Model.ADMINDBID+"/"+(m||h(n)),function(r,q){p(r,q);if(!r){g(document).trigger("databaseDeleted",{_id:m})}})},getDBAttachment:function(m,n){},postDBAttachment:function(n,m,p){var q=g('<form action="" method="POST"></form>').append(m.clone().attr("name","attachment"));var r={url:"/dbs/"+Model.ADMINDBID+"/"+n._id+"/attachments"};g.extend(r,p);q.ajaxSubmit(r)},delDBAttachment:function(m,n){},getDoc:function(s,n,v,t){var p={},m="/dbs/"+s,u=this;m=ag_url+"/dbs/"+s;if(v&&v.headers){g.extend(p,{headers:v.headers});delete v.headers}if(n){m+="/"+n}var r=localStorage.getItem("cookie_id");if(v){m+=h(v)}if(r){if(m.indexOf("?")!=-1){m+="&cookie_id="+r}else{m+="?cookie_id="+r}}var q=function(x,w,y){i(x,function(A,B){if(A){y(A,B)}else{if(B.docs instanceof Array&&B.total>0){var z=[];var C=function(G,E,D){var F=G.shift();if(F){u.parseAttachments(F,function(H){E.push(H);C(G,E,D)})}else{D(E)}};C(B.docs,z,function(D){B.docs=D;y(false,B)})}else{u.parseAttachments(B,function(D){if(D.mobile){var E=new FileWriter(g_fullpath+"/cache/"+n+".json");E.onwriteend=function(F){y(false,D)};E.write(JSON.stringify(D))}else{y(false,D)}})}}},w)};if(n){new FileEntry(n+".json",g_fullpath+"/cache/"+n+".json").file(function(x){var w=new FileReader();w.onload=function(y){t(false,JSON.parse(this.result))};w.onerror=function(y){t("read file error!",null)};w.readAsText(x)},function(w){q(m,p,t)})}else{q(m,p,t)}},postDoc:function(n,r,q,s){var p=ag_url+"/dbs/"+n;var m=localStorage.getItem("cookie_id");if(q&&q.redirect){if(m){p+="?cookie_id="+m}g.post(p,r,function(t){s(t)})}else{if(q){p+=h(q)}if(m){if(p.indexOf("?")!=-1){p+="&cookie_id="+m}else{p+="?cookie_id="+m}}b(p,r,function(u,t){s(u,t);if(!u){g(document).trigger("documentCreated",r)}})}},putDoc:function(n,r,m,q,s){var p="/dbs/"+n+"/"+r;if(q){p+=h(q)}d(p,m,function(u,t){s(u,t);if(!u){g(document).trigger("documentChanged",m)}})},delDoc:function(m,q,p,r){var n="/dbs/"+m;if(q){n+="/"+q}if(p){n+=h(p)}f(n,function(t,s){r(t,s);if(!t){g(document).trigger("documentDeleted",{_id:q})}})},getAttachmentPath:function(m,n,p){return"/dbs/"+m+"/"+n+"/attachments/"+p},postAttachment:function(n,q,m,p){var r=g('<form action="" method="POST"></form>').append(m.clone().attr("name","attachment"));var s={url:"/dbs/"+n+"/"+q+"/attachments"};g.extend(s,p);r.ajaxSubmit(s)},delAttachment:function(m,n,p){},getTempPath:function(m){return"/tmp/"+m},get:function(m,n){i(ag_url+m,n)},postTemp:function(m,n){var p=g('<form action="" method="POST"></form>').append(m.attr("name","file")),q={url:"/tmp"};g.extend(q,n);p.ajaxSubmit(q)},parseAttachments:function(t,w){var s=function(z,y,r){if(z.indexOf(r)!=-1){return z}return z.replace(new RegExp(y,"g"),r)};var n,q=/\/dbs\/[a-zA-Z0-9]+\/[a-zA-Z0-9]+\/attachments\/(\S)*\/[%a-zA-Z0-9_-\u4e00-\u9fa5]+\.\w+/g;var p=function(y,r,A){var z=r.shift();if(z){p(s(y,z,ag_url+z),r,A)}else{A(y)}};function m(r){var A={},z=[];for(var y=0;y<r.length;y++){if(!A[r[y]]){A[r[y]]=1;z.push(r[y])}}return z}if(typeof(t)=="string"){n=t.match(q);if(n&&n.length>0){p(t,m(n),function(r){w(r)})}else{w(t)}}else{if(t instanceof Array){w(t)}else{var v=Object.keys(t).length;if(v<=0){w(t)}else{var x=Object.keys(t);var u=function(y,z,A){var r=y.shift();if(r){if(typeof(z[r])=="string"){n=z[r].match(q);if(n&&n.length>0){p(z[r],m(n),function(B){z[r]=B;u(y,z,A)})}else{u(y,z,A)}}else{u(y,z,A)}}else{A(z)}};u(x,t,function(r){w(r)})}}}},downPdf:function(m){navigator.app.loadUrl(m,{openExternal:true})},getVersion:function(q){var p=g_fullpath+"/cache/main_version.txt";new FileEntry(p).file(function(m){var n=new FileReader();n.onloadend=function(s){q(this.result)};n.readAsText(m)},function(){q("1.0")})}})})(jQuery);(function($){$.extend({metadata:{defaults:{type:"elem",name:"script",single:"script"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts),elem=$(elem);settings.single=settings.single||"metadata";var data=$.data(elem,settings.single);if(!$.isEmptyObject(data)){return data}data="{}";if(settings.type=="elem"){data=$.trim(elem.children(settings.name+"[type='text/json']").html())||data}else{if(settings.type=="attr"){data=elem.attr(settings.name)||data}}if(data.indexOf("{")<0){data="{"+data+"}"}try{data=eval("("+data+")")}catch(e){}if(!$.isEmptyObject(data)){$.data(elem,settings.single,data)}return data},set:function(elem,metadata,opts){var settings=$.extend({},this.defaults,opts),elem=$(elem);settings.single=settings.single||"metadata";if(settings.type=="elem"){elem.children("script[type='text/json']").remove();if(!$.isEmptyObject(metadata)){$("<script type='text/json'>"+$.toJSON(metadata)+"<\/script>").prependTo(elem)}}else{if(settings.type=="attr"){elem.removeAttr(settings.name);if(!$.isEmptyObject(metadata)){elem.attr(settings.name,$.toJSON(metadata))}}}$.data(elem,settings.single,metadata)}}});$.fn.metadata=function(opts){return $.metadata.get(this,opts)};$.fn.getMetadata=function(opts){return $.metadata.get(this,opts)};$.fn.setMetadata=function(metadata,opts){$.metadata.set(this,metadata,opts)}})(jQuery);(function(a){a.extend(a.fn,{validate:function(b){if(!this.length){b&&b.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var d=a.data(this[0],"validator");if(d){return d}this.attr("novalidate","novalidate");d=new a.validator(b,this[0]);a.data(this[0],"validator",d);if(d.settings.onsubmit){var e=this.find("input, button");e.filter(".cancel").click(function(){d.cancelSubmit=true});if(d.settings.submitHandler){e.filter(":submit").click(function(){d.submitButton=this})}this.submit(function(f){if(d.settings.debug){f.preventDefault()}function g(){if(d.settings.submitHandler){if(d.submitButton){var h=a("<input type='hidden'/>").attr("name",d.submitButton.name).val(d.submitButton.value).appendTo(d.currentForm)}d.settings.submitHandler.call(d,d.currentForm);if(d.submitButton){h.remove()}return false}return true}if(d.cancelSubmit){d.cancelSubmit=false;return g()}if(d.form()){if(d.pendingRequest){d.formSubmitted=true;return false}return g()}else{d.focusInvalid();return false}})}return d},valid:function(){if(a(this[0]).is("form")){return this.validate().form()}else{var d=true;var b=a(this[0].form).validate();this.each(function(){d&=b.element(this)});return d}},removeAttrs:function(e){var b={},d=this;a.each(e.split(/\s/),function(f,g){b[g]=d.attr(g);d.removeAttr(g)});return b},rules:function(f,b){var h=this[0];if(f){var e=a.data(h.form,"validator").settings;var j=e.rules;var k=a.validator.staticRules(h);switch(f){case"add":a.extend(k,a.validator.normalizeRule(b));j[h.name]=k;if(b.messages){e.messages[h.name]=a.extend(e.messages[h.name],b.messages)}break;case"remove":if(!b){delete j[h.name];return k}var i={};a.each(b.split(/\s/),function(l,m){i[m]=k[m];delete k[m]});return i}}var g=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(h),a.validator.classRules(h),a.validator.attributeRules(h),a.validator.staticRules(h)),h);if(g.required){var d=g.required;delete g.required;g=a.extend({required:d},g)}return g}});a.extend(a.expr[":"],{blank:function(b){return !a.trim(""+b.value)},filled:function(b){return !!a.trim(""+b.value)},unchecked:function(b){return !b.checked}});a.validator=function(b,d){this.settings=a.extend(true,{},a.validator.defaults,b);this.currentForm=d;this.init()};a.validator.format=function(b,d){if(arguments.length==1){return function(){var e=a.makeArray(arguments);e.unshift(b);return a.validator.format.apply(this,e)}}if(arguments.length>2&&d.constructor!=Array){d=a.makeArray(arguments).slice(1)}if(d.constructor!=Array){d=[d]}a.each(d,function(e,f){b=b.replace(new RegExp("\\{"+e+"\\}","g"),f)});return b};a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(b,d){this.lastActive=b;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,b,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(b)).hide()}},onfocusout:function(b,d){if(!this.checkable(b)&&(b.name in this.submitted||!this.optional(b))){this.element(b)}},onkeyup:function(b,d){if(b.name in this.submitted||b==this.lastElement){this.element(b)}},onclick:function(b,d){if(b.name in this.submitted){this.element(b)}else{if(b.parentNode.name in this.submitted){this.element(b.parentNode)}}},highlight:function(e,b,d){if(e.type==="radio"){this.findByName(e.name).addClass(b).removeClass(d)}else{a(e).addClass(b).removeClass(d)}},unhighlight:function(e,b,d){if(e.type==="radio"){this.findByName(e.name).removeClass(b).addClass(d)}else{a(e).removeClass(b).addClass(d)}}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=a(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm);this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=(this.groups={});a.each(this.settings.groups,function(f,g){a.each(g.split(/\s/),function(i,h){b[h]=f})});var e=this.settings.rules;a.each(e,function(f,g){e[f]=a.validator.normalizeRule(g)});function d(h){var g=a.data(this[0].form,"validator"),f="on"+h.type.replace(/^validate/,"");g.settings[f]&&g.settings[f].call(g,this[0],h)}a(this.currentForm).validateDelegate("input[type='text'], input[type='password'], input[type='file'], select, textarea, input[type='number'], input[type='search'] ,input[type='tel'], input[type='url'], input[type='email'], input[type='datetime'], input[type='date'], input[type='month'], input[type='week'], input[type='time'], input[type='datetime-local'], input[type='range'], input[type='color'] ","focusin focusout keyup",d).validateDelegate("input[type='radio'], input[type='checkbox'], select, option","click",d);if(this.settings.invalidHandler){a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();a.extend(this.submitted,this.errorMap);this.invalid=a.extend({},this.errorMap);if(!this.valid()){a(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var b=0,d=(this.currentElements=this.elements());d[b];b++){this.check(d[b])}return this.valid()},element:function(d){d=this.validationTargetFor(this.clean(d));this.lastElement=d;this.prepareElement(d);this.currentElements=a(d);var b=this.check(d);if(b){delete this.invalid[d.name]}else{this.invalid[d.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return b},showErrors:function(d){if(d){a.extend(this.errorMap,d);this.errorList=[];for(var b in d){this.errorList.push({message:d[b],element:this.findByName(b)[0]})}this.successList=a.grep(this.successList,function(e){return !(e.name in d)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if(a.fn.resetForm){a(this.currentForm).resetForm()}this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var d=0;for(var b in e){d++}return d},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}}},findLastActive:function(){var b=this.lastActive;return b&&a.grep(this.errorList,function(d){return d.element.name==b.name}).length==1&&b},elements:function(){var d=this,b={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&d.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!d.objectLength(a(this).rules())){return false}b[this.name]=true;return true})},clean:function(b){return a(b)[0]},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=a([]);this.toHide=a([]);this.currentElements=a([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(b){this.reset();this.toHide=this.errorsFor(b)},check:function(d){d=this.validationTargetFor(this.clean(d));var i=a(d).rules();var f=false;for(var j in i){var h={method:j,parameters:i[j]};try{var b=a.validator.methods[j].call(this,d.value.replace(/\r/g,""),d,h.parameters);if(b=="dependency-mismatch"){f=true;continue}f=false;if(b=="pending"){this.toHide=this.toHide.not(this.errorsFor(d));return}if(!b){this.formatAndAdd(d,h);return false}}catch(g){this.settings.debug&&window.console&&console.log("exception occured when checking element "+d.id+", check the '"+h.method+"' method",g);throw g}}if(f){return}if(this.objectLength(i)){this.successList.push(d)}return true},customMetaMessage:function(b,e){if(!a.metadata){return}var d=this.settings.meta?a(b).metadata()[this.settings.meta]:a(b).metadata();return d&&d.messages&&d.messages[e]},customMessage:function(d,e){var b=this.settings.messages[d];return b&&(b.constructor==String?b:b[e])},findDefined:function(){for(var b=0;b<arguments.length;b++){if(arguments[b]!==undefined){return arguments[b]}}return undefined},defaultMessage:function(b,d){return this.findDefined(this.customMessage(b.name,d),this.customMetaMessage(b,d),!this.settings.ignoreTitle&&b.title||undefined,a.validator.messages[d],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(d,f){var e=this.defaultMessage(d,f.method),b=/\$?\{(\d+)\}/g;if(typeof e=="function"){e=e.call(this,f.parameters,d)}else{if(b.test(e)){e=jQuery.format(e.replace(b,"{$1}"),f.parameters)}}this.errorList.push({message:e,element:d});this.errorMap[d.name]=e;this.submitted[d.name]=e},addWrapper:function(b){if(this.settings.wrapper){b=b.add(b.parent(this.settings.wrapper))}return b},defaultShowErrors:function(){for(var d=0;this.errorList[d];d++){var b=this.errorList[d];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var d=0;this.successList[d];d++){this.showLabel(this.successList[d])}}if(this.settings.unhighlight){for(var d=0,e=this.validElements();e[d];d++){this.settings.unhighlight.call(this,e[d],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(d,e){var b=this.errorsFor(d);if(b.length){b.removeClass(this.settings.validClass).addClass(this.settings.errorClass);b.attr("generated")&&b.html(e)}else{b=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(d),generated:true}).addClass(this.settings.errorClass).html(e||"");if(this.settings.wrapper){b=b.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(b).length){this.settings.errorPlacement?this.settings.errorPlacement(b,a(d)):b.insertAfter(d)}}if(!e&&this.settings.success){b.text("");typeof this.settings.success=="string"?b.addClass(this.settings.success):this.settings.success(b)}this.toShow=this.toShow.add(b)},errorsFor:function(d){var b=this.idOrName(d);return this.errors().filter(function(){return a(this).attr("for")==b})},idOrName:function(b){return this.groups[b.name]||(this.checkable(b)?b.name:b.id||b.name)},validationTargetFor:function(b){if(this.checkable(b)){b=this.findByName(b.name).not(this.settings.ignore)[0]}return b},checkable:function(b){return/radio|checkbox/i.test(b.type)},findByName:function(b){var d=this.currentForm;return a(document.getElementsByName(b)).map(function(e,f){return f.form==d&&f.name==b&&f||null})},getLength:function(d,b){switch(b.nodeName.toLowerCase()){case"select":return a("option:selected",b).length;case"input":if(this.checkable(b)){return this.findByName(b.name).filter(":checked").length}}return d.length},depend:function(d,b){return this.dependTypes[typeof d]?this.dependTypes[typeof d](d,b):true},dependTypes:{"boolean":function(d,b){return d},string:function(d,b){return !!a(d,b.form).length},"function":function(d,b){return d(b)}},optional:function(b){return !a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch"},startRequest:function(b){if(!this.pending[b.name]){this.pendingRequest++;this.pending[b.name]=true}},stopRequest:function(b,d){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[b.name];if(d&&this.pendingRequest==0&&this.formSubmitted&&this.form()){a(this.currentForm).submit();this.formSubmitted=false}else{if(!d&&this.pendingRequest==0&&this.formSubmitted){a(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}}},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:true,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(b,d){b.constructor==String?this.classRuleSettings[b]=d:a.extend(this.classRuleSettings,b)},classRules:function(d){var e={};var b=a(d).attr("class");b&&a.each(b.split(" "),function(){if(this in a.validator.classRuleSettings){a.extend(e,a.validator.classRuleSettings[this])}});return e},attributeRules:function(d){var f={};var b=a(d);for(var g in a.validator.methods){var e;if(g==="required"&&typeof a.fn.prop==="function"){e=b.prop(g)}else{e=b.attr(g)}if(e){f[g]=e}else{if(b[0].getAttribute("type")===g){f[g]=true}}}if(f.maxlength&&/-1|2147483647|524288/.test(f.maxlength)){delete f.maxlength}return f},metadataRules:function(b){if(!a.metadata){return{}}var d=a.data(b.form,"validator").settings.meta;return d?a(b).metadata()[d]:a(b).metadata()},staticRules:function(d){var e={};var b=a.data(d.form,"validator");if(b.settings.rules){e=a.validator.normalizeRule(b.settings.rules[d.name])||{}}return e},normalizeRules:function(d,b){a.each(d,function(g,f){if(f===false){delete d[g];return}if(f.param||f.depends){var e=true;switch(typeof f.depends){case"string":e=!!a(f.depends,b.form).length;break;case"function":e=f.depends.call(b,b);break}if(e){d[g]=f.param!==undefined?f.param:true}else{delete d[g]}}});a.each(d,function(e,f){d[e]=a.isFunction(f)?f(b):f});a.each(["minlength","maxlength","min","max"],function(){if(d[this]){d[this]=Number(d[this])}});a.each(["rangelength","range"],function(){if(d[this]){d[this]=[Number(d[this][0]),Number(d[this][1])]}});if(a.validator.autoCreateRanges){if(d.min&&d.max){d.range=[d.min,d.max];delete d.min;delete d.max}if(d.minlength&&d.maxlength){d.rangelength=[d.minlength,d.maxlength];delete d.minlength;delete d.maxlength}}if(d.messages){delete d.messages}return d},normalizeRule:function(d){if(typeof d=="string"){var b={};a.each(d.split(/\s/),function(){b[this]=true});d=b}return d},addMethod:function(b,e,d){a.validator.methods[b]=e;a.validator.messages[b]=d!=undefined?d:a.validator.messages[b];if(e.length<3){a.validator.addClassRules(b,a.validator.normalizeRule(b))}},methods:{required:function(d,b,f){if(!this.depend(f,b)){return"dependency-mismatch"}switch(b.nodeName.toLowerCase()){case"select":var e=a(b).val();return e&&e.length>0;case"input":if(this.checkable(b)){return this.getLength(d,b)>0}default:return a.trim(d).length>0}},remote:function(g,d,h){if(this.optional(d)){return"dependency-mismatch"}var e=this.previousValue(d);if(!this.settings.messages[d.name]){this.settings.messages[d.name]={}}e.originalMessage=this.settings.messages[d.name].remote;this.settings.messages[d.name].remote=e.message;h=typeof h=="string"&&{url:h}||h;if(this.pending[d.name]){return"pending"}if(e.old===g){return e.valid}e.old=g;var b=this;this.startRequest(d);var f={};f[d.name]=g;a.ajax(a.extend(true,{url:h,mode:"abort",port:"validate"+d.name,dataType:"json",data:f,success:function(j){b.settings.messages[d.name].remote=e.originalMessage;var l=j===true;if(l){var i=b.formSubmitted;b.prepareElement(d);b.formSubmitted=i;b.successList.push(d);b.showErrors()}else{var m={};var k=j||b.defaultMessage(d,"remote");m[d.name]=e.message=a.isFunction(k)?k(g):k;b.showErrors(m)}e.valid=l;b.stopRequest(d,l)}},h));return"pending"},minlength:function(d,b,e){return this.optional(b)||this.getLength(a.trim(d),b)>=e},maxlength:function(d,b,e){return this.optional(b)||this.getLength(a.trim(d),b)<=e},rangelength:function(e,b,f){var d=this.getLength(a.trim(e),b);return this.optional(b)||(d>=f[0]&&d<=f[1])},min:function(d,b,e){return this.optional(b)||d>=e},max:function(d,b,e){return this.optional(b)||d<=e},range:function(d,b,e){return this.optional(b)||(d>=e[0]&&d<=e[1])},email:function(d,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(d)},url:function(d,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(d)},date:function(d,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(d))},dateISO:function(d,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(d)},number:function(d,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(d)},digits:function(d,b){return this.optional(b)||/^\d+$/.test(d)},creditcard:function(g,d){if(this.optional(d)){return"dependency-mismatch"}if(/[^0-9 -]+/.test(g)){return false}var h=0,f=0,b=false;g=g.replace(/\D/g,"");for(var i=g.length-1;i>=0;i--){var e=g.charAt(i);var f=parseInt(e,10);if(b){if((f*=2)>9){f-=9}}h+=f;b=!b}return(h%10)==0},accept:function(d,b,e){e=typeof e=="string"?e.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||d.match(new RegExp(".("+e+")$","i"))},equalTo:function(d,b,f){var e=a(f).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(b).valid()});return d==e.val()}}});a.format=a.validator.format})(jQuery);(function(d){var a={};if(d.ajaxPrefilter){d.ajaxPrefilter(function(g,f,h){var e=g.port;if(g.mode=="abort"){if(a[e]){a[e].abort()}a[e]=h}})}else{var b=d.ajax;d.ajax=function(f){var g=("mode" in f?f:d.ajaxSettings).mode,e=("port" in f?f:d.ajaxSettings).port;if(g=="abort"){if(a[e]){a[e].abort()}return(a[e]=b.apply(this,arguments))}return b.apply(this,arguments)}}})(jQuery);(function(a){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){a.each({focus:"focusin",blur:"focusout"},function(d,b){a.event.special[b]={setup:function(){this.addEventListener(d,e,true)},teardown:function(){this.removeEventListener(d,e,true)},handler:function(f){arguments[0]=a.event.fix(f);arguments[0].type=b;return a.event.handle.apply(this,arguments)}};function e(f){f=a.event.fix(f);f.type=b;return a.event.handle.call(this,f)}})}a.extend(a.fn,{validateDelegate:function(e,d,b){return this.bind(d,function(f){var g=a(f.target);if(g.is(e)){return b.apply(g,arguments)}})}})})(jQuery);(function($){$.toJSON=function(o){if(typeof(JSON)=="object"&&JSON.stringify){return JSON.stringify(o)}var type=typeof(o);if(o===null){return"null"}if(type=="undefined"){return undefined}if(type=="number"||type=="boolean"){return o+""}if(type=="string"){return $.quoteString(o)}if(type=="object"){if(typeof o.toJSON=="function"){return $.toJSON(o.toJSON())}if(o.constructor===Date){var month=o.getUTCMonth()+1;if(month<10){month="0"+month}var day=o.getUTCDate();if(day<10){day="0"+day}var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10){hours="0"+hours}var minutes=o.getUTCMinutes();if(minutes<10){minutes="0"+minutes}var seconds=o.getUTCSeconds();if(seconds<10){seconds="0"+seconds}var milli=o.getUTCMilliseconds();if(milli<100){milli="0"+milli}if(milli<10){milli="0"+milli}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(o.constructor===Array){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i])||"null")}return"["+ret.join(",")+"]"}var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}if(typeof o[k]=="function"){continue}var val=$.toJSON(o[k]);pairs.push(name+":"+val)}return"{"+pairs.join(", ")+"}"}};$.evalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}return eval("("+src+")")};$.secureEvalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}};$.quoteString=function(string){if(string.match(_escapeable)){return'"'+string.replace(_escapeable,function(a){var c=_meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}})(jQuery);
/*
 * jQuery Form Plugin
 * version: 3.32.0-2013.04.09
 * @requires jQuery v1.5 or later
 * Copyright (c) 2013 M. Alsup
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses.
 * https://github.com/malsup/form#copyright-and-license
 */
(function(g){var d={};d.fileapi=g("<input type='file'/>").get(0).files!==undefined;d.formdata=window.FormData!==undefined;var f=!!g.fn.prop;g.fn.attr2=function(){if(!f){return this.attr.apply(this,arguments)}var h=this.prop.apply(this,arguments);if((h&&h.jquery)||typeof h==="string"){return h}return this.attr.apply(this,arguments)};g.fn.ajaxSubmit=function(j){if(!this.length){e("ajaxSubmit: skipping submit process - no element selected");return this}var i,B,m,p=this;if(typeof j=="function"){j={success:j}}i=this.attr2("method");B=this.attr2("action");m=(typeof B==="string")?g.trim(B):"";m=m||window.location.href||"";if(m){m=(m.match(/^([^#]+)/)||[])[1]}j=g.extend(true,{url:m,success:g.ajaxSettings.success,type:i||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},j);var v={};this.trigger("form-pre-serialize",[this,j,v]);if(v.veto){e("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(j.beforeSerialize&&j.beforeSerialize(this,j)===false){e("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var n=j.traditional;if(n===undefined){n=g.ajaxSettings.traditional}var t=[];var E,F=this.formToArray(j.semantic,t);if(j.data){j.extraData=j.data;E=g.param(j.data,n)}if(j.beforeSubmit&&j.beforeSubmit(F,this,j)===false){e("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[F,this,j,v]);if(v.veto){e("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var z=g.param(F,n);if(E){z=(z?(z+"&"+E):E)}if(j.type.toUpperCase()=="GET"){j.url+=(j.url.indexOf("?")>=0?"&":"?")+z;j.data=null}else{j.data=z}var H=[];if(j.resetForm){H.push(function(){p.resetForm()})}if(j.clearForm){H.push(function(){p.clearForm(j.includeHidden)})}if(!j.dataType&&j.target){var l=j.success||function(){};H.push(function(q){var k=j.replaceTarget?"replaceWith":"html";g(j.target)[k](q).each(l,arguments)})}else{if(j.success){H.push(j.success)}}j.success=function(K,q,L){var J=j.context||this;for(var I=0,k=H.length;I<k;I++){H[I].apply(J,[K,q,L||p,p])}};var D=g('input[type=file]:enabled[value!=""]',this);var r=D.length>0;var C="multipart/form-data";var y=(p.attr("enctype")==C||p.attr("encoding")==C);var x=d.fileapi&&d.formdata;e("fileAPI :"+x);var s=(r||y)&&!x;var w;if(j.iframe!==false&&(j.iframe||s)){if(j.closeKeepAlive){g.get(j.closeKeepAlive,function(){w=G(F)})}else{w=G(F)}}else{if((r||y)&&x){w=u(F)}else{w=g.ajax(j)}}p.removeData("jqxhr").data("jqxhr",w);for(var A=0;A<t.length;A++){t[A]=null}this.trigger("form-submit-notify",[this,j]);return this;function h(K){var L=g.param(K).split("&");var q=L.length;var k=[];var J,I;for(J=0;J<q;J++){L[J]=L[J].replace(/\+/g," ");I=L[J].split("=");k.push([decodeURIComponent(I[0]),decodeURIComponent(I[1])])}return k}function u(q){var k=new FormData();for(var I=0;I<q.length;I++){k.append(q[I].name,q[I].value)}if(j.extraData){var L=h(j.extraData);for(I=0;I<L.length;I++){if(L[I]){k.append(L[I][0],L[I][1])}}}j.data=null;var K=g.extend(true,{},g.ajaxSettings,j,{contentType:false,processData:false,cache:false,type:i||"POST"});if(j.uploadProgress){K.xhr=function(){var M=jQuery.ajaxSettings.xhr();if(M.upload){M.upload.addEventListener("progress",function(Q){var P=0;var N=Q.loaded||Q.position;var O=Q.total;if(Q.lengthComputable){P=Math.ceil(N/O*100)}j.uploadProgress(Q,N,O,P)},false)}return M}}K.data=null;var J=K.beforeSend;K.beforeSend=function(N,M){M.data=k;if(J){J.call(this,N,M)}};return g.ajax(K)}function G(af){var L=p[0],K,ab,V,ad,Y,N,Q,O,P,Z,ac,T;var ai=g.Deferred();if(af){for(ab=0;ab<t.length;ab++){K=g(t[ab]);if(f){K.prop("disabled",false)}else{K.removeAttr("disabled")}}}V=g.extend(true,{},g.ajaxSettings,j);V.context=V.context||V;Y="jqFormIO"+(new Date().getTime());if(V.iframeTarget){N=g(V.iframeTarget);Z=N.attr2("name");if(!Z){N.attr2("name",Y)}else{Y=Z}}else{N=g('<iframe name="'+Y+'" src="'+V.iframeSrc+'" />');N.css({position:"absolute",top:"-1000px",left:"-1000px"})}Q=N[0];O={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(aj){var ak=(aj==="timeout"?"timeout":"aborted");e("aborting upload... "+ak);this.aborted=1;try{if(Q.contentWindow.document.execCommand){Q.contentWindow.document.execCommand("Stop")}}catch(al){}N.attr("src",V.iframeSrc);O.error=ak;if(V.error){V.error.call(V.context,O,ak,aj)}if(ad){g.event.trigger("ajaxError",[O,V,ak])}if(V.complete){V.complete.call(V.context,O,ak)}}};ad=V.global;if(ad&&0===g.active++){g.event.trigger("ajaxStart")}if(ad){g.event.trigger("ajaxSend",[O,V])}if(V.beforeSend&&V.beforeSend.call(V.context,O,V)===false){if(V.global){g.active--}ai.reject();return ai}if(O.aborted){ai.reject();return ai}P=L.clk;if(P){Z=P.name;if(Z&&!P.disabled){V.extraData=V.extraData||{};V.extraData[Z]=P.value;if(P.type=="image"){V.extraData[Z+".x"]=L.clk_x;V.extraData[Z+".y"]=L.clk_y}}}var U=1;var R=2;function S(al){var ak=null;try{if(al.contentWindow){ak=al.contentWindow.document}}catch(aj){e("cannot get iframe.contentWindow document: "+aj)}if(ak){return ak}try{ak=al.contentDocument?al.contentDocument:al.document}catch(aj){e("cannot get iframe.contentDocument: "+aj);ak=al.document}return ak}var J=g("meta[name=csrf-token]").attr("content");var I=g("meta[name=csrf-param]").attr("content");if(I&&J){V.extraData=V.extraData||{};V.extraData[I]=J}function aa(){var al=p.attr2("target"),aj=p.attr2("action");L.setAttribute("target",Y);if(!i){L.setAttribute("method","POST")}if(aj!=V.url){L.setAttribute("action",V.url)}if(!V.skipEncodingOverride&&(!i||/post/i.test(i))){p.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(V.timeout){T=setTimeout(function(){ac=true;X(U)},V.timeout)}function am(){try{var aq=S(Q).readyState;e("state = "+aq);if(aq&&aq.toLowerCase()=="uninitialized"){setTimeout(am,50)}}catch(ar){e("Server abort: ",ar," (",ar.name,")");X(R);if(T){clearTimeout(T)}T=undefined}}var ak=[];try{if(V.extraData){for(var ap in V.extraData){if(V.extraData.hasOwnProperty(ap)){if(g.isPlainObject(V.extraData[ap])&&V.extraData[ap].hasOwnProperty("name")&&V.extraData[ap].hasOwnProperty("value")){ak.push(g('<input type="hidden" name="'+V.extraData[ap].name+'">').val(V.extraData[ap].value).appendTo(L)[0])}else{ak.push(g('<input type="hidden" name="'+ap+'">').val(V.extraData[ap]).appendTo(L)[0])}}}}if(!V.iframeTarget){N.appendTo("body");if(Q.attachEvent){Q.attachEvent("onload",X)}else{Q.addEventListener("load",X,false)}}setTimeout(am,15);try{console.log(L.target);L.submit()}catch(an){var ao=document.createElement("form").submit;ao.apply(L)}}finally{L.setAttribute("action",aj);if(al){L.setAttribute("target",al)}else{p.removeAttr("target")}g(ak).remove()}}if(V.forceSync){aa()}else{setTimeout(aa,10)}var ag,ah,ae=50,M;function X(ap){if(O.aborted||M){return}ah=S(Q);if(!ah){e("cannot access response document");ap=R}if(ap===U&&O){O.abort("timeout");ai.reject(O,"timeout");return}else{if(ap==R&&O){O.abort("server abort");ai.reject(O,"error","server abort");return}}if(!ah||ah.location.href==V.iframeSrc){if(!ac){return}}if(Q.detachEvent){Q.detachEvent("onload",X)}else{Q.removeEventListener("load",X,false)}var an="success",ar;try{if(ac){throw"timeout"}var am=V.dataType=="xml"||ah.XMLDocument||g.isXMLDoc(ah);e("isXml="+am);if(!am&&window.opera&&(ah.body===null||!ah.body.innerHTML)){if(--ae){e("requeing onLoad callback, DOM not available");setTimeout(X,250);return}}var at=ah.body?ah.body:ah.documentElement;O.responseText=at?at.innerHTML:null;O.responseXML=ah.XMLDocument?ah.XMLDocument:ah;if(am){V.dataType="xml"}O.getResponseHeader=function(aw){var av={"content-type":V.dataType};return av[aw]};if(at){O.status=Number(at.getAttribute("status"))||O.status;O.statusText=at.getAttribute("statusText")||O.statusText}var aj=(V.dataType||"").toLowerCase();var aq=/(json|script|text)/.test(aj);if(aq||V.textarea){var ao=ah.getElementsByTagName("textarea")[0];if(ao){O.responseText=ao.value;O.status=Number(ao.getAttribute("status"))||O.status;O.statusText=ao.getAttribute("statusText")||O.statusText}else{if(aq){var ak=ah.getElementsByTagName("pre")[0];var au=ah.getElementsByTagName("body")[0];if(ak){O.responseText=ak.textContent?ak.textContent:ak.innerText}else{if(au){O.responseText=au.textContent?au.textContent:au.innerText}}}}}else{if(aj=="xml"&&!O.responseXML&&O.responseText){O.responseXML=W(O.responseText)}}try{ag=k(O,aj,V)}catch(al){an="parsererror";O.error=ar=(al||an)}}catch(al){e("error caught: ",al);an="error";O.error=ar=(al||an)}if(O.aborted){e("upload aborted");an=null}if(O.status){an=(O.status>=200&&O.status<300||O.status===304)?"success":"error"}if(an==="success"){if(V.success){V.success.call(V.context,ag,"success",O)}ai.resolve(O.responseText,"success",O);if(ad){g.event.trigger("ajaxSuccess",[O,V])}}else{if(an){if(ar===undefined){ar=O.statusText}if(V.error){V.error.call(V.context,O,an,ar)}ai.reject(O,"error",ar);if(ad){g.event.trigger("ajaxError",[O,V,ar])}}}if(ad){g.event.trigger("ajaxComplete",[O,V])}if(ad&&!--g.active){g.event.trigger("ajaxStop")}if(V.complete){V.complete.call(V.context,O,an)}M=true;if(V.timeout){clearTimeout(T)}setTimeout(function(){if(!V.iframeTarget){N.remove()}O.responseXML=null},100)}var W=g.parseXML||function(aj,ak){if(window.ActiveXObject){ak=new ActiveXObject("Microsoft.XMLDOM");ak.async="false";ak.loadXML(aj)}else{ak=(new DOMParser()).parseFromString(aj,"text/xml")}return(ak&&ak.documentElement&&ak.documentElement.nodeName!="parsererror")?ak:null};var q=g.parseJSON||function(aj){return window["eval"]("("+aj+")")};var k=function(ao,am,al){var ak=ao.getResponseHeader("content-type")||"",aj=am==="xml"||!am&&ak.indexOf("xml")>=0,an=aj?ao.responseXML:ao.responseText;if(aj&&an.documentElement.nodeName==="parsererror"){if(g.error){g.error("parsererror")}}if(al&&al.dataFilter){an=al.dataFilter(an,am)}if(typeof an==="string"){if(am==="json"||!am&&ak.indexOf("json")>=0){an=q(an)}else{if(am==="script"||!am&&ak.indexOf("javascript")>=0){g.globalEval(an)}}}return an};return ai}};g.fn.ajaxForm=function(h){h=h||{};h.delegation=h.delegation&&g.isFunction(g.fn.on);if(!h.delegation&&this.length===0){var i={s:this.selector,c:this.context};if(!g.isReady&&i.s){e("DOM not ready, queuing ajaxForm");g(function(){g(i.s,i.c).ajaxForm(h)});return this}e("terminating; zero elements found by selector"+(g.isReady?"":" (DOM not ready)"));return this}if(h.delegation){g(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,a).on("submit.form-plugin",this.selector,h,b).on("click.form-plugin",this.selector,h,a);return this}return this.ajaxFormUnbind().bind("submit.form-plugin",h,b).bind("click.form-plugin",h,a)};function b(i){var h=i.data;if(!i.isDefaultPrevented()){i.preventDefault();g(this).ajaxSubmit(h)}}function a(l){var k=l.target;var i=g(k);if(!(i.is("[type=submit],[type=image]"))){var h=i.closest("[type=submit]");if(h.length===0){return}k=h[0]}var j=this;j.clk=k;if(k.type=="image"){if(l.offsetX!==undefined){j.clk_x=l.offsetX;j.clk_y=l.offsetY}else{if(typeof g.fn.offset=="function"){var m=i.offset();j.clk_x=l.pageX-m.left;j.clk_y=l.pageY-m.top}else{j.clk_x=l.pageX-k.offsetLeft;j.clk_y=l.pageY-k.offsetTop}}}setTimeout(function(){j.clk=j.clk_x=j.clk_y=null},100)}g.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};g.fn.formToArray=function(z,h){var y=[];if(this.length===0){return y}var m=this[0];var r=z?m.getElementsByTagName("*"):m.elements;if(!r){return y}var t,s,q,A,p,w,l;for(t=0,w=r.length;t<w;t++){p=r[t];q=p.name;if(!q||p.disabled){continue}if(z&&m.clk&&p.type=="image"){if(m.clk==p){y.push({name:q,value:g(p).val(),type:p.type});y.push({name:q+".x",value:m.clk_x},{name:q+".y",value:m.clk_y})}continue}A=g.fieldValue(p,true);if(A&&A.constructor==Array){if(h){h.push(p)}for(s=0,l=A.length;s<l;s++){y.push({name:q,value:A[s]})}}else{if(d.fileapi&&p.type=="file"){if(h){h.push(p)}var k=p.files;if(k.length){for(s=0;s<k.length;s++){y.push({name:q,value:k[s],type:p.type})}}else{y.push({name:q,value:"",type:p.type})}}else{if(A!==null&&typeof A!="undefined"){if(h){h.push(p)}y.push({name:q,value:A,type:p.type,required:p.required})}}}}if(!z&&m.clk){var u=g(m.clk),x=u[0];q=x.name;if(q&&!x.disabled&&x.type=="image"){y.push({name:q,value:u.val()});y.push({name:q+".x",value:m.clk_x},{name:q+".y",value:m.clk_y})}}return y};g.fn.formSerialize=function(h){return g.param(this.formToArray(h))};g.fn.fieldSerialize=function(i){var h=[];this.each(function(){var m=this.name;if(!m){return}var k=g.fieldValue(this,i);if(k&&k.constructor==Array){for(var l=0,j=k.length;l<j;l++){h.push({name:m,value:k[l]})}}else{if(k!==null&&typeof k!="undefined"){h.push({name:this.name,value:k})}}});return g.param(h)};g.fn.fieldValue=function(n){for(var m=[],k=0,h=this.length;k<h;k++){var l=this[k];var j=g.fieldValue(l,n);if(j===null||typeof j=="undefined"||(j.constructor==Array&&!j.length)){continue}if(j.constructor==Array){g.merge(m,j)}else{m.push(j)}}return m};g.fieldValue=function(h,q){var k=h.name,x=h.type,y=h.tagName.toLowerCase();if(q===undefined){q=true}if(q&&(!k||h.disabled||x=="reset"||x=="button"||(x=="checkbox"||x=="radio")&&!h.checked||(x=="submit"||x=="image")&&h.form&&h.form.clk!=h||y=="select"&&h.selectedIndex==-1)){return null}if(y=="select"){var r=h.selectedIndex;if(r<0){return null}var u=[],j=h.options;var m=(x=="select-one");var s=(m?r+1:j.length);for(var l=(m?r:0);l<s;l++){var p=j[l];if(p.selected){var w=p.value;if(!w){w=(p.attributes&&p.attributes.value&&!(p.attributes.value.specified))?p.text:p.value}if(m){return w}u.push(w)}}return u}return g(h).val()};g.fn.clearForm=function(h){return this.each(function(){g("input,select,textarea",this).clearFields(h)})};g.fn.clearFields=g.fn.clearInputs=function(h){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var k=this.type,j=this.tagName.toLowerCase();if(i.test(k)||j=="textarea"){this.value=""}else{if(k=="checkbox"||k=="radio"){this.checked=false}else{if(j=="select"){this.selectedIndex=-1}else{if(k=="file"){if(/MSIE/.test(navigator.userAgent)){g(this).replaceWith(g(this).clone(true))}else{g(this).val("")}}else{if(h){if((h===true&&/hidden/.test(k))||(typeof h=="string"&&g(this).is(h))){this.value=""}}}}}}})};g.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};g.fn.enable=function(h){if(h===undefined){h=true}return this.each(function(){this.disabled=!h})};g.fn.selected=function(h){if(h===undefined){h=true}return this.each(function(){var i=this.type;if(i=="checkbox"||i=="radio"){this.checked=h}else{if(this.tagName.toLowerCase()=="option"){var j=g(this).parent("select");if(h&&j[0]&&j[0].type=="select-one"){j.find("option").selected(false)}this.selected=h}}})};g.fn.ajaxSubmit.debug=false;function e(){if(!g.fn.ajaxSubmit.debug){return}var h="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(h)}else{if(window.opera&&window.opera.postError){window.opera.postError(h)}}}})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.widget",{options:{mode:"browser"},_create:function(){var d=this,f=this.options,e=this.element;f.mode=f.readonly&&f.mode=="edit"?"browser":f.mode;e.addClass("an-widget "+f.mode)[0].contentEditable=false;f.metadata=e.getMetadata()||{};f.attributes=attributes(e.get(0));f["transient"]=f.attributes["transient"];f.id=e.attr("id");if(f.id){f.id=f.id.replace(/-/g,".")}f.type=e.attr("type");if(a.type(f.parent)=="function"){f.parent=f.parent()}this.content=e.children("div.content");if(this.content.size()==0){this.content=a("<div class='content'/>").appendTo(e)}this._makeResizable();e.bind("metadatachanged.widget",function(i,h,g){i.stopImmediatePropagation();d._reloadMetadata(h,g)}).bind("attributeschanged.widget",function(i,g,h){i.stopImmediatePropagation();f.attributes=g;d._trigger("optionchanged",null,{key:"attributes",value:g,oldValue:h})}).bind("dblclick.widget click.widget change.widget",function(g){if(a(g.target).closest(".widget")[0]==d.element[0]){setTimeout(function(){e.trigger(a.Event(g,{type:"widget"+g.type}),d)},20)}})},_init:function(){this.refresh()},selectable:function(d){return this.options.mode=="design"},_makeResizable:function(){var d=this,g=this.options,f=this.element,e=null;f.removeClass("fill-width auto-width fill-height auto-height");if(g.width=="fill"||g.width=="auto"){f.css("width","").addClass(g.width+"-width")}else{e="e"}if(g.height=="fill"||g.height=="auto"){f.css("height","").addClass(g.height+"-height")}else{e=e?(e+",s,se"):"s"}if(e&&(g.mode=="design"||g.resizable)){f.resizable({handles:e,stop:function(i,h){d._trigger("resize",null,{size:h.size,oldSize:h.originalSize})}})}},option:function(d,e){var f=this.options;if(d==="mode"&&e==="edit"&&f.readonly){e="browser"}if(d==="value"&&e===b){return f.value}if(d==="actionSet"&&e===b){return f.actioSet}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(e,f){var g=this.options,d=g[e];if(!equals(f,d)){a.Widget.prototype._setOption.apply(this,arguments);this._handleChange(e,f,d);this._trigger("optionchanged",null,{key:e,value:f,oldValue:d,isTransient:g.isTransient})}return this},_handleChange:function(e,f,d){if(e==="mode"||e==="value"){if(e==="mode"){this.element.removeClass(d).addClass(f)}this.refresh()}else{if(e=="width"||e=="height"){this._makeResizable()}else{if(e=="readonly"){if(f){this.option("mode","browser")}else{this.option("mode","edit")}}}}},_reloadMetadata:function(e,d){this.options.metadata=e;this.option(e[this.widgetName]);this.refresh();this._trigger("optionchanged",null,{key:"metadata",value:e,oldValue:d})},_updateMetadata:function(){var f=this.options,e=this.element,d=e.getMetadata();if(!equals(f.metadata,d)){e.setMetadata(f.metadata);this._trigger("optionchanged",null,{key:"metadata",value:f.metadata,oldValue:d})}},refresh:function(){var d=this.options;this["_"+d.mode]&&this["_"+d.mode]()},highlight:function(d){this.element.toggleClass("an-state-hover",d)},scrollTo:function(){var e=this.options,d={onlyIfOutside:true,offsetTop:50,offsetLeft:50};if(e.mode=="design"){e.parent.scrollTo(e.id,d)}else{this.element.ScrollTo(d)}},destroy:function(){this.element.resizable("destroy").unbind(".widget").removeAttr("contenteditable").removeClass("an-widget browser design edit selected");return a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.field",a.an.widget,{options:{value:"",},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var f=this.options,e=this.element;e.addClass("an-field");var d={};if(f.width){d.width=f.width}if(f.height){d.height=f.height}this.content.empty();if(!a.isEmptyObject(d)){this.content.css(d)}f.isTransient=e.attr("transient");this._createControl();this._createLabel()},_createControl:function(){},_createLabel:function(){var e=this.options,d=this.element;if(e.label){a("<label/>").attr("for",e.id).html(e.label).prependTo(d)}},destroy:function(){this.content.remove();this.element.removeClass("an-field").children("label").remove();return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.box",a.an.widget,{options:{visibleButtonCount:3,link:"raw"},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var e=this.options,d=this.element;d.addClass("an-box ui-corner-all").addClass(e.link=="raw"?"raw":"link").children(".title-bar").remove();this._showTitleBar(!e.hideTitleBar);this._showFootButtons(e.footAreaButtons||[]);d.bind("contextmenu2.box contextmenu.box",function(f){if((e.contextmenu2&&f.type=="contextmenu2")||(!e.contextmenu2&&f.type=="contextmenu")){var g={};if(e.mode=="design"){g.select={type:"menuItem",text:"Select",handler:function(){d.trigger("click")}}}if(!a.isEmptyObject(g)){a(f.target).menu({autoShow:true,menuPosition:{of:f,my:"left top",at:"left bottom"},actions:g,select:function(i,h){a(this).menu("destroy")},collapseAll:function(h){a(this).menu("destroy")}})}}f.preventDefault()})},selectable:function(f){var g=this.options,d=f.target;if(g.hideTitleBar){return d==this.element[0]}else{return a(d).closest("div.title-bar")[0]==this.titleBar[0]}},_showTitleBar:function(d){var f=this.options,e=this.element;if(d){if(!this.titleBar){this.titleBar=a("<div class='title-bar ui-widget-header ui-corner-top'/>").prependTo(this.element);this.title=a("<div class='title'/>").html(f.title).appendTo(this.titleBar);this.toolbar=a("<div class='toolbar'/>").appendTo(this.titleBar)}this._refreshToolbarButtons()}else{e.removeClass("title-bar");this.titleBar&&this.titleBar.remove();delete this.titleBar}},_refreshToolbarButtons:function(){var f=this,j=this.options,h=j.toolbarButtons||[];a.each(h,function(i,l){if(i>=j.visibleButtonCount){return false}a("<button class='title-button'/>").appendTo(f.toolbar).button({label:l.label}).click(function(k){f.element.trigger("boxtoolbarbuttonclick",[f,l.id]);k.preventDefault();k.stopImmediatePropagation()})});if(h.length>j.visibleButtonCount){var e=[];for(var g=j.visibleButtonCount;g<h.length;g++){e.push({id:h[g].id,type:"menuItem",text:h[g].label,handler:function(){f.element.trigger("toolbarbuttonclick",[f,this.id])},enabled:function(){return true}})}var d=a("<button class='box-menu'/>").button({label:"Box Menu",text:false,icons:{primary:"box-menu-icon"}}).appendTo(f.toolbar);d.menu({triggerEvent:"click",menuPosition:{of:d,my:"right top",at:"right bottom"},actions:e,select:function(){a(this).menu("collapseAll")}}).click(function(i){i.preventDefault()}).blur(function(i){d.menu("collapseAll")})}},_showFootButtons:function(f){var d=this,e=this.element;if(f&&f.length>0){if(!this.footArea){this.footArea=a("<div class='foot-area'/>").appendTo(e)}else{this.footArea.empty()}a.each(f,function(g,h){a("<button class='foot-button'/>").attr("id",h.id).html(h.label).prependTo(d.footArea).button().click(function(i){d.element.trigger("boxfootareabuttonclick",[d,h.id]);i.preventDefault();i.stopImmediatePropagation()})})}else{e.removeClass("foot-area");this.footArea&&this.footArea.remove();delete this.footArea}},newDocument:function(g,h){h=h||{};var e=this,j=this.options,d=h.dbId||j.dbId,f=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var l=k.option("document"),m=h.title||l.title||l._id;e._showFootButtons(h.footAreaButtons||[]);e.option("title",m);h.opened&&h.opened(k)}});i.mode=i.mode!="design"?"edit":i.mode;i.mobile=h.mobile;if(h.mobile&&h.mode=="design"){a.ans.getDoc(d,h.parent,null,function(l,n){if(l){console.log("Get parent document "+h.parent+" error:"+l)}else{var k=Model.rootId(g),m=a.extend(true,{},h["default"],{_id:h.id||new ObjectId().toString(),type:g});if(m._path){m._path=m._path.replace(/[^,]+,$/,m._id+",")}else{if(k){m._path=k+","+m._id+","}}if(n&&n._path){m._path=n._path+m._id+","}if(m.type==Model.FORM||m.type==Model.PAGE){f.page({mode:"design",mobile:true,page:m})}else{Model.newDocument(f,d,g,i)}}})}else{Model.newDocument(f,d,g,i)}return this},openDocument:function(f,h){h=h||{};var e=this,j=this.options,d=h.dbId||j.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var l=k.option("document"),m=h.title||l.title||l._id;e._showFootButtons(h.footAreaButtons||[]);e.option("title",m);h.opened&&h.opened(k)}});if(j.mobile&&j.mode=="design"){Model.getPages(d,[f],function(k,l){g.page({mode:"design",page:l[0],mobile:true})})}else{Model.openDocument(g,d,f,i)}return this},saveDocument:function(d){d=d||{};var e=this.linkedWidget();if(e&&e.option("isDocumentEditor")){e.save(d)}return this},openForm:function(j,g){g=g||{};a.extend(true,g,{isFormEditor:true});var e=this,i=this.options,d=g.dbId||i.dbId,f=a("<div class='target'/>").appendTo(this.content.empty()),h=a.extend(true,{mode:g.mode!="design"?"edit":g.mode},g,{opened:function(k){var l=k.option("currentForm"),m=g.title||l.title||l._id;e._showFootButtons(g.footAreaButtons||[]);e.option("title",m);g.opened&&g.opened(k)}});if(i.mobile&&i.mode=="design"){Model.getPages(d,[j],function(l,k){f.page({mode:"design",page:k[0],document:k[0],mobile:true})})}else{Model.openPage(f,d,j,h)}return this},openView:function(d,h){h=h||{};var f=this,j=this.options,e=h.dbId||j.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var l=k.option("view"),m=h.title||l.title||l._id;f._showFootButtons(h.footAreaButtons||[]);f.option("title",m);h.opened&&h.opened(k)}});Model.openView(g,e,d,i);return this},openPage:function(f,h){h=h||{};a.extend(true,h,{isPageEditor:true});var e=this,j=this.options,d=h.dbId||j.dbId,g=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{mode:h.mode!="design"?"edit":h.mode},h,{opened:function(k){var l=k.option("page"),m=h.title||l.title||l._id;e._showFootButtons(h.footAreaButtons||[]);e.option("title",m);h.opened&&h.opened(k)}});if(j.mobile&&j.mode=="design"){Model.getPages(d,[f],function(l,k){g.page({mode:"design",page:k[0],mobile:true})})}else{Model.openPage(g,d,f,i)}return this},openSideView:function(g,h){h=h||{};var e=this,j=this.options,d=h.dbId||j.dbId,f=a("<div class='target'/>").appendTo(this.content.empty()),i=a.extend(true,{},h,{opened:function(k){var l=h.title||k.option("title")||k.option("_id");e._showFootButtons(h.footAreaButtons||[]);e.option("title",l);h.opened&&h.opened(page)}});Model.openSideView(f,d,g,i);return this},_browser:function(){var k=this.options,f=k.link;this.option("contextmenu2",false);this.content[0].contentEditable=false;if(f&&f!="raw"){var j=this.content.children(".target"),h=j.data(),g=false;for(var d in h){if(a.inArray(d,["editor","gridview","formview","customview","customizedview","page","sideview","explorer","mobilelistview"])!=-1){h[d].option("mode","browser");g=true}}if(!g){var e={dbId:k.odbId||k.dbId,mobile:k.mobile},l=k.targetId;if(k.mobile&&k.mode=="design"){e.mode=k.mode}if(f=="documentType"){this.newDocument(l,e)}else{if(f=="document"){this.openDocument(l,e)}else{if(f=="form"){this.openForm(l,e)}else{if(f=="view"){this.openView(l,e)}else{if(f=="page"){this.openPage(l,e)}else{if(f=="sideView"){this.openSideView(l,e)}}}}}}}}},linkedWidget:function(){var e=this.content.children(".an-view,.an-page,.an-editor,.an-mpage").data(),d=null;if(e){a.each(e,function(){if(a.inArray(this.widgetName,["editor","gridview","formview","customview","view","page","mobilelistview"])!=-1){d=this;return false}})}return d},_edit:function(){var g=this.options,l=g.link;this.option("contextmenu2",false);this.content[0].contentEditable=false;if(l&&l!="raw"){var k=this.content.children(".target"),h=k.data(),d=false;for(var j in h){if(j=="editor"){h[j].option("mode","edit");d=true}if(a.inArray(j,["gridview","formview","view","page","sideview","explorer"])!=-1){h[j].option("mode","browser");d=true}}if(!d){var e=g.targetId,f={dbId:g.odbId||g.dbId},m={mode:"edit",dbId:g.odbId||g.dbId};if(l=="documentType"){this.newDocument(e,m)}else{if(l=="document"){this.openDocument(e,m)}else{if(l=="form"){this.openForm(e,m)}else{if(l=="view"){this.openView(e,f)}else{if(l=="page"){this.openPage(e,m)}else{if(l=="sideView"){this.openSideView(e,f)}}}}}}}}},_design:function(){var e=this.options,d=e.link;if(e.mobile){e.mode="design"}this._browser();this.option("contextmenu2",true);if(d=="raw"){this.content[0].contentEditable=true}},_handleChange:function(e,f,d){if(e==="title"){this.title&&this.title.html(f)}else{if(e==="hideTitleBar"){this._showTitleBar(!f)}}return a.an.widget.prototype._handleChange.apply(this,arguments)},destroy:function(){var e=this.options,d=e.link;if(d&&d!="raw"){this.content.remove()}else{this.content.removeAttr("contenteditable")}this.titleBar&&this.titleBar.remove();this.footArea&&this.footArea.remove();this.element.unbind(".box").removeClass("an-box ui-corner-all title-bar");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
 * This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.inputfield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-inputfield")},_createControl:function(){var d=this,f=this.options;if(f.mobile){var e=this.element.find(".content").eq(0);e.addClass("ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c ui-input-text");this.input=a("<input type='"+f.type+"'/>").attr({name:f.id}).addClass("ui-body-c ui-input-text").bind("change.inputfield keyup.inputfield",function(i){var h=d.input.val(),g=f.value;if(h!=g){f.value=h;d._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}}).bind("dblclick.inputfield",function(g){g.stopImmediatePropagation()}).bind("focus.inputfield",function(g){e.addClass("ui-focus")}).bind("blur.inputfield",function(g){e.removeClass("ui-focus")}).bind("keyup.inputfield",function(g){});if(f.placeholder){this.input.attr("placeholder",f.placeholder)}if(f.value){this.input.attr("value",f.value);this._trigger("optionchanged",null,{key:"value",value:f.value,oldValue:"",isTransient:f.isTransient})}if(f.data_mini){this.input.attr("data-mini",f.data_mini)}}else{this.input=a("<input type='"+f.type+"'/>").attr({name:f.id}).addClass("ui-widget-content ui-corner-all").bind("change.inputfield keyup.inputfield",function(i){var h=d.input.val(),g=f.value;if(h!=g){f.value=h;d._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}}).bind("dblclick.inputfield",function(g){g.stopImmediatePropagation()})}if(!a.isEmptyObject(f.validate)){this.input.addClass(a.toJSON({validate:f.validate}))}this.input.css({width:f.width,height:f.height})},_makeResizable:function(){},_browser:function(){this.input.detach();var d=this.content;if(d.is(".ui-resizable")){d.resizable("destroy")}d.html(this.options.value+"").css("display","")},_edit:function(){this.input.detach().val(this.options.value).appendTo(this.content.empty())},_design:function(){this.input.detach();var d=this,e=this.options,f=this.content;if(f.is(".ui-resizable")){f.resizable("destroy")}f.html(e.value+"").css({width:e.width,height:e.height,display:""}).resizable({stop:function(h,g){e.width=f.width();e.height=f.height();a.extend(true,e.metadata[d.widgetName],{width:e.width,height:e.height});d._updateMetadata();d._trigger("resize",null,{size:g.size,oldSize:g.originalSize})}})},_handleChange:function(e,f,d){if(e==="label"){this.input&&this.input.remove();this.element.children("label").remove();this._createControl();this._createLabel()}else{a.an.field.prototype._handleChange.apply(this,arguments)}},highlight:function(d){(this.options.mode=="edit"?this.input:this.element).toggleClass("an-state-hover",d)},destroy:function(){this.input&&this.input.unbind(".inputfield").remove();this.element.removeClass("an-inputfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.textfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-textfield")},destroy:function(){this.element.removeClass("an-textfield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.checkboxfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-checkboxfield");this.content.hide()},_createControl:function(){var e=this,h=this.options,f=this.element,i=this.content;if(h.mobile){var g={};if(h.selectItems.length>1){var d=a("<fieldset data-role='controlgroup' />").appendTo(i);if(h.orientation=="horizontal"){d.attr({"data-type":"horizontal"})}a.each(h.selectItems||[],function(l,j){this.input=a("<input type='checkbox'/>").attr({id:h.id+l,name:h.id+l,value:this.value}).appendTo(d);a("<label />").attr({"for":h.id+l}).html(this.label).appendTo(d)})}else{a.each(h.selectItems||[],function(l,j){this.input=a("<input type='checkbox'/>").attr({id:h.id,name:h.id,value:this.value}).addClass("custom").appendTo(i);a("<label  />").attr({"for":h.id}).html(this.label).appendTo(i)})}if(!h.data_theme){h.data_theme="c"}g.theme=h.data_theme;if(h.isMini){g.mini=true}if(a("input[type='checkbox']").checkboxradio){a("input[type='checkbox']").checkboxradio(g);a("fieldset[data-role='controlgroup']").controlgroup()}}else{this.input=a("<input type='checkbox'/>").attr({name:h.id}).addClass("ui-widget-content ui-corner-all").bind("change.checkboxfield",function(l){var k=e.input.prop("checked"),j=h.value;if(k!=j){h.value=k;e._trigger("optionchanged",null,{key:"value",value:k,oldValue:j,isTransient:h.isTransient})}}).bind("dblclick.checkboxfield",function(j){j.stopImmediatePropagation()});if(!a.isEmptyObject(h.validate)){this.input.addClass(a.toJSON({validate:h.validate}))}this.input.appendTo(this.element)}},_handleChange:function(e,f,d){var g=this.options;if(e=="value"){this.input.filter("[value="+g.value+"]").prop("checked",true)}else{if(e=="selectItems"){this.input.remove();this.contents.remove();this.element.children("label,br").remove();this._createControl()}else{return a.an.inputfield.prototype._handleChange.apply(this,arguments)}}},_makeResizable:function(){},_createLabel:function(){var e=this.options,d=this.element;if(e.label){if(!e.mobile){a("<label/>").attr("for",e.id).html(e.label).appendTo(d)}}},_browser:function(){if(!this.options.mobile){this.input.prop("checked",this.options.value).attr("disabled","disabled")}else{this.content.css("display","")}},_edit:function(){if(!this.options.mobile){this.input.prop("checked",this.options.value).removeAttr("disabled")}else{this.content.css("display","")}},_design:function(){var f=this.options,g=this.content;if(f.mobile){if(!f.data_theme){f.data_theme="c"}g.html("");if(f.selectItems.length>1){var d=a("<fieldset class='ui-corner-all ui-controlgroup' />").appendTo(g);if(f.orientation=="horizontal"){d.addClass("ui-controlgroup-horizontal")}var e=a("<div class='ui-controlgroup-controls' />").appendTo(d);a.each(f.selectItems||[],function(i,h){var l=a("<div class='ui-checkbox' />").html('<input type="checkbox" id="'+f.id+i+'" name="'+f.id+i+'" value="'+h+'">').appendTo(e);var j=a("<label class='ui-checkbox-off ui-btn ui-btn-corner-all ui-fullsize ui-btn-icon-left ui-btn-up-"+f.data_theme+"' />").html('<span class="ui-btn-inner"><span class="ui-btn-text">'+this.label+'</span><span class="ui-icon ui-icon-checkbox-off ui-icon-shadow">&nbsp;</span></span>').appendTo(l);if(i==0){j.addClass("ui-first-child")}if(i==f.selectItems.length-1){j.addClass("ui-last-child")}})}else{a.each(f.selectItems||[],function(i,h){a("<div class='ui-checkbox' />").html('<input type="checkbox" id="'+f.id+i+'" name="'+f.id+i+'" value="'+h+'"><label for="1230" class="ui-checkbox-off ui-btn ui-btn-corner-all ui-fullsize ui-btn-icon-left ui-btn-up-'+f.data_theme+'"><span class="ui-btn-inner"><span class="ui-btn-text">'+this.label+'</span><span class="ui-icon ui-icon-checkbox-off ui-icon-shadow">&nbsp;</span></span></label>').appendTo(g)})}this.content.css("display","")}else{this.input.hide();this.content.css("display","")}},highlight:function(d){this.element.toggleClass("an-state-hover",d)},destroy:function(){if(!this.options.mobile){this.input.unbind(".checkboxfield")}this.element.removeClass("an-checkboxfield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.radiofield",a.an.inputfield,{options:{orientation:"horizontal"},_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-radiofield");this.content.remove()},_createControl:function(){var e=this,h=this.options,f=this.element;if(h.mobile){var g=a("<div class='ui-controlgroup-controls' />");g.append(a("<label />").attr("for",h.id).html(h.label).css("display","block"));a.each(h.selectItems||[],function(j,i){var n=a("<div class='ui-radio' />");a("<input type='radio'/>").attr({id:h.id+j,name:h.id,value:this.value}).addClass("ui-widget-content").appendTo(n);a("<div class='content'/>").hide().appendTo(f);var l='<span class="ui-btn-inner"><span class="ui-btn-text">'+this.label+'</span> 					<span class="ui-icon ui-icon-radio-on ui-icon-shadow"> </span>					</span>';var m=a("<label class='ui-radio-off ui-btn ui-btn-up-c ui-fullsize ui-btn-icon-left' style='margin:0'  />").attr("for",h.id+j);if(!h.data_theme){h.data_theme="c"}if(j==0){m.addClass("ui-first-child")}if(j==(h.selectItems.length-1)){m.addClass("ui-last-child")}m.addClass("ui-btn-up-"+h.data_theme);m.html(l).appendTo(n);n.appendTo(g)});var d=a("<div border='1' class='ui-controlgroup ui-corner-all ui-controlgroup-"+h.orientation+"'/>");if(h.isMini){d.addClass("ui-mini")}g.appendTo(d.appendTo(f));g.delegate(".ui-radio","click",function(j){var i=a(this);if(h.orientation=="vertical"){i.removeClass("ui-icon-radio-off").addClass("ui-radio-on").siblings().removeClass("ui-radio-on")}else{i.find(">label").addClass("ui-btn-active");i.siblings().find(">label").removeClass("ui-btn-active")}i.find("input").attr("checked","checked");i.siblings().find("input").removeAttr("checked");i.find("input").trigger("change.radiofield")})}else{a.each(h.selectItems||[],function(j,i){a("<input type='radio'/>").attr({id:h.id+j,name:h.id,value:this.value}).addClass("ui-widget-content ui-corner-all").appendTo(f);a("<div class='content'/>").hide().appendTo(f);a("<label/>").attr("for",h.id+j).html(this.label).appendTo(f);if(h.orientation=="vertical"){f.append("<br>")}})}this.inputs=f.find("input");this.contents=f.children(".content");if(!a.isEmptyObject(h.validate)){this.inputs.addClass(a.toJSON({validate:h.validate}))}this.inputs.filter("[value="+h.value+"]").prop("checked",true);this.inputs.bind("change.radiofield",function(k){var j=a(k.target).attr("value"),i=h.value;if(j!=i){h.value=j;e._trigger("optionchanged",null,{key:"value",value:j,oldValue:i,isTransient:h.isTransient})}}).bind("dblclick.radiofield",function(i){i.stopImmediatePropagation()})},_createLabel:function(){},_makeResizable:function(){},_handleChange:function(e,f,d){var g=this.options;if(e=="value"){this.inputs.filter("[value="+g.value+"]").prop("checked",true)}else{if(e=="selectItems"){this.inputs.remove();this.contents.remove();this.element.children("label,br").remove();this._createControl()}else{if(e=="orientation"){this.inputs.remove();this.contents.remove();this.element.children("label,br").remove();this._createControl()}else{return a.an.inputfield.prototype._handleChange.apply(this,arguments)}}}},_browser:function(){this.contents.css("display","none");this.inputs.attr("disabled","disabled")},_edit:function(){this.contents.css("display","none");this.inputs.removeAttr("disabled")},_design:function(){if(!this.options.mobile){this.inputs.hide();this.contents.css("display","")}},highlight:function(d){this.element.toggleClass("an-state-hover",d)},destroy:function(){if(this.options.mobile){this.element.children(".ui-controlgroup").unbind(".radiofield").remove()}this.inputs.unbind(".radiofield").remove();this.contents.remove();this.element.removeClass("an-radiofield").children("br").remove();a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.passwordfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-passwordfield")},_browser:function(){a.an.inputfield.prototype._browser.apply(this,arguments);this.content.html("********")},_design:function(){this.input.hide();var d=this,e=this.options,f=this.content;if(f.is(".ui-resizable")){f.resizable("destroy")}f.html("********").css({width:e.width,height:e.height,display:""}).resizable({stop:function(h,g){e.width=f.width();e.height=f.height();a.extend(true,e.metadata[d.widgetName],{width:e.width,height:e.height});d._updateMetadata();d._trigger("resize",null,{size:g.size,oldSize:g.originalSize})}})},destroy:function(){this.element.removeClass("an-passwordfield");a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.textareafield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-textareafield")},_createControl:function(){var d=this,f=this.options,e=this.element;if(f.mobile){e.find(".content").addClass("codiqa-control");this.textarea=a("<textarea type='"+f.type+"'/>").attr("name",f.id).addClass("ui-input-text ui-body-c ui-corner-all ui-shadow-inset");this.textarea.bind("change.textareafield keyup.textareafield",function(i){i.preventDefault();var h=d.textarea.val(),g=f.value;if(h!=g){f.value=h;d._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}}).bind("dblclick.textareafield",function(g){g.stopImmediatePropagation()}).bind("focus.textareafield",function(g){a(this).addClass("ui-focus")}).bind("blur.textareafield",function(g){a(this).removeClass("ui-focus")})}else{this.textarea=a("<textarea type='"+f.type+"'/>").attr("name",f.id).addClass("ui-widget-content ui-corner-all");this.textarea.bind("change.textareafield keyup.textareafield",function(i){i.preventDefault();var h=d.textarea.val(),g=f.value;if(h!=g){f.value=h;d._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}}).bind("dblclick.textareafield",function(g){g.stopImmediatePropagation()})}if(f.resizable){this.content.resizable()}if(!a.isEmptyObject(f.validate)){this.textarea.addClass(a.toJSON({validate:f.validate}))}},_makeResizable:function(){},_browser:function(){this.textarea.detach();var d=this.options,e=this.content;if(e.is(".ui-resizable")){e.resizable("destroy")}e.html(d.pre?"<pre>"+d.value+"</pre>":d.value).css("display","")},_edit:function(){this.textarea.detach().val(this.options.value).appendTo(this.content.empty())},_design:function(){this.textarea.detach();var d=this,e=this.options,f=this.content;if(f.is(".ui-resizable")){f.resizable("destroy")}f.html(e.pre?"<pre>"+e.value+"</pre>":e.value).css({width:e.width,height:e.height,display:""}).resizable({stop:function(h,g){e.width=f.width();e.height=f.height();a.extend(true,e.metadata[d.widgetName],{width:e.width,height:e.height});d._updateMetadata();d._trigger("resize",null,{size:g.size,oldSize:g.originalSize})}})},_handleChange:function(e,f,d){if(e==="label"){this.textarea.remove();this.element.children("label").remove();this._createControl();this._createLabel()}else{a.an.field.prototype._handleChange.apply(this,arguments)}},destroy:function(){this.textarea.unbind(".textareafield").parent().remove();this.element.removeClass("an-textareafield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.selectfield",a.an.field,{options:{nativeMenu:true},_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-selectfield")},_createControl:function(){var d=this,f=this.options;var e=this.select=a("<select />").attr("name",f.id);if(!f.mobile){a("<option/>").attr("value","").html("").appendTo(e)}a.each(f.selectItems||[],function(){a("<option/>").attr("value",this.value).html(this.label).appendTo(e)});e.bind("change.selectfield",function(i){i.preventDefault();var h=e.val(),g=f.value;if(h!=g){f.value=h;d._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}});if(!a.isEmptyObject(f.validate)){e.addClass(a.toJSON({validate:f.validate}))}if(f.mobile){if(!f.value&&f.selectItems[0]){f.value=f.selectItems[0].value}}},_makeResizable:function(){},_browser:function(){var d=this,e=this.options;this.select.detach();a.each(e.selectItems,function(){if(this.value==e.value){d.content.html('<span style="padding: .6em 20px;display:inline-block;">'+this.label+"</span>").show();return false}})},_edit:function(){var e=this.options;this.select.detach().val(this.options.value).appendTo(this.content.empty());this._trigger("optionchanged",null,{key:"value",value:e.value,oldValue:"",isTransient:e.isTransient});if(e.mobile){var d={};d.icon="arrow-r";if(e.corners){d.conrners=false}if(e.icon){d.icon=e.icon}if(e.iconpos){d.iconpos=e.iconpos}if(e.iconshadow){d.iconshadow=false}if(e.inline){d.inline=true}if(e.mini){d.mini=true}if(e.nativeMenu){d.nativeMenu=false}if(e.overlayTheme){d.overlayTheme=e.overlayTheme}if(e.preventFocusZoom){d.preventFocusZoom=false}if(e.shadow){d.shadow=false}if(e.theme){d.theme=e.theme}if(this.select.data("mobileSelectmenu")){this.select.data("mobileSelectmenu").destroy()}this.select.selectmenu(d)}},_design:function(){this.select.detach();var d=this,e=this.options,f=this.content;if(e.mobile){f.html('<div class="ui-select">					<a class="ui-btn ui-shadow ui-btn-corner-all ui-btn-icon-right ui-btn-up-c">					<span class="ui-btn-inner">					<span class="ui-btn-text"><span>'+e.selectItems[0].label+'</span></span><span class="ui-icon ui-icon-arrow-d ui-icon-shadow">&nbsp;</span></span></a>					<select>					  </select>					    </div>')}else{if(f.is(".ui-resizable")){f.resizable("destroy")}a.each(e.selectItems,function(){if(this.value==e.value){f.html(this.label);return false}});f.css({width:e.width,height:e.height}).resizable({stop:function(h,g){e.width=f.width();e.height=f.height();a.extend(true,e.metadata[d.widgetName],{width:e.width,height:e.height});d._updateMetadata();d._trigger("resize",null,{size:g.size,oldSize:g.originalSize})}})}},_handleChange:function(e,f,d){if(e==="label"){this.element.children("label").remove();this._createLabel()}else{if(e=="selectItems"){this.select.remove();this._createControl()}else{if(this.options.mobile){this.select.remove();this._createControl()}else{a.an.field.prototype._handleChange.apply(this,arguments)}}}},destroy:function(){this.select.unbind(".selectfield").remove();this.element.removeClass("an-selectfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.jsrenderfield",$.an.field,{options:{mode:"browser",selector:"",browserTemplate:"",editorTemplate:"",value:[]},_create:function(){$.an.field.prototype._create.apply(this,arguments);var o=this.options,c=this.content;this.element.addClass("an-jsrenderfield");try{c.html(o.content)}catch(e){}if(o.template){o.template=$.templates(o.template)}if(o.converters){var conv={};var tmp=null;for(var j=0;j<o.converters.length;j++){tmp=eval("(0,"+o.converters[j]["function"]+")");if(!$.isFunction(tmp)){conv[o.converters[j]["name"]]=function(v){return v}}else{conv[o.converters[j]["name"]]=tmp}}$.views.converters(conv)}},_notify:function(oldValue,value){var o=this.options;if(value!=oldValue){o.value=value;this._trigger("optionchanged",null,{key:"value",value:value,oldValue:oldValue,isTransient:o.isTransient})}},appendValue:function(value){var o=this.options,oldValue=[].concat(o.value);o.value.push(value);this.refresh();this._notify(oldValue,o.value)},insertValue:function(index,value){var o=this.options,oldValue=[].concat(o.value);o.value.splice(index,1,value);this.refresh();this._notify(oldValue,o.value)},delValue:function(index){var o=this.options,oldValue=[].concat(o.value);o.value.splice(index,1);this.refresh();this._notify(oldValue,o.value)},getValue:function(index){var o=this.options;return o.value[index]},replaceValue:function(index,value){var o=this.options,oldValue=[].concat(o.value);o.value[index]=value;this.refresh();this._notify(oldValue,o.value)},_browser:function(){var o=this.options;if(o.browserTemplate!=undefined&&o.browserTemplate!=""){var html=$.render[o.browserTemplate](o.value);$(o.selector,this.element).html(html)}else{if(o.template){var html=o.template.render(o.value);$(o.selector,this.element).html(html)}}},_edit:function(){var o=this.options;if(o.editorTemplate!=undefined&&o.editorTemplate!=""){var html=$.render[o.editorTemplate](o.value);$(o.selector,this.element).html(html)}else{if(o.template){var html=o.template.render(o.value);$(o.selector,this.element).html(html)}}},_design:function(){this._browser()},destroy:function(){this.element.removeClass("an-jsrenderfield");return $.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.buttonwidget",a.an.widget,{_create:function(){var f=this.options;a.an.widget.prototype._create.apply(this,arguments);this.element.addClass("an-buttonwidget");var e={label:this.options.label};if(f.mobile){e.corners=true;e.iconshadow=false;if(f.data_transition){e.transition=f.data_transition}if(f.data_icon){e.icon=f.data_icon}if(f.data_iconpos){e.iconpos=f.data_iconpos}if(f.data_theme){e.theme=f.data_theme}if(f.data_inline){e.inline=f.data_inline}if(f.isMini){e.mini=true}var d=this.content.button(e);a(a(a(a(d).parent()).find(">span")).find(">span").eq(0)).html(this.options.label)}else{this.content.button(e)}},_makeResizable:function(){},_handleChange:function(e,f,d){if(e==="label"){this.content.button("option","label",f)}else{a.an.widget.prototype._handleChange.apply(this,arguments)}},_design:function(){var f=this.options;if(f.mobile){var e='<div data-corners="true" data-shadow="true" data-iconshadow="false"				data-wrapperels="span"  data-disabled="true" data-label="'+f.label+'"				aria-disabled="false">				<span class="ui-btn-inner">					<span class="ui-btn-text">'+f.label+"</span>";if(f.data_icon){e+='<span class="ui-icon ui-icon-arrow-d">&nbsp;</span>'}e+='</span>				<div class="content ui-btn-hidden" data-disabled="false"></div>			</div>';var d=a(e);if(f.data_icon){d.addClass("ui-btn-icon-"+f.data_icon)}if(f.data_iconpos){d.addClass("ui-btn-icon-"+f.data_iconpos)}if(f.data_theme){d.addClass("ui-btn-up-"+f.data_theme)}if(f.data_inline){d.addClass("ui-btn-inline")}if(f.isMini){d.addClass("ui-mini")}d.addClass("ui-btn ui-shadow ui-btn-corner-all");this.content.html(d)}},destroy:function(){this.content.button("destroy").remove();this.element.removeClass("an-buttonwidget");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.tabsxwidget",$.an.widget,{_create:function(){$.an.widget.prototype._create.apply(this,arguments);var self=this,o=this.options,el=this.element,c=this.content,ul=c.children("ul");el.addClass("an-tabsxwidget");if(ul.length<=0){ul=$("<ul/>").appendTo(c)}c.tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a></li>",destroyTabs:false,duration:o.duration,slideshow:o.slideshow,fxs:eval("("+o.fx+")"),mode:o.mode}).bind("contextmenu2.tabsxwidget contextmenu.tabsxwidget",function(e){if((o.contextmenu2&&e.type=="contextmenu2")||(!o.contextmenu2&&e.type=="contextmenu")){var t=$(e.target),actions={},index=t.closest("li").index(),ul=t.closest("ul");if(o.mode=="design"){actions.add={type:"menuItem",text:"Add Tab",handler:function(){self.insertTab(index)}};if(ul.size()!=0){actions.edit={type:"menuItem",text:"Edit Tab",handler:function(){self.editTab(index)}};actions.del={type:"menuItem",text:"Delete Tab",handler:function(){self.removeTab(index)}}}}if(!$.isEmptyObject(actions)){t.menu({autoShow:true,menuPosition:{of:e,my:"left top",at:"left bottom"},actions:actions,select:function(e,ui){$(this).menu("destroy")},collapseAll:function(e){$(this).menu("destroy")}})}e.preventDefault()}});this._updateContentHeight();if(o.mode=="design"){this._contentEditable(true)}},selectable:function(e){return e.target==this.content.children(".ui-tabs-nav")[0]||e.target==this.element[0]},select:function(id){this.content.tabsx("select",id)},_updateContentHeight:function(){var o=this.options,c=this.content,css={},ul=c.children("ul");if(o.minHeight){css["min-height"]=o.minHeight-ul.outerHeight(true)-16}else{if(o.height){css.height=o.height-ul.outerHeight(true)-16}}c.children(".ui-tabs-panel").css(css)},_doEditTab:function(index,isNew){var self=this,o=this.options,c=this.content,doc={},a,p;if(!isNew){a=c.children("ul").find("li").eq(index).children("a");doc.id=a.attr("href").substring(1);doc.label=a.html();p=c.find("#"+doc.id)}$("<div/>").dialog({title:isNew?"Insert Tab":"Edit Tab",height:400,width:500,modal:true,create:function(event,ui){var $this=$(this);$.ans.getDoc(o.dbId,"50a4f883d6c6603d0a000018",null,function(err,form){$this.editor({document:doc,forms:[form],dbId:o.dbId,ignoreEscape:true,mode:"edit"})})},buttons:{OK:function(){var $this=$(this),doc=$this.editor("option","document");if(isNew){c.tabsx("add","#"+doc.id,doc.label,index);self._updateContentHeight();c.children("#"+doc.id)[0].contentEditable=true}else{a.attr("href","#"+doc.id).html(doc.label);p.attr("id",doc.id)}self.element.trigger("contentchange");$this.dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(e,ui){$(this).remove()}})},insertTab:function(index){if(index<0||index>this.content.tabsx("length")){index=this.content.tabsx("length")}this._doEditTab(index,true)},editTab:function(index){if(index>=0&&index<this.content.tabsx("length")){this._doEditTab(index)}},removeTab:function(index){this.content.tabsx("remove",index).trigger("contentchange")},_browser:function(){this.option("contextmenu2",false);this._contentEditable(false)},_edit:function(){this.option("contextmenu2",false);this._contentEditable(false)},_design:function(){this.option("contextmenu2",true);this._contentEditable(true)},_contentEditable:function(editable){this.content.children(".ui-tabs-panel").each(function(){this.contentEditable=editable})},destroy:function(){this.content.children(".ui-tabs-panel").css({height:"","min-height":""});this.content.tabsx("destroy");this.element.unbind(".tabsxwidget").removeClass("an-tabsxwidget");return $.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
 * This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.searchfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-searchfield")},_createControl:function(){a.an.inputfield.prototype._createControl.apply(this,arguments);if(this.options.mobile){this.input.attr("data-type","search");var d=this.element.find(".content").eq(0);d.removeClass("ui-input-text");d.addClass("ui-input-search ui-icon-search ui-icon-searchfield")}},_makeResizable:function(){},_browser:function(){a.an.inputfield.prototype._browser.apply(this,arguments)},_edit:function(){this.input.detach().val(this.options.value).appendTo(this.content.empty(),arguments);if(this.options.mobile){var d=this;var e='<a style="position: absolute;right: 20px; top: 17px;display:none;" class="ui-input-clear ui-btn ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-btn-up-c" href="#" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false">					<span class="ui-btn-inner">					<span class="ui-btn-text">clear text</span>					<span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span>					</span></a>';a(e).bind("click",function(f){d.input.val("");a(this).hide()}).appendTo(this.content);this.input.bind("keyup.inputfield",function(f){a(a(f.target).siblings()).show()}).bind("keydown.inputfield",function(f){a(a(f.target).siblings()).show()})}},_design:function(){a.an.inputfield.prototype._design.apply(this,arguments)},_handleChange:function(e,f,d){a.an.inputfield.prototype._handleChange.apply(this,arguments)},highlight:function(d){(this.options.mode=="edit"?this.input:this.element).toggleClass("an-state-hover",d)},destroy:function(){this.input&&this.input.unbind(".inputfield").remove();this.element.removeClass("an-inputfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.tree",{options:{draggable:true,droppable:true,labelProvider:{getText:function(d){return d.text},getClass:function(d){return d["class"]}}},_create:function(){var d=this,e=this.element,f=this.options;e.addClass("an-tree").empty();f.contentProvider=f.contentProvider||this._defaultContentProvider();this._loadChildren(e);e.delegate(".hitarea","click.tree",function(){var g=a(this).parent();d["_do"+(g.is(".expandable")?"Expand":"Collapse")](g)}).delegate("li>span","hover.tree",function(g){a(this).toggleClass("ui-state-hover");d._trigger("nodehover",g,a(this).closest("li").data("node"))}).delegate("li>span","click.tree contextmenu.tree",function(g){e.find("li>span.selected").removeClass("selected");a(this).addClass("selected");if(g.type=="click"){d._trigger("nodeclick",g,a(this).closest("li").data("node"))}else{if(g.type=="contextmenu"){d._trigger("contextmenu",g,a(this).closest("li").data("node"))}}}).delegate("li>span","dblclick.tree",function(g){d._trigger("nodedblclick",g,a(this).closest("li").data("node"))})},_defaultContentProvider:function(){return{getRoots:function(){return[]},getChildren:function(d){return[]},hasChildren:function(d){return false},getId:function(d){return d.id?d.id:null}}},refresh:function(f){var l=this;if(f){var j=this.element.find("#"+f);if(j.length){var e=this.options,g=e.labelProvider,h=e.contentProvider,d=j.attr("id"),i=j.parent().closest("li");function k(m){var p=null;for(var n in m){if(d==m[n].id){p=n;break}}if(p!=null){j.data("node",m[p]).addClass(g.getClass(m[p])).children("span").html(g.getText(m[p]));if(j.is(".expandable")){j.addClass("stale")}else{if(j.is(".collapsable")){l._loadChildren(j)}}}else{j.remove()}}if(i.length){h.getChildren(i.data("node"),k)}else{h.getRoots(k)}}}else{this._loadChildren(this.element)}},add:function(e,d){this._addNode(this.element.find("#"+e).children("ul"),d)},"delete":function(e){var d=this.element.find("#"+e);if(d.is(".last")){d.prev().addClass("last")}d.remove()},expand:function(e){var d=this.element.find("#"+e);if(d.length>0){this._doExpand(d)}},collapse:function(e){var d=this.element.find("#"+e);if(d.length>=0){this._doCollapse(d)}},_doExpand:function(d){if(d.is(".expandable.stale")){this._loadChildren(d)}else{if(d.is(".expandable")){d.children("ul").show();d.removeClass("expandable").addClass("collapsable")}}},_doCollapse:function(d){if(d.is(".collapsable")){d.children("ul").hide();d.removeClass("collapsable").addClass("expandable")}},_addNode:function(j,f){var m=this,e=this.options,g=e.labelProvider,i=e.contentProvider,d=i.getId(f),l=g.getText(f),k=a("<li/>").addClass(g.getClass(f)).attr("id",d);if(e.checkbox){a("<input type='checkbox'/>").prop("checked",a.inArray(d,e.checkedNodes)!=-1).appendTo(k)}a("<span/>").addClass(g.getClass(f)).html(l).appendTo(k);if(i.hasChildren(f)){k.addClass("expandable stale").prepend("<div class='hitarea'/>");var h=a.type(e.droppable)=="function"?e.droppable(f):e.droppable;if(h){k.children("span").droppable({greedy:true,hoverClass:"ui-state-hover",drop:function(p,q){m._trigger("drop",null,{source:q.draggable.data("node"),target:f})}})}}j.children("li.last").removeClass("last");k.data("node",f).addClass("last").appendTo(j);var n=a.type(e.draggable)=="function"?e.draggable(f):e.draggable;if(n){k.draggable({appendTo:"body",helper:"clone",scroll:true,distance:20,scrollSensitivity:100,zIndex:9999})}},_loadChildren:function(h){var e=this,k=this.options,f=h.children("ul"),i=k.contentProvider||this._defaultContentProvider();if(f.length==0){f=a("<ul/>").appendTo(h)}var g=[];f.find(".collapsable").each(function(){g.push(a(this).attr("id"))});f.empty();var d=h.children(".hitarea").addClass("loading");function j(l){a.each(l,function(p,n){e._addNode(f,n)});h.removeClass("expandable stale").addClass("collapsable");for(var m in g){e.expand(g[m])}d.removeClass("loading")}if(h[0]==this.element[0]){i.getRoots(j)}else{i.getChildren(h.data("node"),j)}},option:function(f,g){if(f=="checkedNodes"&&g===b){var e=[];a("input:checked",this.element).each(function(){e.push(a(this).closest("li").data("node"))});return e}else{if(f==="roots"&&g===b){var d=[];this.element.children("ul").children("li").each(function(){d.push(a(this).attr("id"))});return d}else{if(f==="selectedNodes"&&g===b){var e=[];this.element.find(".selected").each(function(){e.push(a(this).closest("li").attr("id"))});return e}}}return a.Widget.prototype.option.apply(this,arguments)},_setOption:function(e,g){a.Widget.prototype._setOption.apply(this,arguments);var d=this,f=this.element;if(e==="contentProvider"){this._loadChildren(this.element)}else{if(e==="checkedNodes"){a.each(g,function(i,h){a("#"+h+" input",d.element).prop("checked",true)})}else{if(e==="selectedNodes"){a.each(g,function(i,h){f.find("li>span.selected").removeClass("selected");f.find("li#"+h+">span").addClass("selected")})}}}return this},destroy:function(){this.element.undelegate(".hitarea",".tree").undelegate("li>span",".tree").removeClass("an-tree");a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.tabsx",a.ui.tabs,{options:{duration:2000,slideshow:false,fxs:null},_create:function(){var d=this,e=this.options;if((e.mode=="edit"||e.mode=="browser")&&e.slideshow){e.fx=e.fxs?e.fxs:{opacity:"toggle",duration:200}}a.ui.tabs.prototype._create.apply(this,arguments);this.element.addClass("an-tabsx");this._navMenu=a("<div id='nav-menu'>>><span>0</span></div>");this._navMenu.css({position:"relative","float":"left",width:"18px",height:"22px","font-size":"60%",border:"1px solid #CCCCCC",margin:"0px",padding:"0px"});this._navMenu.find("span").css({position:"absolute",right:"0px",bottom:"0px","font-size":"11px"});this._navMenu.hover(function(f){d._navMenu.css({border:"1px solid #AAAAAA",cursor:"pointer",margin:"0px",padding:"0px"})},function(){d._navMenu.css({border:"1px solid #CCCCCC",margin:"0px",padding:"0px"})});if((e.mode=="edit"||e.mode=="browser")&&e.slideshow){this._slideshow(e.duration)}else{this.element.bind("tabsxadd.tabsx",a.proxy(this,"_showMenu"));this.element.bind("tabsxshow.tabsx",a.proxy(this,"_showMenu"));this.element.bind("tabsxremove.tabsx",a.proxy(this,"_showMenu"));this._proxy=a.proxy(this,"_showMenu");a(window).bind("resize.tabsx",this._proxy)}if(e.showTabsContextMenu){this.list.menu({triggerEvent:"contextmenu",menuPosition:{my:"left top",at:"left bottom"},delay:false,actions:{close:{type:"menuItem",text:"Close",handler:a.proxy(d,"closeCurrent")},closeOthers:{type:"menuItem",text:"Close Others",handler:a.proxy(d,"closeOthers")},closeAll:{type:"menuItem",text:"Close All",handler:a.proxy(d,"closeAll")}},select:function(g,f){a(this).menu("collapseAll")}})}},_slideshow:function(h){var d=this,i=this.options,j=null,g=0;this.lis.each(function(){g+=a(this).outerWidth(true)});this.list.css({width:g}).addClass("ui-tabs-slideshow-nav").removeClass("ui-widget-header");var e=function(k){f();d._rotation=setTimeout(function(){var l=i.selected;if(j!=null&&j==l){f();return false}d.select(++l<d.anchors.length?l:0);e()},h)};function f(){clearTimeout(d._rotation);d._rotation=null}if(h){this.anchors.bind("click",f);this.anchors.bind("mouseover",function(){var k=d.anchors.index(this);if(i.selected==k){f()}else{j=k}});this.anchors.bind("mouseout",function(){e();j=null});this.anchors.bind("mouseup",function(){a(this).parent().hasClass("ui-state-focus")&&a(this).parent().removeClass("ui-state-focus")});e()}else{f()}return this},closeCurrent:function(){this.remove(this.option("selected"))},closeOthers:function(){var d=this.option("selected");while(this.length()-1>d){this.remove(this.length()-1)}while(this.length()>1){this.remove(0)}},closeAll:function(){while(this.length()>0){this.remove(0)}},option:function(d,e){if(d==="selectedPanel"&&e===b){return this.panels.get(this.options.selected)}else{if(d==="panels"&&e===b){return this.panels}}return a.Widget.prototype.option.apply(this,arguments)},_showMenu:function(j,i){if(this.list.is(":hidden")){return}var d=this;if(j.type=="tabsxshow"){this.lis.each(function(m,e){var p=a(e),n=parseInt(p.attr("hit"))||0;p.attr("hit",p.is(".ui-tabs-selected")?0:n+1)})}var l=this.lis.toArray();l.sort(function(e,p){var n=parseInt(a(e).attr("hit")),m=parseInt(a(p).attr("hit"));return n-m});this._navMenu.appendTo(this.list);var h=this.list.width()-this._navMenu.outerWidth(true);this._navMenu.menu("destroy").detach();a.each(l,function(m,e){h-=a(e).outerWidth(true);a(e)[h>0?"show":"hide"]()});var g=this.lis.filter(":hidden"),f=g.size();if(f>0){this._navMenu.find("span").html(f);var k={};g.each(function(){var m=a(this),e=m.find("a:first"),n=e.attr("href").slice(1);k[n]={type:"menuItem",text:e.text(),handler:function(){d.element.tabsx("select","#"+n)}}});d._navMenu.appendTo(this.list);d._navMenu.menu({triggerEvent:"click",menuPosition:{of:d._navMenu,my:"left top",at:"left bottom"},delay:false,actions:k,select:function(n,m){a(this).menu("collapseAll")}})}},remove:function(d){if(this._getIndex(d)==-1){return}return a.ui.tabs.prototype.remove.apply(this,arguments)},panel:function(d){return a(this.panels[this._getIndex(d)])},_trigger:function(d,e,f){var i,h,g=this.options[d];f=f||{};e=a.Event(e);e.type=(d===this.widgetEventPrefix?d:this.widgetEventPrefix+d).toLowerCase();e.target=this.element[0];h=e.originalEvent;if(h){for(i in h){if(!(i in e)){e[i]=h[i]}}}!(a.isFunction(g)&&g.call(this.element[0],e,f)===false||e.isDefaultPrevented());return this.element.trigger(e,f)},destroy:function(){var d=this.options;if(!d.destroyTabs){this.lis.add(this.panels).each(function(){a.removeData(this,"destroy.tabs")})}a(window).unbind("resize.tabsx",this._proxy);this.list.unbind(".tabsx");this.element.removeClass("an-tabsx").unbind(".tabsx").removeData("tabsx");return a.ui.tabs.prototype.destroy.apply(this,arguments)}})}(jQuery));
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.page",{options:{mode:"browser",actionSets:[],wrapper:"<div/>",modelType:"page",formIds:{button:["5080143085ac60df09000001","50de596da092007b11000001"],tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],codearea:["5080143085ac60df09000001","51d66f5fedad572a8b0001ad"]},mFormIds:{tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],text:["5080143085ac60df09000001","519095a03bcccb65f400008b"],search:["5080143085ac60df09000001","51932b05ac8f2725e1000048"],password:["5080143085ac60df09000001","5185ac02a092006ca6000048"],checkbox:["5080143085ac60df09000001","519dbd9c3bcccb444800008c","51a2ffeeac8f275c2700013b"],button:["5080143085ac60df09000001","51933105ac8f2712ab000069"],slider:["5080143085ac60df09000001","51a5a62dac8f2755d2000069"],datetime:["5080143085ac60df09000001","50af2da26cec663c0a00000b"],textarea:["5080143085ac60df09000001","50af2ca66cec663c0a000008"],tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],file:["5080143085ac60df09000001","50ceb75ba092004120000000"],grid:["5080143085ac60df09000001","5089e21f2b2255080a000005"],jsrender:["5080143085ac60df09000001","514d0a46caa05a669e0005c8","514d0e9dcaa05a26e30001af","514d0825caa05a669e0002ae","514d5ef3ac8f27413200014e"],radio:["5080143085ac60df09000001","51a2b48dac8f2770b7000001","51850c1ca092003b12000024"],select:["5080143085ac60df09000001","51af125321c7d61a65000024","508259700b27990c0a000003"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],rte:["5080143085ac60df09000001"],collapsible:["5080143085ac60df09000001","51a8639ebd94293c2f000081"],mobiledate:["5080143085ac60df09000001","51c967a3ba4682122900004a"],toggle:["5080143085ac60df09000001","51a565753bcccb5b0e0000ac"],navbar:["5080143085ac60df09000001","51c17808caa05a042500004a","51c02b6eac8f274167000120"],listview:["5080143085ac60df09000001","51ad5e1f21c7d6296100006c","51ad54a921c7d63144000144"],customhtml:["5080143085ac60df09000001","51c175e221c7d6118800023a"],swipe:["5080143085ac60df09000001","51ca58ebedad5734e8000023"],codearea:["5080143085ac60df09000001","51d66f5fedad572a8b0001ad"]}},_create:function(){this.element.addClass("an-page");var o=this.options,page=o[this.widgetName];$.extend(this,eval("try{("+(page.methods||"{}")+")}catch(e){}"));o.cssFiles=o.cssFiles||[];o.jsFiles=o.jsFiles||[];if(o.mobile){o.cssFiles=["stylesheets/jquery.mobile-1.3.1.min.css","stylesheets/jquery.an.mwidget.css"].concat(o.cssFiles);o.jsFiles=["javascripts/jquery-1.8.2.js","javascripts/jquery.scrollto.js"].concat(o.jsFiles);o.formIds=o.mFormIds}else{o.cssFiles=["stylesheets/rte/rte-design.css","stylesheets/jquery-ui-1.8.24.custom.css","stylesheets/jquery.ui.timepicker.css","stylesheets/jquery.an.menu.css","stylesheets/jquery.an.agilegrid.css","stylesheets/jquery.an.tree.css","stylesheets/jquery.an.border.css","stylesheets/jquery.an.tabsx.css","stylesheets/jquery.an.toolbar.css","stylesheets/jquery.an.page.css","stylesheets/jquery.an.editor.css","stylesheets/jquery.an.formview.css","stylesheets/jquery.an.widget.css","stylesheets/jquery.an.tabsxwidget.css","stylesheets/jquery.an.box.css","stylesheets/jquery.an.fileinput.css","stylesheets/jquery.an.filefield.css","stylesheets/jquery.an.gridfield.css","stylesheets/jquery.colorpicker.css","stylesheets/jquery.ui.select.css","stylesheets/rte/paddinginput.css","stylesheets/jquery.an.rte.css","stylesheets/base.css"].concat(o.cssFiles);o.jsFiles=["javascripts/jquery-1.8.2.js","javascripts/jquery.scrollto.js"].concat(o.jsFiles)}this._initPage()},_initPage:function(){this.refresh()},_createOutline:function(){var self=this,page=this.options[this.widgetName],root=this._getPage();return{getRoots:function(mountNodes){var nodes=new Array();nodes.push({id:"root",text:page.title||page.name||page._id,"class":"folder"});mountNodes(nodes)},getChildren:function(parentNode,mountNodes){var nodes=new Array();if(parentNode.id=="root"){root.find(".widget").each(function(){var $this=$(this),id=$this.attr("id");if($this.parent().closest(".widget").length==0){nodes.push({id:id,text:id,"class":self._isContainer($this)?"folder":"file",data:self._getWidgetObj($this)})}})}else{root.find("#"+parentNode.id).find(".widget").each(function(){var $this=$(this),id=$this.attr("id");if($this.parent().closest(".widget").attr("id")==parentNode.id){nodes.push({id:id,text:id,"class":self._isContainer($this)?"folder":"file",data:self._getWidgetObj($this)})}})}mountNodes(nodes)},hasChildren:function(node){return node["class"]=="folder"},getId:function(node){return node.id?node.id:null}}},_isContainer:function(el){return el.is("[type=tabsx], [type=box]")},_getWidgetObj:function(el){var widget=null,type=el.attr("type");if(el.is(".box")){widget=el.data(type)}else{if(el.is(".widget")){widget=el.data(type+"widget")}}return widget},option:function(key,value){var o=this.options;if(key==="actionSets"&&value===undefined){return this._createActionSets()}else{if(key==="outline"&&value===undefined){return this._createOutline()}else{if(key=="content"&&value==undefined){if(o.isDirty){this._syncPageContent()}return o[this.widgetName].content}}}var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var o=this.options,oldValue=o[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);this._handleChange(key,value,oldValue);this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},_handleChange:function(key,value,oldValue){var o=this.options;if(key==="mode"){if(o.isDirty){this._syncPageContent()}this.refresh()}else{if(key==="page"){var page=o[this.widgetName];this.element.children("style").text(page.stylesheet);this.$page&&!o.isDirty&&this.$page.empty().html(page.content);if(this.rte){!o.isDirty&&this.rte.rte("option","content",page.content);this.rte.rte("option","stylesheet",page.stylesheet)}this.refresh()}}},refresh:function(){var o=this.options;this["_"+o.mode]&&this["_"+o.mode]()},_browser:function(){this.rte&&this.rte.hide();if(!this.$page){this._createPage()}else{this.$page.show();this._refreshWidgets()}},_edit:function(){this.rte&&this.rte.hide();if(!this.$page){this._createPage()}else{this.$page.show();this._refreshWidgets()}},_design:function(){this.$page&&this.$page.hide();if(!this.rte){var self=this,o=this.options,page=o[this.widgetName];Model.getDb(o.dbId,function(error,db){self._createRTE(db&&db.globalCss?db.globalCss+page.stylesheet:page.stylesheet)})}else{this.rte.show();this._refreshWidgets()}},getWidget:function(id){var self=this,o=this.options,page=o[this.widgetName],widget=null;this._getPage().find("#"+id).each(function(){var $this=$(this),filter=(o.mode=="design"?".an-box:not(.raw),."+page.name:".an-page");$this.parent().closest(filter).each(function(){if($(this).is("."+page.name)||this==self.element[0]){widget=self._getWidgetObj($this);return false}});if(widget){return false}});return widget},showWidget:function(){var self=this;$.each(arguments,function(){var w=self.getWidget(this);w&&w.widget().show()})},hideWidget:function(){var self=this;$.each(arguments,function(){var w=self.getWidget(this);w&&w.widget().hide()})},_createPage:function(){var o=this.options,page=o[this.widgetName],el=this.element;$('<style type="text/css">'+(page.stylesheet||"")+"</style>").appendTo(el);this.$page=$(o.wrapper).addClass(page.name).html(page.content).appendTo(el);var data={};data[this.widgetName]=this;$.each(eval("("+(o[this.widgetName].actions||"[]")+")"),function(k,action){el.bind(action.events,data,action.handler)});if(o.mobile){this._refreshMobileToolbar()}this._refreshWidgets()},_refreshMobileToolbar:function(){try{var $page=this.element.parents(".ui-page-active"),o=$page.data("mobile-page").options,pageRole=$page.jqmData("role"),pageTheme=o.theme;$(":jqmData(role='header'), :jqmData(role='footer'), :jqmData(role='content')",$page).jqmEnhanceable().each(function(){var $this=$(this),role=$this.jqmData("role"),theme=$this.jqmData("theme"),contentTheme=theme||o.contentTheme||(pageRole==="dialog"&&pageTheme),$headeranchors,leftbtn,rightbtn,backBtn;$this.addClass("ui-"+role);if(role==="header"||role==="footer"){var thisTheme=theme||(role==="header"?o.headerTheme:o.footerTheme)||pageTheme;$this.addClass("ui-bar-"+thisTheme).attr("role",role==="header"?"banner":"contentinfo");if(role==="header"){$headeranchors=$this.children("a, button");leftbtn=$headeranchors.hasClass("ui-btn-left");rightbtn=$headeranchors.hasClass("ui-btn-right");leftbtn=leftbtn||$headeranchors.eq(0).not(".ui-btn-right").addClass("ui-btn-left").length;rightbtn=rightbtn||$headeranchors.eq(1).addClass("ui-btn-right").length}if(o.addBackBtn&&role==="header"&&$(".ui-page").length>1&&$page.jqmData("url")!==$.mobile.path.stripHash(location.hash)&&!leftbtn){backBtn=$("<a href='javascript:void(0);' class='ui-btn-left' data-"+$.mobile.ns+"rel='back' data-"+$.mobile.ns+"icon='arrow-l'>"+o.backBtnText+"</a>").attr("data-"+$.mobile.ns+"theme",o.backBtnTheme||thisTheme).prependTo($this)}$this.children("h1, h2, h3, h4, h5, h6").addClass("ui-title").attr({role:"heading","aria-level":"1"})}else{if(role==="content"){if(contentTheme){$this.addClass("ui-body-"+(contentTheme))}$this.attr("role","main")}}})}catch(e){}},_createRTE:function(stylesheet){var self=this,o=this.options,page=o[this.widgetName];this.rte=$("<div class = 'rte'/>").appendTo(this.element).rte({content:page.content,cssFiles:o.cssFiles,jsFiles:o.jsFiles,dbId:o.dbId,mobile:o.mobile,modelType:o.modelType,stylesheet:stylesheet,cssClass:page.name,restore:function(page){self._refreshWidgets(page)},clean:function(page){page.find(".widget").each(function(){var $this=$(this),wid;wid=self._getWidgetObj($this);wid&&wid.destroy()})},onload:function(){var sel=self.rte.rte("option","selection"),$doc=$(self.rte.rte("option","doc"));$doc.bind("paste.page",function(e){setTimeout(function(){self._refreshWidgets();self.rte.rte("updatePath");self._trigger("change",null,self)},20)}).bind("widgetdblclick.page widgetclick.page widgetchange.page click.page",function(e,widget){$doc.find(".widget.selected").removeClass("selected");if(e.type=="widgetclick"||e.type=="widgetdblclick"){if(widget.selectable(e.originalEvent)){var el=widget.widget();el.addClass("selected");!$.browser.chrome&&sel.select(el[0]);self._trigger("widgetselect",null,widget)}self.rte.rte("updatePath");if(e.type=="widgetdblclick"){var type=widget.option("type");if(self.rteWidgetActive(type)){self.rteWidget(type)}}}self.rte.trigger(e,widget)});self._refreshWidgets();var data={};data[self.widgetName]=self;self._trigger(self.widgetName+"create",null,data)}}).bind("change.page contentchange.page",function(e){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}).bind("newwidget.page",function(e,widget){e.stopImmediatePropagation();self.refresh();self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)})},_getPage:function(){return this.options.mode=="design"?$(this.rte.rte("option","doc")):this.$page},_refreshWidgets:function(page){var self=this;(page||this._getPage()).find(".widget").each(function(){self._refreshWidget($(this))});return this},_refreshWidget:function(el){var self=this,o=this.options,type=el.attr("type");if(el.is(".box")){var actions=[],id=el.attr("id");$.each(o.boxToolbarActions||[],function(){if(this.boxName==id){actions.push(this)}});if(el.is(".an-box")){el.data("box").option("mode",o.mode)}else{el.box({parent:function(){return self},mode:o.mode,dbId:o.dbId,mobile:o.mobile,toolbarActions:actions,optionchanged:function(e,data){if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}})}}else{if(el.is("[type="+type+"]")){if(el.is(".an-"+type+"widget")){el.data(type+"widget").option("mode",o.mode)}else{el[type+"widget"]({parent:function(){return self},mode:o.mode,dbId:o.dbId,mobile:o.mobile,optionchanged:function(e,data){if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}})}}}},_createActionSets:function(){if(this.options.mode=="design"){return[this._controlActionSet(),this._formatActionSet(),this._tableActionSet()]}},_controlActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["properties","cleanFormat"],actions)},_formatActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["bold","italic","underline","strikethrough","subscript","superscript","alignLeft","alignCenter","alignRight","alignFull","font","fontSize","format","leftToRight","rightToLeft","fontColor","backgroundColor","outdent","indent","orderedList","unorderedList","link","deleteLink","horizontalRule","blockQuote","blockElement","stopFloat","image"],actions)},_tableActionSet:function(){var actions=this.rte.rte("option","actions");return this._createActionSet(["table","tableProps","deleteTable","rowBefore","rowAfter","deleteRow","columnBefore","columnAfter","deleteColumn","cellProps","mergeCells","splitCells"],actions)},_createActionSet:function(actionNames,actions){var actionSet={};$.each(actionNames,function(){actionSet[this]=actions[this]});return actionSet},_syncPageContent:function(){var page=this.options[this.widgetName];page.content=this.rte.rte("option","content");this.$page&&this.$page.empty().html(page.content)},rteWidget:function(type,opts){this.rte&&this.rte.rte("rteWidget",type,this.options.formIds[type],opts);return this},rteWidgetActive:function(type){return this.rte&&this.rte.rte("rteWidgetActive",type)},labelActive:function(){return this.rte&&this.rte.rte("labelActive")},sourceCode:function(){if(this.rte){var mode=this.rte.rte("option","mode");this.rte.rte("option","mode",mode=="sourcecode"?"design":"sourcecode")}},sourceCodeActive:function(){return this.rte&&this.rte.rte("option","mode")=="sourcecode"},handler:function(){self.option("mode",o.mode=="sourcecode"?"design":"sourcecode")},checked:function(){return o.mode=="sourcecode"},highlightWidget:function(id,highlight){var w=this.getWidget(id);w&&w.highlight(highlight);return this},scrollTo:function(id,opts){var o=this.options;if(o.mode=="design"){var win=this.rte.rte("option","win");win.$("#"+id.replace(/\./g,"-")).ScrollTo(opts)}else{this.$page.find("#"+id).scrollTo(opts)}},save:function(){var self=this,o=this.options,page=o[this.widgetName];if(o.isDirty){this._syncPageContent();ModelupdateDocument(o.dbId,page._id,page,null,function(err,result){self.option("isDirty",false)})}return this},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&pageid="+o[this.widgetName]._id;print(url);return this},destroy:function(){$(this.options.document).unbind(".page");this.element.unbind(".page").removeClass("an-page").children("style").remove();return $.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.mpage",a.an.page,{_create:function(){this.element.addClass("an-mpage");if(this.widgetName=="mpage"){this.widgetName="page"}a.an.page.prototype._create.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.form",$.an.page,{options:{document:{},printable:true,formIds:{text:["5080143085ac60df09000001","5092733215ca72150a000001"],password:["5080143085ac60df09000001","5185ac02a092006ca6000048"],checkbox:["5080143085ac60df09000001","50af2d266cec663c0a000009"],datetime:["5080143085ac60df09000001","50af2da26cec663c0a00000b"],mobiledate:["5080143085ac60df09000001","51c967a3ba4682122900004a"],textarea:["5080143085ac60df09000001","50af2ca66cec663c0a000008"],tabsx:["5080143085ac60df09000001","51306faad58d1c129f000000"],file:["5080143085ac60df09000001","50ceb75ba092004120000000"],grid:["5080143085ac60df09000001","5089e21f2b2255080a000005"],jsrender:["5080143085ac60df09000001","514d0a46caa05a669e0005c8","514d0e9dcaa05a26e30001af","514d0825caa05a669e0002ae","514d5ef3ac8f27413200014e"],radio:["5080143085ac60df09000001","50af2d626cec663c0a00000a","51850c1ca092003b12000024"],select:["5080143085ac60df09000001","51850b35a09200784a000122","508259700b27990c0a000003"],box:["5080143085ac60df09000001","50de56d0a092007b11000000","50ea38efa0920073870000ef"],rte:["5080143085ac60df09000001"]},wrapper:"<form/>"},_create:function(){$.an.page.prototype._create.apply(this,arguments)},_initPage:function(){var self=this,o=this.options,el=this.element;el.addClass("an-form");o.cssFiles=o.cssFiles||[];o.cssFiles.push("stylesheets/jquery.an.form.css");o.document=$.type(o.document)=="function"?o.document():o.document;$(o.document).bind("docchanged.form",function(e,doc,oldDoc){self.refresh();el.trigger("documentchanged",e,[doc,oldDoc])}).bind("propchanged.form",function(e,id,value,oldValue,trans){self.field(id,value)});$.an.page.prototype._initPage.apply(this,arguments)},option:function(key,value){var o=this.options;if(key==="mode"&&o.readonly){return}else{if(key==="isValid"&&value===undefined&&o.mode=="edit"){return this.validator.form()}}return $.an.page.prototype.option.apply(this,arguments)},_getWidgetObj:function(el){if(el.is(".field")){return el.data(el.attr("type")+"field")}return $.an.page.prototype._getWidgetObj.apply(this,arguments)},_handleChange:function(key,value,oldValue){var o=this.options;if(key==="document"){this.refresh()}else{if(key==="url"){this.$page.find(".field.file").filefield("option","url",o.url);this.$page.find(".field.grid").gridfield("option","url",o.url)}}return $.an.page.prototype._handleChange.apply(this,arguments)},_createPage:function(){$.an.page.prototype._createPage.apply(this,arguments);this.validator=this.$page.validate($.extend({meta:"validate",ignore:"",errorPlacement:function(error,el){error.insertAfter(el.closest("div.field"))}},eval("("+(this.options[this.widgetName].validator||"{}")+")")))},_refreshWidget:function(el){var self=this,o=this.options,type=el.attr("type");if(el.is(".field")){var id=el.attr("id");if(id){id=id.replace(/-/g,".")}var doc=o.document,value=doc&&doc.prop&&doc.prop(id),field=el.data(type+"field");if(field){field.option("mode",o.mode).option("value",value);field.refresh()}else{var opts={dbId:o.dbId,parent:function(){return self},value:value,url:o.url,mode:o.mode,mobile:o.mobile,optionchanged:function(e,data){if(data.key=="value"&&doc.prop){var id=$(e.target).attr("id");id=id&&id.replace(/-/g,".");var curValue=doc.prop(id);if(curValue!=data.value){doc.prop(id,data.value,data["transient"])}}else{if(data.key=="metadata"||data.key=="attributes"){self.option("isDirty",true);setTimeout(function(){self._trigger("change",null,self)},20)}}},resize:function(e,data){self.option("isDirty",true)}};if(type=="button"){el[type+"widget"]({parent:function(){return self},label:el.attr("label")})}else{el[type+"field"]&&el[type+"field"](opts)}}}else{$.an.page.prototype._refreshWidget.apply(this,arguments)}},field:function(id,value){var field=this._getPage().find("#"+id.replace(/\./g,"-")+".field");if(field.size()==0){return}if(value===undefined){var v=null;field.each(function(){var $this=$(this),type=$this.attr("type");v=$this[type+"field"]("option","value");if(type=="radio"&&v!=null){return false}});return v}else{field[field.attr("type")+"field"]("option","value",value)}},label:function(){this.rte&&this.rte.rte("label");return this},reset:function(){var o=this.options,staticAttr=["type","_path"],doc=o.document._doc,_this=this;this.element.find("form")[0].reset();for(var q in doc){if(q=="_id"){doc[q]=new ObjectId().toString()}else{if(q!="type"&&q!="_path"){delete doc[q]}}}var field=this._getPage().find(".field");if(field.size()==0){return}field.each(function(){if($(this).attr("type")=="select"){_this.field(this.id,$(this).find("select").val())}else{if($.isFunction($(this)[$(this).attr("type")+"field"])){_this.field(this.id,"")}}_this.getWidget(this.id)&&_this.getWidget(this.id).element.trigger("change")})},validate:function(){return this.validator?this.validator.form():true},print:function(){var o=this.options,docId=o.document.prop("_id"),loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&docid="+docId+"&formid="+o[this.widgetName]._id;print(url);return this},destroy:function(){this.element.removeClass("an-form");return $.an.page.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.view",{options:{mode:"browser",actionSets:[]},_create:function(){var o=this.options,el=this.element;el.addClass("an-view").addClass(o.view.name).empty();$('<style type="text/css">'+(o.view.stylesheet||"")+"</style>").appendTo(el);o.limit=o.limit||parseInt(o.view.limit)||10;o.skip=o.skip||parseInt(o.view.skip)||0;o.total=o.total||parseInt(o.view.total)||0;o.filter=o.filter||o.view.filter;o.showPager=o.showPager||o.view.showPager;try{$.extend(this,eval("("+(o.view.methods||"{}")+")"))}catch(e){console.log(e)}var data={};data[this.widgetName]=this;$.each(eval("("+(o.view.actions||"[]")+")"),function(k,action){el.bind(action.events,data,action.handler)});o.showPager&&this._createPager();this.docs=[];this._loadDocs()},option:function(key,value){var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var oldValue=this.options[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);this._handleChange&&this._handleChange(key,value,oldValue);this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},_handleChange:function(key,value,oldValue){if(key==="mode"||key==="view"){this.refresh()}},_createPager:function(){var o=this.options,self=this;this.pager=$("<div style='display:none;' class='pager'/>").css({left:0,right:0,bottom:0,height:o.pagerHeight}).appendTo(this.element);this.pager.addClass(o.className);$.each(["first","prev","goto","next","last"],function(k,v){if(v=="goto"){self.pager.append("<div class='goto-page'>Page<input class='current-page' type='text' value='"+o.currentPage+"'>of<div class='total-page'>"+o.totalPage+"</div></div>");self.pager.delegate("input","change.pager",function(){var $this=$(this),p=$(this).val();if(p<=0){p=1;$this.val(p)}else{if(p>o.totalPage){p=o.totalPage;$this.val(p)}}self.gotopage(p)})}else{$("<button class='pager-button'/>").attr("id",v).appendTo(self.pager).button({label:$.i18n.pager?$.i18n.pager[v]:v,icons:{primary:"ui-icon-"+v+"-page"},text:false,disabled:true}).click(function(e){e.preventDefault();e.stopImmediatePropagation();self[v+"page"]()})}});this.pager.append("<div class='info'>")},firstpage:function(e,data){this.options.skip=0;this._loadDocs()},prevpage:function(){var o=this.options;o.skip=o.skip-o.limit;this._loadDocs()},gotopage:function(page){var o=this.options;o.skip=(page-1)*o.limit;this._loadDocs()},nextpage:function(){var o=this.options;o.skip=o.skip+o.limit;this._loadDocs()},lastpage:function(){var o=this.options;o.skip=Math.floor(o.total/o.limit)*o.limit;this._loadDocs()},refresh:function(){var o=this.options;this["_"+o.mode]&&this["_"+o.mode]();this._refreshPager()},_refreshPager:function(){var o=this.options;if(this.pager){if(o.totalPage<=1){this.pager.hide();return this}this.pager.show();this.pager.find(".pager-button").button("enable");if(o.currentPage<=1){this.pager.find("#first").button("disable");this.pager.find("#prev").button("disable")}else{if(o.currentPage>=o.totalPage){this.pager.find("#last").button("disable");this.pager.find("#next").button("disable")}}this.pager.find("input.current-page").val(o.currentPage);this.pager.find(".total-page").html(o.totalPage);var currentNums=o.currentPage==o.totalPage?(o.limit*(o.currentPage-1)+o.total%o.limit):o.limit*o.currentPage,info="";if($.i18n.pager){info=$.i18n.pager.display.replace(/{total}/,o.total).replace(/{currentPagerFirst}/,(o.limit*(o.currentPage-1)+1)).replace(/{currentPagerLast}/,currentNums)}else{info="Displaying "+(o.limit*(o.currentPage-1)+1)+" to "+currentNums+" of "+o.total+" items."}this.pager.find(".info").html(info)}},reload:function(){this._loadDocs()},_loadDocs:function(){var self=this,o=this.options,sel=o.view.selector,filter=o.filter,opts={skip:o.skip,limit:o.limit},selectorStr,taskUrl=o.view.taskUrl;if($.type(o.view.sort)=="string"){opts.sort=eval("("+o.view.sort+")")}if($.type(taskUrl)=="string"&&taskUrl.replace(/(^\s*)|(\s*$)/g,"")!=""){var param={};param.taskFilter=typeof filter=="string"?eval("("+filter+")"):filter;param.skip=o.skip;param.limit=o.limit;param.sort=opts.sort||o.view.sort;param.options={exec:true,redirect:true};$.ans.getDoc(o.dbId,taskUrl,param,function(err,data){self.docs=data.docs;try{self._docsLoaded&&self._docsLoaded()}catch(e){}self._trigger("documentloaded",null,data)});return}if($.type(sel)=="string"&&sel.replace(/\s/g,"")){sel=eval("("+sel+")");if($.type(filter)=="string"){selectorStr=filter.replace(/\s/g,"")?{selector:sel,filter:eval("("+filter+")"),options:opts}:{selector:sel,options:opts}}else{selectorStr=filter?{selector:sel,filter:filter,options:opts}:{selector:sel,options:opts}}$.ans.getDoc(o.dbId,null,selectorStr,function(err,data){self.docs=data.docs;o.total=data.total;if(self.pager){o.currentPage=Math.floor(o.skip/o.limit+1);o.totalPage=Math.ceil(o.total/o.limit)}try{self._docsLoaded&&self._docsLoaded()}catch(e){}self._trigger("documentloaded",null,data)})}},_getRow:function(row){return this.docs[row-this.options.skip]},_delRow:function(row){var self=this,o=this.options;Model.deleteDocument(o.dbId,this.docs[row-o.skip]._id,null,function(err,result){self._loadDocs()})},save:function(){var self=this,o=this.options,view=o.view;Model.updateDocument(o.dbId,view._id,view,null,function(err,result){self.option("isDirty",false)})},destroy:function(){this.element.children("style").remove();this.element.unbind(".view").empty();$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.gridview",$.an.view,{options:{printable:false},_create:function(){$.an.view.prototype._create.apply(this,arguments);this.element.addClass("an-gridview");var self=this,o=this.options;if(o.view.cellRender){o.cellRender=eval("("+o.view.cellRender+")")}this.element.agilegrid($.extend({rowOffset:o.skip,showPager:o.showPager,dbId:o.dbId,leftHeaderRender:function(row){return row+1},cellRender:function(row,col){var value="",r=self._getRow(row),cm=this.colModel,c=cm[col];if(o.cellRender){value=o.cellRender(row,col,doc,cm)}else{if(r&&c){value=eval("try{r['"+c.name+"']}catch(e){}")}}return value?value+"":""},firstpage:function(e,data){o.skip=0;self._loadDocs()},prevpage:function(e,data){o.skip=o.skip-o.limit;self._loadDocs()},gotopage:function(e,data){o.skip=(data.page-1)*o.limit;self._loadDocs()},nextpage:function(e,data){o.skip=o.skip+o.limit;self._loadDocs()},lastpage:function(e,data){o.skip=Math.floor(o.total/o.limit)*o.limit;self._loadDocs()},celldblclick:function(e,data){self._trigger("docdblclick",e,self.docs[data.row-o.skip])},cellclick:function(e,data){self._trigger("docclick",e,self.docs[data.row-o.skip])},contentActions:function(row,col){return o.contentActions(self.docs[row-o.skip])},optionchanged:function(e,data){if(data.key=="colModel"&&o.mode=="design"){self.option("isDirty",true)}}},o.view.options));this.refresh()},_docsLoaded:function(){var o=this.options,rc=this.docs.length;this.element.agilegrid({currentPage:Math.floor(o.skip/o.limit+1),totalPage:Math.ceil(o.total/o.limit),rowOffset:o.skip,rowCount:rc,totalRowCount:o.total})},_design:function(){this.element.agilegrid({columnEditable:true,isColumnResizable:true,isRowResizable:true})},_browser:function(){this.element.agilegrid($.extend({columnEditable:false,isColumnResizable:false,isRowResizable:false},this.options.view.options))},_createPager:function(){},save:function(){$.extend(this.options.view.options,this._viewOptions());return $.an.view.prototype.save.apply(this,arguments)},option:function(key,value){if(key==="viewOptions"&&value===undefined){return this._viewOptions()}return $.an.view.prototype.option.apply(this,arguments)},_viewOptions:function(){var self=this,value={};$.each(["showTopHeader","showLeftHeader","isColumnResizable","isRowResizable","topHeaderHeight","leftHeaderWidth","defaultColWidth","defaultRowHeight","colModel","rowModel","totalColCount"],function(k,v){value[v]=self.element.agilegrid("option",v)});return value},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&viewid="+o.view._id;print(url)},destroy:function(){this.element.agilegrid("destroy").unbind(".gridview").removeClass("an-gridview");$.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.formview",a.an.view,{options:{printable:false,pagerPosition:"bottom",itemWidth:320,itemHeight:280},_create:function(){a.an.view.prototype._create.apply(this,arguments);var e=this.options,d=this.element;e.showPager=e.view.showPager;e.itemWidth=e.view.itemWidth;e.itemHeight=e.view.itemHeight;d.addClass("an-formview");this.documents=a("<div class='content'/>").prependTo(d)},_showDocuments:function(){var d=this,f=this.options;this.documents.empty();var e=document.createDocumentFragment();a.each(this.docs,function(h,i){var g=a("<div class='grid-item'/>").css({width:f.itemWidth,height:f.itemHeight});e.appendChild(g[0]);g.editor({dbId:f.dbId,document:i,forms:[f.form],readOnly:true})});d.documents[0].appendChild(e)},_docsLoaded:function(d){if(a.isArray(d)){this.docs=d}this.refresh()},_design:function(){this._showDocuments()},_browser:function(){this._showDocuments()},save:function(){var d=this,e={};a.extend(this.options.view.options,e);return a.an.view.prototype.save.apply(this,arguments)},print:function(){var f=this.options,e=window.location,d=e.protocol+"//"+e.host+"/pdfs?dbid="+f.dbId+"&viewid="+f.view._id;print(d)},destroy:function(){this.element.unbind(".formview").removeClass("an-formview show-pager");a.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.customview",$.an.view,{options:{printable:false,pagerPosition:"bottom"},_create:function(){$.an.view.prototype._create.apply(this,arguments);var o=this.options,el=this.element;el.addClass("an-customview");o.templateTemp=o.view.templateTemp;o.templateSelector=o.view.templateSelector;o.templateConverts=o.view.templateConverts;o.templateContent=o.view.templateContent;this.documents=$(o.templateContent).prependTo(el);if(o.templateTemp){o.templateTemp=$.templates(o.templateTemp)}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_showDocuments:function(){var self=this,o=this.options;if(o.templateTemp){var html=o.templateTemp.render(self.docs);$(o.templateSelector,this.documents).html(html)}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_docsLoaded:function(){this.refresh()},_design:function(){this._showDocuments()},_browser:function(){this._showDocuments()},save:function(){var value={};$.extend(this.options.view.options,value);return $.an.view.prototype.save.apply(this,arguments)},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&viewid="+o.view._id;print(url)},destroy:function(){this.element.unbind(".formview").removeClass("an-formview show-pager");$.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.editor",{options:{printable:true,mode:"browser",document:{},forms:[],actionSets:[],parseDot:true,isDocDirty:false},_create:function(){this.element.addClass("an-editor");var self=this,o=this.options,el=this.element,doc=o.document,docType=doc.type,forms={};this.doc=new DocWrapper(doc,o.parseDot);var id=doc._id;if(id){o.url="/dbs/"+o.dbId+"/"+id+"/attachments"}if(o.forms.length<=1){el.addClass("tabs-nav-hide")}if(o.design&&(docType==Model.FORM||docType==Model.PAGE||docType==Model.VIEW)){forms[doc._id+"-design"]=doc}$.each(o.forms||[],function(k,v){forms[v._id]=v});el.append("<ul />").tabsx({tabTemplate:"<li><a href='#{href}' hidefocus='true'>#{label}</a></li>",show:function(event,ui){var $p=$(ui.panel),id=$p.attr("id"),d=forms[id],type=d.type;if($p.is(".an-form,.an-page,.an-view,.an-mpage")){var data=$p.data();for(var i in data){if($.inArray(i,["form","page","mpage","gridview","formview","customview","view","mobilelistview"])!=-1){if(!o.design||!(/-design$/.test(id))){data[i].option("mode",o.mode)}data[i].option("mobile",o.mobile);self._trigger("tabshow",event,data[i]);break}}}else{var opt={dbId:o.dbId,mode:(o.design&&/-design$/.test(id))?"design":o.mode,ignoreEscape:o.ignoreEscape,change:function(){o.change&&o.change()},mobile:o.mobile,readOnly:o.readOnly,widgetselect:o.widgetselect,optionchanged:function(e,data){if(data.key=="isDirty"){if(data.value){self.option("isFormDirty",true)}else{var isFormDirty=false;el.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview","customview","view","mobilelistview"])!=-1){isFormDirty=data[i].option("isDirty");if(isFormDirty){break}}}});self.option("isFormDirty",isFormDirty)}}else{if(data.key=="mode"){self.option(data.key,data.value)}}}};if(type==Model.FORM){$p.form($.extend(true,{form:d,document:(o.design&&/-design$/.test(id))?{}:function(){return self.doc},url:o.url,editor:self,create:function(){self._trigger("tabcreated",event,$(this).data("form"))}},opt))}else{if(type==Model.PAGE){$p.page($.extend(true,{page:d,create:function(){self._trigger("tabcreated",event,$(this).data("page"))}},opt))}else{if(type==Model.VIEW){var vt=d.viewType||"gridview",vt=vt.toLowerCase();vt=(vt=="customizedview"?"view":vt);var optsx={view:d,create:function(){self._trigger("tabcreated",event,$(this).data(vt))}};if(vt=="formview"||vt=="customview"||vt=="mobilelistview"){optsx.form=o.form}$p[vt]($.extend(true,optsx,opt))}}}}}});$.each(forms||[],function(k,v){el.tabsx("add","#"+k,v.title)});if(o.tabsPosition=="bottom"){el.addClass("tabs-bottom").children(".ui-tabs-nav, .ui-tabs-nav > *").removeClass("ui-corner-all ui-corner-top").addClass("ui-corner-bottom")}el.attr("tabIndex",-1).css("outline",0).keydown(function(e){var form=self._currentForm();if(e.keyCode===$.ui.keyCode.ESCAPE&&!o.ignoreEscape&&!e.isDefaultPrevented()&&form.validate()){e.preventDefault();self.option("mode","browser");form.option("mode","browser")}}).bind("dblclick.form",function(e){var form=self._currentForm();if(o.mode=="browser"&&!o.readOnly){self.option("mode","edit");form.option("mode","edit")}});$(this.doc).bind("propchanged.editor",function(e,id,value,oldValue,trans){if(!trans){self.option("isDocDirty",true)}if(o.design&&(docType==Model.FORM||docType==Model.PAGE||docType==Model.VIEW)){var docId=doc._id+"-design",dd=$.extend(true,{},doc);el.children("#"+docId+".ui-tabs-panel").each(function(){var $this=$(this);if($this.is(".an-form,.an-page,.an-view,.an-mpage")){var data=$this.data();for(var i in data){if($.inArray(i,["form","page","mpage"])!=-1){$this[i]("option",i,dd)}else{if($.inArray(i,["gridview","formview","customview","view","mobilelistview"])!=-1){$this[i]("option","view",dd)}}}}})}self._trigger("docpropchanged",e,{id:id,value:value,oldValue:oldValue,"transient":trans})});$(document).bind("documentChanged.editor",function(e,data){var ds=$.isArray(data)?data:[data],id;for(var i in ds){id=ds[i]._id;if(id==o.document._id){$.extend(true,o.document,ds[i]);el.children(".ui-tabs-panel").each(function(){var $this=$(this);$this.is(".an-form")&&$this.form("refresh")})}if(forms[id]||forms[id+"-design"]){if(forms[id+"-design"]){id=id+"-design"}forms[id]=$.extend(true,{},ds[i]);for(var j in o.forms){if(o.forms[j]._id==ds[i]._id){o.forms[j]=forms[id];break}}el.children("#"+id+".ui-tabs-panel").each(function(){var $this=$(this);if($this.is(".an-form,.an-page,.an-view,.an-mpage")){var data=$this.data();for(var i in data){if($.inArray(i,["form","page","mpage"])!=-1){$this[i]("option",i,forms[id])}else{if($.inArray(i,["gridview","formview","customview","view","mobilelistview"])!=-1){$this[i]("option","view",forms[id])}}}}})}}}).bind("documentDeleted.editor",function(e,data){var ds=$.isArray(data)?data:[data],id;for(var i in ds){id=ds[i]._id;if(forms[id]||forms[id+"-design"]){if(forms[id+"-design"]){id=id+"-design"}for(var j in o.forms){if(o.forms[j]._id==ds[i]._id){o.forms.splice(j,1);delete forms[id];el.tabsx("remove",id);break}}}}})},_validate:function(){var self=this,valid=true;this.element.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page"])!=-1&&data[i].option("mode")!="design"&&!data[i].option("isValid")){self.element.tabsx("select",data[i].option("form")._id);valid=false;return false}}});return valid},save:function(opts){opts=opts||{};var self=this,o=this.options,dbId=o.dbId,valid=true;this.element.tabsx("option","panels").each(function(){var data=$(this).data();for(var i in data){if($.inArray(i,["form","page"])!=-1){if(data[i].option("isDirty")){if(data[i].option(i)._id==o.document._id){o.document.content=data[i].option("content");data[i].option("isDirty",false);o.isDocDirty=true}else{data[i].save()}}if(opts.validate&&valid&&form.option("mode")!="design"){valid=form.option("isValid");if(!valid){self.element.tabsx("select",form.option("form")._id)}}}else{if($.inArray(i,["gridview","formview","customview","view","mobilelistview"])!=-1){if(data[i].option("isDirty")){if(data[i].option("view")._id==o.document._id){o.document.options=$.extend(true,o.document.options,data[i].option("viewOptions"));data[i].option("isDirty",false);o.isDocDirty=true}else{data[i].save()}}}}}});this.option("isFormDirty",false);if(valid&&o.isDocDirty){var doc=this._getDocument(),opNew={options:{}},tags=false;if($.type(opts.beforesave)=="function"){opts.beforesave(doc)}if(o.formIds){doc.formIds=o.formIds}if(o.task||opts.task){opNew.options["task"]=o.task||opts.task;tags=true}if(o.isNew){var def=o["default"]&&o["default"]._id;if(def){opNew.options["default"]=def;tags=true}Model.postDocument(dbId,doc,tags?opNew:null,function(err,result){if(!err){delete o.isNew;$.extend(o.document,result);self.option("option","url","/dbs/"+dbId+"/"+doc._id+"/attachments");self.option("isDocDirty",false)}if($.type(opts.saved)=="function"){opts.saved(err,doc,true)}else{o.saved&&o.saved(err,doc,true)}})}else{Model.updateDocument(dbId,doc._id,doc,tags?opNew:null,function(err,result){if(!err){$.extend(o.document,result);self.option("isDocDirty",false)}if($.type(opts.saved)=="function"){opts.saved(err,doc,true)}else{o.saved&&o.saved(err,doc,true)}})}}},_getDocument:function(){var o=this.options,doc=$.extend(true,{},o.document);$.each(o.forms,function(){$(this.content).find(".field[transient=true]").each(function(){var $this=$(this),id=$this.attr("id");if(id){id=id.replace(/-/g,".");if($this.attr("transient")){try{delete eval("doc."+id)}catch(e){}}}})});return doc},print:function(){this._currentForm().print()},option:function(key,value){var self=this,o=this.options;if(key==="actionSets"&&value===undefined){var cf=this._currentForm();return cf&&cf.option("actionSets")}else{if(key==="outline"&&value===undefined){var form=this._currentForm();if(form){return form.option("outline")}}else{if(key==="document"&&value===undefined){return this._getDocument()}else{if(key==="namedValues"&&value===undefined){var nv={};$.each(o.forms,function(k,form){$(form.form).find(".field:not(.button)").each(function(){var id=$(this).attr("id");if(id){id=id.replace(/-/g,".");nv[id]=self.doc.prop(id)}})});return nv}else{if(key=="currentForm"&&value==undefined){return this._currentForm()}else{if(key=="isValid"&&value==undefined){return this._validate()}}}}}}var ret=$.Widget.prototype.option.apply(this,arguments);return ret===undefined?null:ret},_setOption:function(key,value){var oldValue=this.options[key];if(!equals(value,oldValue)){$.Widget.prototype._setOption.apply(this,arguments);if(key==="document"){this.doc.setDoc(value);this._setOption("isDocDirty",false)}else{if(key==="url"){this.element.tabsx("option","panels").each(function(){$(this).form("option",key,value)})}else{if(key==="mode"){this._currentForm().option(key,value)}}}this._trigger("optionchanged",null,{key:key,value:value,oldValue:oldValue})}return this},getForm:function(id){var o=this.options;if(o.design&&(id==o.document._id)){id=id+"-design"}var data=this.element.tabsx("panel",id).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview","customview","view","mobilelistview"])!=-1){return data[i]}}return null},_currentForm:function(){var data=$(this.element.tabsx("option","selectedPanel")).data();for(var i in data){if($.inArray(i,["form","page","gridview","formview","customview","view","mobilelistview"])!=-1){return data[i]}}return null},refresh:function(){this._currentForm().refresh();return this},highlightWidget:function(id,highlight){return this._currentForm().highlightWidget(id,highlight)},destroy:function(){$(document).unbind(".editor");this.element.tabsx("destroy").removeClass("an-editor tabs-bottom").unbind(".editor").undelegate(".an-form",".editor").empty();$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.authorization",a.ui.dialog,{options:{title:"Authorization",westWidth:220,width:620,height:480,forms:[]},_create:function(){a.ui.dialog.prototype._create.apply(this,arguments);var d=this.element.addClass("an-authorization");this.west=a("<div class='west'/>").appendTo(d);this.organization=a("<div class='organization ui-corner-all'/>").appendTo(this.west);this.center=a("<div class='center'/>").appendTo(d);this.operation=a("<div class='operation ui-corner-all'><h4 class='title'/></div>").appendTo(this.center);this.content=a("<div class='content'/>").appendTo(this.operation)},_init:function(){a.ui.dialog.prototype._init.apply(this,arguments);var d=this,e=this.options;this.element.border({west:{selector:".west",width:e.westWidth,resizable:true},center:{selector:".center"}});this.organization.explorer({dbId:e.dbId,roots:[Model.OU_ROOT,Model.GROUP_ROOT,Model.ROLE_ROOT],nodeclick:function(h,f){var g=f.data;d.center.find(".title").html(g.title||g.name||g._id);d.content.editor({document:d._getACLAuthz(g),forms:e.forms,dbId:e.dbId,mode:"edit",ignoreEscape:true,docpropchanged:function(j,i){d._updateDocument(g,i)}})}});e.resize=function(){d.element.border("refresh")}},_getACLAuthz:function(h){var e=this.options,k=e.document,q=(h.type==Model.USER?h._id:h._path),p=null,d={title:k.title||k.name||k._id,typeName:"Document"},g=this._getPathsName(h),n=k._acl,j=k._authz,f,l,i,m;if(n){p=n.get&&n.get[g];f=p&&(a.inArray(q,p)!=-1)?true:false;p=n.put&&n.put[g];i=p&&(a.inArray(q,p)!=-1)?true:false;p=n["delete"]&&n["delete"][g];m=p&&(a.inArray(q,p)!=-1)?true:false;d._acl={get:f,put:i,"delete":m}}if(k.type==Model.META){d.typeName=k.title||k.name||k._id||"Document";if(j){p=j.post&&j.post[g];l=p&&(a.inArray(q,p)!=-1)?true:false;p=j.get&&j.get[g];f=p&&(a.inArray(q,p)!=-1)?true:false;p=j.put&&j.put[g];i=p&&(a.inArray(q,p)!=-1)?true:false;p=j["delete"]&&j["delete"][g];m=p&&(a.inArray(q,p)!=-1)?true:false;d._authz={get:f,post:l,put:i,"delete":m}}}return d},_updateDocument:function(g,h){var k=this.options.document,e=h.id.split("."),j=k[e[0]]=k[e[0]]||{},d=j[e[1]]=j[e[1]]||{},f=this._getPathsName(g),m=d[f]=d[f]||[],l=(g.type==Model.USER?g._id:g._path),i=a.inArray(l,m);if(h.value&&(i==-1)){m.push(l)}else{if(!h.value&&i!=-1){m.splice(i,1);if(m.length<=0){delete d[f];if(a.isEmptyObject(d)){delete j[e[1]];if(a.isEmptyObject(j)){}}}}}},_getPathsName:function(d){var e=null;if(d.type==Model.USER){e="users"}else{if(d.type==Model.OU){e="ouPaths"}else{if(d.type==Model.GROUP){e="groupPaths"}else{if(d.type==Model.ROLE){e="rolePaths"}}}}return e},destroy:function(){this.element.border("destroy").removeClass("an-authorization");a.ui.dialog.prototype.destroy.apply(this,arguments)}})})(jQuery);if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/* JsRender v1.0pre: http://github.com/BorisMoore/jsrender */
(function(a,z,r){if(z&&z.views||a.jsviews){return}var aj="v1.0pre",O,af,v,A,p="{",n="{",h="}",g="}",ab="^",B=/^(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,ac=/(\()(?=\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*((\))(?=\s*\.|\s*\^)|\)|\])([([]?))|(\s+)/g,W=/\s*\n/g,f=/\\(['"])/g,ah=/([\\'"])/g,q=/\x08(~)?([^\x08]+)\x08/g,k=/^if\s/,t=/<(\w+)[>\s]/,Q=/<(\w+)[^>\/]*>[^>]*$/,R=/[<"'&]/g,M=/[><"'&]/g,ak=0,ai=0,N={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;"},Z="data-jsv-tmpl",u=[].slice,S={},V={template:{compile:b},tag:{compile:s},helper:{},converter:{}},P={jsviews:aj,render:S,View:ag,settings:{delimiters:x,debugMode:true,tryCatch:true},sub:{Error:G,tmplFn:E,parse:y,extend:w,error:I,syntaxError:U},_cnvt:J,_tag:d,_err:function(al){return X.debugMode?("Error: "+(al.message||al))+". ":""}};function G(am,al){if(al&&al.onError){if(al.onError(am)===false){return}}this.name="JsRender Error";this.message=am||"JsRender error"}function w(an,am){var al;an=an||{};for(al in am){an[al]=am[al]}return an}(G.prototype=new Error()).constructor=G;function x(al,an,am){if(!Y.rTag||arguments.length){p=al?al.charAt(0):p;n=al?al.charAt(1):n;h=an?an.charAt(0):h;g=an?an.charAt(1):g;ab=am||ab;al="\\"+p+"(\\"+ab+")?\\"+n;an="\\"+h+"\\"+g;v="(?:(?:(\\w+(?=[\\/\\s\\"+h+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+h+"]|\\"+h+"(?!\\"+g+"))*?)";Y.rTag=v+")";v=new RegExp(al+v+"(\\/)?|(?:\\/(\\w+)))"+an,"g");A=new RegExp("<.*>|([^\\\\]|^)[{}]|"+al+".*"+an)}return[p,n,h,g,ab]}function L(ap,ar){if(!ar){ar=ap;ap=r}var ao,aq,an,at,am=this,al=!ar||ar==="root";if(ap){at=am.type===ar?am:r;if(!at){ao=am.views;if(am._.useKey){for(aq in ao){if(at=ao[aq].get(ap,ar)){break}}}else{for(aq=0,an=ao.length;!at&&aq<an;aq++){at=ao[aq].get(ap,ar)}}}}else{if(al){while(am.parent.parent){at=am=am.parent}}else{while(am&&!at){at=am.type===ar?am:r;am=am.parent}}}return at}function K(){var al=this.get("item");return al?al.index:r}K.depends=function(){return[this.get("item"),"index"]};function aa(ao){var am,al=this,an=(al.ctx||{})[ao];an=an===r?al.getRsc("helpers",ao):an;if(an){if(typeof an==="function"){am=function(){return an.apply(al,arguments)};w(am,an)}}return am||an}function J(aq,ao,ap){var an,am,at,ar=+ap===ap&&ap,al=ao.linkCtx;if(ar){ap=(ar=ao.tmpl.bnds[ar-1])(ao.data,ao,P)}at=ap.args[0];if(aq||ar){am=al&&al.tag||{_:{inline:!al},tagName:aq+":",flow:true,_is:"tag"};am._.bnd=ar;if(al){al.tag=am;am.linkCtx=al;ap.ctx=ae(ap.ctx,al.view.ctx)}am.tagCtx=ap;ap.view=ao;am.ctx=ap.ctx||{};delete ap.ctx;ao._.tag=am;aq=aq!=="true"&&aq;if(aq&&((an=ao.getRsc("converters",aq))||I("Unknown converter: {{"+aq+":"))){am.depends=an.depends;at=an.apply(am,ap.args)}at=ar&&ao._.onRender?ao._.onRender(at,ao,ar):at;ao._.tag=r}return at}function C(an,ap){var ao,al=this,am=P[an];ao=am&&am[ap];while((ao===r)&&al){am=al.tmpl[an];ao=am&&am[ap];al=al.parent}return ao}function d(an,ap,at,au){var aI,aJ,aw,ay,aG,aC,aD,aA,aF,av,al,aB,aE,ar,aH="",aq=+au===au&&au,ao=ap.linkCtx||0,az=ap.ctx,am=at||ap.tmpl,ax=ap._;if(an._is==="tag"){aJ=an;an=aJ.tagName}if(aq){au=(aE=am.bnds[aq-1])(ap.data,ap,P)}aA=au.length;aJ=aJ||ao.tag;for(aD=0;aD<aA;aD++){av=au[aD];aB=av.tmpl;aB=av.content=aB&&am.tmpls[aB-1];at=av.props.tmpl;if(!aD&&(!at||!aJ)){ar=ap.getRsc("tags",an)||I("Unknown tag: {{"+an+"}}")}at=at||!aD&&ar.template||aB;at=""+at===at?ap.getRsc("templates",at)||H(at):at;w(av,{tmpl:at,render:m,index:aD,view:ap,ctx:ae(av.ctx,az)});if(!aJ){if(ar.init){aJ=new ar.init(av,ao,az);aJ.attr=aJ.attr||ar.attr||r}else{aJ={render:ar.render}}aJ._={inline:!ao};if(ao){ao.attr=aJ.attr=ao.attr||aJ.attr;ao.tag=aJ;aJ.linkCtx=ao}if(aJ._.bnd=aE||ao){aJ._.arrVws={}}aJ.tagName=an;aJ.parent=aC=az&&az.tag,aJ._is="tag"}ax.tag=aJ;av.tag=aJ;aJ.tagCtxs=au;aJ.rendering={};if(!aJ.flow){al=av.ctx=av.ctx||{};aw=al.parentTags=az&&ae(al.parentTags,az.parentTags)||{};if(aC){aw[aC.tagName]=aC}al.tag=aJ}}for(aD=0;aD<aA;aD++){av=aJ.tagCtx=au[aD];aJ.ctx=av.ctx;if(aI=aJ.render){aF=aI.apply(aJ,av.args)}aH+=aF!==r?aF:av.tmpl?av.render():""}delete aJ.rendering;aJ.tagCtx=aJ.tagCtxs[0];aJ.ctx=aJ.tagCtx.ctx;if(aJ._.inline&&(ay=aJ.attr)&&ay!=="html"){aH=ay==="text"?ad.html(aH):""}return aH=aq&&ap._.onRender?ap._.onRender(aH,ap,aq):aH}function ag(al,aq,ax,am,ar,at,aw,az){var au,ap,ay,ao=aq==="array",an={key:0,useKey:ao?0:1,id:""+ai++,onRender:az,bnds:{}},av={data:am,tmpl:ar,content:aw,views:ao?[]:{},parent:ax,ctx:al,type:aq,get:L,getIndex:K,getRsc:C,hlp:aa,_:an,_is:"view"};if(ax){au=ax.views;ap=ax._;if(ap.useKey){au[an.key="_"+ap.useKey++]=av;ay=ap.tag;an.bnd=ao&&(!ay||!!ay._.bnd&&ay)}else{au.splice(an.key=av.index=at!==r?at:au.length,0,av)}av.ctx=al||ax.ctx}return av}function l(ap){var al,aq,am,an,ao;for(al in V){an=V[al];if((ao=an.compile)&&(aq=ap[al+"s"])){for(am in aq){aq[am]=ao(am,aq[am],ap,al,an)}}}}function s(am,an,ao){var ap,al;if(typeof an==="function"){an={depends:an.depends,render:an}}else{if(al=an.template){an.template=""+al===al?(H[al]||H(al)):al}if(an.init!==false){ap=an.init=an.init||function(aq){};ap.prototype=an;(ap.prototype=an).constructor=ap}}if(ao){an._parentTmpl=ao}return an}function b(al,ar,at,aq,am,au){function ao(av){if((""+av===av)||av.nodeType>0){try{an=av.nodeType>0?av:!A.test(av)&&z&&z(a.document).find(av)[0]}catch(aw){}if(an){av=an.getAttribute(Z);al=al||av;av=H[av];if(!av){al=al||"_"+ak++;an.setAttribute(Z,al);av=H[al]=b(al,an.innerHTML,at,aq,am,au)}}return av}}var ap,an;ar=ar||"";ap=ao(ar);au=au||(ar.markup?ar:{});au.tmplName=al;if(at){au._parentTmpl=at}if(!ap&&ar.markup&&(ap=ao(ar.markup))){if(ap.fn&&(ap.debug!==ar.debug||ap.allowCode!==ar.allowCode)){ap=ap.markup}}if(ap!==r){if(al&&!at){S[al]=function(){return ar.render.apply(ar,arguments)}}if(ap.fn||ar.fn){if(ap.fn){if(al&&al!==ap.tmplName){ar=ae(au,ap)}else{ar=ap}}}else{ar=i(ap,au);E(ap,ar)}l(au);return ar}}function i(ao,ap){var al,am=X.wrapMap||{},an=w({markup:ao,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:m},ap);if(!ap.htmlTag){al=t.exec(ao);an.htmlTag=al?al[1].toLowerCase():""}al=am[an.htmlTag];if(al&&al!==am.div){an.markup=O.trim(an.markup);an._elCnt=true}return an}function e(an,am){function ao(ap,ar,aw){var aq,av,au,at;if(ap&&""+ap!==ap&&!ap.nodeType&&!ap.markup){for(au in ap){ao(au,ap[au],ar)}return P}at=aw?aw[al]=aw[al]||{}:ao;if(ar===r){ar=ap;ap=r}av=am.compile;if(aq=Y.onBeforeStoreItem){av=aq(at,ap,ar,av)||av}if(!ap){ar=av(r,ar)}else{if(""+ap===ap){if(ar===null){delete at[ap]}else{at[ap]=av?(ar=av(ap,ar,aw,an,am)):ar}}}if(ar){ar._is=an}if(aq=Y.onStoreItem){aq(at,ap,ar,av)}return ar}var al=an+"s";P[al]=ao;V[an]=am}function m(aG,an,ao,aH,aq,ap){var aB,aA,at,aD,aF,ay,ax,au,am,aE,aC,al,ar,az=this,aw=!az.attr||az.attr==="html",av="";if(aH===true){ax=true;aH=0}if(az.tag){au=az;az=az.tag;aE=az._;al=az.tagName;ar=au.tmpl;an=ae(an,az.ctx);am=au.content;if(au.props.link===false){an=an||{};an.link=false}ao=ao||au.view;aG=aG===r?ao:aG}else{ar=az.jquery&&(az[0]||I('Unknown template: "'+az.selector+'"'))||az}if(ar){if(!ao&&aG&&aG._is==="view"){ao=aG}if(ao){am=am||ao.content;ap=ap||ao._.onRender;if(aG===ao){aG=ao.data;aq=true}an=ae(an,ao.ctx)}if(!ao||ao.data===r){(an=an||{}).root=aG}if(!ar.fn){ar=H[ar]||H(ar)}if(ar){ap=(an&&an.link)!==false&&aw&&ap;aC=ap;if(ap===true){aC=r;ap=ao._.onRender}if(O.isArray(aG)&&!aq){aD=ax?ao:(aH!==r&&ao)||ag(an,"array",ao,aG,ar,aH,am,ap);for(aB=0,aA=aG.length;aB<aA;aB++){at=aG[aB];aF=ag(an,"item",aD,at,ar,(aH||0)+aB,am,ap);ay=ar.fn(at,aF,P);av+=aD._.onRender?aD._.onRender(ay,aF):ay}}else{aD=ax?ao:ag(an,al||"data",ao,aG,ar,aH,am,ap);if(aE&&!az.flow){aD.tag=az}av+=ar.fn(aG,aD,P)}return aC?aC(av,aD):av}}return""}function I(al){if(X.debugMode){throw new P.sub.Error(al)}}function U(al){I("Syntax error\n"+al)}function E(az,av,ay,aq){function an(aA){aA-=ap;if(aA){at.push(az.substr(ap,aA).replace(W,"\\n"))}}function ax(aA){aA&&U('Unmatched or missing tag: "{{/'+aA+'}}" in template:\n'+az)}function al(aE,aS,aF,aP,aN,aI,aC,aM,aO,aK,aR,aG){if(aI){aN=":";aP="html"}aK=aK||ay;var aA,aJ,aQ=aS&&[],aB="",aD="",aL="",aH=!aK&&!aN&&!aC;aF=aF||aN;an(aG);ap=aG+aE.length;if(aM){if(ao){at.push(["*","\n"+aO.replace(f,"$1")+"\n"])}}else{if(aF){if(aF==="else"){if(k.test(aO)){U('for "{{else if expr}}" use "{{else expr}}"')}aQ=ar[6];ar[7]=az.substring(ar[7],aG);ar=au.pop();at=ar[3];aH=true}if(aO){aO=aO.replace(W," ");aB=y(aO,aQ).replace(q,function(aT,aU,aV){if(aU){aL+=aV+","}else{aD+=aV+","}return""})}aD=aD.slice(0,-1);aB=aB.slice(0,-1);aA=aD&&(aD.indexOf("noerror:true")+1)&&aD||"";aw=[aF,aP||!!aq||"",aB,aH&&[],'params:"'+aO+'",props:{'+aD+"}"+(aL?",ctx:{"+aL.slice(0,-1)+"}":""),aA,aQ||0];at.push(aw);if(aH){au.push(ar);ar=aw;ar[7]=ap}}else{if(aR){aJ=ar[0];ax(aR!==aJ&&aJ!=="else"&&aR);ar[7]=az.substring(ar[7],aG);ar=au.pop()}}}ax(!ar&&aR);at=ar[3]}var aw,ao=av&&av.allowCode,am=[],ap=0,au=[],at=am,ar=[,,,am];az=az.replace(ah,"\\$1");ax(au[0]&&au[0][3].pop()[0]);az.replace(v,al);an(az.length);if(ap=am[am.length-1]){ax(""+ap!==ap&&(+ap[7]===ap[7])&&ap[0])}return D(am,av||az,ay)}function D(al,ay,ar){var aS,aE,az,aC,an,aM,aR,aF,ao,aT,aL,aB,at,aw,ax,aJ,ap,aD,aI,au,aK,am,aW,aG,aV,aA,aH,aP,av=0,aq="",aN="",aQ={},aO=al.length;if(""+ay===ay){aJ=ar?'data-link="'+ay.replace(W," ").slice(1,-1)+'"':ay;ay=0}else{aJ=ay.tmplName||"unnamed";if(aI=ay.allowCode){aQ.allowCode=true}if(ay.debug){aQ.debug=true}aL=ay.bnds;ax=ay.tmpls}for(aS=0;aS<aO;aS++){aE=al[aS];if(""+aE===aE){aq+='\nret+="'+aE+'";'}else{az=aE[0];if(az==="*"){aq+=""+aE[1]}else{aC=aE[1];an=aE[2];au=aE[3];aM=aE[4];aN=aE[5];aK=aE[7];if(!(aV=az==="else")){av=0;if(aL&&(aB=aE[6])){av=aL.push(aB)}}if(aA=az===":"){if(aC){az=aC==="html"?">":aC+az}if(aN){aH="prm"+aS;aN="try{var "+aH+"=["+an+"][0];}catch(e){"+aH+'="";}\n';an=aH}}else{if(au){ap=i(aK,aQ);ap.tmplName=aJ+"/"+az;D(au,ap);ax.push(ap)}if(!aV){aD=az;aG=aq;aq="";at=aS}aW=al[aS+1];aW=aW&&aW[0]==="else"}aM+=",args:["+an+"]}";if(aA&&aB||aC&&az!==">"){aP=new Function("data,view,j,u"," // "+aJ+" "+av+" "+az+"\n"+aN+"return {"+aM+";");aP.paths=aB;aP._ctxs=az;if(ar){return aP}aT=true}aq+=(aA?"\n"+(aB?"":aN)+(ar?"return ":"ret+=")+(aT?(aT=true,'c("'+aC+'",view,'+(aB?((aL[av-1]=aP),av):"{"+aM)+");"):az===">"?(aF=true,"h("+an+");"):(ao=true,"(v="+an+")!="+(ar?"=":"")+'u?v:"";')):(aR=true,"{tmpl:"+(au?ax.length:"0")+","+aM+","));if(aD&&!aW){aq="["+aq.slice(0,-1)+"]";if(ar||aB){aq=new Function("data,view,j,u"," // "+aJ+" "+av+" "+aD+"\nreturn "+aq+";");if(aB){(aL[av-1]=aq).paths=aB}aq._ctxs=az;if(ar){return aq}}aq=aG+'\nret+=t("'+aD+'",view,this,'+(av||aq)+");";aB=0;aD=0}}}}aq="// "+aJ+"\nvar j=j||"+(z?"jQuery.":"js")+"views"+(ao?",v":"")+(aR?",t=j._tag":"")+(aT?",c=j._cnvt":"")+(aF?",h=j.converters.html":"")+(ar?";\n":',ret="";\n')+(X.tryCatch?"try{\n":"")+(aQ.debug?"debugger;":"")+aq+(ar?"\n":"\nreturn ret;\n")+(X.tryCatch?"\n}catch(e){return j._err(e);}":"");try{aq=new Function("data,view,j,u",aq)}catch(aU){U("Compiled template code:\n\n"+aq,aU)}if(ay){ay.fn=aq}return aq}function y(ap,am){function av(ax,aP,az,aH,aE,aA,aQ,aw,aF,aO,aN,aJ,aM,aC,aK,ay,aL,aB,aD){aE=aE||"";az=az||aP||aN;aH=aH||aw;if(am&&aK){am.push({_jsvOb:aD.slice(au[an-1]+1,aB+1)})}aF=aF||ay||"";function aI(aU,aT,aW,aR,aY,aX,aV){if(aT){am&&!ar&&am.push(aH);if(aT!=="."){var aS=(aW?'view.hlp("'+aW+'")':aR?"view":"data")+(aV?(aY?"."+aY:aW?"":(aR?"":"."+aT))+(aX||""):(aV=aW?"":aR?aY||"":aT,""));aS=aS+(aV?"."+aV:"");return aS.slice(0,9)==="view.data"?aS.slice(5):aS}}return aU}if(aA){U(ap)}else{var aG=(at?(at=!aJ,(at?ax:'"')):ao?(ao=!aM,(ao?ax:'"')):((az?(an++,au[an]=aB,az):"")+(aL?(an?"":aq?(aq=ar=false,"\b"):","):aQ?(an&&U(ap),aq=aH,ar=aH.charAt(0)==="~","\b"+aH+":"):aH?(aH.split("^").join(".").replace(B,aI)+(aF?(al[++an]=true,aF):aE)):aE?aE:aC?((al[an--]=false,aC)+(aF?(al[++an]=true,aF):"")):aO?(al[an]||U(ap),","):aP?"":(at=aJ,ao=aM,'"'))));return aG}}var aq,ar,al={},au={0:-1},an=0,ao=false,at=false;return(ap+" ").replace(ac,av)}function ae(am,al){return am&&am!==al?(al?w(w({},al),am):am):al&&w({},al)}for(af in V){e(af,V[af])}var H=P.templates,ad=P.converters,F=P.helpers,T=P.tags,Y=P.sub,X=P.settings;if(z){O=z;O.fn.render=m}else{O=a.jsviews={};O.isArray=Array&&Array.isArray||function(al){return Object.prototype.toString.call(al)==="[object Array]"}}O.render=S;O.views=P;O.templates=H=P.templates;T({"else":function(){},"if":{render:function(an){var al=this,am=(al.rendering.done||!an&&(arguments.length||!al.tagCtx.index))?"":(al.rendering.done=true,al.selected=al.tagCtx.index,al.tagCtx.render());return am},onUpdate:function(ap,ao,an){var am,al,aq;for(am=0;(al=this.tagCtxs[am])&&al.args.length;am++){al=al.args[0];aq=!al!==!an[am].args[0];if(!!al||aq){return aq}}return false},flow:true},"for":{render:function(at){var ar,am,ap=this,ao=ap.tagCtx,aq=!arguments.length,al="",an=aq||0;if(!ap.rendering.done){if(aq){al=r}else{if(at!==r){al+=ao.render(at);an+=O.isArray(at)?at.length:1}}if(ap.rendering.done=an){ap.selected=ao.index}}return al},onUpdate:function(an,am,al){},onArrayChange:function(ao,am){var an,al=this,ap=am.change;if(this.tagCtxs[1]&&(ap==="insert"&&ao.target.length===am.items.length||ap==="remove"&&!ao.target.length||ap==="refresh"&&!am.oldItems.length!==!ao.target.length)){this.refresh()}else{for(an in al._.arrVws){an=al._.arrVws[an];if(an.data===ao.target){an._.onArrayChange.apply(an,arguments)}}}ao.done=true},flow:true},include:{flow:true},"*":{render:function(al){return al},flow:true}});function j(al){return N[al]}ad({html:function(al){return al!=r?String(al).replace(M,j):""},attr:function(al){return al!=r?String(al).replace(R,j):al===null?null:""},url:function(al){return al!=r?encodeURI(String(al)):al===null?null:""}});x()})(this,this.jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.sliderfield",a.an.inputfield,{_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-sliderfield")},_createControl:function(){var e=this.options,d=this;if(!e.min){e.min=1}if(!e.max){e.max=100}this.input=a("<input type='text'/>").attr({name:e.id}).attr({min:e.min,max:e.max}).bind("change.inputfield keyup.inputfield",function(h){var g=d.input.val(),f=e.value;if(g!=f){e.value=g;d._trigger("optionchanged",null,{key:"value",value:g,oldValue:f,isTransient:e.isTransient})}}).addClass("content ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c ui-input-text")},_edit:function(){this.input.appendTo(this.content).slider(this.options)},_makeResizable:function(){},_design:function(){if(!this.linkStr){this.linkStr=a('<input type="text" disabled="disabled" class="content ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c ui-input-text ui-slider-input"><div role="application" class="ui-slider-track ui-btn-down-c ui-btn-corner-all">			<a href="#"			class="ui-slider-handle ui-btn ui-shadow ui-btn-corner-all ui-btn-up-c"			data-corners="true" data-shadow="true" data-iconshadow="true"			data-wrapperels="span" data-theme="c" role="slider" aria-valuemin="0"			aria-valuemax="100" aria-valuenow="0" aria-valuetext="0" title="0"			aria-labelledby="slider1-label" style="left: 50%;">			<span class="ui-btn-inner">				<span class="ui-btn-text"></span>			</span>		</a>	</div>');this.linkStr.appendTo(this.content.removeClass("content"))}},destroy:function(){return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.togglefield",a.an.sliderfield,{_create:function(){a.an.sliderfield.prototype._create.apply(this,arguments);this.element.addClass("an-togglefield");this.element.unbind("change.widget")},_createControl:function(){var f=this.options,d=this;var e=this.element;f.ontext=f.ontext||"On";f.offtext=f.offtext||"Off";this.input=a('<select >		    <option value="no">'+f.ontext+'</option>		    <option value="yes">'+f.offtext+"</option>		  </select>").attr({name:f.id});f.stop=function(j,i){var h=d.input.val(),g=f.value;if(h!=g){f.value=h;d._trigger("optionchanged",null,{key:"value",value:h,oldValue:g,isTransient:f.isTransient})}if(a(j.target).closest(".widget")[0]==d.element[0]){setTimeout(function(){e.trigger(a.Event(j,{type:"widgetchange"}),d)},20)}};d._trigger("optionchanged",null,{key:"value",value:"no",oldValue:"",isTransient:f.isTransient})},_edit:function(){var e=this.options,d=this;this.input.appendTo(this.content).slider(this.options)},_browser:function(){var f=this.options,d=this;var e=f.value=="no"?f.ontext:f.offtext;this.input.detach();this.content.empty().append(a('<span style="height:32px;line-height:32px;margin:.5em 0;width: 5.8em;display:inline-block;">'+e+"</span>"))},_makeResizable:function(){},_design:function(){if(!this.select){var g=this.options;if(g.mobile){var e=this.element.find(".content").eq(0);e.addClass("codiqa-control ui-field-contain ui-body ui-br");this.select=a("<select />").attr({id:g.id,name:g.id,value:this.value}).addClass("ui-slider-switch").appendTo(e);var f=a("<div />").addClass("ui-slider ui-slider-switch ui-btn-down-c ui-btn-corner-all").appendTo(e);f.html('<span class="ui-slider-label ui-slider-label-a ui-btn-active ui-btn-corner-all" role="img" style="width: 0%;">On</span><span class="ui-slider-label ui-slider-label-b ui-btn-down-c ui-btn-corner-all" role="img" style="width: 100%;">Off</span>');var d=a("<div />").addClass("ui-slider-inneroffset").appendTo(f);a("<a />").addClass("ui-slider-handle ui-slider-handle-snapping ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all").html('<span class="ui-btn-inner"><span class="ui-btn-text"></span></span>').appendTo(d);this.content.removeClass("content")}}},destroy:function(){return a.an.sliderfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.collapsiblewidget",a.an.widget,{_create:function(){a.an.widget.prototype._create.apply(this,arguments);var e=this.options,f={};e.mobile=true;if(e.mobile){e.content_theme=e.content_theme||"";this.element.addClass("an-collapsiblewidget");var d=this.element.children(".content");d.attr("data-content-theme",e.content_theme);this.header=a("<h3>"+e.headerText+"</h3>");this.contentDiv=a("<div></div>");d.prepend(this.header);if(e.link!="raw"){d.append(this.contentDiv)}if(e.collapsedIcon){f.collapsedIcon=e.collapsedIcon}if(e.collapsed){f.collapsed=false}if(e.expandedIcon){f.expandedIcon=e.expandedIcon}if(e.iconpos){f.iconpos=e.iconpos}if(e.theme){f.theme=e.theme}this.opts=f}},_browser:function(){this._edit()},_edit:function(){var f=this.options,e=f.link;var d=this.element.children(".content");this.option("contextmenu2",false);this.content[0].contentEditable=false;d.collapsible&&d.collapsible(this.opts);if(e&&e!="raw"){this.contentDiv.box({hideTitleBar:true,link:f.link,odbId:f.dbId,targetId:f.targetId,mode:"browser"});this.contentDiv.css("border","0 none")}else{this.contentDiv.append(f.contentText)}},_design:function(){var f=this.options,e=f.link;this.option("contextmenu2",true);this.header.addClass("ui-collapsible-heading").html('<a href="#" class="ui-collapsible-heading-toggle ui-btn ui-fullsize ui-btn-icon-right ui-btn-up-c" data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="span" data-icon="arrow-u" data-iconpos="right" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">'+f.headerText+'<span class="ui-collapsible-heading-status"> click to collapse contents</span></span><span class="ui-icon ui-icon-shadow ui-icon-arrow-d">&nbsp;</span></span></a>');var d=false;if(e&&e!="raw"){this.contentDiv.box({hideTitleBar:true,link:f.link,odbId:f.dbId,targetId:f.targetId,mode:"design"})}else{d=true;this.contentDiv.append(f.contentText)}this.content[0].contentEditable=d},destroy:function(){var e=this.options,d=e.link;if(d&&d!="raw"){this.content.remove()}else{this.content.removeAttr("contenteditable");this.content.removeAttr("data-content-theme");this.header.remove()}this.element.removeClass("an-collapsiblewidget");this.element.unbind("collapsiblewidget");return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.navbarwidget",a.an.widget,{_create:function(){var f=this.options;a.an.widget.prototype._create.apply(this,arguments);if(f.mobile){try{this.content.navbar({iconpos:f.iconpos})}catch(d){}}},_makeResizable:function(){},_browser:function(){var d=this.content.find(".an-navbarwidget");a(d).each(function(f,e){a(e).remove()});this.content.find(".c li").css("clear","none")},_edit:function(){var d=this.content.find(".an-navbarwidget");a(d).each(function(f,e){a(e).remove()});this.content.find(".c li").css("clear","none")},_design:function(){var h=this.options;if(h.mobile){var g=a("<div data-role='navbar'/>").attr("id",h.id);var e=a("<ul class='c' />"),f;var d=h.selectItems.length;a(h.selectItems).each(function(l,j){var m=a("<a/>"),n="ui-btn ";var i=a("<span style='display:none;' class='an-navbarwidget' />");i.addClass(h.iconpos||"");if(j.data_transition){m.attr("data-transition",j.data_transition)}if(j.data_icon){i.addClass("ui-icon ui-icon-"+j.data_icon);i.css("display","block");m.attr("data-icon",j.data_icon)}if(h.iconpos){i.addClass("ui-btn-icon-"+h.iconpos)}if(j.data_theme){n+=" ui-btn-up-"+j.data_theme;m.attr("data-theme",j.data_theme)}if(j.data_inline){n+=" ui-btn-inline";m.attr("data-inline",true)}if(j.isMini){n+=" ui-mini";m.attr("data-mini",true)}if(j.href){m.attr("link",j.href)}if(d<=5){f=100/d}else{f="33.33"}if(h.iconpos&&h.iconpos!="bottom"){m.append(i).addClass(n)}m.append(j.label||"Button");if(h.iconpos&&h.iconpos=="bottom"){m.append(i).addClass(n)}e.append(a("<li style='width:"+f+"%;'/>").addClass("ui-block-a").append(m))});g.append(e);this.content.html(g.html())}},destroy:function(){return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.listviewfield",a.an.field,{options:{mode:"browser",value:[]},_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-listviewfield")},_createControl:function(){var e=this,g=this.options,f=this.element;if(g.mobile){var d=this.element.find(".content").eq(0);this.ul_element=a('<ul name="'+g.id+'" data-role="listview" />').appendTo(d);if(g.isInset){this.ul_element.attr("data-inset","true")}if(g.label_theme){this.ul_element.attr("data-divider-theme",g.label_theme)}if(g.data_theme){this.ul_element.attr("data-theme",g.data_theme)}if(g.splitIcon){this.ul_element.attr("data-split-icon",g.splitIcon);this.ul_element.attr("data-split-theme","d")}}},_createLabel:function(){},_makeResizable:function(){},_notify:function(d,e){var f=this.options;if(e!=d){f.value=e;this._trigger("optionchanged",null,{key:"value",value:e,oldValue:d,isTransient:f.isTransient})}},appendValue:function(e){var f=this.options,d=[].concat(f.value);f.value.push(e);this.refresh();this._notify(d,f.value)},insertValue:function(e,f){var g=this.options,d=[].concat(g.value);g.value.splice(e,1,f);this.refresh();this._notify(d,g.value)},delValue:function(e){var f=this.options,d=[].concat(f.value);f.value.splice(e,1);this.refresh();this._notify(d,f.value)},getValue:function(d){var e=this.options;return e.value[d]},replaceValue:function(e,f){var g=this.options,d=[].concat(g.value);g.value[e]=f;this.refresh();this._notify(d,g.value)},_browser:function(){var e=this.options,d="";this.ul_element.empty();e.value=[];a.each(e.selectItems||[],function(g,f){e.value.push(e.selectItems[g].value);d+="<li><a>"+this.label+"</a></li>"});if(e.label){this.ul_element.append('<li data-role="list-divider"><a>'+e.label+"</a></li>")}this.ul_element.append(d);this.ul_element.listview();this.ul_element.data("mobileListview").refresh()},_edit:function(){var e=this.options,d="";this.ul_element.empty();e.value=[];a.each(e.selectItems||[],function(g,f){e.value.push(e.selectItems[g].value);if(e.splitIcon){d+="<li><a>"+this.label+'</a><a href="javascript:;">'+e.splitText+"</a></li>"}else{d+="<li><a>"+this.label+"</a></li>"}});if(e.value.length>0){this._trigger("optionchanged",null,{key:"value",value:e.value,oldValue:[],isTransient:e.isTransient})}if(e.label){this.ul_element.append('<li data-role="list-divider"><a>'+e.label+"</a></li>")}this.ul_element.append(d);if(this.ul_element.listview){this.ul_element.listview();this.ul_element.data("mobileListview").refresh()}},_design:function(){var f=this,h=this.options,e=this.content;if(e.is(".ui-resizable")){c.resizable("destroy")}e.html("");var d=a("<ul />").addClass("codiqa-control ui-listview").appendTo(e);if(!h.label_theme){h.label_theme="c"}if(h.label){d.html('<li data-role="list-divider"><a>'+h.label+"</a></li>")}var g=a("<li />").addClass("ui-li ui-li-divider ui-bar-"+h.label_theme+" ui-first-child").html(h.label).appendTo(d);a.each(h.selectItems||[],function(j,i){button_li=a("<li class='ui-btn ui-btn-icon-right ui-li-has-arrow ui-li' />").appendTo(d);a('<div class="ui-btn-inner ui-li" />').html('<div class="ui-btn-text"><a class="ui-link-inherit" >'+this.label+'</a></div><span class="ui-icon ui-icon-arrow-r ui-icon-shadow"> </span>').appendTo(button_li);if(j==h.selectItems.length-1){button_li.addClass("ui-last-child")}if(h.isInset){d.addClass("ui-listview-inset ui-corner-all ui-shadow")}button_li.addClass("ui-btn-up-"+h.data_theme)})},destroy:function(){this.element.removeClass("an-listviewfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.customhtmlfield",a.an.field,{_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-customhtmlfield")},_createControl:function(){var f=this,i=this.options,g=this.element;if(i.mobile){try{var d=this.element.find(".content").eq(0);var j="";j+=i.customhtml;d.html(j);this.element.context.lastElementChild.lastElementChild.className="customhtml";if(a(".customhtml").listview){a(".customhtml").listview()}}catch(h){}}},_createLabel:function(){this.element.find("label").remove()},_makeResizable:function(){},_browser:function(){},_edit:function(){},_design:function(){var d=this},destroy:function(){this.element.removeClass("an-customhtmlfield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function($,undefined){$.widget("an.mobilelistview",$.an.view,{options:{printable:false,pagerPosition:"bottom"},_create:function(){$.an.view.prototype._create.apply(this,arguments);var o=this.options,el=this.element;el.addClass("an-mobilelistbview");o.templateTemp=o.view.templateTemp;o.templateSelector=o.view.templateSelector;o.templateConverts=o.view.templateConverts;o.templateContent=o.view.templateContent;this.documents=$(o.templateContent).prependTo(el);if(o.templateTemp){o.templateTemp=$.templates(o.templateTemp)}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_showDocuments:function(){var self=this,o=this.options;if(o.templateTemp){var html=o.templateTemp.render(self.docs);$.ans.parseAttachments(html,function(data){$(o.templateSelector,this.documents).html(data)})}if($(o.templateSelector).listview){$(o.templateSelector).listview()}if(o.templateConverts&&typeof o.templateConverts=="string"){o.templateConverts=eval("("+o.templateConverts+")");$.views.converters(o.templateConverts)}},_docsLoaded:function(){this.refresh()},_design:function(){this._showDocuments()},_browser:function(){this._showDocuments();if($(this.options.templateSelector).listview){$(this.options.templateSelector).listview("refresh")}},save:function(){var value={};$.extend(this.options.view.options,value);return $.an.view.prototype.save.apply(this,arguments)},print:function(){var o=this.options,loc=window.location,url=loc.protocol+"//"+loc.host+"/pdfs?dbid="+o.dbId+"&viewid="+o.view._id;print(url)},destroy:function(){this.element.unbind(".formview").removeClass("an-formview show-pager");$.an.view.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(R){function F(aS,aP){function aL(e){return R.isArray(aN.readonly)?(e=R(".dwwl",aA).index(e),aN.readonly[e]):aN.readonly}function aR(t){var r='<div class="dw-bf">',t=aq[t],t=t.values?t:n(t),e=1,S=t.values,p=t.keys||S;R.each(S,function(T,U){0==e%20&&(r+='</div><div class="dw-bf">');r+='<div class="dw-li dw-v" data-val="'+p[T]+'" style="height:'+ak+"px;line-height:"+ak+'px;"><div class="dw-i">'+U+"</div></div>";e++});return r+="</div>"}function aO(e){h=R(".dw-li",e).index(R(".dw-v",e).eq(0));f=R(".dw-li",e).index(R(".dw-v",e).eq(-1));ag=R(".dw-ul",aA).index(e)}function ai(e){var p=aN.headerText;return p?"function"===typeof p?p.call(af,e):p.replace(/\{value\}/i,e):""}function am(){aM.temp=aw&&null!==aM.val&&aM.val!=aj.val()||null===aM.values?aN.parseValue(aj.val()||"",aM):aM.values.slice(0);ay()}function al(p){var e=window.getComputedStyle?getComputedStyle(p[0]):p[0].style,r;Q?(R.each(["t","webkitT","MozT","OT","msT"],function(t,S){if(void 0!==e[S+"ransform"]){return r=e[S+"ransform"],!1}}),r=r.split(")")[0].split(", "),p=r[13]||r[5]):p=e.top.replace("px","");return Math.round(i-p/ak)}function aQ(e,p){clearTimeout(an[p]);delete an[p];e.closest(".dwwl").removeClass("dwa")}function aJ(p,S,U,r,T){var e=(i-U)*ak,t=p[0].style;e==ap[S]&&an[S]||(r&&e!=ap[S]&&aK("onAnimStart",[aA,S,r]),ap[S]=e,t[g+"Transition"]="all "+(r?r.toFixed(3):0)+"s ease-out",Q?t[g+"Transform"]="translate3d(0,"+e+"px,0)":t.top=e+"px",an[S]&&aQ(p,S),r&&void 0!==T&&(p.closest(".dwwl").addClass("dwa"),an[S]=setTimeout(function(){aQ(p,S)},1000*r)),ax[S]=U)}function aE(r,e,S,p,t){!1!==aK("validate",[aA,e,r])&&(R(".dw-ul",aA).each(function(aa){var T=R(this),Y=R('.dw-li[data-val="'+aM.temp[aa]+'"]',T),Z=R(".dw-li",T),U=Z.index(Y),aV=Z.length,aU=aa==e||void 0===e;if(!Y.hasClass("dw-v")){for(var W=Y,V=0,X=0;0<=U-V&&!W.hasClass("dw-v");){V++,W=Z.eq(U-V)}for(;U+X<aV&&!Y.hasClass("dw-v");){X++,Y=Z.eq(U+X)}(X<V&&X&&2!==p||!V||0>U-V||1==p)&&Y.hasClass("dw-v")?U+=X:(Y=W,U-=V)}if(!Y.hasClass("dw-sel")||aU){aM.temp[aa]=Y.attr("data-val"),R(".dw-sel",T).removeClass("dw-sel"),Y.addClass("dw-sel"),aJ(T,aa,U,aU?r:0.1,aU?t:!1)}}),ab=aN.formatResult(aM.temp),"inline"==aN.display?ay(S,0,!0):R(".dwv",aA).html(ai(ab)),S&&aK("onChange",[ab]))}function aK(p,r){var e;r.push(aM);R.each([b.defaults,aB,aP],function(t,S){S[p]&&(e=S[p].apply(af,r))});return e}function aH(U,V,W,t,S){var V=Math.max(h,Math.min(V,f)),e=R(".dw-li",U).eq(V),p=void 0===S?V:S,r=ag,T=t?V==p?0.1:Math.abs((V-p)*aN.timeUnit):0;aM.temp[r]=e.attr("data-val");aJ(U,r,V,T,S);setTimeout(function(){aE(T,r,!0,W,S)},10)}function E(e){var p=ax[ag]+1;aH(e,p>f?h:p,1,!0)}function D(e){var p=ax[ag]-1;aH(e,p<h?f:p,2,!0)}function ay(p,r,t,e){s&&!t&&aE(r);ab=aN.formatResult(aM.temp);e||(aM.values=aM.temp.slice(0),aM.val=ab);p&&aw&&aj.val(ab).trigger("change")}var i,ak,ab,aA,z,ae,v,aT,ac,w,au,b,I,az,ao,aD,q,aI,u,a,h,f,ah,ag,at,B,aM=this,aG=R.mobiscroll,af=aS,aj=R(af),aN=j({},G),aB={},an={},ax={},ap={},aq=[],aw=aj.is("input"),s=!1,ar=function(e){d(e)&&!M&&!aL(this)&&!az&&(e.preventDefault(),M=!0,ao="clickpick"!=aN.mode,ah=R(".dw-ul",this),aO(ah),a=(aD=void 0!==an[ag])?al(ah):ax[ag],q=m(e,"Y"),aI=new Date,u=q,aJ(ah,ag,a,0.001),ao&&ah.closest(".dwwl").addClass("dwa"),R(document).bind(L,av).bind(k,ad))},av=function(e){ao&&(e.preventDefault(),e.stopPropagation(),u=m(e,"Y"),aJ(ah,ag,Math.max(h-1,Math.min(a+(q-u)/ak,f+1))));aD=!0},ad=function(){var t=new Date-aI,S=Math.max(h-1,Math.min(a+(q-u)/ak,f+1)),e,p=ah.offset().top;300>t?(t=(u-q)/t,e=t*t/aN.speedUnit,0>u-q&&(e=-e)):e=u-q;t=Math.round(a-e/ak);if(!e&&!aD){var p=Math.floor((u-p)/ak),r=R(".dw-li",ah).eq(p);e=ao;!1!==aK("onValueTap",[r])?t=p:e=!0;e&&(r.addClass("dw-hl"),setTimeout(function(){r.removeClass("dw-hl")},200))}ao&&aH(ah,t,0,!0,Math.round(S));M=!1;ah=null;R(document).unbind(L,av).unbind(k,ad)},y=function(r){R(document).bind(k,aC);R(this).hasClass("dwb-d")||R(this).addClass("dwb-a");if(R(this).hasClass("dwwb")){var t=R(this).closest(".dwwl");if(d(r)&&!aL(t)&&!t.hasClass("dwa")){r.stopPropagation();r.preventDefault();az=!0;var e=t.find(".dw-ul"),p=R(this).hasClass("dwwbp")?E:D;aO(e);clearInterval(at);at=setInterval(function(){p(e)},aN.delay);p(e)}}},aC=function(){az&&(clearInterval(at),az=!1);R(document).unbind(k,aC);R(".dwb-a",aA).removeClass("dwb-a")},aF=function(e){if(!aL(this)){e.preventDefault();var e=e.originalEvent,e=e.wheelDelta?e.wheelDelta/120:e.detail?-e.detail/3:0,p=R(".dw-ul",this);aO(p);aH(p,Math.round(ax[ag]-e),0>e?1:2)}};aM.position=function(X){if(!("inline"==aN.display||z===R(window).width()&&v===R(window).height()&&X||!1===aK("onPosition",[aA]))){var Y,Z,S,V,e,p,t,W,aa,aU=0,U=0,X=R(window).scrollTop();V=R(".dwwr",aA);var T=R(".dw",aA),r={};e=void 0===aN.anchor?aj:aN.anchor;z=R(window).width();v=R(window).height();ae=(ae=window.innerHeight)||v;/modal|bubble/.test(aN.display)&&(R(".dwc",aA).each(function(){Y=R(this).outerWidth(!0);aU+=Y;U=Y>U?Y:U}),Y=aU>z?U:aU,V.width(Y).css("white-space",aU>z?"":"nowrap"));aT=T.outerWidth();ac=T.outerHeight(!0);"modal"==aN.display?(Z=(z-aT)/2,S=X+(ae-ac)/2):"bubble"==aN.display?(aa=!0,W=R(".dw-arrw-i",aA),Z=e.offset(),p=Z.top,t=Z.left,V=e.outerWidth(),e=e.outerHeight(),Z=t-(T.outerWidth(!0)-V)/2,Z=Z>z-aT?z-(aT+20):Z,Z=0<=Z?Z:20,S=p-ac,S<X||p>X+ae?(T.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),S=p+e):T.removeClass("dw-bubble-bottom").addClass("dw-bubble-top"),W=W.outerWidth(),V=t+V/2-(Z+(aT-W)/2),R(".dw-arr",aA).css({left:Math.max(0,Math.min(V,W))})):(r.width="100%","top"==aN.display?S=X:"bottom"==aN.display&&(S=X+ae-ac));r.top=0>S?0:S;r.left=Z;T.css(r);R(".dw-persp",aA).height(0).height(S+ac>R(document).height()?S+ac:R(document).height());aa&&(S+ac>X+ae||p>X+ae)&&R(window).scrollTop(S+ac-ae)}};aM.enable=function(){aN.disabled=!1;aw&&aj.prop("disabled",!1)};aM.disable=function(){aN.disabled=!0;aw&&aj.prop("disabled",!0)};aM.setValue=function(r,e,t,p){aM.temp=R.isArray(r)?r.slice(0):aN.parseValue.call(af,r+"",aM);ay(e,t,!1,p)};aM.getValue=function(){return aM.values};aM.getValues=function(){var e=[],p;for(p in aM._selectedValues){e.push(aM._selectedValues[p])}return e};aM.changeWheel=function(e,t){if(aA){var p=0,r=e.length;R.each(aN.wheels,function(S,T){R.each(T,function(U,V){if(-1<R.inArray(p,e)&&(aq[p]=V,R(".dw-ul",aA).eq(p).html(aR(p)),r--,!r)){return aM.position(),aE(t,void 0,!0),!1}p++});if(!r){return !1}})}};aM.isVisible=function(){return s};aM.tap=function(p,r){var e,t;aN.tap&&p.bind("touchstart",function(S){S.preventDefault();e=m(S,"X");t=m(S,"Y")}).bind("touchend",function(S){20>Math.abs(m(S,"X")-e)&&20>Math.abs(m(S,"Y")-t)&&r.call(this,S);C=!0;setTimeout(function(){C=!1},300)});p.bind("click",function(S){C||r.call(this,S)})};aM.show=function(e){if(aN.disabled||s){return !1}"top"==aN.display&&(w="slidedown");"bottom"==aN.display&&(w="slideup");am();aK("onBeforeShow",[]);var t=0,p="";w&&!e&&(p="dw-"+w+" dw-in");var r='<div class="'+aN.theme+" dw-"+aN.display+(l?" dw"+l:"")+'">'+("inline"==aN.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dw-persp"><div class="dwo"></div><div class="dw dwbg '+p+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div><div class="dwwr">'+(aN.headerText?'<div class="dwv"></div>':""))+'<div class="dwcc">';R.each(aN.wheels,function(S,T){r+='<div class="dwc'+("scroller"!=aN.mode?" dwpm":" dwsc")+(aN.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>';R.each(T,function(V,U){aq[t]=U;r+='<td><div class="dwwl dwrc dwwl'+t+'">'+("scroller"!=aN.mode?'<div class="dwb-e dwwb dwwbp" style="height:'+ak+"px;line-height:"+ak+'px;"><span>+</span></div><div class="dwb-e dwwb dwwbm" style="height:'+ak+"px;line-height:"+ak+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+(U.label||V)+'</div><div class="dwww"><div class="dww" style="height:'+aN.rows*ak+"px;min-width:"+aN.width+'px;"><div class="dw-ul">';r+=aR(t);r+='</div><div class="dwwol"></div></div><div class="dwwo"></div></div><div class="dwwol"></div></div></td>';t++});r+="</tr></table></div></div>"});r+="</div>"+("inline"!=aN.display?'<div class="dwbc'+(aN.button3?" dwbc-p":"")+'"><span class="dwbw dwb-s"><span class="dwb dwb-e">'+aN.setText+"</span></span>"+(aN.button3?'<span class="dwbw dwb-n"><span class="dwb dwb-e">'+aN.button3Text+"</span></span>":"")+'<span class="dwbw dwb-c"><span class="dwb dwb-e">'+aN.cancelText+"</span></span></div></div>":"")+"</div></div></div>";aA=R(r);aE();aK("onMarkupReady",[aA]);"inline"!=aN.display?(aA.appendTo("body"),w&&!e&&(aA.addClass("dw-trans"),setTimeout(function(){aA.removeClass("dw-trans").find(".dw").removeClass(p)},350))):aj.is("div")?aj.html(aA):aA.insertAfter(aj);aK("onMarkupInserted",[aA]);s=!0;b.init(aA,aM);"inline"!=aN.display&&(aM.tap(R(".dwb-s span",aA),function(){if(aM.hide(false,"set")!==false){ay(true,0,true);aK("onSelect",[aM.val])}}),aM.tap(R(".dwb-c span",aA),function(){aM.cancel()}),aN.button3&&aM.tap(R(".dwb-n span",aA),aN.button3),aN.scrollLock&&aA.bind("touchmove",function(S){ac<=ae&&aT<=z&&S.preventDefault()}),R("input,select,button").each(function(){this.disabled||R(this).addClass("dwtd").prop("disabled",true).data("autocomplete",R(this).attr("autocomplete")).attr("autocomplete","off")}),aM.position(),R(window).bind("orientationchange.dw resize.dw",function(){clearTimeout(au);au=setTimeout(function(){aM.position(true)},100)}));aA.delegate(".dwwl","DOMMouseScroll mousewheel",aF).delegate(".dwb-e",A,y).delegate(".dwwl",A,ar);aK("onShow",[aA,ab])};aM.hide=function(p,e){if(!s||!1===aK("onClose",[ab,e])){return !1}R(".dwtd").each(function(){R(this).prop("disabled",!1).removeClass("dwtd");R(this).data("autocomplete")?R(this).attr("autocomplete",R(this).data("autocomplete")):R(this).removeAttr("autocomplete")});aj.blur();aA&&("inline"!=aN.display&&w&&!p?(aA.addClass("dw-trans").find(".dw").addClass("dw-"+w+" dw-out"),setTimeout(function(){aA.remove();aA=null},350)):(aA.remove(),aA=null),s=!1,ap={},R(window).unbind(".dw"))};aM.cancel=function(){!1!==aM.hide(!1,"cancel")&&aK("onCancel",[aM.val])};aM.init=function(e){b=j({defaults:{},init:N},aG.themes[e.theme||aN.theme]);I=aG.i18n[e.lang||aN.lang];j(aP,e);j(aN,b.defaults,I,aP);aM.settings=aN;aj.unbind(".dw");if(e=aG.presets[aN.preset]){aB=e.call(af,aM),j(aN,aB,aP)}i=Math.floor(aN.rows/2);ak=aN.height;w=aN.animate;s&&aM.hide();"inline"==aN.display?aM.show():(am(),aw&&aN.showOnFocus&&(void 0===B&&(B=af.readOnly),af.readOnly=!0,aj.bind("focus.dw",function(){aM.show()})))};aM.trigger=function(e,p){return aK(e,p)};aM.option=function(p,r){var e={};"object"===typeof p?e=p:e[p]=r;aM.init(e)};aM.destroy=function(){aM.hide();aj.unbind(".dw");delete H[af.id];aw&&(af.readOnly=B)};aM.getInst=function(){return aM};aM.values=null;aM.val=null;aM.temp=null;aM._selectedValues={};aM.init(aP)}function O(f){for(var e in f){if(void 0!==K[f[e]]){return !0}}return !1}function d(b){if("touchstart"===b.type){J=!0}else{if(J){return J=!1}}return !0}function m(f,e){var i=f.originalEvent,h=f.changedTouches;return h||i&&i.changedTouches?i?i.changedTouches[0]["page"+e]:h[0]["page"+e]:f["page"+e]}function n(a){var e={values:[],keys:[]};R.each(a,function(b,f){e.keys.push(b);e.values.push(f)});return e}function P(f,e,i){var h=f;if("object"===typeof e){return f.each(function(){this.id||(x+=1,this.id="mobiscroll"+x);H[this.id]=new F(this,e)})}"string"===typeof e&&f.each(function(){var b;if((b=H[this.id])&&b[e]){if(b=b[e].apply(this,Array.prototype.slice.call(i,1)),void 0!==b){return h=b,!1}}});return h}var M,C,J,x=(new Date).getTime(),H={},N=function(){},K=document.createElement("modernizr").style,Q=O(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),l=function(){var f=["Webkit","Moz","O","ms"],e;for(e in f){if(O([f[e]+"Transform"])){return"-"+f[e].toLowerCase()}}return""}(),g=l.replace(/^\-/,"").replace("moz","Moz"),j=R.extend,A="touchstart mousedown",L="touchmove mousemove",k="touchend mouseup",G={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",lang:"en-US",setText:"Set",cancelText:"Cancel",scrollLock:!0,tap:!0,speedUnit:0.0012,timeUnit:0.1,formatResult:function(b){return b.join(" ")},parseValue:function(a,q){var p=a.split(" "),i=[],e=0,h;R.each(q.settings.wheels,function(f,r){R.each(r,function(s,t){t=t.values?t:n(t);h=t.keys||t.values;-1!==R.inArray(p[e],h)?i.push(p[e]):i.push(h[0]);e++})});return i}};R(document).bind("mouseover mouseup mousedown click",function(b){if(C){return b.stopPropagation(),b.preventDefault(),!1}});R.fn.mobiscroll=function(a){j(this,R.mobiscroll.shorts);return P(this,a,arguments)};R.mobiscroll=R.mobiscroll||{setDefaults:function(b){j(G,b)},presetShort:function(b){this.shorts[b]=function(a){return P(this,j(a,{preset:b}),arguments)}},shorts:{},presets:{},themes:{},i18n:{}};R.scroller=R.scroller||R.mobiscroll;R.fn.scroller=R.fn.scroller||R.fn.mobiscroll})(jQuery);(function(b){b.mobiscroll.i18n.hu=b.extend(b.mobiscroll.i18n.hu,{setText:"OK",cancelText:"M\u00e9gse",dateFormat:"dd.mm.yy",dateOrder:"ddmmyy",dayNames:"Vas\u00e1rnap,H\u00e9tf\u0151,Kedd,Szerda,Cs\u00fct\u00f6rt\u00f6k,P\u00e9ntek,Szombat".split(","),dayNamesShort:"Va,H\u00e9,Ke,Sze,Cs\u00fc,P\u00e9,Szo".split(","),dayText:"Nap",hourText:"\u00d3ra",minuteText:"Perc",monthNames:"Janu\u00e1r,Febru\u00e1r,M\u00e1rcius,\u00c1prilis,M\u00e1jus,J\u00fanius,J\u00falius,Augusztus,Szeptember,Okt\u00f3ber,November,December".split(","),monthNamesShort:"Jan,Feb,M\u00e1r,\u00c1pr,M\u00e1j,J\u00fan,J\u00fal,Aug,Szep,Okt,Nov,Dec".split(","),monthText:"H\u00f3nap",secText:"M\u00e1sodperc",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"\u00c9v",nowText:"Most",dateText:"D\u00e1tum",timeText:"Id\u0151",calendarText:"Napt\u00e1r",wholeText:"Eg\u00e9sz",fractionText:"T\u00f6rt",unitText:"Egys\u00e9g",labels:"\u00c9v,H\u00f3nap,Nap,\u00d3ra,Perc,M\u00e1sodperc,".split(","),labelsShort:"\u00c9v,H\u00f3.,Nap,\u00d3ra,Perc,Mp.,".split(","),startText:"Ind\u00edt",stopText:"Meg\u00e1ll\u00edt",resetText:"Vissza\u00e1ll\u00edt",lapText:"Lap",hideText:"Elrejt"})})(jQuery);(function(b){b.mobiscroll.i18n.de=b.extend(b.mobiscroll.i18n.de,{setText:"OK",cancelText:"Abbrechen",dateFormat:"dd.mm.yy",dateOrder:"ddmmyy",dayNames:"Sonntag,Montag,Dienstag,Mittwoch,Donnerstag,Freitag,Samstag".split(","),dayNamesShort:"So,Mo,Di,Mi,Do,Fr,Sa".split(","),dayText:"Tag",hourText:"Stunde",minuteText:"Minuten",monthNames:"Januar,Februar,M\u00e4rz,April,Mai,Juni,Juli,August,September,Oktober,November,Dezember".split(","),monthNamesShort:"Jan,Feb,M\u00e4r,Apr,Mai,Jun,Jul,Aug,Sep,Okt,Nov,Dez".split(","),monthText:"Monat",secText:"Sekunden",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Jahr",nowText:"Jetzt",dateText:"Datum",timeText:"Zeit",calendarText:"Kalender",wholeText:"Ganze Zahl",fractionText:"Bruchzahl",unitText:"Ma\u00dfeinheit",labels:"Jahre,Monate,Tage,Stunden,Minuten,Sekunden,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Start",stopText:"Stop",resetText:"Reset",lapText:"Lap",hideText:"Hide"})})(jQuery);(function(b){b.mobiscroll.i18n.es=b.extend(b.mobiscroll.i18n.es,{setText:"Aceptar",cancelText:"Cancelar",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"Domingo,Lunes,Martes,Mi&#xE9;rcoles,Jueves,Viernes,S&#xE1;bado".split(","),dayNamesShort:"Do,Lu,Ma,Mi,Ju,Vi,S&#xE1;".split(","),dayText:"D&#237;a",hourText:"Horas",minuteText:"Minutos",monthNames:"Enero,Febrero,Marzo,Abril,Mayo,Junio,Julio,Agosto,Septiembre,Octubre,Noviembre,Diciembre".split(","),monthNamesShort:"Ene,Feb,Mar,Abr,May,Jun,Jul,Ago,Sep,Oct,Nov,Dic".split(","),monthText:"Mes",secText:"Segundos",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"A&ntilde;o",nowText:"Ahora",dateText:"Fecha",timeText:"Tiempo",calendarText:"Calendario",wholeText:"Entero",fractionText:"Fracci\u00f3n",unitText:"Unidad",labels:"A\u00f1os,Meses,D\u00edas,Horas,Minutos,Segundos,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Iniciar",stopText:"Det\u00e9ngase",resetText:"Reinicializar",lapText:"Lap",hideText:"Esconder"})})(jQuery);(function(b){b.mobiscroll.i18n.fr=b.extend(b.mobiscroll.i18n.fr,{setText:"Termin\u00e9",cancelText:"Annuler",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"&#68;imanche,Lundi,Mardi,Mercredi,Jeudi,Vendredi,Samedi".split(","),dayNamesShort:"&#68;im.,Lun.,Mar.,Mer.,Jeu.,Ven.,Sam.".split(","),dayText:"Jour",monthText:"Mois",monthNames:"Janvier,F\u00e9vrier,Mars,Avril,Mai,Juin,Juillet,Ao\u00fbt,Septembre,Octobre,Novembre,D\u00e9cembre".split(","),monthNamesShort:"Janv.,F\u00e9vr.,Mars,Avril,Mai,Juin,Juil.,Ao\u00fbt,Sept.,Oct.,Nov.,D\u00e9c.".split(","),hourText:"Heures",minuteText:"Minutes",secText:"Secondes",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Ann\u00e9e",nowText:"Maintenant",dateText:"Date",timeText:"Heure",calendarText:"Calendrier",wholeText:"Entier",fractionText:"Fraction",unitText:"Unit\u00e9",labels:"Ans,Mois,Jours,Heures,Minutes,Secondes,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Ind\u00edt",stopText:"Meg\u00e1ll\u00edt",resetText:"Vissza\u00e1ll\u00edt",lapText:"Lap",hideText:"Elrejt"})})(jQuery);(function(b){b.mobiscroll.i18n.it=b.extend(b.mobiscroll.i18n.it,{setText:"OK",cancelText:"Annulla",dateFormat:"dd-mm-yyyy",dateOrder:"ddmmyy",dayNames:"Domenica,Luned&Igrave;,Merted&Igrave;,Mercoled&Igrave;,Gioved&Igrave;,Venerd&Igrave;,Sabato".split(","),dayNamesShort:"Do,Lu,Ma,Me,Gi,Ve,Sa".split(","),dayText:"Giorno",hourText:"Ore",minuteText:"Minuti",monthNames:"Gennaio,Febbraio,Marzo,Aprile,Maggio,Giugno,Luglio,Agosto,Settembre,Ottobre,Novembre,Dicembre".split(","),monthNamesShort:"Gen,Feb,Mar,Apr,Mag,Giu,Lug,Ago,Set,Ott,Nov,Dic".split(","),monthText:"Mese",secText:"Secondi",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Anno",dateText:"Data",timeText:"Volta",calendarText:"Calendario",wholeText:"Intero",fractionText:"Frazione",unitText:"Unit\u00e0",labels:"Anni,Mesi,Giorni,Ore,Minuti,Secondi,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Inizio",stopText:"Arresto",resetText:"Ripristina",lapText:"Lap",hideText:"Nascondi"})})(jQuery);(function(b){b.mobiscroll.i18n.no=b.extend(b.mobiscroll.i18n.no,{setText:"OK",cancelText:"Avbryt",dateFormat:"dd.mm.yy",dateOrder:"ddmmyy",dayNames:"S\u00f8ndag,Mandag,Tirsdag,Onsdag,Torsdag,Fredag,L\u00f8rdag".split(","),dayNamesShort:"S\u00f8,Ma,Ti,On,To,Fr,L\u00f8".split(","),dayText:"Dag",hourText:"Time",minuteText:"Minutt",monthNames:"Januar,Februar,Mars,April,Mai,Juni,Juli,August,September,Oktober,November,Desember".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,Mai,Jun,Jul,Aug,Sep,Okt,Nov,Des".split(","),monthText:"M\u00e5ned",secText:"Sekund",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"\u00c5r",nowText:"N\u00e5",dateText:"Dato",timeText:"Tid",calendarText:"Kalender",wholeText:"Hele",fractionText:"Fraksjon",unitText:"Enhet",labels:"\u00c5r,M\u00e5neder,Dager,Timer,Minutter,Sekunder,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Start",stopText:"Stopp",resetText:"Tilbakestille",lapText:"Runde",hideText:"Skjul"})})(jQuery);(function(b){b.mobiscroll.i18n["pt-BR"]=b.extend(b.mobiscroll.i18n["pt-BR"],{setText:"Selecionar",cancelText:"Cancelar",dateFormat:"dd/mm/yy",dateOrder:"ddMMyy",dayNames:"Domingo,Segunda-feira,Ter\u00e7a-feira,Quarta-feira,Quinta-feira,Sexta-feira,S\u00e1bado".split(","),dayNamesShort:"Dom,Seg,Ter,Qua,Qui,Sex,S\u00e1b".split(","),dayText:"Dia",hourText:"Hora",minuteText:"Minutos",monthNames:"Janeiro,Fevereiro,Mar\u00e7o,Abril,Maio,Junho,Julho,Agosto,Setembro,Outubro,Novembro,Dezembro".split(","),monthNamesShort:"Jan,Fev,Mar,Abr,Mai,Jun,Jul,Ago,Set,Out,Nov,Dez".split(","),monthText:"M\u00eas",secText:"Segundo",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"Ano",dateText:"Data",timeText:"Tempo",calendarText:"Calend\u00e1rio",wholeText:"Inteiro",fractionText:"Fra\u00e7\u00e3o",unitText:"Unidade",labels:"Anos,Meses,Dias,Horas,Minutos,Segundos,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Come\u00e7ar",stopText:"Pare",resetText:"Reinicializar",lapText:"Lap",hideText:"Esconder"})})(jQuery);(function(b){b.mobiscroll.i18n.zh=b.extend(b.mobiscroll.i18n.zh,{setText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"\u5468\u65e5,\u5468\u4e00,\u5468\u4e8c,\u5468\u4e09,\u5468\u56db,\u5468\u4e94,\u5468\u516d".split(","),dayNamesShort:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),dayText:"\u65e5",hourText:"\u65f6",minuteText:"\u5206",monthNames:"1\u6708,2\u6708,3\u6708,4\u6708,5\u6708,6\u6708,7\u6708,8\u6708,9\u6708,10\u6708,11\u6708,12\u6708".split(","),monthNamesShort:"\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d,\u4e03,\u516b,\u4e5d,\u5341,\u5341\u4e00,\u5341\u4e8c".split(","),monthText:"\u6708",secText:"\u79d2",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"\u5e74",nowText:"\u5f53\u524d",dateText:"\u65e5",timeText:"\u65f6\u95f4",calendarText:"\u65e5\u5386",wholeText:"Whole",fractionText:"Fraction",unitText:"Unit",labels:"Years,Months,Days,Hours,Minutes,Seconds,".split(","),labelsShort:"Yrs,Mths,Days,Hrs,Mins,Secs,".split(","),startText:"Start",stopText:"Stop",resetText:"Reset",lapText:"Lap",hideText:"Hide"})})(jQuery);(function(b){b.mobiscroll.i18n.nl=b.extend(b.mobiscroll.i18n.nl,{setText:"Instellen",cancelText:"Annuleer",dateFormat:"dd/mm/yy",dateOrder:"ddmmyy",dayNames:"Zondag,Maandag,Dinsdag,Woensdag,Donderdag,Vrijdag,Zaterdag".split(","),dayNamesShort:"Zo,Ma,Di,Wo,Do,Vr,Za".split(","),dayText:"Dag",hourText:"Uur",minuteText:"Minuten",monthNames:"Januari,Februari,Maart,April,Mei,Juni,Juli,Augustus,September,Oktober,November,December".split(","),monthNamesShort:"Jan,Feb,Mrt,Apr,Mei,Jun,Jul,Aug,Sep,Okt,Nov,Dec".split(","),monthText:"Maand",secText:"Seconden",timeFormat:"hh:ii A",timeWheels:"hhiiA",yearText:"Jaar",nowText:"Nu",dateText:"Datum",timeText:"Tijd",calendarText:"Kalender",wholeText:"geheel",fractionText:"fractie",unitText:"eenheid",labels:"Jaren,Maanden,Dagen,Uren,Minuten,Seconden,".split(","),labelsShort:"j,m,d,u,min,sec,".split(","),startText:"Start",stopText:"Stop",resetText:"Reset",lapText:"Lap",hideText:"Verbergen"})})(jQuery);(function(b){var f=b.mobiscroll,g=new Date,h={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:g.getFullYear()-100,endYear:g.getFullYear()+1,monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),dayNamesShort:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",nowText:"Now",showNow:!1,stepHour:1,stepMinute:1,stepSecond:1,separator:" "},d=function(ae){function ag(i,j,e){return void 0!==Y[j]?+i[Y[j]]:void 0!==e?e:X[ac[j]]?X[ac[j]]():ac[j](X)}function ab(i,j,e,l){i.push({values:e,keys:j,label:l})}function M(e,i){return Math.floor(e/i)*i}function U(e){var i=ag(e,"h",0);return new Date(ag(e,"y"),ag(e,"m"),ag(e,"d",1),ag(e,"a")?i+12:i,ag(e,"i",0),ag(e,"s",0))}var L=b(this),Q={},ad;if(L.is("input")){switch(L.attr("type")){case"date":ad="yy-mm-dd";break;case"datetime":ad="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":ad="yy-mm-ddTHH:ii:ss";break;case"month":ad="yy-mm";Q.dateOrder="mmyy";break;case"time":ad="HH:ii:ss"}var V=L.attr("min"),L=L.attr("max");V&&(Q.minDate=f.parseDate(ad,V));L&&(Q.maxDate=f.parseDate(ad,L))}var ah,H,E,K,O,V=b.extend({},ae.settings),aa=b.extend(ae.settings,h,Q,V),G=0,L=[],P=[],Y={},ac={y:"getFullYear",m:"getMonth",d:"getDate",h:function(e){e=e.getHours();e=I&&12<=e?e-12:e;return M(e,z)},i:function(e){return M(e.getMinutes(),a)},s:function(e){return M(e.getSeconds(),k)},a:function(e){return T&&11<e.getHours()?1:0}},W=aa.preset,af=aa.dateOrder,Z=aa.timeWheels,C=af.match(/D/),T=Z.match(/a/i),I=Z.match(/h/),x="datetime"==W?aa.dateFormat+aa.separator+aa.timeFormat:"time"==W?aa.timeFormat:aa.dateFormat,X=new Date,z=aa.stepHour,a=aa.stepMinute,k=aa.stepSecond,r=aa.minDate||new Date(aa.startYear,0,1),m=aa.maxDate||new Date(aa.endYear,11,31,23,59,59);ad=ad||x;if(W.match(/date/i)){b.each(["y","m","d"],function(e,i){ah=af.search(RegExp(i,"i"));-1<ah&&P.push({o:ah,v:i})});P.sort(function(e,i){return e.o>i.o?1:-1});b.each(P,function(e,i){Y[i.v]=e});V=[];for(Q=0;3>Q;Q++){if(Q==Y.y){G++;E=[];H=[];K=r.getFullYear();O=m.getFullYear();for(ah=K;ah<=O;ah++){H.push(ah),E.push(af.match(/yy/i)?ah:(ah+"").substr(2,2))}ab(V,H,E,aa.yearText)}else{if(Q==Y.m){G++;E=[];H=[];for(ah=0;12>ah;ah++){K=af.replace(/[dy]/gi,"").replace(/mm/,9>ah?"0"+(ah+1):ah+1).replace(/m/,ah+1),H.push(ah),E.push(K.match(/MM/)?K.replace(/MM/,'<span class="dw-mon">'+aa.monthNames[ah]+"</span>"):K.replace(/M/,'<span class="dw-mon">'+aa.monthNamesShort[ah]+"</span>"))}ab(V,H,E,aa.monthText)}else{if(Q==Y.d){G++;E=[];H=[];for(ah=1;32>ah;ah++){H.push(ah),E.push(af.match(/dd/i)&&10>ah?"0"+ah:ah)}ab(V,H,E,aa.dayText)}}}}L.push(V)}if(W.match(/time/i)){P=[];b.each(["h","i","s","a"],function(e,i){e=Z.search(RegExp(i,"i"));-1<e&&P.push({o:e,v:i})});P.sort(function(e,i){return e.o>i.o?1:-1});b.each(P,function(e,i){Y[i.v]=G+e});V=[];for(Q=G;Q<G+4;Q++){if(Q==Y.h){G++;E=[];H=[];for(ah=0;ah<(I?12:24);ah+=z){H.push(ah),E.push(I&&0==ah?12:Z.match(/hh/i)&&10>ah?"0"+ah:ah)}ab(V,H,E,aa.hourText)}else{if(Q==Y.i){G++;E=[];H=[];for(ah=0;60>ah;ah+=a){H.push(ah),E.push(Z.match(/ii/)&&10>ah?"0"+ah:ah)}ab(V,H,E,aa.minuteText)}else{if(Q==Y.s){G++;E=[];H=[];for(ah=0;60>ah;ah+=k){H.push(ah),E.push(Z.match(/ss/)&&10>ah?"0"+ah:ah)}ab(V,H,E,aa.secText)}else{Q==Y.a&&(G++,H=Z.match(/A/),ab(V,[0,1],H?["AM","PM"]:["am","pm"],aa.ampmText))}}}}L.push(V)}ae.setDate=function(i,n,e,p){for(var l in Y){ae.temp[Y[l]]=i[ac[l]]?i[ac[l]]():ac[l](i)}ae.setValue(ae.temp,n,e,p)};ae.getDate=function(e){return U(e?ae.temp:ae.values)};return{button3Text:aa.showNow?aa.nowText:void 0,button3:aa.showNow?function(){ae.setDate(new Date,!1,0.3,!0)}:void 0,wheels:L,headerText:function(){return f.formatDate(x,U(ae.temp),aa)},formatResult:function(e){return f.formatDate(ad,U(e),aa)},parseValue:function(i){var n=new Date,e,p=[];try{n=f.parseDate(ad,i,aa)}catch(l){}for(e in Y){p[Y[e]]=n[ac[e]]?n[ac[e]]():ac[e](n)}return p},validate:function(i){var l=ae.temp,e={y:r.getFullYear(),m:0,d:1,h:0,i:0,s:0,a:0},q={y:m.getFullYear(),m:11,d:31,h:M(I?11:23,z),i:M(59,a),s:M(59,k),a:1},s=!0,p=!0;b.each("y,m,d,a,h,i,s".split(","),function(al,J){if(Y[J]!==void 0){var A=e[J],n=q[J],B=31,R=ag(l,J),ai=b(".dw-ul",i).eq(Y[J]),an,ak;if(J=="d"){an=ag(l,"y");ak=ag(l,"m");n=B=32-(new Date(an,ak,32)).getDate();C&&b(".dw-li",ai).each(function(){var t=b(this),v=t.data("val"),u=(new Date(an,ak,v)).getDay(),v=af.replace(/[my]/gi,"").replace(/dd/,v<10?"0"+v:v).replace(/d/,v);b(".dw-i",t).html(v.match(/DD/)?v.replace(/DD/,'<span class="dw-day">'+aa.dayNames[u]+"</span>"):v.replace(/D/,'<span class="dw-day">'+aa.dayNamesShort[u]+"</span>"))})}s&&r&&(A=r[ac[J]]?r[ac[J]]():ac[J](r));p&&m&&(n=m[ac[J]]?m[ac[J]]():ac[J](m));if(J!="y"){var aj=b(".dw-li",ai).index(b('.dw-li[data-val="'+A+'"]',ai)),j=b(".dw-li",ai).index(b('.dw-li[data-val="'+n+'"]',ai));b(".dw-li",ai).removeClass("dw-v").slice(aj,j+1).addClass("dw-v");J=="d"&&b(".dw-li",ai).removeClass("dw-h").slice(B).addClass("dw-h")}R<A&&(R=A);R>n&&(R=n);s&&(s=R==A);p&&(p=R==n);if(aa.invalid&&J=="d"){var S=[];aa.invalid.dates&&b.each(aa.invalid.dates,function(t,u){u.getFullYear()==an&&u.getMonth()==ak&&S.push(u.getDate()-1)});if(aa.invalid.daysOfWeek){var am=(new Date(an,ak,1)).getDay(),D;b.each(aa.invalid.daysOfWeek,function(t,u){for(D=u-am;D<B;D=D+7){D>=0&&S.push(D)}})}aa.invalid.daysOfMonth&&b.each(aa.invalid.daysOfMonth,function(t,u){u=(u+"").split("/");u[1]?u[0]-1==ak&&S.push(u[1]-1):S.push(u[0]-1)});b.each(S,function(u,t){b(".dw-li",ai).eq(t).removeClass("dw-v")})}l[Y[J]]=R}})}}};b.each(["date","time","datetime"],function(e,i){f.presets[i]=d;f.presetShort(i)});f.formatDate=function(m,n,k){if(!n){return null}var k=b.extend({},h,k),v=function(p){for(var e=0;a+1<m.length&&m.charAt(a+1)==p;){e++,a++}return e},i=function(p,e,q){e=""+e;if(v(p)){for(;e.length<q;){e="0"+e}}return e},u=function(q,p,t,s){return v(q)?s[p]:t[p]},a,l="",j=!1;for(a=0;a<m.length;a++){if(j){"'"==m.charAt(a)&&!v("'")?j=!1:l+=m.charAt(a)}else{switch(m.charAt(a)){case"d":l+=i("d",n.getDate(),2);break;case"D":l+=u("D",n.getDay(),k.dayNamesShort,k.dayNames);break;case"o":l+=i("o",(n.getTime()-(new Date(n.getFullYear(),0,0)).getTime())/86400000,3);break;case"m":l+=i("m",n.getMonth()+1,2);break;case"M":l+=u("M",n.getMonth(),k.monthNamesShort,k.monthNames);break;case"y":l+=v("y")?n.getFullYear():(10>n.getYear()%100?"0":"")+n.getYear()%100;break;case"h":var r=n.getHours(),l=l+i("h",12<r?r-12:0==r?12:r,2);break;case"H":l+=i("H",n.getHours(),2);break;case"i":l+=i("i",n.getMinutes(),2);break;case"s":l+=i("s",n.getSeconds(),2);break;case"a":l+=11<n.getHours()?"pm":"am";break;case"A":l+=11<n.getHours()?"PM":"AM";break;case"'":v("'")?l+="'":j=!0;break;default:l+=m.charAt(a)}}}return l};f.parseDate=function(J,K,H){var n=new Date;if(!J||!K){return n}var K="object"==typeof K?K.toString():K+"",C=b.extend({},h,H),m=C.shortYearCutoff,H=n.getFullYear(),A=n.getMonth()+1,I=n.getDate(),E=-1,L=n.getHours(),n=n.getMinutes(),j=0,k=-1,y=!1,x=function(e){(e=F+1<J.length&&J.charAt(F+1)==e)&&F++;return e},G=function(e){x(e);e=K.substr(z).match(RegExp("^\\d{1,"+("@"==e?14:"!"==e?20:"y"==e?4:"o"==e?3:2)+"}"));if(!e){return 0}z+=e[0].length;return parseInt(e[0],10)},a=function(i,e,l){i=x(i)?l:e;for(e=0;e<i.length;e++){if(K.substr(z,i[e].length).toLowerCase()==i[e].toLowerCase()){return z+=i[e].length,e+1}}return 0},z=0,F;for(F=0;F<J.length;F++){if(y){"'"==J.charAt(F)&&!x("'")?y=!1:z++}else{switch(J.charAt(F)){case"d":I=G("d");break;case"D":a("D",C.dayNamesShort,C.dayNames);break;case"o":E=G("o");break;case"m":A=G("m");break;case"M":A=a("M",C.monthNamesShort,C.monthNames);break;case"y":H=G("y");break;case"H":L=G("H");break;case"h":L=G("h");break;case"i":n=G("i");break;case"s":j=G("s");break;case"a":k=a("a",["am","pm"],["am","pm"])-1;break;case"A":k=a("A",["am","pm"],["am","pm"])-1;break;case"'":x("'")?z++:y=!0;break;default:z++}}}100>H&&(H+=(new Date).getFullYear()-(new Date).getFullYear()%100+(H<=("string"!=typeof m?m:(new Date).getFullYear()%100+parseInt(m,10))?0:-100));if(-1<E){A=1;I=E;do{C=32-(new Date(H,A-1,32)).getDate();if(I<=C){break}A++;I-=C}while(1)}L=new Date(H,A-1,I,-1==k?L:k&&12>L?L+12:!k&&12==L?0:L,n,j);if(L.getFullYear()!=H||L.getMonth()+1!=A||L.getDate()!=I){throw"Invalid date"}return L}})(jQuery);(function(b){var d=b.mobiscroll,f={invalid:[],showInput:!0,inputClass:""},g=function(m){function E(r,i,q,h){for(var p=0;p<i;){var s=b(".dwwl"+p,r),l=P(h,p,q);b.each(l,function(t,n){b('.dw-li[data-val="'+n+'"]',s).removeClass("dw-v")});p++}}function P(i,h,s){for(var q=0,p,r=[];q<h;){var l=i[q];for(p in s){if(s[p].key==l){s=s[p].children;break}}q++}for(q=0;q<s.length;){s[q].invalid&&r.push(s[q].key),q++}return r}function M(i,h){for(var l=[];i;){l[--i]=!0}l[h]=!1;return l}function A(B,z,y){var w=0,v,r,u=[],t=F;if(z){for(v=0;v<z;v++){u[v]=[{}]}}for(;w<B.length;){v=u;for(var z=w,s=t,l={keys:[],values:[],label:K[w]},p=0;p<s.length;){l.values.push(s[p].value),l.keys.push(s[p].key),p++}v[z]=[l];v=0;for(z=void 0;v<t.length&&void 0===z;){if(t[v].key==B[w]&&(void 0!==y&&w<=y||void 0===y)){z=v}v++}if(void 0!==z&&t[z].children){w++,t=t[z].children}else{if((r=H(t))&&r.children){w++,t=r.children}else{break}}}return u}function H(i,h){if(!i){return !1}for(var n=0,l;n<i.length;){if(!(l=i[n++]).invalid){return h?n-1:l}}return !1}function x(h,i){b(".dwc",h).css("display","").slice(i).hide()}function G(l,i){var u=[],s=F,r=0,t=!1,q,p;if(void 0!==l[r]&&r<=i){t=0;q=l[r];for(p=void 0;t<s.length&&void 0===p;){s[t].key==l[r]&&!s[t].invalid&&(p=t),t++}}else{p=H(s,!0),q=s[p].key}t=void 0!==p?s[p].children:!1;for(u[r]=q;t;){s=s[p].children;r++;if(void 0!==l[r]&&r<=i){t=0;q=l[r];for(p=void 0;t<s.length&&void 0===p;){s[t].key==l[r]&&!s[t].invalid&&(p=t),t++}}else{p=H(s,!0),p=!1===p?void 0:p,q=s[p].key}t=void 0!==p&&H(s[p].children)?s[p].children:!1;u[r]=q}return{lvl:r+1,nVector:u}}function O(h){var i=[];C=C>L++?C:L;h.children("li").each(function(l){var q=b(this),p=q.clone();p.children("ul,ol").remove();var p=p.html().replace(/^\s\s*/,"").replace(/\s\s*$/,""),r=q.data("invalid")?!0:!1,l={key:q.data("val")||l,value:p,invalid:r,children:null},q=q.children("ul,ol");q.length&&(l.children=O(q));i.push(l)});L--;return i}var I=b.extend({},m.settings),Q=b.extend(m.settings,f,I),I=b(this),k,e,a=this.id+"_dummy",C=0,L=0,j={},F=Q.wheelArray||O(I),K=function(h){var l=[],i;for(i=0;i<h;i++){l[i]=Q.labels&&Q.labels[i]?Q.labels[i]:i}return l}(C),N=[],J=function(i){for(var h=[],p,n=!0,l=0;n;){if(p=H(i),h[l++]=p.key,n=p.children){i=p.children}}return h}(F),J=A(J,C);b("#"+a).remove();Q.showInput&&(k=b('<input type="text" id="'+a+'" value="" class="'+Q.inputClass+'" readonly />').insertBefore(I),m.settings.anchor=k,Q.showOnFocus&&k.focus(function(){m.show()}));Q.wheelArray||I.hide().closest(".ui-field-contain").trigger("create");return{width:50,wheels:J,headerText:!1,onBeforeShow:function(){var h=m.temp;N=h.slice(0);m.settings.wheels=A(h,C,C);e=true},onSelect:function(h){k&&k.val(h)},onChange:function(h){k&&Q.display=="inline"&&k.val(h)},onClose:function(){k&&k.blur()},onShow:function(h){b(".dwwl",h).bind("mousedown touchstart",function(){clearTimeout(j[b(".dwwl",h).index(this)])})},validate:function(l,h,t){var r=m.temp;if(h!==void 0&&N[h]!=r[h]||h===void 0&&!e){m.settings.wheels=A(r,null,h);var q=[],s=(h||0)+1,p=G(r,h);if(h!==void 0){m.temp=p.nVector.slice(0)}for(;s<p.lvl;){q.push(s++)}x(l,p.lvl);N=m.temp.slice(0);if(q.length){e=true;m.settings.readonly=M(C,h);clearTimeout(j[h]);j[h]=setTimeout(function(){m.changeWheel(q);m.settings.readonly=false},t*1000);return false}E(l,p.lvl,F,m.temp)}else{p=G(r,r.length);E(l,p.lvl,F,r);x(l,p.lvl)}e=false}}};b.each(["list","image","treelist"],function(h,i){d.presets[i]=g;d.presetShort(i)})})(jQuery);(function(b){var d={inputClass:"",invalid:[],rtl:!1,group:!1,groupLabel:"Groups"};b.mobiscroll.presetShort("select");b.mobiscroll.presets.select=function(Q){function a(){var h,q=0,p=[],l=[],i=[[]];R.group?(R.rtl&&(q=1),b("optgroup",N).each(function(e){p.push(b(this).attr("label"));l.push(e)}),i[q]=[{values:p,keys:l,label:n}],h=A,q+=R.rtl?-1:1):h=N;p=[];l=[];b("option",h).each(function(){var e=b(this).attr("value");p.push(b(this).text());l.push(e);b(this).prop("disabled")&&j.push(e)});i[q]=[{values:p,keys:l,label:n}];return i}function r(h,e){var p=[];if(C){var l=[],i=0;for(i in Q._selectedValues){l.push(F[i]),p.push(i)}L.val(l.join(", "))}else{L.val(h),p=e?Q.values[m]:null}e&&(K=!0,N.val(p).trigger("change"))}var x=b.extend({},Q.settings),R=b.extend(Q.settings,d,x),N=b(this),C=N.prop("multiple"),x=this.id+"_dummy",J=C?N.val()?N.val()[0]:b("option",N).attr("value"):N.val(),A=N.find('option[value="'+J+'"]').parent(),H=A.index()+"",P=H,K;b('label[for="'+this.id+'"]').attr("for",x);var S=b('label[for="'+x+'"]'),n=void 0!==R.label?R.label:S.length?S.text():N.attr("name"),j=[],k=[],F={},M,m,G,L,O=R.readonly;R.group&&!b("optgroup",N).length&&(R.group=!1);R.invalid.length||(R.invalid=j);R.group?R.rtl?(M=1,m=0):(M=0,m=1):(M=-1,m=0);b("#"+x).remove();L=b('<input type="text" id="'+x+'" class="'+R.inputClass+'" readonly />').insertBefore(N);b("option",N).each(function(){F[b(this).attr("value")]=b(this).text()});R.showOnFocus&&L.focus(function(){Q.show()});x=N.val()||[];S=0;for(S;S<x.length;S++){Q._selectedValues[x[S]]=x[S]}r(F[J]);N.unbind(".dwsel").bind("change.dwsel",function(){K||Q.setValue(C?N.val()||[]:[N.val()],true);K=false}).hide().closest(".ui-field-contain").trigger("create");Q._setValue||(Q._setValue=Q.setValue);Q.setValue=function(e,s,p,h,q){var f=b.isArray(e)?e[0]:e;J=f!==void 0?f:b("option",N).attr("value");if(C){Q._selectedValues={};f=0;for(f;f<e.length;f++){Q._selectedValues[e[f]]=e[f]}}if(R.group){A=N.find('option[value="'+J+'"]').parent();P=A.index();e=R.rtl?[J,A.index()]:[A.index(),J];if(P!==H){R.wheels=a();Q.changeWheel([m]);H=P+""}}else{e=[J]}Q._setValue(e,s,p,h,q);if(s){s=C?true:J!==N.val();r(F[J],s)}};Q.getValue=function(e){return(e?Q.temp:Q.values)[m]};return{width:50,wheels:void 0,headerText:!1,multiple:C,anchor:L,formatResult:function(e){return F[e[m]]},parseValue:function(){var e=N.val()||[],f=0;if(C){Q._selectedValues={};for(f;f<e.length;f++){Q._selectedValues[e[f]]=e[f]}}J=C?N.val()?N.val()[0]:b("option",N).attr("value"):N.val();A=N.find('option[value="'+J+'"]').parent();P=A.index();H=P+"";return R.group&&R.rtl?[J,P]:R.group?[P,J]:[J]},validate:function(e,p,g){if(p===void 0&&C){var f=Q._selectedValues,i=0;b(".dwwl"+m+" .dw-li",e).removeClass("dw-msel");for(i in f){b(".dwwl"+m+' .dw-li[data-val="'+f[i]+'"]',e).addClass("dw-msel")}}if(p===M){P=Q.temp[M];if(P!==H){A=N.find("optgroup").eq(P);P=A.index();J=(J=A.find("option").eq(0).val())||N.val();R.wheels=a();if(R.group){Q.temp=R.rtl?[J,P]:[P,J];R.readonly=[R.rtl,!R.rtl];clearTimeout(G);G=setTimeout(function(){Q.changeWheel([m]);R.readonly=O;H=P+""},g*1000);return false}}else{R.readonly=O}}else{J=Q.temp[m]}var h=b(".dw-ul",e).eq(m);b.each(R.invalid,function(l,q){b('.dw-li[data-val="'+q+'"]',h).removeClass("dw-v")})},onBeforeShow:function(){R.wheels=a();if(R.group){Q.temp=R.rtl?[J,A.index()]:[A.index(),J]}},onMarkupReady:function(e){b(".dwwl"+M,e).bind("mousedown touchstart",function(){clearTimeout(G)});if(C){e.addClass("dwms");b(".dwwl",e).eq(m).addClass("dwwms");k={};for(var f in Q._selectedValues){k[f]=Q._selectedValues[f]}}},onValueTap:function(f){if(C&&f.hasClass("dw-v")&&f.closest(".dw").find(".dw-ul").index(f.closest(".dw-ul"))==m){var e=f.attr("data-val");f.hasClass("dw-msel")?delete Q._selectedValues[e]:Q._selectedValues[e]=e;f.toggleClass("dw-msel");R.display=="inline"&&r(e,true);return false}},onSelect:function(e){r(e,true);if(R.group){Q.values=null}},onCancel:function(){if(R.group){Q.values=null}if(C){Q._selectedValues={};for(var e in k){Q._selectedValues[e]=k[e]}}},onChange:function(e){if(R.display=="inline"&&!C){L.val(e);K=true;N.val(Q.temp[m]).trigger("change")}},onClose:function(){L.blur()}}}})(jQuery);(function(b){b.mobiscroll.themes.android={defaults:{dateOrder:"Mddyy",mode:"clickpick",height:50,showLabel:!1}}})(jQuery);(function(b){var d={defaults:{dateOrder:"Mddyy",mode:"mixed",rows:5,width:70,height:36,showLabel:!1,useShortLabels:!0}};b.mobiscroll.themes["android-ics"]=d;b.mobiscroll.themes["android-ics light"]=d})(jQuery);(function(b){b.mobiscroll.themes.ios={defaults:{dateOrder:"MMdyy",rows:5,height:30,width:55,headerText:!1,showLabel:!1,useShortLabels:!0}}})(jQuery);(function(b){b.mobiscroll.themes.jqm={defaults:{jqmBorder:"a",jqmBody:"c",jqmHeader:"b",jqmWheel:"d",jqmClickPick:"c",jqmSet:"b",jqmCancel:"c"},init:function(a,d){var f=d.settings;b(".dw",a).removeClass("dwbg").addClass("ui-overlay-shadow ui-corner-all ui-body-"+f.jqmBorder);b(".dwb-s span",a).attr("data-role","button").attr("data-theme",f.jqmSet);b(".dwb-n span",a).attr("data-role","button").attr("data-theme",f.jqmCancel);b(".dwb-c span",a).attr("data-role","button").attr("data-theme",f.jqmCancel);b(".dwwb",a).attr("data-role","button").attr("data-theme",f.jqmClickPick);b(".dwv",a).addClass("ui-header ui-bar-"+f.jqmHeader);b(".dwwr",a).addClass("ui-body-"+f.jqmBody);b(".dwpm .dwwl",a).addClass("ui-body-"+f.jqmWheel);b(".dwpm .dwl",a).addClass("ui-body-"+f.jqmBody);a.trigger("create");b(".dwo",a).click(function(){d.cancel()})}}})(jQuery);(function(b){var d;b.mobiscroll.themes.wp={defaults:{width:70,height:76,accent:"none",dateOrder:"mmMMddDDyy",showLabel:!1,onAnimStart:function(f,g,a){b(".dwwl"+g,f).addClass("wpam");clearTimeout(d[g]);d[g]=setTimeout(function(){b(".dwwl"+g,f).removeClass("wpam")},1000*a+100)}},init:function(g,h){var a,f;d={};b(".dw",g).addClass("wp-"+h.settings.accent);b(".dwwl",g).delegate(".dw-sel","touchstart mousedown DOMMouseScroll mousewheel",function(){a=!0;f=b(this).closest(".dwwl").hasClass("wpa");b(".dwwl",g).removeClass("wpa");b(this).closest(".dwwl").addClass("wpa")}).bind("touchmove mousemove",function(){a=!1}).bind("touchend mouseup",function(){a&&f&&b(this).closest(".dwwl").removeClass("wpa")})}};b.mobiscroll.themes["wp light"]=b.mobiscroll.themes.wp})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.mobiledatefield",a.an.inputfield,{options:{theme:"jqm",lang:"en",display:"bottom",mode:"scroller",dateFormat:"yy-mm-dd",dateOrder:"yy mmD dd",dateOrder:"yymmdd",minDate:"",maxDate:"",},_create:function(){a.an.inputfield.prototype._create.apply(this,arguments);this.element.addClass("an-mobiledatetimefield")},_edit:function(){var h,j,d=this,i=this.options;var f=new Date(),e=window.database.local,g={theme:i.theme,lang:i.lang,display:i.display,mode:i.mode,dateFormat:i.dateFormat,dateOrder:i.dateOrder,};h=i.minDate=="now"?f:new Date(i.minDate);h.toString()!="Invalid Date"&&(g.minDate=h);j=i.maxDate=="now"?f:new Date(i.maxDate);j.toString()!="Invalid Date"&&(g.maxDate=j);a.an.inputfield.prototype._edit.apply(this,arguments);g.onSelect=function(k){d.input.trigger("keyup")};this.input.mobiscroll().date(g)},destroy:function(){this.input.mobiscroll&&this.input.mobiscroll("destroy");this.input.removeAttr("readony");this.element.removeClass("an-mobiledatetimefield");return a.an.inputfield.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.swipewidget",a.an.widget,{options:{swipeContent:"<li>no content</li>",swipeIcon:'<b class="swipe-icon-active"></b>',swipeindex:0,swipeContent:"<li>no content</li>",swipeduration:false,swipeduration:2000,width:"100"},_create:function(){a.an.widget.prototype._create.apply(this,arguments);var h=this.options;if(h.mobile){var e=this;this.element.addClass("an-swipewidget");var g=a('<div class="swipeBox"></div>'),d=a('<ul class="swipeList c"></ul>'),f=a('<div class="iconList"></div>');d.append(h.swipeContent);d.find("li").each(function(j){var k="<b></b>";if(j==h.swipeindex){k='<b class="swipe-icon-active"></b>'}f.append(a(k))});d.width(h.width*d.find("li").length+"%");d.find("li").width(h.width/d.find("li").length+"%");g.append(d).append(f).appendTo(this.element.find(".content"));e.pos={};var i=e.pos;i.t=null;i.index=h.swipeindex;i.itemLen=d.find("li").length;i.itemWidth=d.find("li").eq(0).outerWidth(true);this.element.bind("touchstart.swipewidget",function(j){var j=j.originalEvent.touches[0];i.x=j.pageX;i.y=j.pageY;i.dx=0;i.dy=0;i.Left=d.offset().left;i.target=j.target.tagName.toLowerCase()=="li"?j.target:a(j.target).closest("li");i.index=d.find("li").index(a(i.target));i.itemWidth=a(i.target).outerWidth(true);clearTimeout(i.t);i.t=null});this.element.bind("touchmove.swipewidget",function(j){j.preventDefault();var j=j.originalEvent.touches[0];i.dx=j.pageX-i.x;i.dy=j.pageY-i.y;d.css({left:parseInt(i.dx+i.Left)+"px"})});this.element.bind("touchend.swipewidget",function(l){var j=0,k=0;if(i.index==0&&i.dx>0){j=0;k=0}else{if(i.index==i.itemLen-1&&i.dx<0){j=-i.itemWidth*i.index;k=i.index}else{if(Math.abs(i.dx)>=i.itemWidth/2){if(i.dx>0){j=-i.itemWidth*(i.index-1);k=i.index-1}else{if(i.dx<0){j=-i.itemWidth*(i.index+1);k=i.index+1}}}else{j=-i.itemWidth*(i.index);k=i.index}}}e._setActive(d,j,k);if(h.autoSwipe&&h.mode!="design"){i.t=setTimeout(function(){e.autoRun(d,j,k)},h.swipeduration)}})}},_setActive:function(g,d,f){var e=this;g.css({left:-f*100+"%"});setTimeout(function(){e.element.find(".iconList b").eq(f).addClass("swipe-icon-active").siblings().removeClass("swipe-icon-active")},100)},autoRun:function(g,d,f){var e=this,h=this.options,i=this.pos;if(f<=0||f>(i.itemLen-1)){f=0}d=-i.itemWidth*f;e._setActive(g,d,f);f++;i.index++;i.t=setTimeout(function(){e.autoRun(g,d,f)},h.swipeduration)},_browser:function(){var d=this.options;if(d.autoSwipe){this.autoRun(this.element.find(".swipeList"),0,0)}},_edit:function(){var d=this.options;if(d.autoSwipe){this.autoRun(this.element.find(".swipeList"),0,0)}},_design:function(){var d=this.options},destroy:function(){this.element.removeClass("an-swipewidget");this.element.unbind("swipewidget");this.content.remove();return a.an.widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.loading",{options:{trans:"0.6",fullscreen:false,msg:""},_create:function(){var e=this.options,d=this;this.wrap=a('<div class="loading" style="width:100%;height:100%;position:absolute;left:0;top:0;z-index:9997;vertical-align:middle;"><div style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:9998;background:#fff;"></div></div>');this.wrap.children().eq(0).css("opacity",e.trans);this.wrap.append(a('<span style="background:url(images/large-loading.gif) center center no-repeat;width:32px;height:32px;position:absolute;left:49%;top:49%;z-index:9999;padding-top:32px;">'+e.msg+"</span>"));if(!e.fullscreen){this.oldPos=this.element.css("postion");this.element.css("postion","relatvie").append(this.wrap)}else{this.wrap.css("position","fixed").appendTo(a("body"))}},open:function(){this.wrap&&this.wrap.show()},close:function(){this.wrap&&this.wrap.hide()},destroy:function(){if(this.oldPos){this.element.css("postion",this.oldPos)}this.wrap&&this.wrap.remove();delete this.pager;a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
/*
 * Agile Notes 1.0
 *
 * Copyright 2013, Sihong Zhu and other contributors
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) version 2 licenses.
* This software is not distributed under version 3 or later of the GPL.
 *
 * http://agilemore.com/agilenotes
 */
(function(a,b){a.widget("an.rtefield",a.an.field,{options:{showToolbar:true},_create:function(){a.an.field.prototype._create.apply(this,arguments);this.element.addClass("an-rtefield");var d=this,e=this.options;this.content.bind("change.rtefield",function(h){h.preventDefault();var g=d.content.rte("option","content"),f=e.value;if(g!=f){e.value=g;d._trigger("optionchanged",null,{key:"value",value:g,oldValue:f,isTransient:e.isTransient})}})},_browser:function(){this.content.rte("destroy").html(this.options.value);this.content.find(".widget[type=tabsx]").each(function(){var d=a(this);if(d.is(".an-tabsxwidget")){d.data("tabsxwidget").option("mode","browser")}else{d.tabsxwidget({parent:function(){return self},mode:"browser"})}})},_edit:function(){var d=this.options;this.content.rte({content:d.value,dbId:d.dbId,showToolbar:d.showToolbar,stylesheet:d.stylesheet,cssClass:d.cssClass,resizable:d.resizable,cssfiles:["stylesheets/rte/rte-design.css","stylesheets/jquery-ui-1.8.24.custom.css","stylesheets/base.css"].concat(d.globalCSSFiles).concat(d.localCSSFiles),jsfiles:[].concat(d.globalJSFiles).concat(d.localJSFiles)})},_design:function(){this._browser()},destroy:function(){this.content.rte("destroy");this.element.removeClass("an-rtefield");return a.an.field.prototype.destroy.apply(this,arguments)}})})(jQuery);